# @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ ----
# ::  Misc  ::                                                                                                   ----
# @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ ----
DescriptionsStyle <- "
padding-left: 35px;
padding-right: 30px;
font-size: inherit;"

ExecuteStyle <- "
padding-left: 0px;
padding-right: 0px;
background-color: #000000d4;
margin-top: 29px;
height: 85px;
width: 85px;
box-shadow: 0px 0px 25px white;
border-radius: 50px;
"

ModelHelpFormat <- "padding-left: 25px; padding-right: 25px"

#' @title Logo
#'
#' @param id id
#' @param Logo character
#'
#' @export
Logo <- function(id = "Logo", Day = FALSE) {
  ns <- shiny::NS(id)
  if(length(Day) == 0L) Day <- FALSE
  if(Day) {
    Logo <- "Logo.PNG"
  } else {
    Logo <- "LogoWhite.PNG"
  }

  if(!Day) {
    LogoStyle <- "max-width: 98.5%; height: auto; max-height: 143px; padding-left: 0px; padding-right: 0px; border-radius: 30px; padding-bottom: 0px; box-shadow: 0px 0px 0px 0px #7bc1ff;"
    LogoBoxStyle <- "padding-left: 15px; padding-right: 16px; border-radius: 30px; margin-right:0px; min-height: 168px;"
  } else {
    LogoStyle <- "max-width: 98.5%; height: auto; max-height: 143px; padding-left: 0px; padding-right: 0px; border-radius: 30px; padding-bottom: 0px; box-shadow: 0px 0px 0px 0px #7bc1ff;"
    LogoBoxStyle <- "padding-left: 15px; padding-right: 16px; border-radius: 30px; margin-right:0px; min-height: 168px; "
  }

  shiny::tagList(
    shiny::column(
      12L, align = "center", style="padding-left: 15px;",
      shiny::fluidRow(
        shiny::tags$img(
          src = Logo,
          style = LogoStyle,
          alt = "Quantico",
          `data-view-component` = "true")
      )
    )
  )
}

# ----

# ----

# @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ ----
# ::  Data Management  ::                                                                                        ----
# @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ ----

#' @title Local_Modal_Fun
#'
#' @description Local Environment
#'
#' @author Adrian Antico
#' @family DM
#'
#' @param id = 'SessionDMID'
#' @param AppWidth = 12L
#'
#' @export
Session_Modal_Fun <- function(id,
                              AppWidth=12L,

                              # Statics
                              LoadSessionName_Choices = NULL,
                              LoadSession_IncludeData_Choices = NULL,
                              SaveSession_IncludeData_Choices = NULL,

                              # Updaters
                              LoadSessionName_Selected = NULL,
                              SaveSessionName_Selected = NULL,
                              LoadSession_IncludeData_Selected = NULL,
                              SaveSession_IncludeData_Selected = NULL) {
  shiny::moduleServer(
    id = id,
    module = function(input, output, session) {
      ns <- session$ns
      shiny::showModal(
        shiny::modalDialog(
          title = 'Sessions: save where you are at or load up from where you left off',
          size = "l",
          easyClose = FALSE,
          fade = TRUE,
          shiny::tagList(

            Quantico:::BlankRow(12L),

            # Tabs
            shiny::tabsetPanel(
              id = 'Session_TabPanel',
              selected = 'Session Import and Export',

              # Session State: Import and Export: fits on one tab nicely
              shiny::tabPanel(
                title = "Session Import and Export",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shinydashboard::box(
                    title = NULL, solidHeader = TRUE, collapsible = FALSE, status = 'danger', width = 12L,
                    Quantico:::BlankRow(12L),

                    shiny::fluidRow(
                      shiny::column(width = 1L),
                      shiny::column(
                        width = 4L, align = 'center',
                        Quantico::SelectizeInput(InputID = 'LoadSessionName', Label = 'Load Session Name', Choices = LoadSessionName_Choices, SelectedDefault = LoadSessionName_Selected)),
                      shiny::column(width = 2L),
                      shiny::column(
                        width = 4L, align = 'center',
                        Quantico::TextInput(InputID = 'SaveSessionName', Label = 'Save Session Name', Value = SaveSessionName_Selected))),

                    Quantico:::BlankRow(12L),

                    shiny::fluidRow(
                      shiny::column(width = 1L),
                      shiny::column(
                        width = 4L, align = 'center',
                        Quantico::SelectizeInput(InputID = 'LoadSession_IncludeData', Label = 'Include Data?', Choices = LoadSession_IncludeData_Choices, SelectedDefault = LoadSession_IncludeData_Selected)),
                      shiny::column(width = 2L),
                      shiny::column(
                        width = 4L, align = 'center',
                        Quantico::SelectizeInput(InputID = 'SaveSession_IncludeData', Label = 'Include Data?', Choices = SaveSession_IncludeData_Choices, SelectedDefault = SaveSession_IncludeData_Selected))),

                    Quantico:::BlankRow(12L),
                    Quantico:::BlankRow(12L),

                    shiny::fluidRow(
                      shiny::column(width = 1L),
                      shiny::column(
                        width = 4L, align = 'center',
                        shiny::actionButton(
                          inputId = 'LoadSessionButton',
                          label = 'Load Session')),
                      shiny::column(width = 2L),
                      shiny::column(
                        width = 4L, align = 'center',
                        shiny::actionButton(
                          inputId = 'SaveSessionButton',
                          label = 'Save Session'))), # fluid Row

                    Quantico:::BlankRow(12L)

                  ) # box
                ) # fluidRow
              ) # tabPanel
            ) # tabsetPanel
          ), # tagList

          footer = shiny::tagList(
            shiny::modalButton(label = "Cancel"),
            shiny::actionButton("Session_OK", "OK", width = '50px'))))
    })
}

#' @title Local_Modal_Fun
#'
#' @description Local Environment
#'
#' @author Adrian Antico
#' @family DM
#'
#' @param id = 'LocalDMID'
#' @param AppWidth = 12L
#'
#' @export
Local_Modal_Fun <- function(id,
                            AppWidth=12L,

                            # Statics
                            SaveData_SelectData_Choices = NULL,
                            ExportFileType_Choices = NULL,
                            SaveData_SelectDataRdata_Choices = NULL,

                            # Updaters
                            SaveData_SelectData_Selected = NULL,
                            SaveFileName_Selected = NULL,
                            ExportFileType_Selected = NULL,
                            SaveData_SelectDataRdata_Selected = NULL,
                            SaveFileNameRdata_Selected = NULL) {

  shiny::moduleServer(
    id = id,
    module = function(input, output, session) {
      ns <- session$ns
      shiny::showModal(
        shiny::modalDialog(
          title = 'Local Enviroment',
          size = "l",
          easyClose = FALSE,
          fade = TRUE,
          shiny::tagList(

            Quantico:::BlankRow(12L),

            # Tabs
            shiny::tabsetPanel(
              id = 'Local_TabPanel',
              selected = 'Local Import',

              # Local Data
              shiny::tabPanel(
                title = "Local Import",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shinydashboard::box(
                    title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                    Quantico:::BlankRow(12L),
                    tags$h4(tags$span(tags$b(paste0('Load a .csv, .txt, or .parquet, or model from a local file directory')))),
                    Quantico:::BlankRow(12L),
                    # shiny::fluidRow(
                    #   shiny::column(7L),
                    # #   shiny::column(
                    # #     width = 4L,
                    # #     align = 'center',
                    # #     tags$h4(tags$b('Local .csv, .txt, or .parquet data')),
                    # #     shiny::uiOutput('TabularData')),
                    # #   shiny::column(2L),
                    #   shiny::column(
                    #     width = 4L,
                    #     align = 'center',
                    #     tags$h4(tags$b('Local Model Output')),
                    #     shiny::uiOutput('ModelObjectLoad'))),

                    # Blank space
                    Quantico:::BlankRow(12L),

                    # Load button
                    Quantico:::BlankRow(12L),
                    shiny::fluidRow(
                      shiny::column(width = 1L),
                      shiny::column(
                        width = 3L,
                        align = 'center',
                        shiny::fileInput("ImportLocalCSV", "Load .csv", accept = c('text/csv', 'text/comma-separated-values,text/plain'))
                      ),
                      shiny::column(width = 4L),
                      shiny::column(
                        width = 3L,
                        align = 'center',
                        shiny::fileInput(inputId = 'ImportLocalRdata', label = 'Load Model Output List (.rds)', accept = "rds")
                      )
                    ),

                    shiny::fluidRow(
                      shiny::column(width = 8L),
                      shiny::column(
                        width = 3L,
                        align = "center",
                        shiny::fileInput(inputId = 'ImportLightGBMModel', label = 'LightGBM Model Object', accept = "rds")),
                    ),

                    Quantico:::BlankRow(12L),
                    Quantico:::BlankRow(12L),
                    Quantico:::BlankRow(12L),
                    Quantico:::BlankRow(12L)
                  )
                )
              ),


              # Local Export
              shiny::tabPanel(
                title = "Local Export",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shinydashboard::box(
                    title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                    Quantico:::BlankRow(12L),
                    tags$h4(tags$span(tags$b(paste0('Export to Local Environment. Data will be downoaded to your downloads folder')))),
                    Quantico:::BlankRow(12L),
                    shiny::fluidRow(
                      shiny::column(width = 1L),
                      shiny::column(
                        width = 4L,
                        align = 'center',
                        Quantico:::SelectizeInput(InputID='SaveData_SelectData', Label='Choose data set', Choices = SaveData_SelectData_Choices, SelectedDefault = SaveData_SelectData_Selected)),
                      shiny::column(width = 1L),
                      shiny::column(
                        width = 4L,
                        align = 'center',
                        Quantico:::SelectizeInput(InputID='SaveData_SelectDataRdata', Label='Select Model', Choices = SaveData_SelectDataRdata_Choices, SelectedDefault = SaveData_SelectDataRdata_Selected, Multiple = FALSE, MaxVars = 1L)
                      )
                    ),

                    shiny::fluidRow(
                      shiny::column(width = 1L),
                      shiny::column(
                        width = 2L,
                        align = 'center',
                        Quantico:::TextInput(InputID = 'SaveFileName', Label='New Filename', Value = SaveFileName_Selected)),
                      shiny::column(
                        width = 2L,
                        align = 'center',
                        Quantico:::SelectizeInput(InputID = 'ExportFileType', Label='File Type', Choices = ExportFileType_Choices, SelectedDefault = ExportFileType_Selected, CloseAfterSelect = TRUE)),
                      # shiny::column(width = 1L),
                      # shiny::column(
                      #   width = 4L,
                      #   align = 'center',
                      #   Quantico:::TextInput(InputID = 'SaveFileNameRdata', Label='New Filename', Value = SaveFileNameRdata_Selected)
                      # )
                    ),

                    Quantico:::BlankRow(12L),
                    shiny::fluidRow(
                      shiny::column(width = 1L),
                      shiny::column(
                        width = 4L,
                        align = 'center',
                        shinyjs::useShinyjs(),
                        shiny::actionButton(
                          inputId = 'SaveLocalData',
                          label = 'Save Data',
                          icon = shiny::icon('chevron-right', lib='font-awesome'))),
                      shiny::column(width = 1L),
                      shiny::column(
                        width = 4L,
                        align = 'center',
                        shinyjs::useShinyjs(),
                        shiny::actionButton(
                          inputId = 'SaveLocalDataRdata',
                          label = 'Save Rdata',
                          icon = shiny::icon('chevron-right', lib='font-awesome')))),

                    Quantico:::BlankRow(12L),
                    Quantico:::BlankRow(12L),
                    Quantico:::BlankRow(12L),
                    Quantico:::BlankRow(12L))))

            ) # end Tab Panel Main
          ), # end TagList

          footer = shiny::tagList(
            shiny::modalButton(label = "Cancel"),
            shiny::actionButton("Local_OK", "OK", width = '50px'))))
    })
}

#' @title PostGRE_Modal_Fun
#'
#' @description PostGRE Environment
#'
#' @author Adrian Antico
#' @family DM
#'
#' @param id = 'PostGREDMID'
#' @param AppWidth = 12L
#'
#' @export
PostGRE_Modal_Fun <- function(id,
                              AppWidth=12L,

                              # Reactives
                              PostGRE_PullTable_Table_Selected = NULL,
                              PostGRE_PullTable_Columns_Selected = NULL,
                              PostGRE_PullTable_GroupByColumns_Selected = NULL,
                              PostGRE_DropTable_Table_Selected = NULL,

                              # Statics
                              PostGRE_PullTable_AggStat_Choices = NULL,
                              PostGRE_SamplePercent_Choices = NULL,
                              PostGRE_PullTable_DB_Choices = NULL,
                              PostGRE_DropTable_DB_Choices = NULL,
                              PostGRE_DropDB_DB_Choices = NULL,
                              SaveData_SelectDataPostGRE_Choices = NULL,
                              SaveData_DataBaseName_Choices_Choices = NULL,

                              # Updaters
                              PostGRE_PullTable_AggStat_Selected = NULL,
                              PostGRE_SamplePercent_Selected = NULL,
                              PostGRE_PullTable_DB_Selected = NULL,
                              PostGRE_DropTable_DB_Selected = NULL,
                              PostGRE_NewDB_DB_Selected = NULL,
                              PostGRE_DropDB_DB_Selected = NULL,
                              SaveData_SelectDataPostGRE_Selected = NULL,
                              SaveData_DataBaseName_Choices_Selected = NULL,
                              SaveData_TableName_Selected = NULL) {

  shiny::moduleServer(
    id = id,
    module = function(input, output, session) {
      ns <- session$ns
      shiny::showModal(
        shiny::modalDialog(
          title = 'PostGRE',
          size = "l",
          easyClose = FALSE,
          fade = TRUE,
          shiny::tagList(

            Quantico:::BlankRow(12L),

            # Tabs
            shiny::tabsetPanel(
              id = 'PostGRE_TabPanel',
              selected = 'Pull Table',

              # PostGRE Pull Table
              shiny::tabPanel(
                title = "Pull Table",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shinydashboard::box(
                    title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                    Quantico:::BlankRow(12L),
                    tags$h4(tags$span(tags$b(paste0('Pull a table down from a PostGRE database')))),
                    Quantico:::BlankRow(12L),
                    shiny::fluidRow(
                      shiny::column(width = 4L, align = 'center', Quantico:::SelectizeInput(InputID = 'PostGRE_PullTable_DB', Label = 'Select DB', Choices = PostGRE_PullTable_DB_Choices, SelectedDefault = PostGRE_PullTable_DB_Selected, Multiple = TRUE, MaxVars = 100)),
                      shiny::column(width = 4L, align = 'center', Quantico:::SelectizeInput(InputID = 'PostGRE_PullTable_Table', Label = 'Select Table', Choices = NULL, SelectedDefault = PostGRE_PullTable_Table_Selected, Multiple = TRUE, MaxVars = 1L)),
                      shiny::column(width = 4L, align = 'center', Quantico:::SelectizeInput(InputID = 'PostGRE_SamplePercent', Label = 'Random Sample %', Choices = PostGRE_SamplePercent_Choices, SelectedDefault = PostGRE_SamplePercent_Selected, Multiple = TRUE, MaxVars = 1L))),
                    Quantico:::BlankRow(12L),
                    Quantico:::BlankRow(12L),
                    shiny::fluidRow(
                      shiny::column(width = 4L, align = 'center', Quantico:::PickerInput(InputID = 'PostGRE_PullTable_Columns', Label = 'SELECT Columns', Choices = NULL, SelectedDefault = PostGRE_PullTable_Columns_Selected)),
                      shiny::column(width = 4L, align = 'center', Quantico:::SelectizeInput(InputID = 'PostGRE_PullTable_GroupByColumns', Label = 'GROUP BY Columns', Choices = NULL, SelectedDefault = PostGRE_PullTable_GroupByColumns_Selected, Multiple = TRUE, MaxVars = 100)),
                      shiny::column(width = 4L, align = 'center', Quantico:::SelectizeInput(InputID = 'PostGRE_PullTable_AggStat', Label = 'Aggregation Method', Choices = PostGRE_PullTable_AggStat_Choices, SelectedDefault = PostGRE_PullTable_AggStat_Selected, Multiple = TRUE, MaxVars = 1))),

                    # Row 3
                    Quantico:::BlankRow(12L),
                    Quantico:::BlankRow(12L),
                    shiny::fluidRow(
                      shiny::column(
                        width = 4L,
                        align = 'center',
                        shiny::actionButton(
                          inputId = 'PostGRE_PullTable',
                          label = 'Execute Query',
                          icon = shiny::icon('chevron-right', lib='font-awesome')))),

                    Quantico:::BlankRow(12L),
                    Quantico:::BlankRow(12L),
                    shiny::fluidRow(
                      shiny::column(
                        3L,
                        selectInput(
                          "editor_theme",
                          "Theme:",
                          choices = shinyAce::getAceThemes(),
                          selected = "cobalt"))),
                    shiny::fluidRow(
                      shiny::column(
                        8L,
                        shinyAce::aceEditor(
                          "sql_code",
                          mode = "sql",
                          wordWrap = TRUE,
                          theme = "cobalt",
                          height = "160px",
                          tabSize = 2,
                          minLines = 33,
                          fontSize = 14,
                          autoComplete = "live"))),

                    Quantico:::BlankRow(12L),
                    Quantico:::BlankRow(12L),
                    Quantico:::BlankRow(12L),
                    Quantico:::BlankRow(12L)))),

              # PostGRE Export Table
              shiny::tabPanel(
                title = "Export Table",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shinydashboard::box(
                    title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                    Quantico:::BlankRow(12L),
                    tags$h4(tags$span(tags$b(paste0('Push data to a PostGRE database')))),
                    Quantico:::BlankRow(12L),
                    shiny::fluidRow(
                      shiny::column(width = 1L, align = 'center'),
                      shiny::column(width = 4L, align = 'center', Quantico:::SelectizeInput(InputID='SaveData_SelectDataPostGRE', Label='Choose data set', Choices = SaveData_SelectDataPostGRE_Choices, SelectedDefault = SaveData_SelectDataPostGRE_Selected, Multiple = TRUE, MaxVars = 1))),
                    Quantico:::BlankRow(12L),
                    shiny::fluidRow(
                      shiny::column(width = 1L, align = 'center'),
                      shiny::column(width = 4L, align = 'center', Quantico:::SelectizeInput(InputID='SaveData_DataBaseName', Label='PostGRE Database Name', Choices = SaveData_DataBaseName_Choices_Choices, SelectedDefault = SaveData_DataBaseName_Choices_Selected, Multiple = TRUE, MaxVars = 1)),
                      shiny::column(width = 4L, align = 'center', Quantico:::TextInput(InputID='SaveData_TableName', Label='PostGRE Table Name', Value = SaveData_TableName_Selected))),

                    Quantico:::BlankRow(12L),
                    Quantico:::BlankRow(12L),

                    shiny::fluidRow(
                      shiny::column(width = 1L, align = 'center'),
                      shiny::column(
                        width = 4L,
                        align = 'center',
                        shinyjs::useShinyjs(),
                        shiny::actionButton(
                          inputId = 'PostGRE_Push',
                          label = 'PostGRE Push',
                          icon = shiny::icon('database', lib='font-awesome')))),

                    Quantico:::BlankRow(12L),
                    Quantico:::BlankRow(12L),
                    Quantico:::BlankRow(12L),
                    Quantico:::BlankRow(12L)))),


              # PostGRE Drop Table
              shiny::tabPanel(
                title = "Drop Table",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shinydashboard::box(
                    title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                    Quantico:::BlankRow(12L),
                    tags$h4(tags$span(tags$b(paste0('Drop a table from a PostGRE database')))),
                    Quantico:::BlankRow(12L),
                    shiny::fluidRow(
                      shiny::column(width = 1L, align = 'center'),
                      shiny::column(width = 4L, align = 'center', Quantico:::SelectizeInput(InputID = 'PostGRE_DropTable_DB', Label = 'Select DB', Choices = PostGRE_DropTable_DB_Choices, SelectedDefault = PostGRE_DropTable_DB_Selected, Multiple = TRUE, MaxVars = 1)),
                      shiny::column(width = 4L, align = 'center', Quantico:::PickerInput(InputID = 'PostGRE_DropTable_Table', Label = 'Select Tables', Choices = NULL, SelectedDefault = PostGRE_DropTable_Table_Selected))),

                    # Row 3
                    Quantico:::BlankRow(12L),
                    shiny::fluidRow(

                      # Drop Table
                      shiny::column(width = 1L, align = 'center'),
                      shiny::column(
                        width = 4L,
                        align = 'center',
                        shiny::actionButton(
                          inputId = 'PostGRE_DropTable',
                          label = 'Drop Table',
                          icon = shiny::icon('chevron-right', lib='font-awesome')))),

                    Quantico:::BlankRow(12L),
                    Quantico:::BlankRow(12L),
                    Quantico:::BlankRow(12L),
                    Quantico:::BlankRow(12L)))),

              # PostGRE Create Database
              shiny::tabPanel(
                title = "Create Database",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shinydashboard::box(
                    title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                    Quantico:::BlankRow(12L),
                    tags$h4(tags$span(tags$b(paste0('Create a database in the PostGRE warehouse')))),
                    Quantico:::BlankRow(12L),
                    shiny::fluidRow(
                      shiny::column(width = 1L, align = 'center'),
                      shiny::column(width = 4L, align = 'center', Quantico:::TextInput(InputID = 'PostGRE_NewDB_DB', Label = 'New DB Name', Value = PostGRE_NewDB_DB_Selected))),

                    # Row 3
                    Quantico:::BlankRow(12L),
                    shiny::fluidRow(

                      # Drop Table
                      shiny::column(width = 1L, align = 'center'),
                      shiny::column(
                        width = 4L,
                        align = 'center',
                        shiny::actionButton(
                          inputId = 'PostGRE_CreateDB',
                          label = 'Create DB',
                          icon = shiny::icon('chevron-right', lib='font-awesome')))),

                    Quantico:::BlankRow(12L),
                    Quantico:::BlankRow(12L),
                    Quantico:::BlankRow(12L),
                    Quantico:::BlankRow(12L)))),

              # PostGRE Remove Database
              shiny::tabPanel(
                title = "Remove Database",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shinydashboard::box(
                    title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                    Quantico:::BlankRow(12L),
                    tags$h4(tags$span(tags$b(paste0('Drop a database from the PostGRE warehouse')))),
                    Quantico:::BlankRow(12L),
                    shiny::fluidRow(
                      shiny::column(width = 1L, align = 'center'),
                      shiny::column(width = 4L, align = 'center', Quantico:::SelectizeInput(InputID = 'PostGRE_DropDB_DB', Label = 'Select DB', Choices = PostGRE_DropDB_DB_Choices, SelectedDefault = PostGRE_DropDB_DB_Selected, Multiple = TRUE, MaxVars = 1))),

                    # Row 3
                    Quantico:::BlankRow(12L),
                    shiny::fluidRow(

                      # Drop Table
                      shiny::column(width = 1L, align = 'center'),
                      shiny::column(
                        width = 4L,
                        align = 'center',
                        shiny::actionButton(
                          inputId = 'PostGRE_DropDB',
                          label = 'Remove Database',
                          icon = shiny::icon('chevron-right', lib='font-awesome')))),

                    Quantico:::BlankRow(12L),
                    Quantico:::BlankRow(12L),
                    Quantico:::BlankRow(12L),
                    Quantico:::BlankRow(12L))))

            ) # end Tab Panel Main
          ), # end TagList

          footer = shiny::tagList(
            shiny::modalButton(label = "Cancel"),
            shiny::actionButton("PostGRE_OK", "OK", width = '50px'))))
    })
}

#' @title AzureBlob_Modal_Fun
#'
#' @description AzureBlob Environment
#'
#' @author Adrian Antico
#' @family DM
#'
#' @param id = 'AzureBlobDMID'
#' @param AppWidth = 12L
#'
#' @export
AzureBlob_Modal_Fun <- function(id,
                                AppWidth=12L,

                                # Statics
                                AzureBlobStorageTabular_Choices = NULL,
                                AzureBlobStorageRdata_Choices = NULL,

                                # Updaters
                                AzureBlobStorageTabular_Selected = NULL,
                                AzureBlobStorageRdata_Selected = NULL) {

  shiny::moduleServer(
    id = id,
    module = function(input, output, session) {
      ns <- session$ns
      shiny::showModal(
        shiny::modalDialog(
          title = 'PostGRE',
          size = "l",
          easyClose = FALSE,
          fade = TRUE,
          shiny::tagList(

            Quantico:::BlankRow(12L),

            # Tabs
            shiny::tabsetPanel(
              id = 'AzureBlob_TabPanel',
              selected = 'AzureBlob Import',

              # AzureBlob Import
              shiny::tabPanel(
                title = "AzureBlob Import",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shinydashboard::box(
                    title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                    Quantico:::BlankRow(12L),
                    tags$h4(tags$span(tags$b(paste0('Import Azure')))),
                    Quantico:::BlankRow(12L),

                    shiny::fluidRow(
                      width = 12L,
                      shiny::column(1L, align = 'center'),
                      shiny::column(4L, align='center', Quantico:::SelectizeInput(InputID='AzureBlobStorageTabular', Label='Azure Blob .csv Files', Choices=AzureBlobStorageTabular_Choices, SelectedDefault = AzureBlobStorageTabular_Selected)),
                      shiny::column(2L, align = 'center'),
                      shiny::column(4L, align='center', Quantico:::SelectizeInput(InputID='AzureBlobStorageRdata', Label='Azure Blob .Rdata Files', Choices=AzureBlobStorageRdata_Choices, SelectedDefault = AzureBlobStorageRdata_Selected))),

                    # Add row
                    Quantico:::BlankRow(12L),

                    # Load button
                    Quantico:::BlankRow(12L),
                    shiny::fluidRow(
                      shiny::column(width = 1L),
                      shiny::column(
                        width = 3L,
                        align = 'center',
                        shiny::actionButton(
                          inputId = 'ImportAzureCSV',
                          label = 'Load CSV',
                          icon = shiny::icon('chevron-right', lib='font-awesome'))),
                      shiny::column(width = 4L),
                      shiny::column(
                        width = 3L,
                        align = 'center',
                        shiny::actionButton(
                          inputId = 'ImportAzureRdata',
                          label = 'Load Rdata',
                          icon = shiny::icon('chevron-right', lib='font-awesome'))),
                      shiny::column(width = 1L)),

                    Quantico:::BlankRow(12L),
                    Quantico:::BlankRow(12L),
                    Quantico:::BlankRow(12L),
                    Quantico:::BlankRow(12L)))),

              # AzureBlob Import
              shiny::tabPanel(
                title = "AzureBlob Export",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shinydashboard::box(
                    title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                    Quantico:::BlankRow(12L),
                    tags$h4(tags$span(tags$b(paste0('Export Azure')))),
                    Quantico:::BlankRow(12L),

                    # shiny::fluidRow(
                    #   width = 12L,
                    #   shiny::column(1L, align = 'center'),
                    #   shiny::column(4L, align='center', shiny::uiOutput('AzureBlobStorageTabular')),
                    #   shiny::column(2L, align = 'center'),
                    #   shiny::column(4L, align='center', shiny::uiOutput('AzureBlobStorageRdata'))),

                    # Add row
                    Quantico:::BlankRow(12L),

                    # Load button
                    Quantico:::BlankRow(12L),
                    # shiny::fluidRow(
                    #   shiny::column(width = 1L),
                    #   shiny::column(
                    #     width = 3L,
                    #     align = 'center',
                    #     shiny::actionButton(
                    #       inputId = 'ExportAzureCSV',
                    #       label = 'Load CSV',
                    #       icon = shiny::icon('chevron-right', lib='font-awesome')
                    #       style = 'gradient')),
                    #   shiny::column(width = 4L),
                    #   shiny::column(
                    #     width = 3L,
                    #     align = 'center',
                    #     shiny::actionButton(
                    #       inputId = 'ExportAzureRdata',
                    #       label = 'Load Rdata',
                    #       icon = shiny::icon('chevron-right', lib='font-awesome')
                    #       style = 'gradient')),
                    #   shiny::column(width = 1L)),

                    Quantico:::BlankRow(12L),
                    Quantico:::BlankRow(12L),
                    Quantico:::BlankRow(12L),
                    Quantico:::BlankRow(12L)
                  )))

            ) # end Tab Panel Main
          ), # end TagList

          footer = shiny::tagList(
            shiny::modalButton(label = "Cancel"),
            shiny::actionButton("AzureBlob_OK", "OK", width = '50px'))))
    })
}

# ----

# ----

# @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ ----
# ::  Data Wrangling  ::                                                                                         ----
# @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ ----

#' @title Shrink_Modal_Fun
#'
#' @description Subset, Sample, Aggregate
#'
#' @author Adrian Antico
#' @family DW
#'
#' @param id = 'Shrink_Modal_Fun'
#' @param AppWidth = 12L
#'
#' @export
Shrink_Modal_Fun <- function(id,
                             AppWidth=12L,

                             # Reactives
                             Aggregate_Columns_Selected = NULL,
                             Aggregate_ByVariables_Selected = NULL,
                             Aggregate_DateVariable_Selected = NULL,
                             SubsetData_FilterVariable1_Selected = NULL,
                             SubsetData_FilterVariable2_Selected = NULL,
                             SubsetData_FilterVariable3_Selected = NULL,
                             SubsetData_FilterVariable4_Selected = NULL,
                             SubsetData_FilterValue_1_1_Selected = NULL,
                             SubsetData_FilterValue_1_2_Selected = NULL,
                             SubsetData_FilterValue_2_1_Selected = NULL,
                             SubsetData_FilterValue_2_2_Selected = NULL,
                             SubsetData_FilterValue_3_1_Selected = NULL,
                             SubsetData_FilterValue_3_2_Selected = NULL,
                             SubsetData_FilterValue_4_1_Selected = NULL,
                             SubsetData_FilterValue_4_2_Selected = NULL,
                             DeleteVariables_Selected = NULL,
                             SampleData_StratifyColumns_Selected = NULL,

                             # Statics
                             AggregateData_SelectData_Choices = NULL,
                             Aggregate_Stat_Choices = NULL,
                             Aggregate_TimeAgg_Choices = NULL,
                             SubsetData_FilterLogic1_Choices = NULL,
                             SubsetData_FilterLogic2_Choices = NULL,
                             SubsetData_FilterLogic3_Choices = NULL,
                             SubsetData_FilterLogic4_Choices = NULL,
                             SubsetData_SelectData_Choices = NULL,
                             DeleteVariables_SelectData_Choices = NULL,
                             SampleData_SelectData_Choices = NULL,
                             SampleData_Rate_Choices = NULL,

                             # Updaters
                             AggregateData_SelectData_Selected = NULL,
                             AggregateData_NewName_Selected = NULL,
                             Aggregate_Stat_Selected = NULL,
                             Aggregate_TimeAgg_Selected = NULL,
                             SubsetData_FilterLogic1_Selected = NULL,
                             SubsetData_FilterLogic2_Selected = NULL,
                             SubsetData_FilterLogic3_Selected = NULL,
                             SubsetData_FilterLogic4_Selected = NULL,
                             SubsetData_SelectData_Selected = NULL,
                             SubsetData_NewName_Selected = NULL,
                             DeleteVariables_SelectData_Selected = NULL,
                             DeleteVariables_NewName_Selected = NULL,
                             SampleData_SelectData_Selected = NULL,
                             SampleData_NewName_Selected = NULL,
                             SampleData_Rate_Selected = NULL) {

  shiny::moduleServer(
    id = id,
    module = function(input, output, session) {
      ns <- session$ns
      shiny::showModal(
        shiny::modalDialog(
          title = 'Shrink Data',
          size = "l",
          easyClose = FALSE,
          fade = TRUE,
          shiny::tagList(

            Quantico:::BlankRow(12L),

            # Tabs
            shiny::tabsetPanel(
              id = 'Shrink_TabPanel',
              selected = 'Aggregate Data',

              # Aggregate Data ----
              shiny::tabPanel(
                title = "Aggregate Data",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  style = ModelHelpFormat,
                  Quantico:::BlankRow(12L),
                  shiny::fluidRow(
                    shiny::column(
                      width = 3L,
                      tags$h4(tags$span(tags$b(paste0('Aggregate Data Inputs'))))
                    ),

                    # Help Button
                    shiny::column(
                      width = 8L,
                      align = "right",
                      shinyWidgets::dropdown(
                        shinydashboard::box(
                          title = NULL, solidHeader = TRUE, collapsible = FALSE, status = "info", width = 12L,
                          shiny::fluidRow(
                            shiny::column(
                              width = 12L,
                              align = "left",
                              shiny::a(name = "aggregate"),
                              shiny::h3("Aggregate Data"),
                              shiny::p("ROC plots are used to evaluate classification and multiclass models where
                                         the model performance is measured over the range of possible cutoff values
                                         used to classify... ")
                            )
                          ),

                          Quantico::BlankRow(12),
                          shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::h3("Aggregate Data Usage"))),
                          shiny::fluidRow(shiny::column(
                            width = 12L, align = "left",
                            shiny::markdown(
                              "
                              Aggregate Data operation contains five inputs:
                              * Data Selection: choose the data set you want to operate on
                              * New Name: if you want to apply results to the existing dataset, leave the input blank. If you fill out a name a new dataset will be created with the new name and the operation conducted on it
                              * Aggregate Columns: these columns are numeric and will be aggregated via a statistics method, listed below
                              * Aggregate Date Column: this is for when you also want to aggregate up your date column, for example, going from daily to weekly. If you don't want to change your time scale you should still include date in the Aggregate Columns list. If you accidentally put your date column in both Aggregate Columns and Aggregate Date Column, the operation will still work as intended.
                              * Aggregate By-Columns: these columns are categorical
                              * Aggregation Statistic: method for aggregating the numeric columns, which include:
                                * count
                                * mean
                                * standard deviation
                                * max
                                * min
                                * first value
                                * last value
                              "
                            )))
                        ),
                        size = "lg",
                        icon = shiny::icon("question"),
                        label = NULL,
                        tooltip = FALSE,
                        right = TRUE,
                        up = FALSE,
                        width = NULL,
                        animate = shinyWidgets::animateOptions(
                          enter = "zoomIn",
                          exit = "fadeOutRightBig"
                        ),
                        inputId = NULL,
                        block = FALSE,
                        no_outline = TRUE
                      )
                    ),

                    # Agg Data Button
                    shiny::column(
                      width = 1L, align = 'right',
                      style = "padding-top: 4px;padding-right: 50px;",
                      shiny::actionButton(
                        inputId = 'DataWrangling_AggregateData',
                        label = 'Run',
                        icon = shiny::icon('chevron-right', lib='font-awesome')
                      )
                    )
                  ),

                  # Inputs
                  Quantico:::BlankRow(12L),
                  shiny::fluidRow(
                    shiny::column(
                      6L,
                      shinydashboard::box(
                        title = NULL, solidHeader = TRUE, collapsible = FALSE, status = "danger", width = 12L,
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(
                          shiny::column(
                            12L, align = "center",
                            Quantico:::SelectizeInput(InputID='AggregateData_SelectData', Label='Choose data set', Choices = AggregateData_SelectData_Choices, SelectedDefault = AggregateData_SelectData_Selected, Multiple = TRUE, MaxVars = 1))),
                        Quantico::BlankRow(12L),
                        shiny::fluidRow(
                          shiny::column(
                            12L, align = "center",
                            Quantico:::TextInput(InputID='AggregateData_NewName', Label='New Data Name', Value = AggregateData_NewName_Selected))),
                        Quantico::BlankRow(12L),
                        shiny::fluidRow(
                          shiny::column(
                            12L, align = "center",
                            Quantico:::SelectizeInput(InputID='Aggregate_Stat', Label='Aggregate Statistic', Choices = Aggregate_Stat_Choices, SelectedDefault = Aggregate_Stat_Selected, Multiple = TRUE, MaxVars = 1))),
                        Quantico::BlankRow(12L),
                        shiny::fluidRow(
                          shiny::column(
                            12L, align = "center",
                            Quantico:::SelectizeInput(InputID='Aggregate_TimeAgg', Label='Aggregate Time Unit', Choices = Aggregate_TimeAgg_Choices, SelectedDefault = Aggregate_TimeAgg_Selected, Multiple = TRUE, MaxVars = 1))),
                        Quantico::BlankRow(12L))),

                    shiny::column(
                      6L,
                      shinydashboard::box(
                        title = NULL, solidHeader = TRUE, collapsible = FALSE, status = "danger", width = 12L,
                        Quantico::BlankRow(12L),
                        shiny::fluidRow(
                          shiny::column(
                            12L, align = "center",
                            Quantico:::PickerInput(InputID='Aggregate_Columns', Label='Aggregate Columns', Choices = NULL, SelectedDefault = Aggregate_Columns_Selected, Multiple = TRUE, MaxVars = 100))),
                        Quantico::BlankRow(12L),
                        shiny::fluidRow(
                          shiny::column(
                            12L, align = "center",
                            Quantico:::PickerInput(InputID='Aggregate_ByVariables', Label='Aggregate By-Columns', Choices = NULL, SelectedDefault = Aggregate_ByVariables_Selected, Multiple = TRUE, MaxVars = 100))),
                        Quantico::BlankRow(12L),
                        shiny::fluidRow(
                          shiny::column(
                            12L, align = "center",
                            Quantico:::PickerInput(InputID='Aggregate_DateVariable', Label='Aggregate Date Column', Choices = NULL, SelectedDefault = Aggregate_DateVariable_Selected, Multiple = TRUE, MaxVars = 100))),
                        Quantico::BlankRow(12L)
                      )
                    )
                  ),

                  # Blank space
                  Quantico:::BlankRow(12L),
                  Quantico:::BlankRow(12L),
                  Quantico:::BlankRow(12L),
                  Quantico:::BlankRow(12L),
                  Quantico:::BlankRow(12L)
                )
              ),

              # Subset Data ----
              shiny::tabPanel(
                title = "Subset Rows",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  style = ModelHelpFormat,
                  Quantico:::BlankRow(12L),
                  shiny::fluidRow(
                    shiny::column(
                      width = 3L,
                      tags$h4(tags$span(tags$b(paste0('Subset Data Inputs'))))
                    ),
                    shiny::column(
                      width = 8L,
                      align = "right",
                      shinyWidgets::dropdown(
                        shinydashboard::box(
                          title = NULL, solidHeader = TRUE, collapsible = FALSE, status = "info", width = 12L,
                          shiny::fluidRow(
                            shiny::column(
                              width = 12L,
                              align = "left",
                              shiny::a(name = "subsetrows"),
                              shiny::h3("Subset Rows"),
                              shiny::p("The subset rows operation filters data per the users specifications... ")
                            )
                          ),
                          Quantico::BlankRow(12),
                          shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::h3("Subset Rows Usage"))),
                          shiny::fluidRow(shiny::column(
                            width = 12L,
                            align = "left",
                            shiny::markdown(
                              "
                              Subset Rows operation allows you to filter by up to four variables by various logic conditions
                              * Logic Condidtions: <, >, >=, <=, %in%, %between%, not %Between%, and %like%
                              * Value 1: for all logic conditions
                              * Value 2: only for logic conditions %between%, and not %Between%
                              "
                            )))
                        ),
                        size = "lg",
                        icon = shiny::icon("question"),
                        label = NULL,
                        tooltip = FALSE,
                        right = TRUE,
                        up = FALSE,
                        width = NULL,
                        animate = shinyWidgets::animateOptions(
                          enter = "zoomIn",
                          exit = "fadeOutRightBig"
                        ),
                        inputId = NULL,
                        block = FALSE,
                        no_outline = TRUE
                      )
                    ),

                    # Agg Data Button
                    shiny::column(
                      width = 1L, align = 'right',
                      style = "padding-top: 4px;padding-right: 50px;",
                      shiny::actionButton(
                        inputId = 'DataWrangling_SubsetData',
                        label = 'Run',
                        icon = shiny::icon('chevron-right', lib='font-awesome')
                      )
                    )
                  ),
                  Quantico::BlankRow(12L),
                  shinydashboard::box(
                    title = NULL, solidHeader = TRUE, collapsible = FALSE, status = "danger", width = 12L,
                    Quantico::BlankRow(12L),
                    shiny::fluidRow(
                      shiny::column(
                        6L, align = 'center',
                        Quantico::SelectizeInput(InputID = 'SubsetData_SelectData', Label = 'Choose data set', Choices = SubsetData_SelectData_Choices, SelectedDefault = SubsetData_SelectData_Selected, Multiple = TRUE, MaxVars = 1)),
                      shiny::column(
                        6L, align = 'center',
                        Quantico:::TextInput(InputID = 'SubsetData_NewName', Label = 'New Data Name (Leave blank to update existing data)', Value = SubsetData_NewName_Selected)))),

                  Quantico::BlankRow(12L),
                  Quantico::BlankRow(12L),
                  shiny::column(
                    3L,
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = "danger", width = 12L,
                      shiny::column(
                        12L, align = 'center',
                        Quantico:::PickerInput(InputID = 'SubsetData_FilterVariable1', Label = 'Filter Variable 1', Choices = NULL, SelectedDefault = SubsetData_FilterVariable1_Selected, Multiple = TRUE)),
                      Quantico::BlankRow(12L),
                      shiny::column(
                        12L, align = 'center',
                        Quantico:::SelectizeInput(InputID = 'SubsetData_FilterLogic1', SelectedDefault = SubsetData_FilterLogic1_Selected, Label = 'Logical Operation', Choices = SubsetData_FilterLogic1_Choices, Multiple = TRUE, MaxVars = 1)),
                      Quantico::BlankRow(12L),
                      shiny::column(
                        12L, align = 'center',
                        Quantico:::SelectizeInput(InputID = 'SubsetData_FilterValue_1_1', Label = "Value 1", Choices = NULL, SelectedDefault = SubsetData_FilterValue_1_1_Selected, Multiple = TRUE, MaxVars = 100L)),
                      Quantico::BlankRow(12L),
                      shiny::column(
                        12L, align = 'center',
                        Quantico:::SelectizeInput(InputID = 'SubsetData_FilterValue_1_2', Label = "Value 2", Choices = NULL, SelectedDefault = SubsetData_FilterValue_1_2_Selected, Multiple = TRUE, MaxVars = 100L))
                    )
                  ),

                  shiny::column(
                    3L,
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = "danger", width = 12L,
                      shiny::column(
                        12L, align = 'center',
                        Quantico:::PickerInput(InputID = 'SubsetData_FilterVariable2', Label = 'Filter Variable 2', Choices = NULL, SelectedDefault = SubsetData_FilterVariable2_Selected, Multiple = TRUE)),
                      Quantico::BlankRow(12L),
                      shiny::column(
                        12L, align = 'center',
                        Quantico:::SelectizeInput(InputID = 'SubsetData_FilterLogic2', SelectedDefault = SubsetData_FilterLogic2_Selected, Label = 'Logical Operation', Choices = SubsetData_FilterLogic2_Choices, Multiple = TRUE, MaxVars = 1)),
                      Quantico::BlankRow(12L),
                      shiny::column(
                        12L, align = 'center',
                        Quantico:::SelectizeInput(InputID = 'SubsetData_FilterValue_2_1', Label = "Value 1", Choices = NULL, SelectedDefault = SubsetData_FilterValue_2_1_Selected, Multiple = TRUE, MaxVars = 100L)),
                      Quantico::BlankRow(12L),
                      shiny::column(
                        12L, align = 'center',
                        Quantico:::SelectizeInput(InputID = 'SubsetData_FilterValue_2_2', Label = "Value 2", Choices = NULL, SelectedDefault = SubsetData_FilterValue_2_2_Selected, Multiple = TRUE, MaxVars = 100L))
                    )
                  ),

                  shiny::column(
                    3L,
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = "danger", width = 12L,
                      shiny::column(
                        12L, align = 'center',
                        Quantico:::PickerInput(InputID = 'SubsetData_FilterVariable3', Label = 'Filter Variable 3', Choices = NULL, SelectedDefault = SubsetData_FilterVariable3_Selected, Multiple = TRUE)),
                      Quantico::BlankRow(12L),
                      shiny::column(
                        12L, align = 'center',
                        Quantico:::SelectizeInput(InputID = 'SubsetData_FilterLogic3', SelectedDefault = SubsetData_FilterLogic3_Selected, Label = 'Logical Operation', Choices = SubsetData_FilterLogic3_Choices, Multiple = TRUE, MaxVars = 1)),
                      Quantico::BlankRow(12L),
                      shiny::column(
                        12L, align = 'center',
                        Quantico:::SelectizeInput(InputID = 'SubsetData_FilterValue_3_1', Label = "Value 1", Choices = NULL, SelectedDefault = SubsetData_FilterValue_3_1_Selected, Multiple = TRUE, MaxVars = 100L)),
                      Quantico::BlankRow(12L),
                      shiny::column(
                        12L, align = 'center',
                        Quantico:::SelectizeInput(InputID = 'SubsetData_FilterValue_3_2', Label = "Value 2", Choices = NULL, SelectedDefault = SubsetData_FilterValue_3_2_Selected, Multiple = TRUE, MaxVars = 100L))
                    )
                  ),

                  shiny::column(
                    3L,
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = "danger", width = 12L,
                      shiny::column(
                        12L, align = 'center',
                        Quantico:::PickerInput(InputID = 'SubsetData_FilterVariable4', Label = 'Filter Variable 4', Choices = NULL, SelectedDefault = SubsetData_FilterVariable4_Selected, Multiple = TRUE)),
                      Quantico::BlankRow(12L),
                      shiny::column(
                        12L, align = 'center',
                        Quantico:::SelectizeInput(InputID = 'SubsetData_FilterLogic4', SelectedDefault = SubsetData_FilterLogic4_Selected, Label = 'Logical Operation', Choices = SubsetData_FilterLogic4_Choices, Multiple = TRUE, MaxVars = 1)),
                      Quantico::BlankRow(12L),
                      shiny::column(
                        12L, align = 'center',
                        Quantico:::SelectizeInput(InputID = 'SubsetData_FilterValue_4_1', Label = "Value 1", Choices = NULL, SelectedDefault = SubsetData_FilterValue_4_1_Selected, Multiple = TRUE, MaxVars = 100L)),
                      Quantico::BlankRow(12L),
                      shiny::column(
                        12L, align = 'center',
                        Quantico:::SelectizeInput(InputID = 'SubsetData_FilterValue_4_2', Label = "Value 2", Choices = NULL, SelectedDefault = SubsetData_FilterValue_4_2_Selected, Multiple = TRUE, MaxVars = 100L)))
                  ),

                  # Blank space
                  Quantico:::BlankRow(12L),
                  Quantico:::BlankRow(12L),
                  Quantico:::BlankRow(12L),
                  Quantico:::BlankRow(12L),
                  Quantico:::BlankRow(12L),
                  Quantico:::BlankRow(12L)
                )
              ),


              # Delete Columns ----
              shiny::tabPanel(
                title = "Subset Columns",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  style = ModelHelpFormat,
                  Quantico:::BlankRow(12L),
                  shiny::fluidRow(
                    shiny::column(
                      width = 3L,
                      tags$h4(tags$span(tags$b(paste0('Delete Columns'))))
                    ),
                    shiny::column(
                      width = 8L,
                      align = "right",
                      shinyWidgets::dropdown(
                        shinydashboard::box(
                          title = NULL, solidHeader = TRUE, collapsible = FALSE, status = "info", width = 12L,
                          shiny::fluidRow(
                            shiny::column(
                              width = 12L,
                              align = "left",
                              shiny::a(name = "subsetcols"),
                              shiny::h3("Subset Cols"),
                              shiny::p("The subset cols operation removes columns based on user specifications... ")
                            )
                          ),

                          Quantico::BlankRow(12),
                          shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::h3("Subset Cols Usage"))),
                          shiny::fluidRow(shiny::column(
                            width = 12L, align = "left",
                            shiny::markdown(
                              "
                              Subset Cols operation allows you to remove columns from your dataset
                              * Select Data: choose your data set
                              * New Data Name: choose a name if you want a new dataset created. Otherwise leave blank
                              * Select Columns: Columns to remove from your data
                              "
                            )))
                        ),
                        size = "lg",
                        icon = shiny::icon("question"),
                        label = NULL,
                        tooltip = FALSE,
                        right = TRUE,
                        up = FALSE,
                        width = NULL,
                        animate = shinyWidgets::animateOptions(
                          enter = "zoomIn",
                          exit = "fadeOutRightBig"
                        ),
                        inputId = NULL,
                        block = FALSE,
                        no_outline = TRUE
                      )
                    ),

                    # Agg Data Button
                    shiny::column(
                      width = 1L, align = 'right',
                      style = "padding-top: 4px;padding-right: 50px;",
                      shiny::actionButton(
                        inputId = 'DataWranglingButton_DeleteColumns',
                        label = 'Run',
                        icon = shiny::icon('chevron-right', lib='font-awesome')
                      )
                    )
                  ),

                  Quantico:::BlankRow(12L),
                  shinydashboard::box(
                    title = NULL, solidHeader = TRUE, collapsible = FALSE, status = "danger", width = 12L,
                    Quantico:::BlankRow(12L),
                    shiny::fluidRow(
                      shiny::column(6L, align = 'center', Quantico:::SelectizeInput(InputID='DeleteVariables_SelectData', Label='Choose data set', Choices = DeleteVariables_SelectData_Choices, SelectedDefault = DeleteVariables_SelectData_Selected, Multiple = TRUE, MaxVars = 1)),
                      shiny::column(6L, align = 'center', Quantico:::PickerInput(InputID='DeleteVariables', Label='Delete Columns', Choices = NULL, SelectedDefault = DeleteVariables_Selected, Multiple = TRUE))),
                    Quantico:::BlankRow(12L),
                    shiny::fluidRow(
                      shiny::column(6L, align = 'center', Quantico:::TextInput(InputID='DeleteVariables_NewName', Label='New Data Name', Value = DeleteVariables_NewName_Selected))
                    )),

                  # Blank space
                  Quantico:::BlankRow(12L),
                  Quantico:::BlankRow(12L),
                  Quantico:::BlankRow(12L),
                  Quantico:::BlankRow(12L),
                  Quantico:::BlankRow(12L)
                )
              ),

              # Sample Data ----
              shiny::tabPanel(
                title = "Sampling",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  style = ModelHelpFormat,
                  Quantico:::BlankRow(12L),
                  shiny::fluidRow(
                    shiny::column(
                      width = 3L,
                      tags$h4(tags$span(tags$b(paste0('Sample Data Inputs')))),
                    ),
                    shiny::column(
                      width = 8L,
                      align = "right",
                      shinyWidgets::dropdown(
                        shinydashboard::box(
                          title = NULL, solidHeader = TRUE, collapsible = FALSE, status = "info", width = 12L,
                          shiny::fluidRow(
                            shiny::column(
                              width = 12L,
                              align = "left",
                              shiny::a(name = "sampledata"),
                              shiny::h3("Sample Data"),
                              shiny::p("The Sample Data operation enables the user to create a sampled dataset,
                                          by either random or stratified sampling... ")
                            )
                          ),

                          Quantico::BlankRow(12),
                          shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::h3("Sample Data Usage"))),
                          shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::markdown(
                            "
                              Sample Data operation allows you to remove columns from your dataset
                              * Select Data: choose your data set
                              * Stratify Columns: optional, can use to stratify sample
                              * New Data Name: supply a name to create a new dataset. Otherwise, you existing data will be returned with sampled rows
                              * Rate: the % of data to keep after sampling
                              "
                          )))
                        ),
                        size = "lg",
                        icon = shiny::icon("question"),
                        label = NULL,
                        tooltip = FALSE,
                        right = TRUE,
                        up = FALSE,
                        width = NULL,
                        animate = shinyWidgets::animateOptions(
                          enter = "zoomIn",
                          exit = "fadeOutRightBig"
                        ),
                        inputId = NULL,
                        block = FALSE,
                        no_outline = TRUE
                      )
                    ),

                    # Agg Data Button
                    shiny::column(
                      width = 1L, align = 'right',
                      style = "padding-top: 4px;padding-right: 50px;",
                      shiny::actionButton(
                        inputId = 'DataWrangling_SampleData',
                        label = 'Run',
                        icon = shiny::icon('chevron-right', lib='font-awesome')
                      )
                    )
                  ),

                  Quantico:::BlankRow(12L),
                  shiny::column(
                    6L,
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = "danger", width = 12L,
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(
                          12L,
                          align = 'center',
                          Quantico::SelectizeInput(InputID = 'SampleData_SelectData', Label = 'Choose data set', Choices = SampleData_SelectData_Choices, SelectedDefault = SampleData_SelectData_Selected, Multiple = TRUE, MaxVars = 1)
                        )),
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(
                          12L,
                          align = 'center',
                          Quantico:::PickerInput(InputID='SampleData_StratifyColumns', Label='Stratify Variables', Choices = NULL, SelectedDefault = SampleData_StratifyColumns_Selected, Multiple = TRUE))
                      ),
                      Quantico:::BlankRow(12L))),
                  shiny::column(
                    6L,
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = "danger", width = 12L,
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(
                          12L,
                          align = 'center',
                          Quantico:::TextInput(InputID='SampleData_NewName', Label='New Data Name', Value = SampleData_NewName_Selected)
                        )),
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(
                          12L,
                          align = 'center',
                          Quantico:::SelectizeInput(InputID='SampleData_Rate', Label='Sample Rate', Choices = SampleData_Rate_Choices, SelectedDefault = SampleData_Rate_Selected, MaxVars = 1L, Multiple = FALSE)
                        )),
                      Quantico:::BlankRow(12L))),

                  # Blank space
                  Quantico:::BlankRow(12L),
                  Quantico:::BlankRow(12L),
                  Quantico:::BlankRow(12L),
                  Quantico:::BlankRow(12L),
                  Quantico:::BlankRow(12L)
                )
              )
            ) # end Tab Panel Main
          ), # end TagList

          footer = shiny::tagList(
            shiny::modalButton(label = "Cancel"),
            shiny::actionButton("Shrink_OK", "OK", width = '50px'))))
    })
}

#' @title Grow_Modal_Fun
#'
#' @description Join and Union data
#'
#' @author Adrian Antico
#' @family DW
#'
#' @param id = 'Grow_Modal_Fun'
#' @param AppWidth = 12L
#'
#' @export
Grow_Modal_Fun <- function(id,
                           AppWidth=12L,

                           # Reactives
                           JoinData_ByXVariables_Selected = NULL,
                           JoinData_ByYVariables_Selected = NULL,

                           # Statics
                           JoinData_SelectData1_Choices = NULL,
                           JoinData_SelectData2_Choices = NULL,
                           JoinData_JoinType_Choices = NULL,
                           UnionData_SelectData1_Choices = NULL,
                           UnionData_SelectData2_Choices = NULL,
                           UnionData_Fill_Choices = NULL,
                           UnionData_UseNames_Choices = NULL,

                           # Updaters
                           JoinData_NewName_Selected = NULL,
                           JoinData_SelectData1_Selected = NULL,
                           JoinData_SelectData2_Selected = NULL,
                           JoinData_JoinType_Selected = NULL,
                           UnionData_NewName_Selected = NULL,
                           UnionData_SelectData1_Selected = NULL,
                           UnionData_SelectData2_Selected = NULL) {

  shiny::moduleServer(
    id = id,
    module = function(input, output, session) {
      ns <- session$ns
      shiny::showModal(
        shiny::modalDialog(
          title = 'Grow Data',
          size = "l",
          easyClose = FALSE,
          fade = TRUE,
          shiny::tagList(

            Quantico:::BlankRow(12L),

            # Tabs
            shiny::tabsetPanel(
              id = 'Grow_TabPanel',
              selected = 'Join Data',

              # Join Data
              shiny::tabPanel(
                title = "Join Data",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  style = ModelHelpFormat,
                  Quantico:::BlankRow(12L),
                  shiny::fluidRow(
                    shiny::column(
                      width = 3L,
                      tags$h4(tags$span(tags$b(paste0('Join Data'))))
                    ),
                    shiny::column(
                      width = 8L,
                      align = "right",
                      shinyWidgets::dropdown(
                        shinydashboard::box(
                          title = NULL, solidHeader = TRUE, collapsible = FALSE, status = "info", width = 12L,
                          shiny::fluidRow(
                            shiny::column(
                              width = 12L,
                              align = "left",
                              shiny::a(name = "join"),
                              shiny::h1(tags$b("Join")),
                              shiny::p("The join operation consists of many joing types, including:"),
                              shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::markdown(
                                "
                                  * inner
                                  * left
                                  * right
                                  * full
                                  * anti: includes anything in the left table that is not in the right table
                                  * semi: left join except no columns from the right table are returned
                                  * cross: Cross join is different from the rest in that it takes any number of vectors and creates a cartesian join of all of them to create a data.table
                                  * RollForward: used to match up two tables with a time stamp where the records are off due to differences in timing
                                  * RollBackward: just like the RollForward except is rolls data backwards instead of fowards
                                  ")))
                            )
                          ),
                          Quantico::BlankRow(12),
                          shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::h3("Join Data Usage"))),
                          shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::markdown(
                            "
                              Join Data operation allows you to horizontally combine two data sets with common keys
                              * Left Table: choose your first data set, typically the data set you want additional data added on to
                              * Right Table: choose your second data set, typically the data set you want take columns from and add to the left table
                              * Join Type: select the appropriate join type for your needs. See join types above for guidance
                              * New Data Name: Choose a name for a new data set to be built, otherwise the left table will be updated
                              * Left Table By-Vars: Include all by-vars (keys) for joining
                              * Right Table By-Vars: Include all by-vars (keys) for joining
                              "
                          )))
                        ),
                        size = "lg",
                        icon = shiny::icon("question"),
                        label = NULL,
                        tooltip = FALSE,
                        right = TRUE,
                        up = FALSE,
                        width = NULL,
                        animate = shinyWidgets::animateOptions(
                          enter = "zoomIn",
                          exit = "fadeOutRightBig"
                        ),
                        inputId = NULL,
                        block = FALSE,
                        no_outline = TRUE
                      )
                    ),

                    # Join Data Button
                    shiny::column(
                      width = 1L, align = 'right',
                      style = "padding-top: 4px;padding-right: 50px;",
                      shiny::actionButton(
                        inputId = 'DataWrangling_JoinData',
                        label = 'Run',
                        icon = shiny::icon('chevron-right', lib='font-awesome')
                      )
                    )
                  ),

                  Quantico:::BlankRow(12L),
                  shiny::column(
                    6L, align = "center",
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = "danger", width = 12L,
                      Quantico::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(
                          12L,
                          Quantico:::SelectizeInput(InputID='JoinData_SelectData1', Label='Left Table', Choices = JoinData_SelectData1_Choices, SelectedDefault = JoinData_SelectData1_Selected, Multiple = TRUE, MaxVars = 1),
                        )
                      ),
                      Quantico::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(
                          12L,
                          Quantico:::SelectizeInput(InputID='JoinData_SelectData2', Label='Right Table', Choices = JoinData_SelectData2_Choices, SelectedDefault = JoinData_SelectData2_Selected, Multiple = TRUE, MaxVars = 1)
                        )
                      ),
                      Quantico::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(
                          12L,
                          Quantico:::SelectizeInput(InputID='JoinData_JoinType', Label='Join Type', Choices = JoinData_JoinType_Choices, SelectedDefault = JoinData_JoinType_Selected, Multiple = TRUE, MaxVars = 1)
                        )
                      ),
                      Quantico::BlankRow(12L)
                    )
                  ),

                  shiny::column(
                    6L, align = "center",
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = "danger", width = 12L,
                      Quantico::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(
                          12L,
                          Quantico:::TextInput(InputID='JoinData_NewName', Label='New Data Name', Value = JoinData_NewName_Selected)
                        )
                      ),
                      Quantico::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(
                          12L,
                          Quantico:::SelectizeInput(InputID='JoinData_ByXVariables', Label='Left Table ByVars', Choices = NULL, SelectedDefault = JoinData_ByXVariables_Selected, Multiple = TRUE)
                        )
                      ),
                      Quantico::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(
                          12L,
                          Quantico:::SelectizeInput(InputID='JoinData_ByYVariables', Label='Right Table ByVars', Choices = NULL, SelectedDefault = JoinData_ByYVariables_Selected, Multiple = TRUE)
                        )
                      ),
                      Quantico::BlankRow(12L)
                    )
                  ),

                  # Blank space
                  Quantico:::BlankRow(12L),
                  Quantico:::BlankRow(12L),
                  Quantico:::BlankRow(12L),
                  Quantico:::BlankRow(12L),
                  Quantico:::BlankRow(12L)
                )
              ),

              # Union Data
              shiny::tabPanel(
                title = "Union Data",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  style = ModelHelpFormat,
                  Quantico:::BlankRow(12L),
                  shiny::fluidRow(
                    shiny::column(
                      width = 3L,
                      tags$h4(tags$span(tags$b(paste0('Union Data Inputs'))))
                    ),
                    shiny::column(
                      width = 8L,
                      align = "right",
                      shinyWidgets::dropdown(
                        shinydashboard::box(
                          title = NULL, solidHeader = TRUE, collapsible = FALSE, status = "info", width = 12L,
                          shiny::fluidRow(
                            shiny::column(
                              width = 12L,
                              align = "left",
                              shiny::a(name = "union"),
                              shiny::h1(tags$b("Union Data")),
                              shiny::p("The Union data operation consists of stacking multiple tables on top of each other... ")
                            )
                          ),

                          Quantico::BlankRow(12),
                          shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::h3("Union Data Usage"))),
                          shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::markdown(
                            "
                              Union Data operation allows you to vertically stack two data sets
                              * Choose data set: This is the dataset you want to utilize for the operation
                              * Append table: this table gets stacked onto the Base data set
                              * New Data Name: Choose a name for a new data set to be built, otherwise the left table will be updated
                              * Fill:
                              * Right Table By-Vars: Include all by-vars (keys) for joining
                              "
                          )))
                        ),
                        size = "lg",
                        icon = shiny::icon("question"),
                        label = NULL,
                        tooltip = FALSE,
                        right = TRUE,
                        up = FALSE,
                        width = NULL,
                        animate = shinyWidgets::animateOptions(
                          enter = "zoomIn",
                          exit = "fadeOutRightBig"
                        ),
                        inputId = NULL,
                        block = FALSE,
                        no_outline = TRUE
                      )
                    ),

                    # Union Data Button
                    shiny::column(
                      width = 1L, align = 'right',
                      style = "padding-top: 4px;padding-right: 50px;",
                      shiny::actionButton(
                        inputId = 'DataWrangling_UnionData',
                        label = 'Run',
                        icon = shiny::icon('chevron-right', lib='font-awesome')
                      )
                    )
                  ),

                  Quantico:::BlankRow(12L),
                  shiny::column(
                    6L, align = "center",
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = "danger", width = 12L,
                      Quantico::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(
                          12L,
                          Quantico:::SelectizeInput(InputID='UnionData_SelectData1', Label='Base data set', Choices = UnionData_SelectData1_Choices, SelectedDefault = UnionData_SelectData1_Selected, Multiple = TRUE, MaxVars = 1)
                        )
                      ),
                      Quantico::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(
                          12L,
                          Quantico:::SelectizeInput(InputID='UnionData_SelectData2', Label='Append Table', Choices = UnionData_SelectData2_Choices, SelectedDefault = UnionData_SelectData2_Selected, Multiple = TRUE, MaxVars = 1)
                        )
                      ),
                      Quantico::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(
                          12L,
                          Quantico:::TextInput(InputID='UnionData_NewName', Label='New Data Name', Value = UnionData_NewName_Selected)
                        )
                      ),
                      Quantico::BlankRow(12L)
                    )
                  ),

                  # Blank space
                  Quantico:::BlankRow(12L),
                  Quantico:::BlankRow(12L),
                  Quantico:::BlankRow(12L),
                  Quantico:::BlankRow(12L),
                  Quantico:::BlankRow(12L)
                )
              )
            ) # end Tab Panel Main
          ), # end TagList

          footer = shiny::tagList(
            shiny::modalButton(label = "Cancel"),
            shiny::actionButton("Grow_OK", "OK", width = '50px'))))
    })
}

#' @title DataSets_Modal_Fun
#'
#' @description DataSet operations
#'
#' @author Adrian Antico
#' @family DW
#'
#' @param id = 'DataSets_Modal_Fun'
#' @param AppWidth = 12L
#'
#' @export
DataSets_Modal_Fun <- function(id,
                               AppWidth=12L,

                               # Reactives
                               AutoDataPartition_StratifyColumnNames_Selected = NULL,
                               AutoDataPartition_TimeColumnName_Selected = NULL,
                               SortData_SortColumns_Selected = NULL,
                               ModelDataPrep_IgnoreCols_Selected = NULL,

                               # Statics
                               AutoDataPartition_SelectData_Choices = NULL,
                               AutoDataPartition_NumDataSets_Choices = NULL,
                               AutoDataPartition_Ratios_Train_Choices = NULL,
                               AutoDataPartition_Ratios_Validation_Choices = NULL,
                               AutoDataPartition_Ratios_Test_Choices = NULL,
                               AutoDataPartition_PartitionType_Choices = NULL,
                               SortData_SelectData_Choices = NULL,
                               SortData_SortOrder_Choices = NULL,
                               ModelDataPrep_SelectData_Choices = NULL,
                               ModelDataPrep_CharToFactor_Choices = NULL,
                               ModelDataPrep_FactorToChar_Choices = NULL,
                               ModelDataPrep_DateToChar_Choices = NULL,
                               ModelDataPrep_IDateConversion_Choices = NULL,
                               ModelDataPrep_RemoveDates_Choices = NULL,
                               ModelDataPrep_IntToNumeric_Choices = NULL,
                               ModelDataPrep_LogicalToBinary_Choices = NULL,
                               RemoveData_Datasets_Choices = NULL,

                               # Updaters
                               AutoDataPartition_SelectData_Selected = NULL,
                               AutoDataPartition_NumDataSets_Selected = NULL,
                               AutoDataPartition_Ratios_Train_Selected = NULL,
                               AutoDataPartition_Ratios_Validation_Selected = NULL,
                               AutoDataPartition_Ratios_Test_Selected = NULL,
                               AutoDataPartition_PartitionType_Selected = NULL,
                               SortData_SelectData_Selected = NULL,
                               SortData_SortOrder_Selected = NULL,
                               ModelDataPrep_SelectData_Selected = NULL,
                               ModelDataPrep_CharToFactor_Selected = NULL,
                               ModelDataPrep_FactorToChar_Selected = NULL,
                               ModelDataPrep_DateToChar_Selected = NULL,
                               ModelDataPrep_IDateConversion_Selected = NULL,
                               ModelDataPrep_RemoveDates_Selected = NULL,
                               ModelDataPrep_IntToNumeric_Selected = NULL,
                               ModelDataPrep_LogicalToBinary_Selected = NULL,
                               RemoveData_Datasets_Selected = NULL) {

  shiny::moduleServer(
    id = id,
    module = function(input, output, session) {
      ns <- session$ns
      shiny::showModal(
        shiny::modalDialog(
          title = 'Dataset Operations',
          size = "l",
          easyClose = FALSE,
          fade = TRUE,
          shiny::tagList(

            Quantico:::BlankRow(12L),

            # Tabs
            shiny::tabsetPanel(
              id = 'DataSet_TabPanel',
              selected = 'Partition Data',

              # Partition Data ----
              shiny::tabPanel(
                title = "Partition Data",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  style = ModelHelpFormat,
                  Quantico:::BlankRow(12L),
                  shiny::fluidRow(
                    shiny::column(
                      width = 3L,
                      tags$h4(tags$span(tags$b(paste0('Partition Data'))))
                    ),
                    shiny::column(
                      width = 8L,
                      align = "right",
                      shinyWidgets::dropdown(
                        shinydashboard::box(
                          title = NULL, solidHeader = TRUE, collapsible = FALSE, status = "info", width = 12L,
                          shiny::fluidRow(
                            shiny::column(
                              width = 12L,
                              align = "left",
                              shiny::a(name = "partitiondata"),
                              shiny::h1(tags$b("Partition Data")),
                              shiny::p("The partition data operation is for generating
                                         datasets for machine learning, such as a train,
                                         validation, and test data set. The user can choose
                                         between random data spitting or time based splitting,
                                         and they can add a stratification variable as well... ")
                            )
                          ),

                          Quantico::BlankRow(12),
                          shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::h3("Partition Data Usage"))),
                          shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::markdown(
                            "
                              Partition Data operation allows you to split up your info dataset into many datasets. Your supplied dataset will remain untouched but new datasets will be created
                              * Choose data set: This is the dataset you want to utilize for the operation
                              * Partition Type: choose 'random' for a purely random split amongst the data. Choose 'time' to have a time based split where training will consist of the earliest in time records, followed by the validation data and then test data
                              * Train %: this is the percentage of data you want allocated to the train data set. Defaults to 70%
                              * Validation %: this is the percentage of data you want allocated to the train data set. Defaults to 20%
                              * Test %: this is the percentage of data you want allocated to the train data set. Defaults to 10%
                              * Stratify variable: you can supply a stratification variable to ensure an even split amongst the levels in the variable supplied
                              * Date Variable: required for a 'time' based partition, unused otherwise
                              * Number of datasets: 3 is the standard but you can go with 2. Just ensure that the %'s add up to 100%
                              "
                          )))
                        ),
                        size = "lg",
                        icon = shiny::icon("question"),
                        label = NULL,
                        tooltip = FALSE,
                        right = TRUE,
                        up = FALSE,
                        width = NULL,
                        animate = shinyWidgets::animateOptions(
                          enter = "zoomIn",
                          exit = "fadeOutRightBig"
                        ),
                        inputId = NULL,
                        block = FALSE,
                        no_outline = TRUE
                      )
                    ),

                    # Partition Data Button
                    shiny::column(
                      width = 1L, align = 'right',
                      style = "padding-top: 4px;padding-right: 50px;",
                      shiny::actionButton(
                        inputId = 'FeatureEngineeringButton_AutoDataPartition',
                        label = 'Run',
                        icon = shiny::icon('chevron-right', lib='font-awesome')
                      )
                    )
                  ),

                  Quantico:::BlankRow(12L),
                  shiny::fluidRow(
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = "danger", width = 12L,
                      Quantico::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(
                          6L, align = "center",
                          Quantico:::SelectizeInput(InputID='AutoDataPartition_SelectData', Label='Choose data set', Choices = AutoDataPartition_SelectData_Choices, SelectedDefault = AutoDataPartition_SelectData_Selected, Multiple = TRUE, MaxVars = 1)),
                        shiny::column(
                          6L, align = "center",
                          Quantico:::SelectizeInput(InputID='AutoDataPartition_PartitionType', Label='Partition Type', Choices = AutoDataPartition_PartitionType_Choices, SelectedDefault = AutoDataPartition_PartitionType_Selected, Multiple = TRUE, MaxVars = 1)
                        )
                      )
                    )
                  ),

                  Quantico::BlankRow(12L),
                  shiny::fluidRow(
                    shiny::column(
                      6L, align = "center",
                      shinydashboard::box(
                        title = NULL, solidHeader = TRUE, collapsible = FALSE, status = "danger", width = 12L,
                        Quantico::BlankRow(12L),
                        shiny::fluidRow(
                          shiny::column(
                            12L,
                            Quantico:::SelectizeInput(InputID='AutoDataPartition_Ratios_Train', Label='Train %', Choices = AutoDataPartition_Ratios_Train_Choices, SelectedDefault = AutoDataPartition_Ratios_Train_Selected, Multiple = TRUE, MaxVars = 1)
                          )
                        ),
                        Quantico::BlankRow(12L),
                        shiny::fluidRow(
                          shiny::column(
                            12L,
                            Quantico:::SelectizeInput(InputID='AutoDataPartition_Ratios_Validation', Label='Validation %', Choices = AutoDataPartition_Ratios_Validation_Choices, SelectedDefault = AutoDataPartition_Ratios_Validation_Selected, Multiple = TRUE, MaxVars = 1)
                          )
                        ),
                        Quantico::BlankRow(12L),
                        shiny::fluidRow(
                          shiny::column(
                            12L,
                            Quantico:::SelectizeInput(InputID='AutoDataPartition_Ratios_Test', Label='Test %', Choices = AutoDataPartition_Ratios_Test_Choices, SelectedDefault = AutoDataPartition_Ratios_Test_Selected, Multiple = TRUE, MaxVars = 1)
                          )
                        ),
                        Quantico::BlankRow(12L)
                      )
                    ),

                    shiny::column(
                      6L, align = "center",
                      shinydashboard::box(
                        title = NULL, solidHeader = TRUE, collapsible = FALSE, status = "danger", width = 12L,
                        Quantico::BlankRow(12L),
                        shiny::fluidRow(
                          shiny::column(
                            12L,
                            Quantico:::PickerInput(InputID='AutoDataPartition_StratifyColumnNames', Label='Stratify Variable', Choices = NULL, SelectedDefault = AutoDataPartition_StratifyColumnNames_Selected, Multiple = TRUE)
                          )
                        ),
                        Quantico::BlankRow(12L),
                        shiny::fluidRow(
                          shiny::column(
                            12L,
                            Quantico:::PickerInput(InputID='AutoDataPartition_TimeColumnName', Label='Date Variable', Choices = NULL, SelectedDefault = AutoDataPartition_TimeColumnName_Selected, Multiple = TRUE)
                          )
                        ),
                        Quantico::BlankRow(12L),
                        shiny::fluidRow(
                          shiny::column(
                            12L,
                            Quantico:::SelectizeInput(InputID='AutoDataPartition_NumDataSets', Label='Number of Data Sets', Choices = AutoDataPartition_NumDataSets_Choices, SelectedDefault = AutoDataPartition_NumDataSets_Selected, Multiple = TRUE, MaxVars = 1)
                          )
                        ),
                        Quantico::BlankRow(12L)
                      )
                    )
                  ),

                  # Blank space
                  Quantico:::BlankRow(12L),
                  Quantico:::BlankRow(12L),
                  Quantico:::BlankRow(12L),
                  Quantico:::BlankRow(12L),
                  Quantico:::BlankRow(12L)
                )
              ), # end Tab Panel

              # Sort Data ----
              shiny::tabPanel(
                title = "Sort Data",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  style = ModelHelpFormat,
                  Quantico:::BlankRow(12L),
                  shiny::fluidRow(
                    shiny::column(
                      width = 3L,
                      tags$h4(tags$span(tags$b(paste0('Sort Data'))))
                    ),
                    shiny::column(
                      width = 8L,
                      align = "right",
                      shinyWidgets::dropdown(
                        shinydashboard::box(
                          title = NULL, solidHeader = TRUE, collapsible = FALSE, status = "info", width = 12L,
                          shiny::fluidRow(
                            shiny::column(
                              width = 12L,
                              align = "left",
                              shiny::a(name = "sort"),
                              shiny::h1(tags$b("Sort Data")),
                              shiny::p("The Sort data operation is for sorting data based
                                          a set of selected columns and selected orders... ")
                            )
                          ),

                          Quantico::BlankRow(12),
                          shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::h3("Sort Data Usage"))),
                          shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::markdown(
                            "
                              Sort Data operation allows you to split up your info dataset into many datasets. Your supplied dataset will remain untouched but new datasets will be created
                              * Choose data set: This is the dataset you want to utilize for the operation
                              * Sort Columns: choose the columns to drive the sort operation
                              * Sort Order: Ascending or Decending
                              "
                          )))
                        ),
                        size = "lg",
                        icon = shiny::icon("question"),
                        label = NULL,
                        tooltip = FALSE,
                        right = TRUE,
                        up = FALSE,
                        width = NULL,
                        animate = shinyWidgets::animateOptions(
                          enter = "zoomIn",
                          exit = "fadeOutRightBig"
                        ),
                        inputId = NULL,
                        block = FALSE,
                        no_outline = TRUE
                      )
                    ),

                    # Sort Data Button
                    shiny::column(
                      width = 1L, align = 'right',
                      style = "padding-top: 4px;padding-right: 50px;",
                      shiny::actionButton(
                        inputId = 'DataWranglingButton_SortData',
                        label = 'Run',
                        icon = shiny::icon('chevron-right', lib='font-awesome')
                      )
                    )
                  ),

                  Quantico:::BlankRow(12L),
                  shinydashboard::box(
                    Quantico::BlankRow(12L),
                    title = NULL, solidHeader = TRUE, collapsible = FALSE, status = "danger", width = 6L,
                    shiny::fluidRow(
                      shiny::column(
                        width = 12L, align = 'center',
                        Quantico:::SelectizeInput(InputID='SortData_SelectData', Label='Choose data set', Choices = SortData_SelectData_Choices, SelectedDefault = SortData_SelectData_Selected, Multiple = TRUE, MaxVars = 1))),
                    Quantico:::BlankRow(12L),
                    shiny::fluidRow(
                      shiny::column(
                        width = 12L, align = 'center',
                        Quantico:::PickerInput(InputID='SortData_SortColumns', Label='Sort Columns', Choices = NULL, SelectedDefault = SortData_SortColumns_Selected, Multiple = TRUE))),
                    Quantico::BlankRow(12L),
                    shiny::fluidRow(
                      shiny::column(
                        width = 12L, align = 'center',
                        Quantico:::SelectizeInput(InputID='SortData_SortOrder', Label='Sort Order', Choices = SortData_SortOrder_Choices, SelectedDefault = SortData_SortOrder_Selected, Multiple = TRUE, MaxVars = 1)))),

                  # Sort Data Button
                  Quantico:::BlankRow(12L),
                  Quantico:::BlankRow(12L),
                  Quantico:::BlankRow(12L),
                  Quantico:::BlankRow(12L),
                  Quantico:::BlankRow(12L)
                )
              ),

              # Model Data Prep ----
              shiny::tabPanel(
                title = "Model Data Prep",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  style = ModelHelpFormat,
                  Quantico:::BlankRow(12L),
                  shiny::fluidRow(
                    shiny::column(
                      width = 3L,
                      tags$h4(tags$span(tags$b(paste0('Model Data Prep'))))
                    ),
                    shiny::column(
                      width = 8L,
                      align = "right",
                      shinyWidgets::dropdown(
                        shinydashboard::box(
                          title = NULL, solidHeader = TRUE, collapsible = FALSE, status = "info", width = 12L,
                          shiny::fluidRow(
                            shiny::column(
                              width = 12L,
                              align = "left",
                              shiny::a(name = "modeldataprep"),
                              shiny::h1(tags$b("Model Data Prep")),
                              shiny::p("The Model Data Prep operation is for
                                         preparing your data for machine learning.
                                         Some ML algorithms requires numeric variables
                                         to be converted to integers, for example... ")
                            )
                          ),

                          Quantico::BlankRow(12),
                          shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::h3("Model Data Prep Usage"))),
                          shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::markdown(
                            "
                              Model Data Prep applies type conversions across an entire dataset that are suitable for modeling purposes
                              * Choose data set: This is the dataset you want to utilize for the operation
                              * Skip Columns: Choose columns that you want to be ignored throughout this operation
                              * Char to Factor: convert all character columns to factor columns
                              * Factor to Char: convert all factor columns to character columns
                              * Date to Char: convert date columns to character columns
                              * IDate to Date: convert all IDate types columns to Date columns
                              * Remove Date: remove Date columns from data
                              * Integer to Numeric: convert all integer columns to numeric columns
                              * Logical to Binary: convert all logical columns to binary columns
                              "
                          )))
                        ),
                        size = "lg",
                        icon = shiny::icon("question"),
                        label = NULL,
                        tooltip = FALSE,
                        right = TRUE,
                        up = FALSE,
                        width = NULL,
                        animate = shinyWidgets::animateOptions(
                          enter = "zoomIn",
                          exit = "fadeOutRightBig"
                        ),
                        inputId = NULL,
                        block = FALSE,
                        no_outline = TRUE
                      )
                    ),

                    # Data Prep Data Button
                    shiny::column(
                      width = 1L, align = 'right',
                      style = "padding-top: 4px;padding-right: 50px;",
                      shiny::actionButton(
                        inputId = 'FeatureEngineeringButton_ModelDataPrep',
                        label = 'Run',
                        icon = shiny::icon('chevron-right', lib='font-awesome')
                      )
                    )
                  ),

                  Quantico:::BlankRow(12L),
                  shinydashboard::box(
                    title = NULL, solidHeader = TRUE, collapsible = FALSE, status = "danger", width = 12L,
                    Quantico::BlankRow(12L),
                    shiny::fluidRow(
                      shiny::column(
                        width=6L, align = "center",
                        Quantico:::SelectizeInput(InputID='ModelDataPrep_SelectData', Label='Choose data set', Choices = ModelDataPrep_SelectData_Choices, SelectedDefault = ModelDataPrep_SelectData_Selected, Multiple = TRUE, MaxVars = 1))
                    )),

                  Quantico:::BlankRow(12L),

                  # TODO: Imputation Methods: time series fill, fill roll, next up: impute meow
                  # Quantico:::SelectizeInput(InputID='ModelDataPrep_MissFactor', Label='Character Impute', Choices = NULL)
                  # Quantico:::SelectizeInput(InputID='ModelDataPrep_MissNum', Label='Numeric Impute', Choices = NULL)
                  shiny::column(
                    6L, align = "center",
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = "danger", width = 12L,

                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(
                          12L, align = "center",
                          Quantico:::PickerInput(InputID='ModelDataPrep_IgnoreCols', Label='Skip Columns', Choices = NULL, SelectedDefault = ModelDataPrep_IgnoreCols_Selected, Multiple = TRUE, MaxVars = 1)
                        )
                      ),

                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(
                          12L, align = "center",
                          Quantico:::SelectizeInput(InputID='ModelDataPrep_CharToFactor', Label='Char to Factor', Choices = ModelDataPrep_CharToFactor_Choices, SelectedDefault = ModelDataPrep_CharToFactor_Selected, Multiple = TRUE, MaxVars = 1)
                        )
                      ),

                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(
                          12L, align = "center",
                          Quantico:::SelectizeInput(InputID='ModelDataPrep_FactorToChar', Label='Factor to Char', Choices = ModelDataPrep_FactorToChar_Choices, SelectedDefault = ModelDataPrep_FactorToChar_Selected, Multiple = TRUE, MaxVars = 1)
                        )
                      ),

                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(
                          12L, align = "center",
                          Quantico:::SelectizeInput(InputID='ModelDataPrep_DateToChar', Label='Date to Char', Choices = ModelDataPrep_DateToChar_Choices, SelectedDefault = ModelDataPrep_DateToChar_Selected, Multiple = TRUE, MaxVars = 1)
                        )
                      )
                    )
                  ),

                  shiny::column(
                    6L, align = "center",
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = "danger", width = 12L,

                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(
                          12L, align = "center",
                          Quantico:::SelectizeInput(InputID='ModelDataPrep_IDateConversion', Label='IDate to Date', Choices = ModelDataPrep_IDateConversion_Choices, SelectedDefault = ModelDataPrep_IDateConversion_Selected, Multiple = TRUE, MaxVars = 1)
                        )
                      ),

                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(
                          12L, align = "center",
                          Quantico:::SelectizeInput(InputID='ModelDataPrep_RemoveDates', Label='Remove Dates', Choices = ModelDataPrep_RemoveDates_Choices, SelectedDefault = ModelDataPrep_RemoveDates_Selected, Multiple = TRUE, MaxVars = 1)
                        )
                      ),

                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(
                          12L, align = "center",
                          Quantico:::SelectizeInput(InputID='ModelDataPrep_IntToNumeric', Label='Integer to Numeric', Choices = ModelDataPrep_IntToNumeric_Choices, SelectedDefault = ModelDataPrep_IntToNumeric_Selected, Multiple = TRUE, MaxVars = 1)
                        )
                      ),

                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(
                          12L, align = "center",
                          Quantico:::SelectizeInput(InputID='ModelDataPrep_LogicalToBinary', Label='Logical to Binary', Choices = ModelDataPrep_LogicalToBinary_Choices, SelectedDefault = ModelDataPrep_LogicalToBinary_Selected, Multiple = TRUE, MaxVars = 1)
                        )
                      )
                    )
                  ),
                  Quantico:::BlankRow(12L),
                  Quantico:::BlankRow(12L),
                  Quantico:::BlankRow(12L),
                  Quantico:::BlankRow(12L)
                )
              ), # end Tab Panel Main

              # Remove Data ----
              shiny::tabPanel(
                title = "Remove Data",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  style = ModelHelpFormat,
                  Quantico:::BlankRow(12L),
                  shiny::fluidRow(
                    shiny::column(
                      width = 3L,
                      tags$h4(tags$span(tags$b(paste0('Remove Data Sets'))))
                    ),
                    shiny::column(
                      width = 8L,
                      align = "right",
                      shinyWidgets::dropdown(
                        shinydashboard::box(
                          title = NULL, solidHeader = TRUE, collapsible = FALSE, status = "info", width = 12L,
                          shiny::fluidRow(
                            shiny::column(
                              width = 12L,
                              align = "left",
                              shiny::a(name = "remove"),
                              shiny::h1(tags$b("Remove Data")),
                              shiny::p("The Remove data operation is for removing data
                                          from memory to free up space... ")
                            )
                          ),

                          Quantico::BlankRow(12),
                          shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::h3("Remove Data Usage"))),
                          shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::markdown(
                            "
                              Remove Data operation allows you to remove datasets from the app session
                              * Choose data set: This is the dataset you want to utilize for the operation
                              "
                          )))
                        ),
                        size = "lg",
                        icon = shiny::icon("question"),
                        label = NULL,
                        tooltip = FALSE,
                        right = TRUE,
                        up = FALSE,
                        width = NULL,
                        animate = shinyWidgets::animateOptions(
                          enter = "zoomIn",
                          exit = "fadeOutRightBig"
                        ),
                        inputId = NULL,
                        block = FALSE,
                        no_outline = TRUE
                      )
                    ),

                    # Remove Data Button
                    shiny::column(
                      width = 1L, align = 'right',
                      style = "padding-top: 4px;padding-right: 50px;",
                      shiny::actionButton(
                        inputId = 'DataWrangling_RemoveData',
                        label = 'Run',
                        icon = shiny::icon('chevron-right', lib='font-awesome')
                      )
                    )
                  ),

                  Quantico:::BlankRow(12L),
                  shinydashboard::box(
                    title = NULL, solidHeader = TRUE, collapsible = FALSE, status = "danger", width = 12L,
                    Quantico::BlankRow(12L),
                    shiny::fluidRow(shiny::column(6L, align = 'center', Quantico:::SelectizeInput(InputID='RemoveData_Datasets', Label = 'Choose data sets', Choices = RemoveData_Datasets_Choices, SelectedDefault = RemoveData_Datasets_Selected, Multiple = TRUE, MaxVars = 1)))),

                  # Blank space
                  Quantico:::BlankRow(12L),
                  Quantico:::BlankRow(12L),
                  Quantico:::BlankRow(12L),
                  Quantico:::BlankRow(12L),
                  Quantico:::BlankRow(12L)
                )
              )
            ) # end Tab Panel Main
          ), # end TagList

          footer = shiny::tagList(
            shiny::modalButton(label = "Cancel"),
            shiny::actionButton("DataSets_OK", "OK", width = '50px'))))
    })
}

#' @title Pivot_Modal_Fun
#'
#' @description Melt and cast data
#'
#' @author Adrian Antico
#' @family DW
#'
#' @param id = 'Pivot_Modal_Fun'
#' @param AppWidth = 12L
#'
#' @export
Pivot_Modal_Fun <- function(id,
                            AppWidth=12L,

                            # Reactives
                            MeltData_id.vars_Selected = NULL,
                            MeltData_measure.vars_Selected = NULL,
                            CastData_id.vars_Selected = NULL,
                            CastData_CastColumns_Selected = NULL,
                            CastData_value.var_Selected = NULL,

                            # Statics
                            MeltData_SelectData_Choices = NULL,
                            MeltData_na.rm_Choices = NULL,
                            MeltData_variable.factor_Choices = NULL,
                            MeltData_value.factor_Choices = NULL,
                            CastData_SelectData_Choices = NULL,
                            CastData_fun.aggregate_Choices = NULL,
                            CastData_fill_Choices = NULL,

                            # Updaters
                            MeltData_NewName_Selected = NULL,
                            MeltData_SelectData_Selected = NULL,
                            MeltData_na.rm_Selected = NULL,
                            MeltData_variable.name_Selected = NULL,
                            MeltData_value.name_Selected = NULL,
                            MeltData_variable.factor_Selected = NULL,
                            MeltData_value.factor_Selected = NULL,
                            CastData_SelectData_Selected = NULL,
                            CastData_NewName_Selected = NULL,
                            CastData_fun.aggregate_Selected = NULL,
                            CastData_fill_Selected = NULL) {

  shiny::moduleServer(
    id = id,
    module = function(input, output, session) {
      ns <- session$ns
      shiny::showModal(
        shiny::modalDialog(
          title = 'Pivot Data',
          size = "l",
          easyClose = FALSE,
          fade = TRUE,
          shiny::tagList(

            Quantico:::BlankRow(12L),

            # Tabs
            shiny::tabsetPanel(
              id = 'Pivot_TabPanel',
              selected = 'Melt Data',

              # Melt Data ----
              shiny::tabPanel(
                title = "Melt Data",
                icon = shiny::icon('code'),
                shiny::fluidRow(
                  style = ModelHelpFormat,
                  Quantico:::BlankRow(12L),
                  shiny::fluidRow(
                    shiny::column(
                      width = 3L,
                      tags$h4(tags$span(tags$b(paste0('Melt Data'))))
                    ),
                    shiny::column(
                      width = 8L,
                      align = "right",
                      shinyWidgets::dropdown(
                        shinydashboard::box(
                          title = NULL, solidHeader = TRUE, collapsible = FALSE, status = "info", width = 12L,
                          shiny::fluidRow(
                            shiny::column(
                              width = 12L,
                              align = "left",
                              shiny::a(name = "melt"),
                              shiny::h1(tags$b("Melt Data")),
                              shiny::p("The Melt Data operation is for turning your
                                      data from wide to long... ")
                            )
                          ),

                          Quantico::BlankRow(12),
                          shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::h3("Melt Data Usage"))),
                          shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::markdown(
                            "
                          Melt Data operation allows you to convert a wide data set to a long data set
                          * Choose data set: This is the dataset you want to utilize for the operation
                          * New Data Name: Choose a name for a new data set to be built, otherwise the left table will be updated
                          * ID Columns: This variables remain in the dataset but are not transformed
                          * Measure columns: These columns will be turned into a single column (melted)
                          * RemoveNA: should NA values result after melting the data, select TRUE to have them removed
                          * Variable Column Name: This will be the name of the new column that references which rows the values correspond to
                          * Value Column Name: This will be the name of the column that contains the melted values
                          * Variable to Factor: The variable column is of character type and you can set this to TRUE to convert it to a factor column
                          * Value to Factor: If the melted value column is of character type you can set this to TRUE to convert it to a factor column
                          "
                          )))
                        ),
                        size = "lg",
                        icon = shiny::icon("question"),
                        label = NULL,
                        tooltip = FALSE,
                        right = TRUE,
                        up = FALSE,
                        width = NULL,
                        animate = shinyWidgets::animateOptions(
                          enter = "zoomIn",
                          exit = "fadeOutRightBig"
                        ),
                        inputId = NULL,
                        block = FALSE,
                        no_outline = TRUE
                      )
                    ),

                    # Melt Data Button
                    shiny::column(
                      width = 1L, align = 'right',
                      style = "padding-top: 4px;padding-right: 50px;",
                      shiny::actionButton(
                        inputId = 'DataWrangling_MeltData',
                        label = 'Run',
                        icon = shiny::icon('chevron-right', lib='font-awesome')
                      )
                    )
                  ),

                  Quantico:::BlankRow(12L),
                  shiny::fluidRow(
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                      Quantico:::BlankRow(12L),

                      shiny::fluidRow(
                        shinydashboard::box(
                          title = NULL, solidHeader = TRUE, collapsible = FALSE, status = "danger", width = 12L,
                          Quantico:::BlankRow(12L),
                          shiny::column(
                            6L, align = "center",
                            Quantico:::SelectizeInput(InputID='MeltData_SelectData', Label='Choose data set', Choices = MeltData_SelectData_Choices, SelectedDefault = MeltData_SelectData_Selected, Multiple = TRUE, MaxVars = 1)),
                          shiny::column(
                            6L, align = "center",
                            Quantico:::TextInput(InputID='MeltData_NewName', Label='New Data Name', Value = MeltData_NewName_Selected)),
                          Quantico:::BlankRow(12L))
                      ),

                      Quantico::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(
                          4L, align = "center",
                          shinydashboard::box(
                            title = NULL, solidHeader = TRUE, collapsible = FALSE, status = "danger", width = 12L,
                            Quantico::BlankRow(12L),
                            shiny::fluidRow(
                              shiny::column(
                                12L,
                                Quantico:::PickerInput(InputID='MeltData_id.vars', Label='ID Columns', Choices = NULL, SelectedDefault = MeltData_id.vars_Selected, Multiple = TRUE)
                              )
                            ),
                            Quantico::BlankRow(12L),
                            shiny::fluidRow(
                              shiny::column(
                                12L,
                                Quantico:::PickerInput(InputID='MeltData_measure.vars', Label='Measure Columns', Choices = NULL, SelectedDefault = MeltData_measure.vars_Selected, Multiple = TRUE)
                              )
                            ),
                            Quantico::BlankRow(12L),
                            shiny::fluidRow(
                              shiny::column(
                                12L,
                                Quantico:::SelectizeInput(InputID='MeltData_na.rm', Label='Remove NA', Choices = MeltData_na.rm_Choices, SelectedDefault = MeltData_na.rm_Selected, Multiple = TRUE, MaxVars = 1)
                              )
                            ),
                            Quantico::BlankRow(12L)
                          )
                        ),

                        shiny::column(
                          4L, align = "center",
                          shinydashboard::box(
                            title = NULL, solidHeader = TRUE, collapsible = FALSE, status = "danger", width = 12L,
                            Quantico::BlankRow(12L),
                            shiny::fluidRow(
                              shiny::column(
                                12L,
                                Quantico:::TextInput(InputID='MeltData_variable.name', Label='Variable Column Name', Value = MeltData_variable.name_Selected)
                              )
                            ),
                            Quantico::BlankRow(12L),
                            shiny::fluidRow(
                              shiny::column(
                                12L,
                                Quantico:::TextInput(InputID='MeltData_value.name', Label='Value Column Name', Value = MeltData_value.name_Selected)
                              )
                            ),
                            Quantico::BlankRow(12L)
                          )
                        ),

                        shiny::column(
                          4L, align = "center",
                          shinydashboard::box(
                            title = NULL, solidHeader = TRUE, collapsible = FALSE, status = "danger", width = 12L,
                            Quantico::BlankRow(12L),
                            shiny::fluidRow(
                              shiny::column(
                                12L,
                                Quantico:::SelectizeInput(InputID='MeltData_variable.factor', Label='Variable to Factor', Choices = MeltData_variable.factor_Choices, SelectedDefault = MeltData_variable.factor_Selected, Multiple = TRUE, MaxVars = 1)
                              )
                            ),
                            Quantico::BlankRow(12L),
                            shiny::fluidRow(
                              shiny::column(
                                12L,
                                Quantico:::SelectizeInput(InputID='MeltData_value.factor', Label='Value to Factor', Choices = MeltData_value.factor_Choices, SelectedDefault = MeltData_value.factor_Selected, Multiple = TRUE, MaxVars = 1)
                              )
                            ),
                            Quantico::BlankRow(12L)
                          )
                        )
                      ),
                      Quantico:::BlankRow(12L),
                      Quantico:::BlankRow(12L),
                      Quantico:::BlankRow(12L),
                      Quantico:::BlankRow(12L)
                    )
                  )
                )
              ),

              # Cast Data ----
              shiny::tabPanel(
                title = "Cast Data",
                icon = shiny::icon('code'),
                shiny::fluidRow(
                  style = ModelHelpFormat,
                  Quantico:::BlankRow(12L),
                  shiny::fluidRow(
                    shiny::column(
                      width = 3L,
                      tags$h4(tags$span(tags$b(paste0('Cast Data'))))
                    ),
                    shiny::column(
                      width = 8L,
                      align = "right",
                      shinyWidgets::dropdown(
                        shinydashboard::box(
                          title = NULL, solidHeader = TRUE, collapsible = FALSE, status = "info", width = 12L,
                          shiny::fluidRow(
                            shiny::column(
                              width = 12L,
                              align = "left",
                              shiny::a(name = "cast"),
                              shiny::h1(tags$b("Cast Data")),
                              shiny::p("The Cast Data operation is for turning your
                           data from long to wide... ")
                            )
                          ),

                          Quantico::BlankRow(12),
                          shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::h3("Cast Data Usage"))),
                          shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::markdown(
                            "
                          Cast Data operation allows you to convert a wide data set to a long data set
                          * Choose data set: This is the dataset you want to utilize for the operation
                          * New Data Name: Choose a name for a new data set to be built, otherwise the left table will be updated
                          * Agg Stat: when casting the measure columns go through an aggregation step. Select a metric from the list:
                            * length
                            * sum
                            * median
                            * sd (standard deviation)
                            * max
                            * min
                            * data.table::first
                            * data.table::last
                          * Impute Value: for missing values supply a value to fill in the blanks
                          * LHS Columns: Left hand side columns are columns that are not transformed but remain in the data set
                          * RHS Columns: Right hand side columns are columns that will be casted into column names
                          * Values Variable: This column will be casted into the RHS columns as values for those columns
                          "
                          )))
                        ),
                        size = "lg",
                        icon = shiny::icon("question"),
                        label = NULL,
                        tooltip = FALSE,
                        right = TRUE,
                        up = FALSE,
                        width = NULL,
                        animate = shinyWidgets::animateOptions(
                          enter = "zoomIn",
                          exit = "fadeOutRightBig"
                        ),
                        inputId = NULL,
                        block = FALSE,
                        no_outline = TRUE
                      )
                    ),

                    # Cast Data Button
                    shiny::column(
                      width = 1L, align = 'right',
                      style = "padding-top: 4px;padding-right: 50px;",
                      shiny::actionButton(
                        inputId = 'DataWrangling_CastData',
                        label = 'Run',
                        icon = shiny::icon('chevron-right', lib='font-awesome')
                      )
                    )
                  ),

                  Quantico:::BlankRow(12L),
                  shiny::fluidRow(
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = "danger", width = 12L,
                      tags$h4(tags$span(tags$b(paste0('Cast Data')))),
                      shiny::column(
                        6L, align = "center",
                        Quantico:::SelectizeInput(InputID='CastData_SelectData', Label='Choose data set', Choices = CastData_SelectData_Choices, SelectedDefault = CastData_SelectData_Selected, Multiple = TRUE, MaxVars = 1)),
                      shiny::column(
                        6L, align = "center",
                        Quantico:::TextInput(InputID='CastData_NewName', Label='New Data Name', Value = NULL)))
                  ),

                  Quantico::BlankRow(12L),
                  shiny::fluidRow(
                    shiny::column(
                      6L, align = "center",
                      shinydashboard::box(
                        title = NULL, solidHeader = TRUE, collapsible = FALSE, status = "danger", width = 12L,
                        Quantico::BlankRow(12L),
                        shiny::fluidRow(
                          shiny::column(
                            12L,
                            Quantico:::SelectizeInput(InputID='CastData_fun.aggregate', Label='Agg Stat', Choices = CastData_fun.aggregate_Choices, SelectedDefault = CastData_fun.aggregate_Selected, Multiple = TRUE, MaxVars = 1)
                          )
                        ),
                        Quantico::BlankRow(12L),
                        shiny::fluidRow(
                          shiny::column(
                            12L,
                            Quantico:::SelectizeInput(InputID='CastData_fill', Label='Impute Value', Choices = CastData_fill_Choices, SelectedDefault = CastData_fill_Selected, Multiple = TRUE, MaxVars = 1)
                          )
                        ),
                        Quantico::BlankRow(12L)
                      )
                    ),

                    shiny::column(
                      6L, align = "center",
                      shinydashboard::box(
                        title = NULL, solidHeader = TRUE, collapsible = FALSE, status = "danger", width = 12L,
                        Quantico::BlankRow(12L),
                        shiny::fluidRow(
                          shiny::column(
                            12L,
                            Quantico:::PickerInput(InputID='CastData_id.vars', Label='LHS Columns', Choices = NULL, SelectedDefault = CastData_id.vars_Selected, Multiple = TRUE)
                          )
                        ),
                        Quantico::BlankRow(12L),
                        shiny::fluidRow(
                          shiny::column(
                            12L,
                            Quantico:::PickerInput(InputID='CastData_CastColumns', Label='RHS Columns', Choices = NULL, SelectedDefault = CastData_CastColumns_Selected, Multiple = TRUE)
                          )
                        ),
                        Quantico::BlankRow(12L),
                        shiny::fluidRow(
                          shiny::column(
                            12L,
                            Quantico:::PickerInput(InputID='CastData_value.var', Label='Values Variable', Choices = NULL, SelectedDefault = CastData_value.var_Selected, Multiple = TRUE)
                          )
                        ),
                        Quantico::BlankRow(12L)
                      )
                    )
                  ),
                  Quantico:::BlankRow(12L),
                  Quantico:::BlankRow(12L),
                  Quantico:::BlankRow(12L),
                  Quantico:::BlankRow(12L)
                )
              )
            )
          ),

          footer = shiny::tagList(
            shiny::modalButton(label = "Cancel"),
            shiny::actionButton("Pivot_OK", "OK", width = '50px'))))
    })
}

#' @title Columns_Modal_Fun
#'
#' @description Melt and cast data
#'
#' @author Adrian Antico
#' @family DW
#'
#' @param id = 'Columns_Modal_Fun'
#' @param AppWidth = 12L
#'
#' @export
Columns_Modal_Fun <- function(id,
                              AppWidth=12L,

                              # Reactives
                              TypeCast_Numeric_Selected = NULL,
                              TypeCast_Integer_Selected = NULL,
                              TypeCast_Character_Selected = NULL,
                              TypeCast_Factor_Selected = NULL,
                              TypeCast_Logical_Selected = NULL,
                              TypeCast_Date_Selected = NULL,
                              TypeCast_ExcelDate_Selected = NULL,
                              TypeCast_Posix_Selected = NULL,
                              RenameColumns_RenameColumn_Selected = NULL,
                              TimeTrendColumn_DateColumn_Selected = NULL,
                              TimeTrendColumn_GroupVars_Selected = NULL,
                              ConcatColumns_Selected = NULL,

                              # Statics
                              TypeCast_SelectData_Choices = NULL,
                              RenameColumns_SelectData_Choices = NULL,
                              TimeTrendColumn_SelectData_Choices = NULL,
                              TimeTrendColumn_TimeTrendOrder_Choices = NULL,
                              ConcatColumns_SelectData_Choices = NULL,

                              # Updaters
                              TypeCast_SelectData_Selected = NULL,
                              RenameColumns_SelectData_Selected = NULL,
                              RenameColumns_NewName_Selected = NULL,
                              TimeTrendColumn_SelectData_Selected = NULL,
                              TimeTrendColumn_TimeTrendOrder_Selected = NULL,
                              TimeTrendColumn_NewName_Selected = NULL,
                              ConcatColumns_SelectData_Selected = NULL) {

  shiny::moduleServer(
    id = id,
    module = function(input, output, session) {
      ns <- session$ns
      shiny::showModal(
        shiny::modalDialog(
          title = 'Column Operations',
          size = "l",
          easyClose = FALSE,
          fade = TRUE,
          shiny::tagList(

            Quantico:::BlankRow(12L),

            # Tabs
            shiny::tabsetPanel(
              id = 'Columns_TabPanel',
              selected = 'Type Casting',

              # Type Casting
              shiny::tabPanel(
                title = "Type Casting",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  style = ModelHelpFormat,
                  Quantico:::BlankRow(12L),
                  shiny::fluidRow(
                    shiny::column(
                      width = 3L,
                      tags$h4(tags$span(tags$b(paste0('Type Casting'))))
                    ),
                    shiny::column(
                      width = 8L,
                      align = "right",
                      shinyWidgets::dropdown(
                        shinydashboard::box(
                          title = NULL, solidHeader = TRUE, collapsible = FALSE, status = "info", width = 12L,
                          shiny::fluidRow(
                            shiny::column(
                              width = 12L,
                              align = "left",
                              shiny::a(name = "typecast"),
                              shiny::h1(tags$b("Type Cast Data")),
                              shiny::p("The Type Cast operation is for changing
                                      the variable types of your columns... ")
                            )
                          ),

                          Quantico::BlankRow(12),
                          shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::h3("Type Cast Data Usage"))),
                          shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::markdown(
                            "
                            Type Cast Data operation to change the variable types of your columns
                            * Choose data set: This is the dataset you want to utilize for the operation
                            * Convert Numeric: Select columns you want converted to numeric type
                            * Convert Date: Select columns to convert to date type
                            * Convert Logical: Select columns to convert to logical
                            * Convert Integer: Select columns to convert to integer type
                            * Convert Factor: Select columns to convert to factor type
                            * Excel Date to R Date: Select columns to convert to R Date types
                            * Convert Posix: Select columns to convert to Posix type (date time)
                            "
                          )))
                        ),
                        size = "lg",
                        icon = shiny::icon("question"),
                        label = NULL,
                        tooltip = FALSE,
                        right = TRUE,
                        up = FALSE,
                        width = NULL,
                        animate = shinyWidgets::animateOptions(
                          enter = "zoomIn",
                          exit = "fadeOutRightBig"
                        ),
                        inputId = NULL,
                        block = FALSE,
                        no_outline = TRUE
                      )
                    ),

                    # Tyep Cast Data Button
                    shiny::column(
                      width = 1L, align = 'right',
                      style = "padding-top: 4px;padding-right: 50px;",
                      shiny::actionButton(
                        inputId = 'DataWranglingButton_TypeCasting',
                        label = 'Run',
                        icon = shiny::icon('chevron-right', lib='font-awesome')
                      )
                    )
                  ),

                  Quantico:::BlankRow(12L),
                  shiny::column(
                    6L, align = "center",
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = "danger", width = 12L,
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='TypeCast_SelectData', Label='Choose data set', Choices = TypeCast_SelectData_Choices, SelectedDefault = TypeCast_SelectData_Selected, Multiple = TRUE, MaxVars = 1))),
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::PickerInput(InputID='TypeCast_Numeric', Label='Convert Numeric', Choices = NULL, SelectedDefault = TypeCast_Numeric_Selected, Multiple = TRUE))),
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::PickerInput(InputID='TypeCast_Character', Label='Convert Character', Choices = NULL, SelectedDefault = TypeCast_Character_Selected, Multiple = TRUE))),
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::PickerInput(InputID='TypeCast_Date', Label='Convert Date', Choices = NULL, SelectedDefault = TypeCast_Date_Selected, Multiple = TRUE))),
                      Quantico:::BlankRow(12L))
                  ),

                  shiny::column(
                    6L, align = "center",
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = "danger", width = 12L,
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::PickerInput(InputID='TypeCast_Logical', Label='Convert Logical', Choices = NULL, SelectedDefault = TypeCast_Logical_Selected, Multiple = TRUE))),
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::PickerInput(InputID='TypeCast_Integer', Label='Convert Integer', Choices = NULL, SelectedDefault = TypeCast_Integer_Selected, Multiple = TRUE))),
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::PickerInput(InputID='TypeCast_Factor', Label='Convert Factor', Choices = NULL, SelectedDefault = TypeCast_Factor_Selected, Multiple = TRUE))),
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::PickerInput(InputID='TypeCast_ExcelDate', Label='Excel Date to R Date', Choices = NULL, SelectedDefault = TypeCast_ExcelDate_Selected, Multiple = TRUE))),
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::PickerInput(InputID='TypeCast_Posix', Label='Convert Posix', Choices = NULL, SelectedDefault = TypeCast_Posix_Selected, Multiple = TRUE))),
                      Quantico:::BlankRow(12L))),

                  # Type Cast Build Button
                  Quantico:::BlankRow(12L),
                )
              ),

              # Rename Columns
              shiny::tabPanel(
                title = "Rename Columns",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  style = ModelHelpFormat,
                  Quantico:::BlankRow(12L),
                  shiny::fluidRow(
                    shiny::column(
                      width = 3L,
                      tags$h4(tags$span(tags$b(paste0('Rename Columns'))))
                    ),
                    shiny::column(
                      width = 8L,
                      align = "right",
                      shinyWidgets::dropdown(
                        shinydashboard::box(
                          title = NULL, solidHeader = TRUE, collapsible = FALSE, status = "info", width = 12L,
                          shiny::fluidRow(
                            shiny::column(
                              width = 12L,
                              align = "left",
                              shiny::a(name = "rename"),
                              shiny::h1(tags$b("Renaming Columns")),
                              shiny::p("The Rename Columns operation is for changing
                                          the names of columns in your data... ")
                            )
                          ),

                          Quantico::BlankRow(12),
                          shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::h3("Renaming Columns Usage"))),
                          shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::markdown(
                            "
                              Rename Columns operation to change the variable names in your data
                              * Choose data set: This is the dataset you want to utilize for the operation
                              * New Data Name: Choose a name for a new data set to be built, otherwise the left table will be updated
                              * Select Column: Choose a column whose name you'd like to change
                              "
                          )))
                        ),
                        size = "lg",
                        icon = shiny::icon("question"),
                        label = NULL,
                        tooltip = FALSE,
                        right = TRUE,
                        up = FALSE,
                        width = NULL,
                        animate = shinyWidgets::animateOptions(
                          enter = "zoomIn",
                          exit = "fadeOutRightBig"
                        ),
                        inputId = NULL,
                        block = FALSE,
                        no_outline = TRUE
                      )
                    ),

                    # Rename Cols Button
                    shiny::column(
                      width = 1L, align = 'right',
                      style = "padding-top: 4px;padding-right: 50px;",
                      shiny::actionButton(
                        inputId = 'DataWranglingButton_RenameColumns',
                        label = 'Run',
                        icon = shiny::icon('chevron-right', lib='font-awesome')
                      )
                    )
                  ),

                  Quantico:::BlankRow(12L),
                  shinydashboard::box(
                    title = NULL, solidHeader = TRUE, collapsible = FALSE, status = "danger", width = 12L,
                    Quantico:::BlankRow(12L),
                    shiny::fluidRow(shiny::column(6L, align = 'center', Quantico:::SelectizeInput(InputID='RenameColumns_SelectData', Label='Choose data set', Choices = RenameColumns_SelectData_Choices, SelectedDefault = RenameColumns_SelectData_Selected, Multiple = TRUE, MaxVars = 1))),
                    Quantico:::BlankRow(12L),
                    shiny::fluidRow(shiny::column(6L, align = 'center', Quantico:::PickerInput(InputID='RenameColumns_RenameColumn', Label='Select Column', Choices = NULL, SelectedDefault = RenameColumns_RenameColumn_Selected, Multiple = TRUE))),
                    Quantico:::BlankRow(12L),
                    shiny::fluidRow(shiny::column(6L, align = 'center', Quantico:::TextInput(InputID='RenameColumns_NewName', Label='New Name', Value = RenameColumns_NewName_Selected))),
                    Quantico:::BlankRow(12L)),

                  # Rename Columns Button
                  Quantico:::BlankRow(12L),
                  Quantico:::BlankRow(12L),
                  Quantico:::BlankRow(12L),
                  Quantico:::BlankRow(12L),
                  Quantico:::BlankRow(12L)
                )
              ),

              # Time Trend Columns
              shiny::tabPanel(
                title = "Time Trend Column",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  Quantico:::BlankRow(12L),
                  shiny::fluidRow(
                    style = ModelHelpFormat,
                    shiny::column(
                      width = 3L,
                      tags$h4(tags$span(tags$b(paste0('Time Trend Columns'))))
                    ),
                    shiny::column(
                      width = 8L,
                      align = "right",
                      shinyWidgets::dropdown(
                        shinydashboard::box(
                          title = NULL, solidHeader = TRUE, collapsible = FALSE, status = "info", width = 12L,
                          shiny::fluidRow(
                            shiny::column(
                              width = 12L,
                              align = "left",
                              shiny::a(name = "timetrend"),
                              shiny::h1(tags$b("Time Trend")),
                              shiny::p("The Time Trend operation is for adding a
                                         column to your data. This can be done by
                                         groups as well... ")
                            )
                          ),

                          Quantico::BlankRow(12),
                          shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::h3("Time Trend Usage"))),
                          shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::markdown(
                            "
                              Time Trend operation creates a time trend column in your dataset
                              * Choose data set: This is the dataset you want to utilize for the operation
                              * New Data Name: Choose a name for a new data set to be built, otherwise the left table will be updated
                              * Trend Order: Ascending or Decending
                              * Date Column: This is the date column used to create the time trend variable
                              * Group Variables: If you have group variables in your data you'll want to inclue those so that you end up with time trends for each group level
                              "
                          )))
                        ),
                        size = "lg",
                        icon = shiny::icon("question"),
                        label = NULL,
                        tooltip = FALSE,
                        right = TRUE,
                        up = FALSE,
                        width = NULL,
                        animate = shinyWidgets::animateOptions(
                          enter = "zoomIn",
                          exit = "fadeOutRightBig"
                        ),
                        inputId = NULL,
                        block = FALSE,
                        no_outline = TRUE
                      )
                    ),

                    # Time trend Button
                    shiny::column(
                      width = 1L, align = 'right',
                      style = "padding-top: 4px;padding-right: 50px;",
                      shiny::actionButton(
                        inputId = 'DataWranglingButton_TimeTrendColumn',
                        label = 'Run',
                        icon = shiny::icon('chevron-right', lib='font-awesome')
                      )
                    )
                  ),

                  Quantico:::BlankRow(12L),
                  shiny::fluidRow(
                    shiny::column(
                      6L, align = "center",
                      shinydashboard::box(
                        title = NULL, solidHeader = TRUE, collapsible = FALSE, status = "danger", width = 12L,
                        Quantico::BlankRow(12L),
                        shiny::fluidRow(
                          shiny::column(
                            12L, align = "center",
                            Quantico:::SelectizeInput(InputID='TimeTrendColumn_SelectData', Label='Choose data set', Choices = TimeTrendColumn_SelectData_Choices, SelectedDefault = TimeTrendColumn_SelectData_Selected, Multiple = TRUE, MaxVars = 1))
                        ),
                        Quantico::BlankRow(12L),
                        shiny::fluidRow(
                          shiny::column(
                            12L, align = "center",
                            Quantico:::TextInput(InputID='TimeTrendColumn_NewName', Label='New Colname', Value = TimeTrendColumn_NewName_Selected))
                        ),
                        Quantico::BlankRow(12L),
                        shiny::fluidRow(
                          shiny::column(
                            12L, align = "center",
                            Quantico:::SelectizeInput(InputID='TimeTrendColumn_TimeTrendOrder', Label='Trend Order', Choices = TimeTrendColumn_TimeTrendOrder_Choices, SelectedDefault = TimeTrendColumn_TimeTrendOrder_Selected, Multiple = TRUE, MaxVars = 1))
                        ),
                        Quantico:::BlankRow(12L)
                      )
                    ),

                    shiny::column(
                      6L, align = "center",
                      shinydashboard::box(
                        title = NULL, solidHeader = TRUE, collapsible = FALSE, status = "danger", width = 12L,
                        Quantico::BlankRow(12L),
                        shiny::fluidRow(
                          shiny::column(
                            12L, align = "center",
                            Quantico:::PickerInput(InputID='TimeTrendColumn_DateColumn', Label='Date Column', Choices = NULL, SelectedDefault = TimeTrendColumn_DateColumn_Selected, Multiple = TRUE))
                        ),
                        Quantico::BlankRow(12L),
                        shiny::fluidRow(
                          shiny::column(
                            12L, align = "center",
                            Quantico:::PickerInput(InputID='TimeTrendColumn_GroupVars', Label='Group Variables', Choices = NULL, SelectedDefault = TimeTrendColumn_GroupVars_Selected, Multiple = TRUE))
                        ),
                        Quantico:::BlankRow(12L)
                      )
                    )
                  ),

                  # Blank space
                  Quantico:::BlankRow(12L),
                  Quantico:::BlankRow(12L),
                  Quantico:::BlankRow(12L),
                  Quantico:::BlankRow(12L),
                  Quantico:::BlankRow(12L)
                )
              ),

              # Concatenate Columns
              shiny::tabPanel(
                title = "Concat Columns",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  Quantico:::BlankRow(12L),
                  shiny::fluidRow(
                    style = ModelHelpFormat,
                    shiny::column(
                      width = 3L,
                      tags$h4(tags$span(tags$b(paste0('Time Trend Columns'))))
                    ),
                    shiny::column(
                      width = 8L,
                      align = "right",
                      shinyWidgets::dropdown(
                        shinydashboard::box(
                          title = NULL, solidHeader = TRUE, collapsible = FALSE, status = "info", width = 12L,
                          shiny::fluidRow(
                            shiny::column(
                              width = 12L,
                              align = "left",
                              shiny::a(name = "concat"),
                              shiny::h1(tags$b("Concat Columns")),
                              shiny::p("The Concat Columns operation is for combining
                                      multiple columns into a single column... ")
                            )
                          ),

                          Quantico::BlankRow(12),
                          shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::h3("Concat Columns Usage"))),
                          shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::markdown(
                            "
                            Concat Columns operation creates one new column this is the combination of selected columns
                            * Choose data set: This is the dataset you want to utilize for the operation
                            * Concat Columns: select columns that you want combined
                            "
                          )))
                        ),
                        size = "lg",
                        icon = shiny::icon("question"),
                        label = NULL,
                        tooltip = FALSE,
                        right = TRUE,
                        up = FALSE,
                        width = NULL,
                        animate = shinyWidgets::animateOptions(
                          enter = "zoomIn",
                          exit = "fadeOutRightBig"
                        ),
                        inputId = NULL,
                        block = FALSE,
                        no_outline = TRUE
                      )
                    ),

                    # Concat Button
                    shiny::column(
                      width = 1L, align = 'right',
                      style = "padding-top: 4px;padding-right: 50px;",
                      shiny::actionButton(
                        inputId = 'DataWranglingButton_ConcatColumns',
                        label = 'Run',
                        icon = shiny::icon('chevron-right', lib='font-awesome')
                      )
                    )
                  ),

                  Quantico:::BlankRow(12L),
                  shinydashboard::box(
                    title = NULL, solidHeader = TRUE, collapsible = FALSE, status = "danger", width = 12L,
                    shiny::fluidRow(
                      shiny::column(6L, align = 'center', Quantico:::SelectizeInput(InputID='ConcatColumns_SelectData', Label='Choose data set', Choices = ConcatColumns_SelectData_Choices, SelectedDefault = ConcatColumns_SelectData_Selected, Multiple = TRUE, MaxVars = 1)),
                      shiny::column(6L, align = 'center', Quantico:::PickerInput(InputID='ConcatColumns', Label='Concat Columns', Choices = NULL, SelectedDefault = ConcatColumns_Selected, Multiple = TRUE))),
                    Quantico:::BlankRow(12L)),

                  # Blank space
                  Quantico:::BlankRow(12L),
                  Quantico:::BlankRow(12L),
                  Quantico:::BlankRow(12L),
                  Quantico:::BlankRow(12L),
                  Quantico:::BlankRow(12L)
                )
              )
            ) # end Tab Panel Main
          ), # end TagList

          footer = shiny::tagList(
            shiny::modalButton(label = "Cancel"),
            shiny::actionButton("Columns_OK", "OK", width = '50px'))))
    })
}

#' @title Misc_Modal_Fun
#'
#' @description Misc operations
#'
#' @author Adrian Antico
#' @family DW
#'
#' @param id = 'Misc_Modal_Fun'
#' @param AppWidth = 12L
#'
#' @export
Misc_Modal_Fun <- function(id,
                           AppWidth=12L,

                           # Reactives
                           TSF_DateColumnName_Selected = NULL,
                           TSF_GroupVariables_Selected = NULL,
                           Roll_RollVars_Selected = NULL,
                           Roll_NonRollVars_Selected = NULL,
                           Roll_DateColumnName_Selected = NULL,
                           Roll_GroupVariables_Selected = NULL,

                           # Statics
                           MetaProgramming_TextCode_Choices = NULL,
                           TSF_SelectData_Choices = NULL,
                           TSF_TimeUnit_Choices = NULL,
                           TSF_MaxMissingPercent_Choices = NULL,
                           TSF_SimpleImpute_Choices = NULL,
                           Roll_SelectData_Choices = NULL,
                           Roll_TimeUnit_Choices = NULL,
                           Roll_RollDirection_Choices = NULL,
                           Roll_SimpleImpute_Choices = NULL,

                           # Updaters
                           TSF_SelectData_Selected = NULL,
                           TSF_NewName_Selected = NULL,
                           TSF_TimeUnit_Selected = NULL,
                           TSF_MaxMissingPercent_Selected = NULL,
                           TSF_SimpleImpute_Selected = NULL,
                           Roll_SelectData_Selected = NULL,
                           Roll_NewName_Selected = NULL,
                           Roll_TimeUnit_Selected = NULL,
                           Roll_RollDirection_Selected = NULL,
                           Roll_SimpleImpute_Selected = NULL) {

  shiny::moduleServer(
    id = id,
    module = function(input, output, session) {
      ns <- session$ns
      shiny::showModal(
        shiny::modalDialog(
          title = 'Misc Operations',
          size = "l",
          easyClose = FALSE,
          fade = TRUE,
          shiny::tagList(

            Quantico:::BlankRow(12L),

            # Tabs
            shiny::tabsetPanel(
              id = 'Misc_TabPanel',
              selected = 'Meta Programming',

              # Meta Programming
              shiny::tabPanel(
                title = "Meta Programming",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                    Quantico:::BlankRow(12L),
                    shiny::fluidRow(
                      style = ModelHelpFormat,
                      shiny::column(
                        width = 3L,
                        tags$h4(tags$span(tags$b(paste0('Meta Programming'))))
                      ),
                      shiny::column(
                        width = 8L,
                        align = "right",
                        shinyWidgets::dropdown(
                          shinydashboard::box(
                            title = NULL, solidHeader = TRUE, collapsible = FALSE, status = "info", width = 12L,
                            shiny::fluidRow(
                              shiny::column(
                                width = 12L,
                                align = "left",
                                shiny::a(name = "metaprogramming"),
                                shiny::h1(tags$b("Meta Programming")),
                                shiny::p("The meta programming operation is designed to allow
                           one to supply their own code to do things data wrangling
                           related... ")
                              )
                            ),

                            Quantico::BlankRow(12),
                            shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::h3("Meta Programming Usage"))),
                            shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::markdown(
                              "
                              Meta Programming allows you to write your own code to be evaluated
                              * Concat Columns: select columns that you want combined
                              * In the meta programming code panel, to refer to a data set you'll need to access the DataList
                                * DataList[[<Name of Data>]][['data']] is the data set
                                * You can pull out the data if you want: data <- DataList[[<Name of Data>]][['data']]
                                * If you pull out the data and want the changes to update, you need to put it back when you're done (or create a new data object)
                                * DataList[[<Name of data>]][['data']] <- data
                                * You can write as much code as you'd like in between, just make sure that DataList contains the updates when you're done
                              "
                            )))
                          ),
                          size = "lg",
                          icon = shiny::icon("question"),
                          label = NULL,
                          tooltip = FALSE,
                          right = TRUE,
                          up = FALSE,
                          width = NULL,
                          animate = shinyWidgets::animateOptions(
                            enter = "zoomIn",
                            exit = "fadeOutRightBig"
                          ),
                          inputId = NULL,
                          block = FALSE,
                          no_outline = TRUE
                        )
                      ),

                      # Meta Programming Button
                      shiny::column(
                        width = 1L, align = 'right',
                        style = "padding-top: 4px;padding-right: 50px;",
                        shiny::actionButton(
                          inputId = 'DataWranglingButton_MetaProgramming',
                          label = 'Run',
                          icon = shiny::icon('chevron-right', lib='font-awesome')
                        )
                      )
                    ),

                    Quantico::BlankRow(12L),
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = "danger", width = 12L,
                      shiny::fluidRow(
                        shiny::column(
                          6L, align = "center",
                          selectInput(
                            "editor_theme1",
                            "Theme:",
                            choices = shinyAce::getAceThemes(),
                            selected = "cobalt"))),
                      Quantico:::BlankRow(12L)),
                    Quantico:::BlankRow(12L),
                    shiny::fluidRow(
                      shiny::column(
                        8L, align = 'center',
                        shinyAce::aceEditor(
                          "MetaProgramming_TextCode",
                          mode = "r",
                          wordWrap = TRUE,
                          theme = "cobalt",
                          height = "160px",
                          tabSize = 2,
                          minLines = 33,
                          fontSize = 14,
                          autoComplete = "live"))),

                    # Blank space
                    Quantico:::BlankRow(12L),
                    Quantico:::BlankRow(12L),
                    Quantico:::BlankRow(12L),
                    Quantico:::BlankRow(12L),
                    Quantico:::BlankRow(12L)
                  )
                ),

              # Fill
              shiny::tabPanel(
                title = "Time Series Fill",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  Quantico:::BlankRow(12L),
                  shiny::fluidRow(
                    style = ModelHelpFormat,
                    shiny::column(
                      width = 3L,
                      tags$h4(tags$span(tags$b(paste0('Time Series Fill'))))
                    ),
                    shiny::column(
                      width = 8L,
                      align = "right",
                      shinyWidgets::dropdown(
                        shinydashboard::box(
                          title = NULL, solidHeader = TRUE, collapsible = FALSE, status = "info", width = 12L,
                          shiny::fluidRow(
                            shiny::column(
                              width = 12L,
                              align = "left",
                              shiny::a(name = "timeseriesfill"),
                              shiny::h1(tags$b("Time Series Fill")),
                              shiny::p("The Time Series Fill operation is for preparing
                           time series data that has a few gaps in the data... ")
                            )
                          ),

                          Quantico::BlankRow(12),
                          shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::h3("Time Series Fill Usage"))),
                          shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::markdown(
                            "
                            Time Series Fill operation will ensure that your time series data is not missing any dates
                            * Choose data set: This is the dataset you want to utilize for the operation
                            * New Data Name: select a new name to have a new dataset create, otherwise leave blank
                            * Time Unit: Select a time unit that describes your data's time granularity
                            * Max Miss %: Any group levels that are missing more than the max will be dropped from your dataset
                            * Date Column: This is the info date column that determines your times series data
                            * Grouping Columns: If you have panel data, supply your group variables here
                            * Impute value: for missing dates that get created, what value do you want supplied? Zero is a natural options but there are others to select from
                            "
                          )))
                        ),
                        size = "lg",
                        icon = shiny::icon("question"),
                        label = NULL,
                        tooltip = FALSE,
                        right = TRUE,
                        up = FALSE,
                        width = NULL,
                        animate = shinyWidgets::animateOptions(
                          enter = "zoomIn",
                          exit = "fadeOutRightBig"
                        ),
                        inputId = NULL,
                        block = FALSE,
                        no_outline = TRUE
                      )
                    ),

                    # TSF Programming Button
                    shiny::column(
                      width = 1L, align = 'right',
                      style = "padding-top: 4px;padding-right: 50px;",
                      shiny::actionButton(
                        inputId = 'DataWrangling_TimeSeriesFill',
                        label = 'Run',
                        icon = shiny::icon('chevron-right', lib='font-awesome')
                      )
                    )
                  ),

                  Quantico:::BlankRow(12L),
                  shinydashboard::box(
                    title = NULL, solidHeader = TRUE, collapsible = FALSE, status = "danger", width = 12L,
                    Quantico:::BlankRow(12L),
                    shiny::fluidRow(
                      shiny::column(
                        4L, align = "center",
                        Quantico:::SelectizeInput(InputID='TSF_SelectData', Label = 'Choose data set', Choices = TSF_SelectData_Choices, SelectedDefault = TSF_SelectData_Selected, Multiple = TRUE, MaxVars = 1)
                      ))),

                  Quantico:::BlankRow(12L),

                  shiny::fluidRow(
                    shiny::column(
                      6L, align = "center",
                      shinydashboard::box(
                        title = NULL, solidHeader = TRUE, collapsible = FALSE, status = "danger", width = 12L,
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(
                          Quantico:::BlankRow(12L),
                          shiny::column(
                            12L, align = "center",
                            Quantico:::TextInput(InputID='TSF_NewName', Label='New Data Name', Value = TSF_NewName_Selected)
                          ),
                          Quantico:::BlankRow(12L),
                          shiny::column(
                            12L, align = "center",
                            Quantico:::SelectizeInput(InputID='TSF_TimeUnit', Label='Time Unit', Choices = TSF_TimeUnit_Choices, SelectedDefault = TSF_TimeUnit_Selected, Multiple = TRUE, MaxVars = 1)
                          ),
                          Quantico:::BlankRow(12L),
                          shiny::column(
                            12L, align = "center",
                            Quantico:::SelectizeInput(InputID='TSF_MaxMissingPercent', Label='Max Miss %', Choices = TSF_MaxMissingPercent_Choices, SelectedDefault = TSF_MaxMissingPercent_Selected, Multiple = TRUE, MaxVars = 1)
                          )
                        )
                      )
                    ),
                    shiny::column(
                      6L, align = "center",
                      shinydashboard::box(
                        title = NULL, solidHeader = TRUE, collapsible = FALSE, status = "danger", width = 12L,
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(
                          shiny::column(
                            12L, align = "center",
                            Quantico:::PickerInput(InputID='TSF_DateColumnName', Label='Date Column', Choices = NULL, SelectedDefault = TSF_DateColumnName_Selected, Multiple = TRUE)
                          ),
                          Quantico:::BlankRow(12L),
                          shiny::column(
                            12L, align = "center",
                            Quantico:::PickerInput(InputID='TSF_GroupVariables', Label='Grouping Columns', Choices = NULL, SelectedDefault = TSF_GroupVariables_Selected, Multiple = TRUE)
                          ),
                          Quantico:::BlankRow(12L),
                          shiny::column(
                            12L, align = "center",
                            Quantico:::SelectizeInput(InputID='TSF_SimpleImpute', Label='Impute Value', Choices = TSF_SimpleImpute_Choices, SelectedDefault = TSF_SimpleImpute_Selected, Multiple = TRUE, MaxVars = 1)
                          )
                        )
                      )
                    )
                  ),

                  # Blank space
                  Quantico:::BlankRow(12L),
                  Quantico:::BlankRow(12L),
                  Quantico:::BlankRow(12L),
                  Quantico:::BlankRow(12L),
                  Quantico:::BlankRow(12L)
                )
              ),

              # Fill and Roll
              shiny::tabPanel(
                title = "Time Series Roll",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  Quantico:::BlankRow(12L),
                  shiny::fluidRow(
                    style = ModelHelpFormat,
                    shiny::column(
                      width = 3L,
                      tags$h4(tags$span(tags$b(paste0('Time Series Roll'))))
                    ),
                    shiny::column(
                      width = 8L,
                      align = "right",
                      shinyWidgets::dropdown(
                        shinydashboard::box(
                          title = NULL, solidHeader = TRUE, collapsible = FALSE, status = "info", width = 12L,
                          shiny::fluidRow(
                            shiny::column(
                              width = 12L,
                              align = "left",
                              shiny::a(name = "timeseriesfillroll"),
                              shiny::h1(tags$b("Time Series Roll")),
                              shiny::p("The Time Series Roll operation is for preparing
                           intermittent demand time series data that has a lot
                           of gaps in the data... ")
                            )
                          ),

                          Quantico::BlankRow(12),
                          shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::h3("Time Series Fill Roll Usage"))),
                          shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::markdown(
                            "
                            Time Series Roll operation is for converting intermittent demand data into regular panel data but spreading the demand spike across time
                            * Choose data set: This is the dataset you want to utilize for the operation
                            * New Data Name: select a new name to have a new dataset create, otherwise leave blank
                            * Time Unit: Select a time unit that describes your data's time granularity
                            * Date Column: This is the info date column that determines your times series data
                            * Grouping Columns: If you have panel data, supply your group variables here
                            * Impute value: for missing dates that get created, what value do you want supplied? Zero is a natural options but there are others to select from
                            * Roll Vars: These are the columns that need there values 'spread' across time
                            * Non Roll Vars: These columns are not spread out over time
                            * Roll Direction: Do you want your demand spikes spread forward in time or backwards in time?
                            "
                          )))
                        ),
                        size = "lg",
                        icon = shiny::icon("question"),
                        label = NULL,
                        tooltip = FALSE,
                        right = TRUE,
                        up = FALSE,
                        width = NULL,
                        animate = shinyWidgets::animateOptions(
                          enter = "zoomIn",
                          exit = "fadeOutRightBig"
                        ),
                        inputId = NULL,
                        block = FALSE,
                        no_outline = TRUE
                      )
                    ),

                    # TSRF Programming Button
                    shiny::column(
                      width = 1L, align = 'right',
                      style = "padding-top: 4px;padding-right: 50px;",
                      shiny::actionButton(
                        inputId = 'DataWrangling_TimeSeriesRoll',
                        label = 'Run',
                        icon = shiny::icon('chevron-right', lib='font-awesome')
                      )
                    )
                  ),

                  Quantico:::BlankRow(12L),
                  shiny::fluidRow(
                    shiny::column(
                      6L, align = "center",
                      shinydashboard::box(
                        title = NULL, solidHeader = TRUE, collapsible = FALSE, status = "danger", width = 12L,
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(
                          Quantico:::BlankRow(12L),
                          shiny::column(
                            12L, align = "center",
                            Quantico:::SelectizeInput(InputID='Roll_SelectData', Label = 'Choose data set', Choices = Roll_SelectData_Choices, SelectedDefault = Roll_SelectData_Selected, Multiple = TRUE, MaxVars = 1)
                          ),
                          Quantico:::BlankRow(12L),
                          shiny::column(
                            12L, align = "center",
                            Quantico:::TextInput(InputID='Roll_NewName', Label='New Data Name', Value = Roll_NewName_Selected)
                          ),
                          Quantico:::BlankRow(12L),
                          shiny::column(
                            12L, align = "center",
                            Quantico:::SelectizeInput(InputID='Roll_TimeUnit', Label='Time Unit', Choices = Roll_TimeUnit_Choices, SelectedDefault = Roll_TimeUnit_Selected, Multiple = TRUE, MaxVars = 1)
                          ),
                          Quantico:::BlankRow(12L),
                          shiny::column(
                            12L, align = "center",
                            Quantico:::PickerInput(InputID='Roll_DateColumnName', Label='Date Column', Choices = NULL, SelectedDefault = Roll_DateColumnName_Selected, Multiple = TRUE)
                          ),
                          Quantico:::BlankRow(12L),
                          shiny::column(
                            12L, align = "center",
                            Quantico:::PickerInput(InputID='Roll_GroupVariables', Label='Grouping Columns', Choices = NULL, SelectedDefault = Roll_GroupVariables_Selected, Multiple = TRUE)
                          )
                        )
                      )
                    ),

                    shiny::column(
                      6L, align = "center",
                      shinydashboard::box(
                        title = NULL, solidHeader = TRUE, collapsible = FALSE, status = "danger", width = 12L,
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(
                          Quantico:::BlankRow(12L),
                          shiny::column(
                            12L, align = "center",
                            Quantico:::SelectizeInput(InputID='Roll_SimpleImpute', Label='Impute Value', Choices = Roll_SimpleImpute_Choices, SelectedDefault = Roll_SimpleImpute_Selected, Multiple = TRUE, MaxVars = 1)
                          ),
                          Quantico:::BlankRow(12L),
                          shiny::column(
                            12L, align = "center",
                            Quantico:::PickerInput(InputID='Roll_RollVars', Label='Roll Vars', Choices = NULL, SelectedDefault = Roll_RollVars_Selected, Multiple = TRUE)
                          ),
                          Quantico:::BlankRow(12L),
                          shiny::column(
                            12L, align = "center",
                            Quantico:::PickerInput(InputID='Roll_NonRollVars', Label='Non Roll Vars', Choices = NULL, SelectedDefault = Roll_NonRollVars_Selected, Multiple = TRUE)
                          ),
                          Quantico:::BlankRow(12L),
                          shiny::column(
                            12L, align = "center",
                            Quantico:::SelectizeInput(InputID='Roll_RollDirection', Label='Roll Direction', Choices = Roll_RollDirection_Choices, SelectedDefault = Roll_RollDirection_Selected, Multiple = TRUE, MaxVars = 1)
                          )
                        )
                      )
                    )
                  ),

                  # Blank space
                  Quantico:::BlankRow(12L),
                  Quantico:::BlankRow(12L),
                  Quantico:::BlankRow(12L),
                  Quantico:::BlankRow(12L),
                  Quantico:::BlankRow(12L)
                )
              )

            ) # end Tab Panel Main
          ), # end TagList

          footer = shiny::tagList(
            shiny::modalButton(label = "Cancel"),
            shiny::actionButton("Misc_OK", "OK", width = '50px'))))
    })
}

# ----

# ----

# @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ ----
# ::  Feature Engineering  ::                                                                                    ----
# @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ ----

#' @title Windowing_Modal_Fun
#'
#' @description Windowing Methods Modal with OK button to close
#'
#' @author Adrian Antico
#' @family FE
#'
#' @param id = 'Windowing_ID'
#' @param AppWidth = 12L
#'
#' @export
Windowing_Modal_Fun <- function(id,
                                AppWidth=12L,

                                # Reactives
                                AutoLagRollStats_Targets_Selected = NULL,
                                AutoLagRollStats_GroupVars_Selected = NULL,
                                AutoLagRollStats_DateColumn_Selected = NULL,
                                AutoDiffLagN_DateVariable_Selected = NULL,
                                AutoDiffLagN_GroupVariables_Selected = NULL,
                                AutoDiffLagN_DiffVariables_Selected = NULL,
                                AutoDiffLagN_DiffDateVariables_Selected = NULL,
                                AutoDiffLagN_DiffGroupVariables_Selected = NULL,
                                AutoLagRollMode_Targets_Selected = NULL,
                                AutoLagRollMode_GroupingVars_Selected = NULL,
                                AutoLagRollMode_SortDateName_Selected = NULL,

                                # Statics
                                AutoLagRollStats_SelectData_Choices = NULL,
                                AutoLagRollStats_TimeUnits_Choices = NULL,
                                AutoLagRollStats_RollOnLag1_Choices = NULL,
                                AutoLagRollStats_Lags_Choices = NULL,
                                AutoLagRollStats_MA_RollWindows_Choices = NULL,
                                AutoLagRollStats_SD_RollWindows_Choices = NULL,
                                AutoLagRollStats_Skew_RollWindows_Choices = NULL,
                                AutoLagRollStats_Kurt_RollWindows_Choices = NULL,
                                AutoLagRollStats_Quantile_RollWindows_Choices = NULL,
                                AutoLagRollStats_Quantiles_Selected_Choices = NULL,
                                AutoDiffLagN_SelectData_Choices = NULL,
                                AutoDiffLagN_NLag1_Choices = NULL,
                                AutoDiffLagN_NLag2_Choices = NULL,
                                AutoLagRollMode_SelectData_Choices = NULL,
                                AutoLagRollMode_Lags_Choices = NULL,
                                AutoLagRollMode_ModePeriods_Choices = NULL,
                                AutoLagRollMode_WindowingLag_Choices = NULL,

                                # Updaters
                                AutoLagRollStats_SelectData_Selected = NULL,
                                AutoLagRollStats_TimeUnits_Selected = NULL,
                                AutoLagRollStats_RollOnLag1_Selected = NULL,
                                AutoLagRollStats_Lags_Selected = NULL,
                                AutoLagRollStats_MA_RollWindows_Selected = NULL,
                                AutoLagRollStats_SD_RollWindows_Selected = NULL,
                                AutoLagRollStats_Skew_RollWindows_Selected = NULL,
                                AutoLagRollStats_Kurt_RollWindows_Selected = NULL,
                                AutoLagRollStats_Quantile_RollWindows_Selected = NULL,
                                AutoLagRollStats_Quantiles_Selected_Selected = NULL,
                                AutoDiffLagN_SelectData_Selected = NULL,
                                AutoDiffLagN_NLag1_Selected = NULL,
                                AutoDiffLagN_NLag2_Selected = NULL,
                                AutoLagRollMode_SelectData_Selected = NULL,
                                AutoLagRollMode_Lags_Selected = NULL,
                                AutoLagRollMode_ModePeriods_Selected = NULL,
                                AutoLagRollMode_WindowingLag_Selected = NULL) {

  shiny::moduleServer(
    id = id,
    module = function(input, output, session) {
      ns <- session$ns
      shiny::showModal(
        shiny::modalDialog(
          title = 'Windowing Variables',
          size = "l",
          easyClose = FALSE,
          fade = TRUE,
          shiny::tagList(

            Quantico:::BlankRow(12L),

            # Tabs
            shiny::tabsetPanel(
              id = 'Windowing_TabPanel',
              selected = 'Rolling Numeric',

              # Numeric: Auto Lag Roll Stats ----
              shiny::tabPanel(
                title = "Rolling Numeric",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  Quantico:::BlankRow(12L),
                  shiny::fluidRow(
                    style = ModelHelpFormat,
                    shiny::column(
                      width = 3L,
                      tags$h4(tags$span(tags$b(paste0('Rolling Numeric'))))
                    ),
                    shiny::column(
                      width = 8L,
                      align = "right",
                      shinyWidgets::dropdown(
                        shinydashboard::box(
                          title = NULL, solidHeader = TRUE, collapsible = FALSE, status = "info", width = 12L,
                          shiny::fluidRow(
                            shiny::column(
                              width = 12L,
                              align = "left",
                              shiny::a(name = "numericvariables"),
                              shiny::h1(tags$b("Numeric Variables")),
                              shiny::p("The Numeric Variable menu provides operations to generate a variety
                           of lags and rolling statistics. The rolling stats include: 'mean',
                           'sd', skewness', 'kurtosis', and quantiles, which can all be
                           generated by group variables...")
                            )
                          ),

                          Quantico::BlankRow(12),
                          shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::h3("Numeric Variables Usage"))),
                          shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::markdown(
                            "
                              Numeric Variables operation is for generating lags and rolling statistics
                              * Choose Data Set: This is your source dataset
                              * Target Variables: Select at least one target variable which are used to create the lags and rolling stats
                              * By-Variables: Select all the group variables that when combined, create unique time series sets
                              * Date Variable: This date variable is used to define the time series' and windowing for lags and rolling stats
                              * Window Lag: Choose 0 to utilize the current target variable and 1 to utilize the lag-1 version of the target variable. This is important because if you utilize the current Target Variable you can introduce forward leak into your data if you plan on using the lags and rolling stats as features in a model
                              * Time Aggregation: This is the time-grain of your data. If you data is on a daily cadence then select 'day' for example
                              * Lags: Select lags from the list. You can select any values you'd like. For example, you can select lag 4 without selecting lags 1-3
                              * Rolling Mean: rolling average window sizes to select. Select as many as you'd like
                              * Rolling StDev: rolling standard deviation window sizes to select. Select as many as you'd like
                              * Rolling Skew: rolling skew window sizes to select. Select as many as you'd like
                              * Rolling Kurtosis: rolling kurtosis window sizes to select. Select as many as you'd like
                              * Rolling Percentile: rolling percentile window sizes to select. Select as many as you'd like
                              * Selected Percentiles: select which percentiles you want to run for all the Rolling Percentile window sizes
                              "
                          )))
                        ),
                        size = "lg",
                        icon = shiny::icon("question"),
                        label = NULL,
                        tooltip = FALSE,
                        right = TRUE,
                        up = FALSE,
                        width = NULL,
                        animate = shinyWidgets::animateOptions(
                          enter = "zoomIn",
                          exit = "fadeOutRightBig"
                        ),
                        inputId = NULL,
                        block = FALSE,
                        no_outline = TRUE
                      )
                    ),

                    # Agg Data Button
                    shiny::column(
                      width = 1L, align = 'right',
                      style = "padding-top: 4px;padding-right: 50px;",
                      shiny::actionButton(
                        inputId = 'FeatureEngineeringButton_AutoLagRollStats',
                        label = 'Run',
                        icon = shiny::icon('chevron-right', lib='font-awesome')
                      )
                    )
                  ),

                  Quantico:::BlankRow(12L),
                  shinydashboard::box(
                    title = NULL, solidHeader = TRUE, collapsible = FALSE, status = "danger", width = 12L,
                    Quantico::BlankRow(12L),
                    shiny::fluidRow(
                      width=12L,
                      shiny::column(6L, align = 'center', Quantico:::SelectizeInput(InputID='AutoLagRollStats_SelectData', Label='Choose data set', Choices = AutoLagRollStats_SelectData_Choices, SelectedDefault = AutoLagRollStats_SelectData_Selected, Multiple = TRUE, MaxVars = 1)))),

                  Quantico::BlankRow(12L),
                  shiny::fluidRow(
                    shiny::column(
                      4L, align = "center",
                      shinydashboard::box(
                        title = NULL, solidHeader = TRUE, collapsible = FALSE, status = "danger", width = 12L,
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::PickerInput(InputID='AutoLagRollStats_Targets', Label='Target Variables', Choices = NULL, SelectedDefault = AutoLagRollStats_Targets_Selected, Multiple = TRUE))),
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::PickerInput(InputID='AutoLagRollStats_GroupVars', Label='By-Variables', Choices = NULL, SelectedDefault = AutoLagRollStats_GroupVars_Selected, Multiple = TRUE))),
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::PickerInput(InputID='AutoLagRollStats_DateColumn', Label='Date Variable', Choices = NULL, SelectedDefault = AutoLagRollStats_DateColumn_Selected, Multiple = TRUE))),
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='AutoLagRollStats_RollOnLag1', Label='Window Lag', Choices = AutoLagRollStats_RollOnLag1_Choices, SelectedDefault = AutoLagRollStats_RollOnLag1_Selected, Multiple = TRUE, MaxVars = 1))),
                        Quantico:::BlankRow(12L))
                    ),

                    shiny::column(
                      4L, align = "center",
                      shinydashboard::box(
                        title = NULL, solidHeader = TRUE, collapsible = FALSE, status = "danger", width = 12L,
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='AutoLagRollStats_TimeUnits', Label='Time Aggregation', Choices = AutoLagRollStats_TimeUnits_Choices, SelectedDefault = AutoLagRollStats_TimeUnits_Selected, Multiple = TRUE, MaxVars = 100))),
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::NumericInput(InputID='AutoLagRollStats_Lags', Label='Lags', Value = AutoLagRollStats_Lags_Selected, Min = 0, Max = 10000, Step = 1))),
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::NumericInput(InputID='AutoLagRollStats_MA_RollWindows', Label='Rolling Mean', Value = AutoLagRollStats_MA_RollWindows_Selected, Min = 0, Max = 10000, Step = 1))),
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::NumericInput(InputID='AutoLagRollStats_SD_RollWindows', Label='Rolling StDev', Value = AutoLagRollStats_SD_RollWindows_Selected, Min = 0, Max = 10000, Step = 1))),
                        Quantico:::BlankRow(12L))
                    ),

                    shiny::column(
                      4L, align = "center",
                      shinydashboard::box(
                        title = NULL, solidHeader = TRUE, collapsible = FALSE, status = "danger", width = 12L,
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::NumericInput(InputID='AutoLagRollStats_Skew_RollWindows', Label='Rolling Skew', Value = AutoLagRollStats_Skew_RollWindows_Selected, Min = 0, Max = 10000, Step = 1))),
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::NumericInput(InputID='AutoLagRollStats_Kurt_RollWindows', Label='Rolling Kurt', Value = AutoLagRollStats_Kurt_RollWindows_Selected, Min = 0, Max = 10000, Step = 1))),
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::NumericInput(InputID='AutoLagRollStats_Quantile_RollWindows', Label='Rolling Percentile', Value = AutoLagRollStats_Quantile_RollWindows_Selected, Min = 0, Max = 10000, Step = 1))),
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='AutoLagRollStats_Quantiles_Selected', Label='Select Percentiles', Choices = AutoLagRollStats_Quantiles_Selected_Choices, SelectedDefault = AutoLagRollStats_Quantiles_Selected_Selected, Multiple = TRUE, MaxVars = 100))),
                        Quantico:::BlankRow(12L))
                    )),

                  # Windowing Button
                  Quantico:::BlankRow(12L),
                  Quantico:::BlankRow(12L),
                  Quantico:::BlankRow(12L),
                  Quantico:::BlankRow(12L),
                  Quantico:::BlankRow(12L)
                )
              ),

              # Differencing: Auto Diff Lag N ----
              shiny::tabPanel(
                title = "Diff Variables",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  Quantico:::BlankRow(12L),
                  shiny::fluidRow(
                    style = ModelHelpFormat,
                    shiny::column(
                      width = 3L,
                      tags$h4(tags$span(tags$b(paste0('Differencing Variables'))))
                    ),
                    shiny::column(
                      width = 8L,
                      align = "right",
                      shinyWidgets::dropdown(
                        shinydashboard::box(
                          title = NULL, solidHeader = TRUE, collapsible = FALSE, status = "info", width = 12L,
                          shiny::fluidRow(
                            shiny::column(
                              width = 12L,
                              align = "left",
                              shiny::a(name = "diffvariables"),
                              shiny::h1(tags$b("Difference Variables")),
                              shiny::p("The Difference Variable menu provides operations to generate a variety
                                       of differencing features. First off, you can generate difference
                                       variables for numeric, date, and categorical variables, all by
                                       grouping variables if requested. Second, you can choose the
                                       start and end periods. For example, you can get the difference
                                       between current and a day ago, or 10 days age vs 27 days ago...")
                            )
                          ),

                          Quantico::BlankRow(12),
                          shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::h3("Differencing Variables Usage"))),
                          shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::markdown(
                            "
                            Differencing Variables operation is for generating differences (period to period differences) on your data
                            * Choose Data Set: This is your source dataset
                            * Date Variable: This date variable is used to define the time series' and differencing periods
                            * By-Variables: Select all the group variables that when combined, create unique time series sets
                            * Numeric Diff Variables: Select at least one diff variable which are used to create the differenced variables
                            * Date Diff Variables: Select at least one date difference variable which are used to create the days between periods
                            * Group Diff Variables: Select at least one group difference variable which are used to create the difference in group levels over periods
                            * Base Period: 0 means current, 1 means 1 period back, 2 means 2 periods back, etc. Periods are based on time grain in your data. For example, with daily data, 1 period means 1 day.
                            * Lookback Period: this is the period in the past prior to the Base Period. Same logic as the Base Period for what each value means
                            "
                          )))
                        ),
                        size = "lg",
                        icon = shiny::icon("question"),
                        label = NULL,
                        tooltip = FALSE,
                        right = TRUE,
                        up = FALSE,
                        width = NULL,
                        animate = shinyWidgets::animateOptions(
                          enter = "zoomIn",
                          exit = "fadeOutRightBig"
                        ),
                        inputId = NULL,
                        block = FALSE,
                        no_outline = TRUE
                      )
                    ),

                    # Agg Data Button
                    shiny::column(
                      width = 1L, align = 'right',
                      style = "padding-top: 4px;padding-right: 50px;",
                      shiny::actionButton(
                        inputId = 'FeatureEngineeringButton_AutoDiff',
                        label = 'Run',
                        icon = shiny::icon('chevron-right', lib='font-awesome')
                      )
                    )
                  ),

                  Quantico::BlankRow(12L),
                  shiny::fluidRow(
                    shiny::column(
                      6L, align = "center",
                      shinydashboard::box(
                        title = NULL, solidHeader = TRUE, collapsible = FALSE, status = "danger", width = 12L,
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='AutoDiffLagN_SelectData', Label='Choose data set', Choices = AutoDiffLagN_SelectData_Choices, SelectedDefault = AutoDiffLagN_SelectData_Selected, Multiple = TRUE, MaxVars = 1))),
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::PickerInput(InputID='AutoDiffLagN_DateVariable', Label='Date Variable', Choices = NULL, SelectedDefault = AutoDiffLagN_DateVariable_Selected, Multiple = TRUE))),
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::PickerInput(InputID='AutoDiffLagN_GroupVariables', Label='By-Variables', Choices = NULL, SelectedDefault = AutoDiffLagN_GroupVariables_Selected, Multiple = TRUE))),
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::PickerInput(InputID='AutoDiffLagN_DiffVariables', Label='Numeric Diff Variables', Choices = NULL, SelectedText = AutoDiffLagN_DiffVariables_Selected, SelectedDefault = NULL, Multiple = TRUE))),
                        Quantico:::BlankRow(12L))
                    ),

                    shiny::column(
                      6L, align = "center",
                      shinydashboard::box(
                        title = NULL, solidHeader = TRUE, collapsible = FALSE, status = "danger", width = 12L,
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::PickerInput(InputID='AutoDiffLagN_DiffDateVariables', Label='Date Diff Variables', Choices = NULL, SelectedDefault = AutoDiffLagN_DiffDateVariables_Selected, Multiple = TRUE))),
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::PickerInput(InputID='AutoDiffLagN_DiffGroupVariables', Label='Group Diff Variables', Choices = NULL, SelectedDefault = AutoDiffLagN_DiffGroupVariables_Selected, Multiple = TRUE))),
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::NumericInput(InputID='AutoDiffLagN_NLag1', Label='Base Period', Value = AutoDiffLagN_NLag1_Selected, Min = 0, Max = 10000, Step = 1))),
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::NumericInput(InputID='AutoDiffLagN_NLag2', Label='Lookback Period', Value = AutoDiffLagN_NLag2_Selected, Min = 1, Max = 10000, Step = 1))),
                        Quantico:::BlankRow(12L))
                    )),

                  # Blank space
                  Quantico:::BlankRow(12L),
                  Quantico:::BlankRow(12L),
                  Quantico:::BlankRow(12L),
                  Quantico:::BlankRow(12L),
                  Quantico:::BlankRow(12L)
                )
              ),

              # Categorical: Auto Lag Roll Mode ----
              shiny::tabPanel(
                title = "Categorical Variables",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                    Quantico:::BlankRow(12L),
                    shiny::fluidRow(
                      style = ModelHelpFormat,
                      shiny::column(
                        width = 3L,
                        tags$h4(tags$span(tags$b(paste0('Rolling Categorical'))))
                      ),
                      shiny::column(
                        width = 8L,
                        align = "right",
                        shinyWidgets::dropdown(
                          shinydashboard::box(
                            title = NULL, solidHeader = TRUE, collapsible = FALSE, status = "info", width = 12L,
                            shiny::fluidRow(
                              shiny::column(
                                width = 12L,
                                align = "left",
                                shiny::a(name = "categoricalvariables"),
                                shiny::h1(tags$b("Categorical Variables")),
                                shiny::p("The Categorical Variable menu provides operations to generate lags
                           and rolling modes, all by grouping variables if requested...")
                              )
                            ),

                            Quantico::BlankRow(12),
                            shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::h3("Categorical Variables Usage"))),
                            shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::markdown(
                              "
                              Categorical Variables operation is for generating rolling modes on categorical data
                              * Choose Data Set: This is your source dataset
                              * Target Variables: Select at least one categorical variable which are used to create the rolling modes
                              * By-Variables: Select all the group variables that when combined, create unique time series sets
                              * Date Variable: This date variable is used to define the time series' and rolling windows
                              * Window Lag: Choose 0 to utilize the current target variable and 1 to utilize the lag-1 version of the target variable. This is important because if you utilize the current Target Variable you can introduce forward leak into your data if you plan on using the lags and rolling stats as features in a model
                              * Lags: Select lags from the list. You can select any values you'd like. For example, you can select lag 4 without selecting lags 1-3
                              * Window Sizes: rolling mode window sizes to select. Select as many as you'd like
                              "
                            )))
                          ),
                          size = "lg",
                          icon = shiny::icon("question"),
                          label = NULL,
                          tooltip = FALSE,
                          right = TRUE,
                          up = FALSE,
                          width = NULL,
                          animate = shinyWidgets::animateOptions(
                            enter = "zoomIn",
                            exit = "fadeOutRightBig"
                          ),
                          inputId = NULL,
                          block = FALSE,
                          no_outline = TRUE
                        )
                      ),

                      # Agg Data Button
                      shiny::column(
                        width = 1L, align = 'right',
                        style = "padding-top: 4px;padding-right: 50px;",
                        shiny::actionButton(
                          inputId = 'FeatureEngineeringButton_AutoLagRollMode',
                          label = 'Run',
                          icon = shiny::icon('chevron-right', lib='font-awesome')
                        )
                      )
                    ),

                    Quantico::BlankRow(12L),
                    shiny::fluidRow(

                      shiny::column(
                        6L, align = "center",
                        shinydashboard::box(
                          title = NULL, solidHeader = TRUE, collapsible = FALSE, status = "danger", width = 12L,
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='AutoLagRollMode_SelectData', Label='Choose data set', Choices = AutoLagRollMode_SelectData_Choices, SelectedDefault = AutoLagRollMode_SelectData_Selected, Multiple = TRUE, MaxVars = 1))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::PickerInput(InputID='AutoLagRollMode_Targets', Label='Target Variables', Choices = NULL, SelectedDefault = AutoLagRollMode_Targets_Selected, Multiple = TRUE))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::PickerInput(InputID='AutoLagRollMode_GroupingVars', Label='By-Variables', Choices = NULL, SelectedDefault = AutoLagRollMode_GroupingVars_Selected, Multiple = TRUE))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::PickerInput(InputID='AutoLagRollMode_SortDateName', Label='Date Variable', Choices = NULL, SelectedDefault = AutoLagRollMode_SortDateName_Selected, Multiple = TRUE))),
                          Quantico:::BlankRow(12L))
                      ),

                      shiny::column(
                        6L, align = "center",
                        shinydashboard::box(
                          title = NULL, solidHeader = TRUE, collapsible = FALSE, status = "danger", width = 12L,
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='AutoLagRollMode_WindowingLag', Label='Window Lag', Choices = AutoLagRollMode_WindowingLag_Choices, SelectedDefault = AutoLagRollMode_WindowingLag_Selected, Multiple = TRUE, MaxVars = 1))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::NumericInput(InputID='AutoLagRollMode_Lags', Label='Lags', Value = AutoLagRollMode_Lags_Selected, Min = 0, Max = 10000, Step = 1))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::NumericInput(InputID='AutoLagRollMode_ModePeriods', Label='Window Sizes', Value = AutoLagRollMode_ModePeriods_Selected, Min = 0, Max = 10000, Step = 1))),
                          Quantico:::BlankRow(12L)
                        )
                      )),

                    # Categorical Button
                    Quantico:::BlankRow(12L),
                    Quantico:::BlankRow(12L),
                    Quantico:::BlankRow(12L),
                    Quantico:::BlankRow(12L),
                    Quantico:::BlankRow(12L)
                  )
                )
            ) # end Tab Panel Main
          ), # end TagList

          footer = shiny::tagList(
            shiny::modalButton(label = "Cancel"),
            shiny::actionButton("Windowing_OK", "OK", width = '50px'))))
    })
}

#' @title Calendar_Modal_Fun
#'
#' @description Windowing Methods Modal with OK button to close
#'
#' @author Adrian Antico
#' @family FE
#'
#' @param id = 'Calendar_Modal_Fun'
#' @param AppWidth = 12L
#'
#' @export
Calendar_Modal_Fun <- function(id,
                               AppWidth=12L,

                               # Reactives
                               CalendarVariables_DateVariables_Selected = NULL,
                               HolidayVariables_DateVariables_Selected = NULL,
                               HolidayVariables_HolidayGroups_Selected = NULL,
                               HolidayVariables_LookbackDays_Selected = NULL,

                               # Statics
                               CalendarVariables_SelectData_Choices = NULL,
                               CalendarVariables_TimeUnits_Choices = NULL,
                               HolidayVariables_SelectData_Choices = NULL,
                               HolidayVariables_HolidayGroups_Choices = NULL,
                               HolidayVariables_LookbackDays_Choices = NULL,

                               # Updaters
                               CalendarVariables_SelectData_Selected = NULL,
                               CalendarVariables_TimeUnits_Selected = NULL,
                               HolidayVariables_SelectData_Selected = NULL) {

  shiny::moduleServer(
    id = id,
    module = function(input, output, session) {
      ns <- session$ns
      shiny::showModal(
        shiny::modalDialog(
          title = 'Calendar Features',
          size = "l",
          easyClose = FALSE,
          fade = TRUE,
          shiny::tagList(

            Quantico:::BlankRow(12L),

            # Tabs
            shiny::tabsetPanel(
              id = 'Calendar_TabPanel',
              selected = 'Calendar Features',

              # Calendar: Create Calendar Variables ----
              shiny::tabPanel(
                title = "Calendar Features",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  Quantico:::BlankRow(12L),
                  shiny::fluidRow(
                    style = ModelHelpFormat,
                    shiny::column(
                      width = 3L,
                      tags$h4(tags$span(tags$b(paste0('Calendar Features'))))
                    ),
                    shiny::column(
                      width = 8L,
                      align = "right",
                      shinyWidgets::dropdown(
                        shinydashboard::box(
                          title = NULL, solidHeader = TRUE, collapsible = FALSE, status = "info", width = 12L,
                          shiny::fluidRow(
                            shiny::column(
                              width = 12L,
                              align = "left",
                              shiny::a(name = "calendarvariables"),
                              shiny::h1(tags$b("Calendar Variables")),
                              shiny::p("The Calendar Variables operation generates
                                        a columns for all time granularities, including: "),
                              shiny::markdown(
                                "
                                * second
                                * minute
                                * hour
                                * day
                                * week
                                * iso week
                                * week of month
                                * month
                                * quarter
                                * year
                                "
                              )
                            )
                          ),

                          Quantico::BlankRow(12),
                          shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::h3("Calendar Variables Usage"))),
                          shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::markdown(
                            "
                            Calendar Variables operation is for generating variables that represent respective time categories of meaning
                            * Choose Data Set: This is your source dataset
                            * Date Columns: Select at least one date column which are used to create the calendar variables
                            * Time Units: select the time units that you want to have converted to calendar variables
                            "
                          )))
                        ),
                        size = "lg",
                        icon = shiny::icon("question"),
                        label = NULL,
                        tooltip = FALSE,
                        right = TRUE,
                        up = FALSE,
                        width = NULL,
                        animate = shinyWidgets::animateOptions(
                          enter = "zoomIn",
                          exit = "fadeOutRightBig"
                        ),
                        inputId = NULL,
                        block = FALSE,
                        no_outline = TRUE
                      )
                    ),

                    # Agg Data Button
                    shiny::column(
                      width = 1L, align = 'right',
                      style = "padding-top: 4px;padding-right: 50px;",
                      shiny::actionButton(
                        inputId = 'FeatureEngineeringButton_CalendarVariables',
                        label = 'Run',
                        icon = shiny::icon('chevron-right', lib='font-awesome')
                      )
                    )
                  ),

                  Quantico:::BlankRow(12L),
                  shiny::fluidRow(
                    shiny::column(
                      6L,
                      shinydashboard::box(
                        title = NULL, solidHeader = TRUE, collapsible = FALSE, status = "danger", width = 12L,
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='CalendarVariables_SelectData', Label='Choose data set', Choices = CalendarVariables_SelectData_Choices, SelectedDefault = CalendarVariables_SelectData_Selected, Multiple = TRUE, MaxVars = 1))),
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::PickerInput(InputID='CalendarVariables_DateVariables', Label='Date Columns', Choices = NULL, SelectedDefault = CalendarVariables_DateVariables_Selected, Multiple = TRUE))),
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='CalendarVariables_TimeUnits', Label='Time Units', Choices = CalendarVariables_TimeUnits_Choices, SelectedDefault = CalendarVariables_TimeUnits_Selected, Multiple = TRUE, MaxVars = 1)),
                                        Quantico:::BlankRow(12L))))

                  ),

                  # Blank space
                  Quantico:::BlankRow(12L),
                  Quantico:::BlankRow(12L),
                  Quantico:::BlankRow(12L),
                  Quantico:::BlankRow(12L),
                  Quantico:::BlankRow(12L)
                )
              ),

              # Holiday: Create Holiday Variables ----
              shiny::tabPanel(
                title = "Holiday Features",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  Quantico:::BlankRow(12L),
                  shiny::fluidRow(
                    style = ModelHelpFormat,
                    shiny::column(
                      width = 3L,
                      tags$h4(tags$span(tags$b(paste0('Holiday Features'))))
                    ),
                    shiny::column(
                      width = 8L,
                      align = "right",
                      shinyWidgets::dropdown(
                        shinydashboard::box(
                          title = NULL, solidHeader = TRUE, collapsible = FALSE, status = "info", width = 12L,
                          shiny::fluidRow(
                            shiny::column(
                              width = 12L,
                              align = "left",
                              shiny::a(name = "holidayvariables"),
                              shiny::h1(tags$b("Holiday Variables")),
                              shiny::p("The Holiday Variables operation generates
                           a columns for many holiday types, including: "),
                              shiny::markdown(
                                "
                                * US Public Holidays
                                * Easter Group Holiday
                                * Christmas Group Holidays
                                * Other Ecclestical Feasts Holidays
                                "
                              )
                            )
                          ),

                          Quantico::BlankRow(12),
                          shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::h3("Holiday Variables Usage"))),
                          shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::markdown(
                            "
                            Holiday Variables operation is for generating variables that represent respective holiday categories
                            * Choose Data Set: This is your source dataset
                            * Date Columns: Select at least one date column which are used to create the calendar variables
                            * Holiday Selection: select the holiday categories of interest
                            * Lookback Days: for each current row in your dataset, the lookback days will inspect that time period back in time to evaluate if a holiday fell within that window. This is useful for holidays that have an effect that lasts more than just the day the holiday landed on
                            "
                          )))
                        ),
                        size = "lg",
                        icon = shiny::icon("question"),
                        label = NULL,
                        tooltip = FALSE,
                        right = TRUE,
                        up = FALSE,
                        width = NULL,
                        animate = shinyWidgets::animateOptions(
                          enter = "zoomIn",
                          exit = "fadeOutRightBig"
                        ),
                        inputId = NULL,
                        block = FALSE,
                        no_outline = TRUE
                      )
                    ),

                    # Agg Data Button
                    shiny::column(
                      width = 1L, align = 'right',
                      style = "padding-top: 4px;padding-right: 50px;",
                      shiny::actionButton(
                        inputId = 'FeatureEngineeringButton_HolidayVariables',
                        label = 'Run',
                        icon = shiny::icon('chevron-right', lib='font-awesome')
                      )
                    )
                  ),

                  Quantico:::BlankRow(12L),
                  shiny::fluidRow(
                    shiny::column(
                      6L,
                      shinydashboard::box(
                        title = NULL, solidHeader = TRUE, collapsible = FALSE, status = "danger", width = 12L,
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='HolidayVariables_SelectData', Label='Choose data set', Choices = HolidayVariables_SelectData_Choices, SelectedDefault = HolidayVariables_SelectData_Selected, Multiple = TRUE, MaxVars = 1))),
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::PickerInput(InputID='HolidayVariables_DateVariables', Label='Date Variables', Choices = NULL, SelectedDefault = HolidayVariables_DateVariables_Selected, Multiple = TRUE))),
                        Quantico:::BlankRow(12L))),

                    shiny::column(
                      6L,
                      shinydashboard::box(
                        title = NULL, solidHeader = TRUE, collapsible = FALSE, status = "danger", width = 12L,
                        shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='HolidayVariables_HolidayGroups', Label='Holiday Selection', Choices = HolidayVariables_HolidayGroups_Choices, SelectedDefault = HolidayVariables_HolidayGroups_Selected, Multiple = TRUE, MaxVars = 10))),
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::NumericInput(InputID='HolidayVariables_LookbackDays', Label='Lookback Days', Value = HolidayVariables_LookbackDays_Selected, Min = 1, Max = 28, Step = 1))),
                        Quantico:::BlankRow(12L)
                      )
                    )
                  ),

                  # Holiday Button
                  Quantico:::BlankRow(12L),
                  Quantico:::BlankRow(12L),
                  Quantico:::BlankRow(12L),
                  Quantico:::BlankRow(12L)
                )
              )
            ) # end Tab Panel Main
          ), # end TagList

          footer = shiny::tagList(
            shiny::modalButton(label = "Cancel"),
            shiny::actionButton("Calendar_OK", "OK", width = '50px'))))
    })
}

#' @title Categorical_Modal_Fun
#'
#' @description Categorical variables
#'
#' @author Adrian Antico
#' @family FE
#'
#' @param id = 'Categorical_Modal_Fun'
#' @param AppWidth = 12L
#'
#' @export
Categorical_Modal_Fun <- function(id,
                                  AppWidth=12L,

                                  # Reactives
                                  CategoricalEncoding_GroupVariables_Selected = NULL,
                                  CategoricalEncoding_TargetVariable_Selected = NULL,
                                  DummifyDT_Cols_Selected = NULL,

                                  # Statics
                                  CategoricalEncoding_TrainData_Choices = NULL,
                                  CategoricalEncoding_Method_Choices = NULL,
                                  CategoricalEncoding_ValidationData_Choices = NULL,
                                  CategoricalEncoding_TestData_Choices = NULL,
                                  DummifyDT_SelectData_Choices = NULL,
                                  DummifyDT_TopN_Choices = NULL,
                                  DummifyDT_KeepBaseCols_Choices = NULL,

                                  # Updaters
                                  CategoricalEncoding_TrainData_Selected = NULL,
                                  CategoricalEncoding_Method_Selected = NULL,
                                  CategoricalEncoding_ValidationData_Selected = NULL,
                                  CategoricalEncoding_TestData_Selected = NULL,
                                  DummifyDT_SelectData_Selected = NULL,
                                  DummifyDT_TopN_Selected = NULL,
                                  DummifyDT_KeepBaseCols_Selected = NULL) {

  shiny::moduleServer(
    id = id,
    module = function(input, output, session) {
      ns <- session$ns
      shiny::showModal(
        shiny::modalDialog(
          title = 'Categorical Features',
          size = "l",
          easyClose = FALSE,
          fade = TRUE,
          shiny::tagList(

            Quantico:::BlankRow(12L),

            # Tabs
            shiny::tabsetPanel(
              id = 'Categorical_TabPanel',
              selected = 'Categorical Encoding',

              # Categorical ----
              shiny::tabPanel(
                title = "Categorical Encoding",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  Quantico:::BlankRow(12L),
                  shiny::fluidRow(
                    style = ModelHelpFormat,
                    shiny::column(
                      width = 3L,
                      tags$h4(tags$span(tags$b(paste0('Categorical Encoding'))))
                    ),
                    shiny::column(
                      width = 8L,
                      align = "right",
                      shinyWidgets::dropdown(
                        shinydashboard::box(
                          title = NULL, solidHeader = TRUE, collapsible = FALSE, status = "info", width = 12L,
                          shiny::fluidRow(
                            shiny::column(
                              width = 12L,
                              align = "left",
                              shiny::a(name = "categoricalencoding"),
                              shiny::h1(tags$b("Categorical Encoding")),
                              shiny::p("The Categorical Encoding menu provides operations to generate
                           encoding variables. These encodings include: ..."),
                              shiny::markdown(
                                "
                                  * Nested Mixed Effects: blends data across levels if levels have low sample sizes, with respect to the target variable; example: customer -> sku -> brand
                                  * Credibility (James-Stein): blends data across the levels of the variable and overal mean if the group levels have low sample sizes, with respect to the target variable
                                  * Target Encoding: average by group level with respect to the target variable
                                  * Weight of Evidence (woe)
                                  * Poly Encode
                                  * Backward Difference
                                  * Helmert
                                  "
                              )
                            )
                          ),

                          Quantico::BlankRow(12),
                          shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::h3("Categorical Encoding Usage"))),
                          shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::markdown(
                            "
                              Categorical Variables operation is for generating rolling modes on categorical data
                              * Train Data: This is your training dataset. This one is required
                              * Validation Data: Optional. If you have a validation dataset supply that here
                              * Test Data: Optional. If you have a test dataset supply that here
                              * Group Variables: Select all the group variables that when combined, create unique time series sets
                              * Target Variables: Select at least one categorical variable which are used to create the encodings
                              * Encoding Method: Select one method to encode your variables
                              "
                          )))
                        ),
                        size = "lg",
                        icon = shiny::icon("question"),
                        label = NULL,
                        tooltip = FALSE,
                        right = TRUE,
                        up = FALSE,
                        width = NULL,
                        animate = shinyWidgets::animateOptions(
                          enter = "zoomIn",
                          exit = "fadeOutRightBig"
                        ),
                        inputId = NULL,
                        block = FALSE,
                        no_outline = TRUE
                      )
                    ),

                    # Agg Data Button
                    shiny::column(
                      width = 1L, align = 'right',
                      style = "padding-top: 4px;padding-right: 50px;",
                      shiny::actionButton(
                        inputId = 'FeatureEngineeringButton_CategoricalEncoding',
                        label = 'Run',
                        icon = shiny::icon('chevron-right', lib='font-awesome')
                      )
                    )
                  ),

                  Quantico:::BlankRow(12L),
                  shiny::fluidRow(
                    shiny::column(
                      6L,
                      shinydashboard::box(
                        title = NULL, solidHeader = TRUE, collapsible = FALSE, status = "danger", width = 12L,
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='CategoricalEncoding_TrainData', Label='Train Data', Choices = CategoricalEncoding_TrainData_Choices, SelectedDefault = CategoricalEncoding_TrainData_Selected, Multiple = TRUE, MaxVars = 1))),
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='CategoricalEncoding_ValidationData', Label='Validation Data', Choices = CategoricalEncoding_ValidationData_Choices, SelectedDefault = CategoricalEncoding_ValidationData_Selected, Multiple = TRUE, MaxVars = 100))),
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='CategoricalEncoding_TestData', Label='Test Data', Choices = CategoricalEncoding_TestData_Choices, SelectedDefault = CategoricalEncoding_TestData_Selected, Multiple = TRUE, MaxVars = 100))),
                        Quantico:::BlankRow(12L))
                    ),

                    shiny::column(
                      6L,
                      shinydashboard::box(
                        title = NULL, solidHeader = TRUE, collapsible = FALSE, status = "danger", width = 12L,
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::PickerInput(InputID='CategoricalEncoding_GroupVariables', Label='Group Variables', Choices = NULL, SelectedDefault = CategoricalEncoding_GroupVariables_Selected, Multiple = TRUE))),
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::PickerInput(InputID='CategoricalEncoding_TargetVariable', Label='Target Variables', Choices = NULL, SelectedDefault = CategoricalEncoding_TargetVariable_Selected, Multiple = TRUE))),
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='CategoricalEncoding_Method', Label='Encoding Method', Choices = CategoricalEncoding_Method_Choices, SelectedDefault = CategoricalEncoding_Method_Selected, Multiple = TRUE, MaxVars = 1))),
                        Quantico:::BlankRow(12L))
                    )
                  ),

                  # Blank space
                  Quantico:::BlankRow(12L),
                  Quantico:::BlankRow(12L),
                  Quantico:::BlankRow(12L),
                  Quantico:::BlankRow(12L)
                )
              ),

              # Partial Dummies ----
              shiny::tabPanel(
                title = "Dummy Variables",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  Quantico:::BlankRow(12L),
                  shiny::fluidRow(
                    style = ModelHelpFormat,
                    shiny::column(
                      width = 3L,
                      tags$h4(tags$span(tags$b(paste0('Partial Dummy Variables'))))
                    ),
                    shiny::column(
                      width = 8L,
                      align = "right",
                      shinyWidgets::dropdown(
                        shinydashboard::box(
                          title = NULL, solidHeader = TRUE, collapsible = FALSE, status = "info", width = 12L,
                          shiny::fluidRow(
                            shiny::column(
                              width = 12L,
                              align = "left",
                              shiny::a(name = "dummyvariables"),
                              shiny::h1(tags$b("Dummy Variables")),
                              shiny::p("The Dummy Variables menu provides operations to generate
                           dummy variables for some or all of your categorical variable
                           levels... "),
                            )
                          ),

                          Quantico::BlankRow(12),
                          shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::h3("Dummy Variables Usage"))),
                          shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::markdown(
                            "
                            Dummy Variables operation is for generating dummy variables from categorical variables
                            * Choose Data Set: This is your source dataset
                            * Target Columns: Select at least one categorical variable which are used to create the dummy variables
                            * TopN: You can have a partial set of dummy variables created instead of having all group levels turned into dummy variables. If TopN = 5 then the five most frequent levels will be converted to dummy variables
                            * Keep Base Columns: Once your dummy variables are created you can have the source Target Columns removed from your data by setting this to FALSE
                            "
                          )))
                        ),
                        size = "lg",
                        icon = shiny::icon("question"),
                        label = NULL,
                        tooltip = FALSE,
                        right = TRUE,
                        up = FALSE,
                        width = NULL,
                        animate = shinyWidgets::animateOptions(
                          enter = "zoomIn",
                          exit = "fadeOutRightBig"
                        ),
                        inputId = NULL,
                        block = FALSE,
                        no_outline = TRUE
                      )
                    ),

                    # Agg Data Button
                    shiny::column(
                      width = 1L, align = 'right',
                      style = "padding-top: 4px;padding-right: 50px;",
                      shiny::actionButton(
                        inputId = 'FeatureEngineeringButton_PartialDummies',
                        label = 'Run',
                        icon = shiny::icon('chevron-right', lib='font-awesome')
                      )
                    )
                  ),

                  Quantico:::BlankRow(12L),
                  shiny::fluidRow(
                    shiny::column(
                      6L,
                      shinydashboard::box(
                        title = NULL, solidHeader = TRUE, collapsible = FALSE, status = "danger", width = 12L,
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='DummifyDT_SelectData', Label='Choose data set', Choices = DummifyDT_SelectData_Choices, SelectedDefault = DummifyDT_SelectData_Selected, Multiple = TRUE, MaxVars = 100))),
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::PickerInput(InputID='DummifyDT_Cols', Label='Target Columns', Choices = NULL, SelectedDefault = DummifyDT_Cols_Selected, Multiple = TRUE))),
                        Quantico:::BlankRow(12L))
                    ),

                    shiny::column(
                      6L,
                      shinydashboard::box(
                        title = NULL, solidHeader = TRUE, collapsible = FALSE, status = "danger", width = 12L,
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::NumericInput(InputID='DummifyDT_TopN', Label='TopN', Value = DummifyDT_TopN_Selected, Min = 1, Max = 1000, Step = 1))),
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='DummifyDT_KeepBaseCols', Label='Keep Base Cols', Choices = DummifyDT_KeepBaseCols_Choices, SelectedDefault = DummifyDT_KeepBaseCols_Selected, Multiple = TRUE, MaxVars = 1))),
                        Quantico:::BlankRow(12L))
                    )
                  ),

                  # Blank space
                  Quantico:::BlankRow(12L),
                  Quantico:::BlankRow(12L),
                  Quantico:::BlankRow(12L),
                  Quantico:::BlankRow(12L),
                  Quantico:::BlankRow(12L)
                )
              ) # end Tab Panel Main
            ) # end Tab Panel Main
          ), # end TagList

          footer = shiny::tagList(
            shiny::modalButton(label = "Cancel"),
            shiny::actionButton("Categorical_OK", "OK", width = '50px'))))
    })
}

#' @title Numeric_Modal_Fun
#'
#' @description Numeric variables
#'
#' @author Adrian Antico
#' @family FE
#'
#' @param id = 'Numeric_Modal_Fun'
#' @param AppWidth = 12L
#'
#' @export
Numeric_Modal_Fun <- function(id,
                              AppWidth=12L,

                              # Reactives
                              PercentRank_ColNames_Selected = NULL,
                              PercentRank_GroupVars_Selected = NULL,
                              Standardize_ColNames_Selected = NULL,
                              Standardize_GroupVars_Selected = NULL,
                              AutoInteraction_NumericVars_Selected = NULL,
                              AutoTransformationCreate_ColumnNames_Selected = NULL,

                              # Statics
                              PercentRank_SelectData_Choices = NULL,
                              PercentRank_SelectValidationData_Choices = NULL,
                              PercentRank_SelectTestData_Choices = NULL,
                              PercentRank_Granularity_Choices = NULL,
                              Standardize_SelectData_Choices = NULL,
                              Standardize_SelectValidationData_Choices = NULL,
                              Standardize_SelectTestData_Choices = NULL,
                              Standardize_Center_Choices = NULL,
                              Standardize_Scale_Choices = NULL,
                              AutoInteraction_SelectData_Choices = NULL,
                              AutoInteraction_InteractionDepth_Choices = NULL,
                              AutoInteraction_Scale_Choices = NULL,
                              AutoInteraction_Center_Choices = NULL,
                              AutoTransformationCreate_SelectData_Choices = NULL,
                              AutoTransformationCreate_Methods_Choices = NULL,

                              # Updaters
                              PercentRank_SelectData_Selected = NULL,
                              PercentRank_SelectValidationData_Selected = NULL,
                              PercentRank_SelectTestData_Selected = NULL,
                              PercentRank_Granularity_Selected = NULL,
                              Standardize_SelectData_Selected = NULL,
                              Standardize_SelectValidationData_Selected = NULL,
                              Standardize_SelectTestData_Selected = NULL,
                              Standardize_Center_Selected = NULL,
                              Standardize_Scale_Selected = NULL,
                              AutoInteraction_SelectData_Selected = NULL,
                              AutoInteraction_InteractionDepth_Selected = NULL,
                              AutoInteraction_Scale_Selected = NULL,
                              AutoInteraction_Center_Selected = NULL,
                              AutoTransformationCreate_SelectData_Selected = NULL,
                              AutoTransformationCreate_Methods_Selected = NULL) {

  shiny::moduleServer(
    id = id,
    module = function(input, output, session) {
      ns <- session$ns
      shiny::showModal(
        shiny::modalDialog(
          title = 'Numeric Features',
          size = "l",
          easyClose = FALSE,
          fade = TRUE,
          shiny::tagList(

            Quantico:::BlankRow(12L),

            # Tabs
            shiny::tabsetPanel(
              id = 'Numeric_TabPanel',
              selected = 'Percent Rank',

              # Percent Rank ----
              shiny::tabPanel(
                title = "Percent Rank",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  Quantico:::BlankRow(12L),
                  shiny::fluidRow(
                    style = ModelHelpFormat,
                    shiny::column(
                      width = 3L,
                      tags$h4(tags$span(tags$b(paste0('Percent Rank'))))
                    ),
                    shiny::column(
                      width = 8L,
                      align = "right",
                      shinyWidgets::dropdown(
                        shinydashboard::box(
                          title = NULL, solidHeader = TRUE, collapsible = FALSE, status = "info", width = 12L,
                          shiny::fluidRow(
                            shiny::column(
                              width = 12L,
                              align = "left",
                              shiny::a(name = "percentrank"),
                              shiny::h1(tags$b("Percent Rank")),
                              shiny::p("The Percent Rank operation converts numeric variables to a
                           uniform distribution via percentile ranking. Each value is
                           transformed to its percentile in light of all other values...")
                            )
                          ),

                          Quantico::BlankRow(12),
                          shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::h3("Percent Rank Usage"))),
                          shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::markdown(
                            "
                            Percent Rank Variables operation is for converting a numeric column onto the uniform distribution via converting the numeric values in each row to their respective percentiles
                            * Train Data: This is your training dataset. This one is required
                            * Validation Data: Optional. If you have a validation dataset supply that here
                            * Test Data: Optional. If you have a test dataset supply that here
                            * Target Columns: Select at least one date column which are used to create the percent rank variables
                            * By-Variables: If you'd like to get percentiles by group variables (unique percentiles for each group level) supply group variables here
                            * Precision: How many decimals do you want associated with the resuling percentiles. Less precision means there will be likely be duplicated percentiles in the column
                            "
                          )))
                        ),
                        size = "lg",
                        icon = shiny::icon("question"),
                        label = NULL,
                        tooltip = FALSE,
                        right = TRUE,
                        up = FALSE,
                        width = NULL,
                        animate = shinyWidgets::animateOptions(
                          enter = "zoomIn",
                          exit = "fadeOutRightBig"
                        ),
                        inputId = NULL,
                        block = FALSE,
                        no_outline = TRUE
                      )
                    ),

                    # Agg Data Button
                    shiny::column(
                      width = 1L, align = 'right',
                      style = "padding-top: 4px;padding-right: 50px;",
                      shiny::actionButton(
                        inputId = 'FeatureEngineeringButton_PercRank',
                        label = 'Run',
                        icon = shiny::icon('chevron-right', lib='font-awesome')
                      )
                    )
                  ),

                  Quantico::BlankRow(12L),
                  shiny::fluidRow(
                    shiny::column(
                      6L,
                      shinydashboard::box(
                        title = NULL, solidHeader = TRUE, collapsible = FALSE, status = "danger", width = 12L,
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='PercentRank_SelectData', Label='Choose Data', Choices = PercentRank_SelectData_Choices, SelectedDefault = PercentRank_SelectData_Selected, Multiple = TRUE, MaxVars = 1))),
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='PercentRank_SelectValidationData', Label='Choose Validation Data', Choices = PercentRank_SelectValidationData_Choices, SelectedDefault = PercentRank_SelectValidationData_Selected, Multiple = TRUE, MaxVars = 1))),
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='PercentRank_SelectTestData', Label='Choose Test Data', Choices = PercentRank_SelectTestData_Choices, SelectedDefault = PercentRank_SelectTestData_Selected, Multiple = TRUE, MaxVars = 1))),
                        Quantico:::BlankRow(12L))
                    ),

                    shiny::column(
                      6L,
                      shinydashboard::box(
                        title = NULL, solidHeader = TRUE, collapsible = FALSE, status = "danger", width = 12L,
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::PickerInput(InputID='PercentRank_ColNames', Label='Target Columns', Choices = NULL, SelectedDefault = PercentRank_ColNames_Selected, Multiple = TRUE))),
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::PickerInput(InputID='PercentRank_GroupVars', Label='By-Variables', Choices = NULL, SelectedDefault = PercentRank_GroupVars_Selected, Multiple = TRUE))),
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::NumericInput(InputID='PercentRank_Granularity', Label='Precision', Value = PercentRank_Granularity_Selected, Min = 0.001, Max = 0.01, Step = 0.001))),
                        Quantico:::BlankRow(12L))
                    )
                  ),

                  # Blank space
                  Quantico:::BlankRow(12L),
                  Quantico:::BlankRow(12L),
                  Quantico:::BlankRow(12L),
                  Quantico:::BlankRow(12L),
                  Quantico:::BlankRow(12L)
                )
              ),

              # Standardize ----
              shiny::tabPanel(
                title = "Standardize",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  Quantico:::BlankRow(12L),
                  shiny::fluidRow(
                    style = ModelHelpFormat,
                    shiny::column(
                      width = 3L,
                      tags$h4(tags$span(tags$b(paste0('Standardize'))))
                    ),
                    shiny::column(
                      width = 8L,
                      align = "right",
                      shinyWidgets::dropdown(
                        shinydashboard::box(
                          title = NULL, solidHeader = TRUE, collapsible = FALSE, status = "info", width = 12L,
                          shiny::fluidRow(
                            shiny::column(
                              width = 12L,
                              align = "left",
                              shiny::a(name = "standardize"),
                              shiny::h1(tags$b("Standardize")),
                              shiny::p("The Standardize operation can let a user choose between
                           centering, scaling, or both...")
                            )
                          ),

                          Quantico::BlankRow(12),
                          shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::h3("Standardize Usage"))),
                          shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::markdown(
                            "
                            Percent Rank Variables operation is for converting a numeric column onto the uniform distribution via converting the numeric values in each row to their respective percentiles
                            * Train Data: This is your training dataset. This one is required
                            * Validation Data: Optional. If you have a validation dataset supply that here
                            * Test Data: Optional. If you have a test dataset supply that here
                            * Target Columns: Select at least one date column which are used to create the percent rank variables
                            * By-Variables: If you'd like to get percentiles by group variables (unique percentiles for each group level) supply group variables here
                            * Center: This is to center your data within the standardization process. Either Centering or Scaling must be chosen or nothing will change. Both can be selected
                            * Scale: This is to scale your data withing the standardization process. Either Centering or Scaling must be chosen or nothing will change. Both can be selected
                            "
                          )))
                        ),
                        size = "lg",
                        icon = shiny::icon("question"),
                        label = NULL,
                        tooltip = FALSE,
                        right = TRUE,
                        up = FALSE,
                        width = NULL,
                        animate = shinyWidgets::animateOptions(
                          enter = "zoomIn",
                          exit = "fadeOutRightBig"
                        ),
                        inputId = NULL,
                        block = FALSE,
                        no_outline = TRUE
                      )
                    ),

                    # Agg Data Button
                    shiny::column(
                      width = 1L, align = 'right',
                      style = "padding-top: 4px;padding-right: 50px;",
                      shiny::actionButton(
                        inputId = 'FeatureEngineeringButton_Standardize',
                        label = 'Run',
                        icon = shiny::icon('chevron-right', lib='font-awesome')
                      )
                    )
                  ),

                  Quantico::BlankRow(12L),
                  shiny::fluidRow(
                    shiny::column(
                      6L,
                      shinydashboard::box(
                        title = NULL, solidHeader = TRUE, collapsible = FALSE, status = "danger", width = 12L,
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='Standardize_SelectData', Label='Choose Data', Choices = Standardize_SelectData_Choices, SelectedDefault = Standardize_SelectData_Selected, Multiple = TRUE, MaxVars = 1))),
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='Standardize_SelectValidationData', Label='Choose Validation Data', Choices = Standardize_SelectValidationData_Choices, SelectedDefault = Standardize_SelectValidationData_Selected, Multiple = TRUE, MaxVars = 1))),
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='Standardize_SelectTestData', Label='Choose Test Data', Choices = Standardize_SelectTestData_Choices, SelectedDefault = Standardize_SelectTestData_Selected, Multiple = TRUE, MaxVars = 1))),
                        Quantico:::BlankRow(12L))
                    ),

                    shiny::column(
                      6L,
                      shinydashboard::box(
                        title = NULL, solidHeader = TRUE, collapsible = FALSE, status = "danger", width = 12L,
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::PickerInput(InputID='Standardize_ColNames', Label='Target Columns', Choices = NULL, SelectedDefault = Standardize_ColNames_Selected, Multiple = TRUE))),
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::PickerInput(InputID='Standardize_GroupVars', Label='By-Variables', Choices = NULL, SelectedDefault = Standardize_GroupVars_Selected, Multiple = TRUE))),
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='Standardize_Center', Label='Center', Choices = Standardize_Center_Choices, SelectedDefault = Standardize_Center_Selected, Multiple = TRUE, MaxVars = 1))),
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='Standardize_Scale', Label='Scale', Choices = Standardize_Scale_Choices, SelectedDefault = Standardize_Scale_Selected, Multiple = TRUE, MaxVars = 1))),
                        Quantico:::BlankRow(12L)
                      )
                    )
                  ),

                  # Blank space
                  Quantico:::BlankRow(12L),
                  Quantico:::BlankRow(12L),
                  Quantico:::BlankRow(12L),
                  Quantico:::BlankRow(12L),
                  Quantico:::BlankRow(12L)
                )
              ),

              # Transformation ----
              shiny::tabPanel(
                title = "Transform Variables",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  Quantico:::BlankRow(12L),
                  shiny::fluidRow(
                    style = ModelHelpFormat,
                    shiny::column(
                      width = 3L,
                      tags$h4(tags$span(tags$b(paste0('Transform Variables'))))
                    ),
                    shiny::column(
                      width = 8L,
                      align = "right",
                      shinyWidgets::dropdown(
                        shinydashboard::box(
                          title = NULL, solidHeader = TRUE, collapsible = FALSE, status = "info", width = 12L,
                          shiny::fluidRow(
                            shiny::column(
                              width = 12L,
                              align = "left",
                              shiny::a(name = "transform"),
                              shiny::h1(tags$b("Transform")),
                              shiny::p("The Transform operation converts your numeric variable into
                                        another one by applying either a:"),
                              shiny::markdown(
                                "
                                * LogPlus1 (natual log + minimum value in set of values)
                                * Log (standard natural log transformation)
                                * Square Root
                                * Asinh
                                * BoxCox
                                * YeoJohnson
                                * Logit
                                * Asin
                                "
                              )
                            )
                          ),

                          Quantico::BlankRow(12),
                          shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::h3("Transform Usage"))),
                          shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::markdown(
                            "
                            Transform Variables operation is for converting a numeric column onto the uniform distribution via converting the numeric values in each row to their respective percentiles
                            * Choose Data Set: This is your source dataset
                            * Target Columns: Select at least one date column which are used to create the percent rank variables. New transformation columns will be created
                            * Transformation Methods: Select at least one transformation method. The operation will check to see which one normalizes your data best and select that method
                            "
                          )))
                        ),
                        size = "lg",
                        icon = shiny::icon("question"),
                        label = NULL,
                        tooltip = FALSE,
                        right = TRUE,
                        up = FALSE,
                        width = NULL,
                        animate = shinyWidgets::animateOptions(
                          enter = "zoomIn",
                          exit = "fadeOutRightBig"
                        ),
                        inputId = NULL,
                        block = FALSE,
                        no_outline = TRUE
                      )
                    ),

                    # Agg Data Button
                    shiny::column(
                      width = 1L, align = 'right',
                      style = "padding-top: 4px;padding-right: 50px;",
                      shiny::actionButton(
                        inputId = 'FeatureEngineeringButton_Transformations',
                        label = 'Run',
                        icon = shiny::icon('chevron-right', lib='font-awesome')
                      )
                    )
                  ),

                  Quantico::BlankRow(12L),
                  shiny::fluidRow(
                    shiny::column(
                      6L,
                      shinydashboard::box(
                        title = NULL, solidHeader = TRUE, collapsible = FALSE, status = "danger", width = 12L,
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='AutoTransformationCreate_SelectData', Label='Choose data set', Choices = AutoTransformationCreate_SelectData_Choices, SelectedDefault = AutoTransformationCreate_SelectData_Selected, Multiple = TRUE, MaxVars = 1))),
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::PickerInput(InputID='AutoTransformationCreate_ColumnNames', Label='Target Columns', Choices = NULL, SelectedDefault = AutoTransformationCreate_ColumnNames_Selected, Multiple = TRUE))),
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='AutoTransformationCreate_Methods', Label='Transformation Methods', Choices = AutoTransformationCreate_Methods_Choices, SelectedDefault = AutoTransformationCreate_Methods_Selected, Multiple = TRUE, MaxVars = 10))),
                        Quantico:::BlankRow(12L))
                    )
                  ),

                  # Blank space
                  Quantico:::BlankRow(12L),
                  Quantico:::BlankRow(12L),
                  Quantico:::BlankRow(12L),
                  Quantico:::BlankRow(12L),
                  Quantico:::BlankRow(12L)
                )
              ), # end Tab Panel Main

              # Interaction ----
              shiny::tabPanel(
                title = "Interaction Variables",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  Quantico:::BlankRow(12L),
                  shiny::fluidRow(
                    style = ModelHelpFormat,
                    shiny::column(
                      width = 3L,
                      tags$h4(tags$span(tags$b(paste0('Interaction Variables'))))
                    ),
                    shiny::column(
                      width = 8L,
                      align = "right",
                      shinyWidgets::dropdown(
                        shinydashboard::box(
                          title = NULL, solidHeader = TRUE, collapsible = FALSE, status = "info", width = 12L,
                          shiny::fluidRow(
                            shiny::column(
                              width = 12L,
                              align = "left",
                              shiny::a(name = "interaction"),
                              shiny::h1(tags$b("Interaction")),
                              shiny::p("The Interaction operation multiplies numeric variables together.
                                       You can choose to center and scale them first to prevent numeric
                                       overflow...")
                            )
                          ),

                          Quantico::BlankRow(12),
                          shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::h3("Interaction Usage"))),
                          shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::markdown(
                            "
                            Interaction operation is for create interaction variables based on numeric variables
                            * Choose Data Set: This is your source dataset
                            * Target Columns: Select at least one date column which are used to create the percent rank variables. New transformation columns will be created
                            * Interaction Depth: select 2 for pairwise interactions, 3 for three-way interactions, and so on
                            * Center Data: Center and Scaling are useful to prevent numeric overflow from multiplication of large numbers
                            * Scale Data: Center and Scaling are useful to prevent numeric overflow from multiplication of large numbers
                            "
                          )))
                        ),
                        size = "lg",
                        icon = shiny::icon("question"),
                        label = NULL,
                        tooltip = FALSE,
                        right = TRUE,
                        up = FALSE,
                        width = NULL,
                        animate = shinyWidgets::animateOptions(
                          enter = "zoomIn",
                          exit = "fadeOutRightBig"
                        ),
                        inputId = NULL,
                        block = FALSE,
                        no_outline = TRUE
                      )
                    ),

                    # Agg Data Button
                    shiny::column(
                      width = 1L, align = 'right',
                      style = "padding-top: 4px;padding-right: 50px;",
                      shiny::actionButton(
                        inputId = 'FeatureEngineeringButton_Interaction',
                        label = 'Run',
                        icon = shiny::icon('chevron-right', lib='font-awesome')
                      )
                    )
                  ),

                  Quantico::BlankRow(12L),
                  shiny::fluidRow(
                    shiny::column(
                      6L,
                      shinydashboard::box(
                        title = NULL, solidHeader = TRUE, collapsible = FALSE, status = "danger", width = 12L,
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='AutoInteraction_SelectData', Label='Choose data set', Choices = AutoInteraction_SelectData_Choices, SelectedDefault = AutoInteraction_SelectData_Selected, Multiple = TRUE, MaxVars = 1))),
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::PickerInput(InputID='AutoInteraction_NumericVars', Label='Target Columns', Choices = NULL, SelectedDefault = AutoInteraction_NumericVars_Selected, Multiple = TRUE))),
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::NumericInput(InputID='AutoInteraction_InteractionDepth', Label='Interaction Depth', Value = AutoInteraction_InteractionDepth_Selected, Min = 2, Max = 10, Step = 1))),
                        Quantico:::BlankRow(12L))
                    ),

                    shiny::column(
                      6L,
                      shinydashboard::box(
                        title = NULL, solidHeader = TRUE, collapsible = FALSE, status = "danger", width = 12L,
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='AutoInteraction_Center', Label='Center Data', Choices = AutoInteraction_Center_Choices, SelectedDefault = AutoInteraction_Center_Selected, Multiple = TRUE, MaxVars = 1))),
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='AutoInteraction_Scale', Label='Scale Data', Choices = AutoInteraction_Scale_Choices, SelectedDefault = AutoInteraction_Scale_Selected, Multiple = TRUE, MaxVars = 1))),
                        Quantico:::BlankRow(12L)
                      )
                    )
                  ),

                  # Blank space
                  Quantico:::BlankRow(12L),
                  Quantico:::BlankRow(12L),
                  Quantico:::BlankRow(12L),
                  Quantico:::BlankRow(12L),
                  Quantico:::BlankRow(12L)
                )
              ) # end Tab Panel Main
            ) # end Tab Panel Main
          ), # end TagList

          footer = shiny::tagList(
            shiny::modalButton(label = "Cancel"),
            shiny::actionButton("Numeric_OK", "OK", width = '50px'))))
    })
}

#' @title AnomalyDetection_Modal_Fun
#'
#' @description Anomaly Detection operations
#'
#' @author Adrian Antico
#' @family FE
#'
#' @param id = 'AD_Modal_Fun'
#' @param AppWidth = 12L
#'
#' @export
AnomalyDetection_Modal_Fun <- function(id,
                                       AppWidth=12L,

                                       # Reactives
                                       IsolationForest_H2O_Features_Selected = NULL,

                                       # Statics
                                       IsolationForest_H2O_TrainData_Choices = NULL,
                                       IsolationForest_H2O_ValidationData_Choices = NULL,
                                       IsolationForest_H2O_TestData_Choices = NULL,
                                       IsolationForest_H2O_Threshold_Choices = NULL,
                                       IsolationForest_H2O_NTrees_Choices = NULL,
                                       IsolationForest_H2O_MaxDepth_Choices = NULL,
                                       IsolationForest_H2O_MinRows_Choices = NULL,
                                       IsolationForest_H2O_RowSampleRate_Choices = NULL,
                                       IsolationForest_H2O_ColSampleRate_Choices = NULL,
                                       IsolationForest_H2O_ColSampleRatePerLevel_Choices = NULL,
                                       IsolationForest_H2O_ColSampleRatePerTree_Choices = NULL,

                                       # Updaters
                                       IsolationForest_H2O_TrainData_Selected = NULL,
                                       IsolationForest_H2O_ValidationData_Selected = NULL,
                                       IsolationForest_H2O_TestData_Selected = NULL,
                                       IsolationForest_H2O_Threshold_Selected = NULL,
                                       IsolationForest_H2O_NTrees_Selected = NULL,
                                       IsolationForest_H2O_MaxDepth_Selected = NULL,
                                       IsolationForest_H2O_MinRows_Selected = NULL,
                                       IsolationForest_H2O_RowSampleRate_Selected = NULL,
                                       IsolationForest_H2O_ColSampleRate_Selected = NULL,
                                       IsolationForest_H2O_ColSampleRatePerLevel_Selected = NULL,
                                       IsolationForest_H2O_ColSampleRatePerTree_Selected = NULL) {

  shiny::moduleServer(
    id = id,
    module = function(input, output, session) {
      ns <- session$ns
      shiny::showModal(
        shiny::modalDialog(
          title = 'Anomaly Detection Operations',
          size = "l",
          easyClose = FALSE,
          fade = TRUE,
          shiny::tagList(

            Quantico:::BlankRow(12L),

            # Tabs
            shiny::tabsetPanel(
              id = 'AnomalyDetection_TabPanel',
              selected = 'Isolation Forest',

              # Isolation Forest ----
              shiny::tabPanel(
                title = "Isolation Forest",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  Quantico:::BlankRow(12L),
                  shiny::fluidRow(
                    style = ModelHelpFormat,
                    shiny::column(
                      width = 3L,
                      tags$h4(tags$span(tags$b(paste0('Isolation Forest'))))
                    ),
                    shiny::column(
                      width = 8L,
                      align = "right",
                      shinyWidgets::dropdown(
                        shinydashboard::box(
                          title = NULL, solidHeader = TRUE, collapsible = FALSE, status = "info", width = 12L,
                          shiny::fluidRow(
                            shiny::column(
                              width = 12L,
                              align = "left",
                              shiny::a(name = "isolationforest"),
                              shiny::h1(tags$b("Isolation Forest")),
                              shiny::p("The Isolation Forest algorithm is provided by H2O. Per
                                       their documentation, 'Isolation Forest is similar in
                                       principle to Random Forest and is built on the basis of
                                       decision trees. Isolation Forest, however, identifies anomalies
                                       or outliers rather than profiling normal data points. Isolation
                                       Forest isolates observations by randomly selecting a feature and
                                       then randomly selecting a split value between the maximum and minimum
                                       values of that selected feature. This split depends on how long it
                                       takes to separate the points.'"),
                              shiny::p("Random partitioning produces noticeably shorter paths for anomalies.
                                       When a forest of random trees collectively produces shorter path
                                       lengths for particular samples, they are highly likely to be anomalies.'... ")
                            )
                          ),

                          Quantico::BlankRow(12),
                          shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::h3("Isolation Forest Usage"))),
                          shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::markdown(
                            "
                            Isolation Forest operation is for running anomaly detection on your data
                            * Train Data: This is your training dataset. This one is required
                            * Validation Data: Optional. If you have a validation dataset supply that here
                            * Test Data: Optional. If you have a test dataset supply that here
                            * Features: Variables you want included in your anomaly detection operation
                            * Number of Trees: this is for the Random Forest that runs under the hood
                            * Anomaly Detection Threshold: this is to classify records as anomalies
                            * Max Depth: For the Random Forest
                            * Minimum Rows: For the Random Forest
                            * Row Sample Rate: For the Random Forest
                            * Column Sample Rate: For the Random Forest
                            * Column Sample Rate per Level: For the Random Forest
                            * Column Sample Rate per Tree: For the Random Forest
                            "
                          )))
                        ),
                        size = "lg",
                        icon = shiny::icon("question"),
                        label = NULL,
                        tooltip = FALSE,
                        right = TRUE,
                        up = FALSE,
                        width = NULL,
                        animate = shinyWidgets::animateOptions(
                          enter = "zoomIn",
                          exit = "fadeOutRightBig"
                        ),
                        inputId = NULL,
                        block = FALSE,
                        no_outline = TRUE
                      )
                    ),

                    # Agg Data Button
                    shiny::column(
                      width = 1L, align = 'right',
                      style = "padding-top: 4px;padding-right: 50px;",
                      shiny::actionButton(
                        inputId = 'FeatureEngineeringButton_IsolationForest_H2O',
                        label = 'Run',
                        icon = shiny::icon('chevron-right', lib='font-awesome')
                      )
                    )
                  ),

                  Quantico:::BlankRow(12L),
                  shiny::fluidRow(
                    shiny::column(
                      3L,
                      shinydashboard::box(
                        title = NULL, solidHeader = TRUE, collapsible = FALSE, status = "danger", width = 12L,
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='IsolationForest_H2O_TrainData', Label='Train Data', Choices = IsolationForest_H2O_TrainData_Choices, SelectedDefault = IsolationForest_H2O_TrainData_Selected, Multiple = TRUE, MaxVars = 1))),
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='IsolationForest_H2O_ValidationData', Label='Validation Data', Choices = IsolationForest_H2O_ValidationData_Choices, SelectedDefault = IsolationForest_H2O_ValidationData_Selected, Multiple = TRUE, MaxVars = 1))),
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='IsolationForest_H2O_TestData', Label='Test Data', Choices = IsolationForest_H2O_TestData_Choices, SelectedDefault = IsolationForest_H2O_TestData_Selected, Multiple = TRUE, MaxVars = 1))),
                        Quantico:::BlankRow(12L)
                      )
                    ),

                    shiny::column(
                      3L,
                      shinydashboard::box(
                        title = NULL, solidHeader = TRUE, collapsible = FALSE, status = "danger", width = 12L,
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::PickerInput(InputID = 'IsolationForest_H2O_Features', Label = 'Features', Choices = NULL, SelectedDefault = IsolationForest_H2O_Features_Selected, Multiple = TRUE))),
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::NumericInput(InputID = 'IsolationForest_H2O_NTrees', Label = 'Number of Trees', Value = IsolationForest_H2O_NTrees_Selected, Min = 5, Max = 2000, Step = 5))),
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::NumericInput(InputID = 'IsolationForest_H2O_Threshold', Label = 'Anom Detection Threshold', Value = IsolationForest_H2O_Threshold_Selected, Min = 0.001, Max = 0.999, Step = 0.001))),
                        Quantico:::BlankRow(12L)
                      )
                    ),

                    shiny::column(
                      3L,
                      shinydashboard::box(
                        title = NULL, solidHeader = TRUE, collapsible = FALSE, status = "danger", width = 12L,
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::NumericInput(InputID = 'IsolationForest_H2O_MaxDepth', Label = 'Max Depth', Value = IsolationForest_H2O_MaxDepth_Selected, Min = 2, Max = 20, Step = 1))),
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID = 'IsolationForest_H2O_MinRows', Label = 'Minimum Rows', Choices = IsolationForest_H2O_MinRows_Choices, SelectedDefault = IsolationForest_H2O_MinRows_Selected, Multiple = TRUE, MaxVars = 1))),
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID = 'IsolationForest_H2O_RowSampleRate', Label = 'Row Sample Rate', Choices = IsolationForest_H2O_RowSampleRate_Choices, SelectedDefault = IsolationForest_H2O_RowSampleRate_Selected, Multiple = TRUE, MaxVars = 1))),
                        Quantico:::BlankRow(12L)
                      )
                    ),

                    shiny::column(
                      3L,
                      shinydashboard::box(
                        title = NULL, solidHeader = TRUE, collapsible = FALSE, status = "danger", width = 12L,
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID = 'IsolationForest_H2O_ColSampleRate', Label = 'Col Sample Rate', Choices = IsolationForest_H2O_ColSampleRate_Choices, SelectedDefault = IsolationForest_H2O_ColSampleRate_Selected, Multiple = TRUE, MaxVars = 1))),
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID = 'IsolationForest_H2O_ColSampleRatePerLevel', Label = 'Col Sample Rate per Level', Choices = IsolationForest_H2O_ColSampleRatePerLevel_Choices, SelectedDefault = IsolationForest_H2O_ColSampleRatePerLevel_Selected, Multiple = TRUE, MaxVars = 1))),
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID = 'IsolationForest_H2O_ColSampleRatePerTree', Label = 'Col Sample Rate per Tree', Choices = IsolationForest_H2O_ColSampleRatePerTree_Choices, SelectedDefault = IsolationForest_H2O_ColSampleRatePerTree_Selected, Multiple = TRUE, MaxVars = 1))),
                        Quantico:::BlankRow(12L)
                      )
                    )
                  ),

                  # Blank space
                  Quantico:::BlankRow(12L),
                  Quantico:::BlankRow(12L),
                  Quantico:::BlankRow(12L),
                  Quantico:::BlankRow(12L),
                  Quantico:::BlankRow(12L)
                )
              ) # end Tab Panel Main
            ) # end Tab Panel Main
          ), # end TagList

          footer = shiny::tagList(
            shiny::modalButton(label = "Cancel"),
            shiny::actionButton("AnomalyDetection_OK", "OK", width = '50px'))))
    })
}

#' @title DimensionalityReduction_Modal_Fun
#'
#' @description Anomaly Detection operations
#'
#' @author Adrian Antico
#' @family FE
#'
#' @param id = 'AD_Modal_Fun'
#' @param AppWidth = 12L
#'
#' @export
DimensionalityReduction_Modal_Fun <- function(id,
                                              AppWidth=12L,

                                              # Reactives
                                              AutoEncoder_H2O_Features_Selected = NULL,

                                              # Statics
                                              AutoEncoder_H2O_TrainData_Choices = NULL,
                                              AutoEncoder_H2O_ValidationData_Choices = NULL,
                                              AutoEncoder_H2O_TestData_Choices = NULL,
                                              AutoEncoder_H2O_AnomalyDetection_Choices = NULL,
                                              AutoEncoder_H2O_per_feature_Choices = NULL,
                                              AutoEncoder_H2O_RemoveFeatures_Choices = NULL,
                                              AutoEncoder_H2O_LayerStructure_Choices = NULL,
                                              AutoEncoder_H2O_NodeShrinkRate_Choices = NULL,
                                              AutoEncoder_H2O_ReturnLayer_Choices = NULL,
                                              AutoEncoder_H2O_Epochs_Choices = NULL,
                                              AutoEncoder_H2O_L2_Choices = NULL,
                                              AutoEncoder_H2O_ElasticAveraging_Choices = NULL,
                                              AutoEncoder_H2O_ElasticAveragingMovingRate_Choices = NULL,
                                              AutoEncoder_H2O_ElasticAveragingRegularization_Choices = NULL,

                                              AutoEncoder_H2O_TrainData_Selected = NULL,
                                              AutoEncoder_H2O_ValidationData_Selected = NULL,
                                              AutoEncoder_H2O_TestData_Selected = NULL,
                                              AutoEncoder_H2O_AnomalyDetection_Selected = NULL,
                                              AutoEncoder_H2O_per_feature_Selected = NULL,
                                              AutoEncoder_H2O_RemoveFeatures_Selected = NULL,
                                              AutoEncoder_H2O_LayerStructure_Selected = NULL,
                                              AutoEncoder_H2O_NodeShrinkRate_Selected = NULL,
                                              AutoEncoder_H2O_ReturnLayer_Selected = NULL,
                                              AutoEncoder_H2O_Epochs_Selected = NULL,
                                              AutoEncoder_H2O_L2_Selected = NULL,
                                              AutoEncoder_H2O_ElasticAveraging_Selected = NULL,
                                              AutoEncoder_H2O_ElasticAveragingMovingRate_Selected = NULL,
                                              AutoEncoder_H2O_ElasticAveragingRegularization_Selected = NULL) {

  shiny::moduleServer(
    id = id,
    module = function(input, output, session) {
      ns <- session$ns
      shiny::showModal(
        shiny::modalDialog(
          title = 'Dimensionality Reduction Operations',
          size = "l",
          easyClose = FALSE,
          fade = TRUE,
          shiny::tagList(

            Quantico:::BlankRow(12L),

            # Tabs
            shiny::tabsetPanel(
              id = 'DimensionalityReduction_TabPanel',
              selected = 'Autoencoder',

              # Dimensionality Reduction ----
              shiny::tabPanel(
                title = "Autoencoder",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  Quantico:::BlankRow(12L),
                  shiny::fluidRow(
                    style = ModelHelpFormat,
                    shiny::column(
                      width = 3L,
                      tags$h4(tags$span(tags$b(paste0('Autoencoder'))))
                    ),
                    shiny::column(
                      width = 8L,
                      align = "right",
                      shinyWidgets::dropdown(
                        shinydashboard::box(
                          title = NULL, solidHeader = TRUE, collapsible = FALSE, status = "info", width = 12L,
                          shiny::fluidRow(
                            shiny::column(
                              width = 12L,
                              align = "left",
                              shiny::a(name = "dimensionalityreduction"),
                              shiny::h1(tags$b("Dimensionality Reduction")),
                              shiny::p("The Dimensionality Reduction algorithm is provided by H2O. It
                                       utilizes their feed forward neural network multilayer perceptron model.
                                       You set one up to train without a target variable and extract one of the
                                       layers after a sufficient number of ephocs have ran...")
                            )
                          ),

                          Quantico::BlankRow(12),
                          shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::h3("Dimensionality Reduction Usage"))),
                          shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::markdown(
                            "
                            Dimensionality Reduction operation is for reducing a series of columns into a smaller set of columns
                            * Train Data: This is your training dataset. This one is required
                            * Validation Data: Optional. If you have a validation dataset supply that here
                            * Test Data: Optional. If you have a test dataset supply that here
                            * Anomaly Detection: Set to TRUE to return anomaly detection values
                            * Features: Variables you want included in your anomaly detection operation
                            * Remove Base Columns: If you want to retain the source Features set this to FALSE
                            * Anom Per-Feature: Set this to TRUE to have anomaly detection ran on all features individually as well as on the full set in aggregate
                            * Layer Returned: Pick the neural network layer you'd like returned
                            * Layer Count: How many layers do you want in your Neural Network?
                            * Shrink Base: each layer will reduce the number of nodes (dim reduction). E.g. if you have 100 features and choose a shrink rate of 0.50, then layer 2 will contain 50 features, layer 3 will contain 25 features, and so on.
                            * Epochs: number of iterations in training the neural network
                            * L2 Regularization: prevents overfitting. The higher the value the more protection (sometimes at a loss of accuracy)
                            * Elastic Averaging: Specify whether to enable elastic averaging between computing nodes, which can improve distributed model convergence
                            * Elastic Avg Rate: Only applicable if Elastic Averaging is set to TRUE
                            * Elastic Avg L2: Overfitting protection
                            "
                          )))
                        ),
                        size = "lg",
                        icon = shiny::icon("question"),
                        label = NULL,
                        tooltip = FALSE,
                        right = TRUE,
                        up = FALSE,
                        width = NULL,
                        animate = shinyWidgets::animateOptions(
                          enter = "zoomIn",
                          exit = "fadeOutRightBig"
                        ),
                        inputId = NULL,
                        block = FALSE,
                        no_outline = TRUE
                      )
                    ),

                    # Agg Data Button
                    shiny::column(
                      width = 1L, align = 'right',
                      style = "padding-top: 4px;padding-right: 50px;",
                      shiny::actionButton(
                        inputId = 'FeatureEngineeringButton_AutoEncoder_H2O',
                        label = 'Run',
                        icon = shiny::icon('chevron-right', lib='font-awesome')
                      )
                    )
                  ),

                  Quantico:::BlankRow(12L),
                  shiny::fluidRow(
                    shiny::column(
                      3L,
                      shinydashboard::box(
                        title = NULL, solidHeader = TRUE, collapsible = FALSE, status = "danger", width = 12L,
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='AutoEncoder_H2O_TrainData', Label='Train Data', Choices = AutoEncoder_H2O_TrainData_Choices, SelectedDefault = AutoEncoder_H2O_TrainData_Selected, Multiple = TRUE, MaxVars = 1))),
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='AutoEncoder_H2O_ValidationData', Label='Validation Data', Choices = AutoEncoder_H2O_ValidationData_Choices, SelectedDefault = AutoEncoder_H2O_ValidationData_Selected, Multiple = TRUE, MaxVars = 1))),
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='AutoEncoder_H2O_TestData', Label='Test Data', Choices = AutoEncoder_H2O_TestData_Choices, SelectedDefault = AutoEncoder_H2O_TestData_Selected, Multiple = TRUE, MaxVars = 1))),
                        Quantico:::BlankRow(12L)
                      )
                    ),

                    shiny::column(
                      3L,
                      shinydashboard::box(
                        title = NULL, solidHeader = TRUE, collapsible = FALSE, status = "danger", width = 12L,
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID = 'AutoEncoder_H2O_AnomalyDetection', Label = 'Anomaly Detection', Choices = AutoEncoder_H2O_AnomalyDetection_Choices, SelectedDefault = AutoEncoder_H2O_AnomalyDetection_Selected, Multiple = TRUE, MaxVars = 1))),
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::PickerInput(InputID = 'AutoEncoder_H2O_Features', Label = 'Features', Choices = NULL, SelectedDefault = AutoEncoder_H2O_Features_Selected, Multiple = TRUE))),
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID = 'AutoEncoder_H2O_RemoveFeatures', Label = 'Remove Base Cols', Choices = AutoEncoder_H2O_RemoveFeatures_Choices, SelectedDefault = AutoEncoder_H2O_RemoveFeatures_Selected, Multiple = TRUE, MaxVars = 1))),
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID = 'AutoEncoder_H2O_per_feature', Label = 'Anom Per-Feature', Choices = AutoEncoder_H2O_per_feature_Choices, SelectedDefault = AutoEncoder_H2O_per_feature_Selected, Multiple = TRUE, MaxVars = 1))),
                        Quantico:::BlankRow(12L)
                      )
                    ),

                    shiny::column(
                      3L,
                      shinydashboard::box(
                        title = NULL, solidHeader = TRUE, collapsible = FALSE, status = "danger", width = 12L,
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID = 'AutoEncoder_H2O_ReturnLayer', Label = 'Layer Returned', Choices = AutoEncoder_H2O_ReturnLayer_Choices, SelectedDefault = AutoEncoder_H2O_ReturnLayer_Selected, Multiple = TRUE, MaxVars = 1))),
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID = 'AutoEncoder_H2O_LayerStructure', Label = 'Layer Count', Choices = AutoEncoder_H2O_LayerStructure_Choices, SelectedDefault = AutoEncoder_H2O_LayerStructure_Selected, Multiple = TRUE, MaxVars = 1))),
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID = 'AutoEncoder_H2O_NodeShrinkRate', Label = 'Shrink Base', Choices = AutoEncoder_H2O_NodeShrinkRate_Choices, SelectedDefault = AutoEncoder_H2O_NodeShrinkRate_Selected, Multiple = TRUE, MaxVars = 1))),
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::NumericInput(InputID = 'AutoEncoder_H2O_Epochs', Label = 'Epochs', Value = AutoEncoder_H2O_Epochs_Selected, Min = 1, Max = 10000, Step = 1))),
                        Quantico:::BlankRow(12L)
                      )
                    ),

                    shiny::column(
                      3L,
                      shinydashboard::box(
                        title = NULL, solidHeader = TRUE, collapsible = FALSE, status = "danger", width = 12L,
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID = 'AutoEncoder_H2O_L2', Label = 'L2 Regularization', Choices = AutoEncoder_H2O_L2_Choices, SelectedDefault = AutoEncoder_H2O_L2_Selected, Multiple = TRUE, MaxVars = 1))),
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID = 'AutoEncoder_H2O_ElasticAveraging', Label = 'ElasticAveraging', Choices = AutoEncoder_H2O_ElasticAveraging_Choices, SelectedDefault = AutoEncoder_H2O_ElasticAveraging_Selected, Multiple = TRUE, MaxVars = 1))),
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID = 'AutoEncoder_H2O_ElasticAveragingMovingRate', Label = 'Elastic Avg Rate', Choices = AutoEncoder_H2O_ElasticAveragingMovingRate_Choices, SelectedDefault = AutoEncoder_H2O_ElasticAveragingMovingRate_Selected, Multiple = TRUE, MaxVars = 1))),
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID = 'AutoEncoder_H2O_ElasticAveragingRegularization', Label = 'Elastic Avg L2', Choices = AutoEncoder_H2O_ElasticAveragingRegularization_Choices, SelectedDefault = AutoEncoder_H2O_ElasticAveragingRegularization_Selected, Multiple = TRUE, MaxVars = 1))),
                        Quantico:::BlankRow(12L)
                      )
                    )
                  ),

                  # Blank space
                  Quantico:::BlankRow(12L),
                  Quantico:::BlankRow(12L),
                  Quantico:::BlankRow(12L),
                  Quantico:::BlankRow(12L)
                )
              ) # end Tab Panel Main
            ) # end Tab Panel Main
          ), # end TagList

          footer = shiny::tagList(
            shiny::modalButton(label = "Cancel"),
            shiny::actionButton("DimensionalityReduction_OK", "OK", width = '50px'))))
    })
}

#' @title Clustering
#'
#' @description Anomaly Detection operations
#'
#' @author Adrian Antico
#' @family FE
#'
#' @param id = 'AD_Modal_Fun'
#' @param AppWidth = 12L
#'
#' @export
Clustering_Modal_Fun <- function(id,
                                 AppWidth=12L,
                                 input, session,

                                 # Reactives
                                 Kmeans_H2O_Features_Selected = NULL,

                                 # Statics
                                 Kmeans_H2O_TrainData_Choices = NULL,
                                 Kmeans_H2O_ValidationData_Choices = NULL,
                                 Kmeans_H2O_TestData_Choices = NULL,
                                 Kmeans_H2O_MaxClusters_Choices = NULL,
                                 Kmeans_H2O_ClusterMetric_Choices = NULL,

                                 # Updaters
                                 Kmeans_H2O_TrainData_Selected = NULL,
                                 Kmeans_H2O_ValidationData_Selected = NULL,
                                 Kmeans_H2O_TestData_Selected = NULL,
                                 Kmeans_H2O_MaxClusters_Selected = NULL,
                                 Kmeans_H2O_ClusterMetric_Selected = NULL) {

  shiny::moduleServer(
    id = id,
    module = function(input, output, session) {
      ns <- session$ns
      shiny::showModal(
        shiny::modalDialog(
          title = 'Dimensionality Reduction Operations',
          size = "l",
          easyClose = FALSE,
          fade = TRUE,
          shiny::tagList(

            Quantico:::BlankRow(12L),

            # Tabs
            shiny::tabsetPanel(
              id = 'Clustering_TabPanel',
              selected = 'Clustering',

              # Clustering ----
              shiny::tabPanel(
                title = "Clustering",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  Quantico:::BlankRow(12L),
                  shiny::fluidRow(
                    style = ModelHelpFormat,
                    shiny::column(
                      width = 3L,
                      tags$h4(tags$span(tags$b(paste0('Clustering'))))
                    ),
                    shiny::column(
                      width = 8L,
                      align = "right",
                      shinyWidgets::dropdown(
                        shinydashboard::box(
                          title = NULL, solidHeader = TRUE, collapsible = FALSE, status = "info", width = 12L,
                          shiny::fluidRow(
                            shiny::column(
                              width = 12L,
                              align = "left",
                              shiny::a(name = "clustering"),
                              shiny::h1(tags$b("Clustering")),
                              shiny::p("The k-means algorithm is provided by H2O...")
                            )
                          ),

                          Quantico::BlankRow(12),
                          shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::h3("Clustering Usage"))),
                          shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::markdown(
                            "
                            Clustering operation is for grouping rows together by a common key (clusters)
                            * Train Data: This is your training dataset. This one is required
                            * Validation Data: Optional. If you have a validation dataset supply that here
                            * Test Data: Optional. If you have a test dataset supply that here
                            * Features: Variables you want included in your anomaly detection operation
                            * Clustering Loss Metric: choose from:
                              * totss: total sum of squares
                              * betweenss: between sum of squares
                              * withinss: within sum of squares
                            * Max Number of Clusters: set a ceiling for the potential number of clusters generated
                            "
                          )))
                        ),
                        size = "lg",
                        icon = shiny::icon("question"),
                        label = NULL,
                        tooltip = FALSE,
                        right = TRUE,
                        up = FALSE,
                        width = NULL,
                        animate = shinyWidgets::animateOptions(
                          enter = "zoomIn",
                          exit = "fadeOutRightBig"
                        ),
                        inputId = NULL,
                        block = FALSE,
                        no_outline = TRUE
                      )
                    ),

                    # Agg Data Button
                    shiny::column(
                      width = 1L, align = 'right',
                      style = "padding-top: 4px;padding-right: 50px;",
                      shiny::actionButton(
                        inputId = 'FeatureEngineeringButton_Kmeans_H2O',
                        label = 'Run',
                        icon = shiny::icon('chevron-right', lib='font-awesome')
                      )
                    )
                  ),

                  Quantico:::BlankRow(12L),
                  shiny::fluidRow(
                    shiny::column(
                      6L,
                      shinydashboard::box(
                        title = NULL, solidHeader = TRUE, collapsible = FALSE, status = "danger", width = 12L,
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='Kmeans_H2O_TrainData', Label='Train Data', Choices = Kmeans_H2O_TrainData_Choices, SelectedDefault = Kmeans_H2O_TrainData_Selected, Multiple = TRUE, MaxVars = 1))),
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='Kmeans_H2O_ValidationData', Label='Validation Data', Choices = Kmeans_H2O_ValidationData_Choices, SelectedDefault = Kmeans_H2O_ValidationData_Selected, Multiple = TRUE, MaxVars = 1))),
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='Kmeans_H2O_TestData', Label='Test Data', Choices = Kmeans_H2O_TestData_Choices, SelectedDefault = Kmeans_H2O_TestData_Selected, Multiple = TRUE, MaxVars = 1))),
                        Quantico:::BlankRow(12L)
                      )
                    ),

                    shiny::column(
                      6L,
                      shinydashboard::box(
                        title = NULL, solidHeader = TRUE, collapsible = FALSE, status = "danger", width = 12L,
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::PickerInput(InputID = 'Kmeans_H2O_Features', Label = 'Features', Choices = NULL, SelectedDefault = Kmeans_H2O_Features_Selected, Multiple = TRUE))),
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID = 'Kmeans_H2O_ClusterMetric', Label = 'Clustering Loss Metric', Choices = Kmeans_H2O_ClusterMetric_Choices, SelectedDefault = Kmeans_H2O_ClusterMetric_Selected, Multiple = TRUE, MaxVars = 1))),
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::NumericInput(InputID = 'Kmeans_H2O_MaxClusters', Label = 'Max Number of Clusters', Value = Kmeans_H2O_MaxClusters_Selected, Min = 1, Max = 100, Step = 1))),
                        Quantico:::BlankRow(12L)
                      )
                    )
                  ),

                  # Blank space
                  Quantico:::BlankRow(12L),
                  Quantico:::BlankRow(12L),
                  Quantico:::BlankRow(12L),
                  Quantico:::BlankRow(12L),
                  Quantico:::BlankRow(12L)
                )
              ), # end Tab Panel Main

            ) # end Tab Panel Main
          ), # end TagList

          footer = shiny::tagList(
            shiny::modalButton(label = "Cancel"),
            shiny::actionButton("Clustering_OK", "OK", width = '50px'))))
    })
}

# ----

# ----

# @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ ----
# ::  NLP  ::                                                                                                    ----
# @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ ----

#' @title NLP_Modal_Fun
#'
#' @description NLP methods
#'
#' @author Adrian Antico
#' @family FE
#'
#' @param id = 'NLP_Modal_Fun'
#' @param AppWidth = 12L
#'
#' @export
NLP_Modal_Fun <- function(id,
                          AppWidth=12L,

                          # Reactives
                          Word2Vec_H2O_stringCol_Selected = NULL,
                          TextSummary_TextColumns_Selected = NULL,
                          Sentiment_TextColumns_Selected = NULL,
                          Sentiment_CombineTextGroupVar_Selected = NULL,
                          Readability_TextColumns_Selected = NULL,
                          LexicalDiversity_TextColumns_Selected = NULL,

                          # Statics
                          Word2Vec_H2O_TrainData_Choices = NULL,
                          Word2Vec_H2O_ValidationData_Choices = NULL,
                          Word2Vec_H2O_TestData_Choices = NULL,
                          Word2Vec_H2O_BuildType_Choices = NULL,
                          Word2Vec_H2O_KeepStringCol_Choices = NULL,
                          Word2Vec_H2O_vects_Choices = NULL,
                          Word2Vec_H2O_MinWords_Choices = NULL,
                          Word2Vec_H2O_WindowSize_Choices = NULL,
                          Word2Vec_H2O_Epochs_Choices = NULL,
                          TextSummary_RemoveStats_Choices = NULL,
                          TextSummary_SelectData_Choices = NULL,
                          Sentiment_SelectData_Choices = NULL,
                          Sentiment_Response_Choices = NULL,
                          Sentiment_RemoveStopWords_Choices = NULL,
                          Sentiment_Stemming_Choices = NULL,
                          Readability_SelectData_Choices = NULL,
                          Readability_Measures_Choices = NULL,
                          Readability_RemoveHyphens_Choices = NULL,
                          Readability_MinSentenceLength_Choices = NULL,
                          Readability_MaxSentenceLength_Choices = NULL,
                          Readability_Intermediate_Choices = NULL,
                          LexicalDiversity_SelectData_Choices = NULL,
                          LexicalDiversity_Measures_Choices = NULL,
                          LexicalDiversity_RemoveSymbols_Choices = NULL,
                          LexicalDiversity_RemoveHyphens_Choices = NULL,
                          LexicalDiversity_RemovePunctuation_Choices = NULL,
                          LexicalDiversity_RemoveNumbers_Choices = NULL,
                          LexicalDiversity_LogBase_Choices = NULL,
                          LexicalDiversity_MATTR_Window_Choices = NULL,
                          LexicalDiversity_MSTTR_Segment_Choices = NULL,

                          # Updaters
                          Word2Vec_H2O_TrainData_Selected = NULL,
                          Word2Vec_H2O_ValidationData_Selected = NULL,
                          Word2Vec_H2O_TestData_Selected = NULL,
                          Word2Vec_H2O_BuildType_Selected = NULL,
                          Word2Vec_H2O_KeepStringCol_Selected = NULL,
                          Word2Vec_H2O_vects_Selected = NULL,
                          Word2Vec_H2O_MinWords_Selected = NULL,
                          Word2Vec_H2O_WindowSize_Selected = NULL,
                          Word2Vec_H2O_Epochs_Selected = NULL,
                          TextSummary_RemoveStats_Selected = NULL,
                          TextSummary_SelectData_Selected = NULL,
                          Sentiment_SelectData_Selected = NULL,
                          Sentiment_Response_Selected = NULL,
                          Sentiment_RemoveStopWords_Selected = NULL,
                          Sentiment_Stemming_Selected = NULL,
                          Readability_SelectData_Selected = NULL,
                          Readability_Measures_Selected = NULL,
                          Readability_RemoveHyphens_Selected = NULL,
                          Readability_MinSentenceLength_Selected = NULL,
                          Readability_MaxSentenceLength_Selected = NULL,
                          Readability_Intermediate_Selected = NULL,
                          LexicalDiversity_SelectData_Selected = NULL,
                          LexicalDiversity_Measures_Selected = NULL,
                          LexicalDiversity_RemoveSymbols_Selected = NULL,
                          LexicalDiversity_RemoveHyphens_Selected = NULL,
                          LexicalDiversity_RemovePunctuation_Selected = NULL,
                          LexicalDiversity_RemoveNumbers_Selected = NULL,
                          LexicalDiversity_LogBase_Selected = NULL,
                          LexicalDiversity_MATTR_Window_Selected = NULL,
                          LexicalDiversity_MSTTR_Segment_Selected = NULL) {

  shiny::moduleServer(
    id = id,
    module = function(input, output, session) {
      ns <- session$ns
      shiny::showModal(
        shiny::modalDialog(
          title = 'Text',
          size = "l",
          easyClose = FALSE,
          fade = TRUE,
          shiny::tagList(

            Quantico:::BlankRow(12L),

            # Tabs
            shiny::tabsetPanel(
              id = 'NLP_TabPanel',
              selected = 'Word2Vec',

              # Word2Vec ----
              shiny::tabPanel(
                title = "Word2Vec",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  Quantico:::BlankRow(12L),
                  shiny::fluidRow(
                    style = ModelHelpFormat,
                    shiny::column(
                      width = 3L,
                      tags$h4(tags$span(tags$b(paste0('Word2Vec'))))
                    ),
                    shiny::column(
                      width = 8L,
                      align = "right",
                      shinyWidgets::dropdown(
                        shinydashboard::box(
                          title = NULL, solidHeader = TRUE, collapsible = FALSE, status = "info", width = 12L,
                          shiny::fluidRow(
                            shiny::column(
                              width = 12L,
                              align = "left",
                              shiny::a(name = "word2vec"),
                              shiny::h1(tags$b("Word2Vec")),
                              shiny::p("The word2vec model is provided by H2O...")
                            )
                          ),

                          Quantico::BlankRow(12),
                          shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::h3("Word2Vec Usage"))),
                          shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::markdown(
                            "
                            H2O Word2Vec operation is for converting text columns into numeric vectors suitable for modeling purposes
                            * Train Data: This is your training dataset. This one is required
                            * Validation Data: Optional. If you have a validation dataset supply that here
                            * Test Data: Optional. If you have a test dataset supply that here
                            * Text Variables: Text columns you want included in your word2vec operation
                            * Build Type:
                              * individual: Generate a separate model for each text column
                              * combined: Combine all text columns and build a single model
                            * Keep Text Columns: Select TRUE to retain the source text columns after the word2vec operation
                            * Number of vectors: For each text column, how many word2vec columns do you want returned?
                            * Min Word Count: For text data to be considered, it must have a minimum word count supplied by the user
                            * Window Size: For the word2vec operation, it analyzes surrounding words and that window is defined here by the user
                            * Number of Epochs: Number of iterations for training the word2vec model
                            "
                          )))
                        ),
                        size = "lg",
                        icon = shiny::icon("question"),
                        label = NULL,
                        tooltip = FALSE,
                        right = TRUE,
                        up = FALSE,
                        width = NULL,
                        animate = shinyWidgets::animateOptions(
                          enter = "zoomIn",
                          exit = "fadeOutRightBig"
                        ),
                        inputId = NULL,
                        block = FALSE,
                        no_outline = TRUE
                      )
                    ),

                    # Agg Data Button
                    shiny::column(
                      width = 1L, align = 'right',
                      style = "padding-top: 4px;padding-right: 50px;",
                      shiny::actionButton(
                        inputId = 'FeatureEngineeringButton_Word2Vec_H2O',
                        label = 'Run',
                        icon = shiny::icon('chevron-right', lib='font-awesome')
                      )
                    )
                  ),

                  Quantico:::BlankRow(12L),
                  shiny::fluidRow(
                    shiny::column(
                      6L,
                      shinydashboard::box(
                        title = NULL, solidHeader = TRUE, collapsible = FALSE, status = "danger", width = 12L,
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='Word2Vec_H2O_TrainData', Label='Train Data', Choices = Word2Vec_H2O_TrainData_Choices, SelectedDefault = Word2Vec_H2O_TrainData_Selected, Multiple = TRUE, MaxVars = 1))),
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='Word2Vec_H2O_ValidationData', Label='Validation Data', Choices = Word2Vec_H2O_ValidationData_Choices, SelectedDefault = Word2Vec_H2O_ValidationData_Selected, Multiple = TRUE, MaxVars = 1))),
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='Word2Vec_H2O_TestData', Label='Test Data', Choices = Word2Vec_H2O_TestData_Choices, SelectedDefault = Word2Vec_H2O_TestData_Selected, Multiple = TRUE, MaxVars = 1))),
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::PickerInput(InputID='Word2Vec_H2O_stringCol', Label='Text Variables', Choices = NULL, SelectedDefault = Word2Vec_H2O_stringCol_Selected, Multiple = TRUE))),
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='Word2Vec_H2O_BuildType', Label='Build Type', Choices = Word2Vec_H2O_BuildType_Choices, SelectedDefault = Word2Vec_H2O_BuildType_Selected, Multiple = TRUE, MaxVars = 1))),
                        Quantico:::BlankRow(12L)
                      )
                    ),

                    shiny::column(
                      6L,
                      shinydashboard::box(
                        title = NULL, solidHeader = TRUE, collapsible = FALSE, status = "danger", width = 12L,
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='Word2Vec_H2O_KeepStringCol', Label='Keep Text Columns', Choices = Word2Vec_H2O_KeepStringCol_Choices, SelectedDefault = Word2Vec_H2O_KeepStringCol_Selected, Multiple = TRUE, MaxVars = 1))),
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::NumericInput(InputID='Word2Vec_H2O_vects', Label='Number of Vectors', Value = Word2Vec_H2O_vects_Selected, Min = 1, Max = 1000, Step = 1))),
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::NumericInput(InputID='Word2Vec_H2O_MinWords', Label='Min Word Count', Value = Word2Vec_H2O_MinWords_Selected, Min = 1, Max = 200, Step = 1))),
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::NumericInput(InputID='Word2Vec_H2O_WindowSize', Label='Window Size', Value = Word2Vec_H2O_WindowSize_Selected, Min = 1, Max = 100, Step = 1))),
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::NumericInput(InputID='Word2Vec_H2O_Epochs', Label='Number of Epochs', Value = Word2Vec_H2O_Epochs_Selected, Min = 1, Max = 1000, Step = 1))),
                        Quantico:::BlankRow(12L)
                      )
                    )
                  ),

                  # Word2Vec Button
                  Quantico:::BlankRow(12L),
                  Quantico:::BlankRow(12L),
                  Quantico:::BlankRow(12L),
                  Quantico:::BlankRow(12L),
                  Quantico:::BlankRow(12L)) # end of box

              ), # end Tab Panel

              # Text Summary: Create text summary added as columns ----
              shiny::tabPanel(
                title = "Text Summary",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  Quantico:::BlankRow(12L),
                  shiny::fluidRow(
                    style = ModelHelpFormat,
                    shiny::column(
                      width = 3L,
                      tags$h4(tags$span(tags$b(paste0('Text Summary'))))
                    ),
                    shiny::column(
                      width = 8L,
                      align = "right",
                      shinyWidgets::dropdown(
                        shinydashboard::box(
                          title = NULL, solidHeader = TRUE, collapsible = FALSE, status = "info", width = 12L,
                          shiny::fluidRow(
                            shiny::column(
                              width = 12L,
                              align = "left",
                              shiny::a(name = "textsummary"),
                              shiny::h1(tags$b("Text Summary")),
                              shiny::p("The Text Summary function provided a number of new columns
                           to your data set which include counts of: 'document', 'chars',
                           'sents', 'tokens', 'types', 'puncts', 'numbers', 'symbols',
                           'urls', 'tags', 'emojis'")
                            )
                          ),

                          Quantico::BlankRow(12),
                          shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::h3("Text Summary Usage"))),
                          shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::markdown(
                            "
                            Text Summary operation is for summarizing text columns for useful information
                            * Choose Data Set: This is your source dataset with text columns to analyze
                            * Text Columns: Select the text columns you want analyzed
                            * Remove Stats: Choose which stats to remove from the text summary output
                            "
                          )))
                        ),
                        size = "lg",
                        icon = shiny::icon("question"),
                        label = NULL,
                        tooltip = FALSE,
                        right = TRUE,
                        up = FALSE,
                        width = NULL,
                        animate = shinyWidgets::animateOptions(
                          enter = "zoomIn",
                          exit = "fadeOutRightBig"
                        ),
                        inputId = NULL,
                        block = FALSE,
                        no_outline = TRUE
                      )
                    ),

                    # Agg Data Button
                    shiny::column(
                      width = 1L, align = 'right',
                      style = "padding-top: 4px;padding-right: 50px;",
                      shiny::actionButton(
                        inputId = 'NLPButton_TextSummary',
                        label = 'Run',
                        icon = shiny::icon('chevron-right', lib='font-awesome')
                      )
                    )
                  ),

                  Quantico:::BlankRow(12L),
                  shiny::fluidRow(
                    shiny::column(
                      6L,
                      shinydashboard::box(
                        title = NULL, solidHeader = TRUE, collapsible = FALSE, status = "danger", width = 12L,
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='TextSummary_SelectData', Label='Choose data set', Choices = TextSummary_SelectData_Choices, SelectedDefault = TextSummary_SelectData_Selected, Multiple = TRUE, MaxVars = 1))),
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::PickerInput(InputID='TextSummary_TextColumns', Label='Text Columns', Choices = NULL, SelectedDefault = TextSummary_TextColumns_Selected, Multiple = TRUE, MaxVars = 100))),
                        Quantico:::BlankRow(12L))),

                    shiny::column(
                      6L,
                      shinydashboard::box(
                        title = NULL, solidHeader = TRUE, collapsible = FALSE, status = "danger", width = 12L,
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='TextSummary_RemoveStats', Label='Remove Stats', Choices = TextSummary_RemoveStats_Choices, SelectedDefault = TextSummary_RemoveStats_Selected, Multiple = TRUE, MaxVars = 100))),
                        Quantico:::BlankRow(12L)
                      )
                    )
                  ),

                  # Text Summary Button
                  Quantico:::BlankRow(12L),
                  Quantico:::BlankRow(12L),
                  Quantico:::BlankRow(12L),
                  Quantico:::BlankRow(12L),
                  Quantico:::BlankRow(12L)
                )
              ),


              # Sentiment: Create a column of sentiment values ----
              shiny::tabPanel(
                title = "Sentiment",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  Quantico:::BlankRow(12L),
                  shiny::fluidRow(
                    style = ModelHelpFormat,
                    shiny::column(
                      width = 3L,
                      tags$h4(tags$span(tags$b(paste0('Sentiment'))))
                    ),
                    shiny::column(
                      width = 8L,
                      align = "right",
                      shinyWidgets::dropdown(
                        shinydashboard::box(
                          title = NULL, solidHeader = TRUE, collapsible = FALSE, status = "info", width = 12L,
                          shiny::fluidRow(
                            shiny::column(
                              width = 12L,
                              align = "left",
                              shiny::a(name = "sentiment"),
                              shiny::h1(tags$b("Sentiment")),
                              shiny::p("The Sentiment function provided a sentiment score or a
                                       sentiment set of classifiers. One set is simply 'positive' or
                                       'negative' while the other also includes 'neutral'...")
                            )
                          ),

                          Quantico::BlankRow(12),
                          shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::h3("Sentiment Usage"))),
                          shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::markdown(
                            "
                            Sentiment operation is for analyzing text for positive, negative, or neutral expression
                            * Choose Data Set: This is your source dataset with text columns to analyze
                            * Text Columns: Select the text columns you want analyzed
                            * Output Type: Choose which stats to remove from the text summary output
                            * Remove Stopwords: Select TRUE to have the Sentiment operation ignore stopwords
                            * Apply Stemming: Select TRUE to apply stemming
                            "
                          )))
                        ),
                        size = "lg",
                        icon = shiny::icon("question"),
                        label = NULL,
                        tooltip = FALSE,
                        right = TRUE,
                        up = FALSE,
                        width = NULL,
                        animate = shinyWidgets::animateOptions(
                          enter = "zoomIn",
                          exit = "fadeOutRightBig"
                        ),
                        inputId = NULL,
                        block = FALSE,
                        no_outline = TRUE
                      )
                    ),

                    # Agg Data Button
                    shiny::column(
                      width = 1L, align = 'right',
                      style = "padding-top: 4px;padding-right: 50px;",
                      shiny::actionButton(
                        inputId = 'NLPButton_Sentiment',
                        label = 'Run',
                        icon = shiny::icon('chevron-right', lib='font-awesome')
                      )
                    )
                  ),

                  Quantico:::BlankRow(12L),
                  shiny::fluidRow(
                    shiny::column(
                      6L,
                      shinydashboard::box(
                        title = NULL, solidHeader = TRUE, collapsible = FALSE, status = "danger", width = 12L,
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='Sentiment_SelectData', Label='Choose data set', Choices = Sentiment_SelectData_Choices, SelectedDefault = Sentiment_SelectData_Selected, Multiple = TRUE, MaxVars = 1))),
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::PickerInput(InputID='Sentiment_TextColumns', Label='Text Columns', Choices = NULL, SelectedDefault = Sentiment_TextColumns_Selected, Multiple = TRUE, MaxVars = 100))),
                        Quantico:::BlankRow(12L))),

                    shiny::column(
                      6L,
                      shinydashboard::box(
                        title = NULL, solidHeader = TRUE, collapsible = FALSE, status = "danger", width = 12L,
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='Sentiment_Response', Label='Output Type', Choices = Sentiment_Response_Choices, SelectedDefault = Sentiment_Response_Selected, Multiple = TRUE, MaxVars = 1))),
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='Sentiment_RemoveStopWords', Label='Remove Stopwords', Choices = Sentiment_RemoveStopWords_Choices, SelectedDefault = Sentiment_RemoveStopWords_Selected, Multiple = TRUE, MaxVars = 1))),
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='Sentiment_Stemming', Label='Apply Stemming', Choices = Sentiment_Stemming_Choices, SelectedDefault = Sentiment_Stemming_Selected, Multiple = TRUE, MaxVars = 1))),
                        Quantico:::BlankRow(12L)
                      )
                    )
                  ),

                  # Sentiment Button
                  Quantico:::BlankRow(12L),
                  Quantico:::BlankRow(12L),
                  Quantico:::BlankRow(12L),
                  Quantico:::BlankRow(12L),
                  Quantico:::BlankRow(12L)
                )
              ),

              # Readability: Create a column of sentiment values ----
              shiny::tabPanel(
                title = "Readability",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  Quantico:::BlankRow(12L),
                  shiny::fluidRow(
                    style = ModelHelpFormat,
                    shiny::column(
                      width = 3L,
                      tags$h4(tags$span(tags$b(paste0('Readability'))))
                    ),
                    shiny::column(
                      width = 8L,
                      align = "right",
                      shinyWidgets::dropdown(
                        shinydashboard::box(
                          title = NULL, solidHeader = TRUE, collapsible = FALSE, status = "info", width = 12L,
                          shiny::fluidRow(
                            shiny::column(
                              width = 12L,
                              align = "left",
                              shiny::a(name = "readability"),
                              shiny::h1(tags$b("Readability")),
                              shiny::p("The Readability function provides a readability score for a variety
                           of readability metrics. You can choose to have a single verion returned or
                           as many as you'd like and they're be returned as new features in your dataset.
                           The definitions can be found in the link below..."),
                              tags$a(target="_blank", shiny::icon("newspaper"), href="https://cran.r-project.org/web/packages/quanteda.textstats/quanteda.textstats.pdf", "Definitions Link")
                            )
                          ),

                          shiny::fluidRow(
                            shiny::column(
                              width = 12L,
                              align = "left",
                              shiny::p("The Readability measures include: "))),
                          shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::markdown(
                            "
                              * 'Flesch'
                              * 'ARI'
                              * 'Bormuth.MC'
                              * 'Bormuth.GP'
                              * 'Coleman'
                              * 'Coleman.C2'
                              * 'Coleman.Liau.ECP'
                              * 'Coleman.Liau.grade'
                              * 'Coleman.Liau.short'
                              * 'Dale.Chall'
                              * 'Danielson.Bryan'
                              * 'Dickes.Steiwer'
                              * 'DRP'
                              * 'ELF'
                              * 'Farr.Jenkins.Paterson'
                              * 'Flesch.PSK'
                              * 'Flesch.Kincaid'
                              * 'FOG'
                              * 'FOG.PSK'
                              * 'FOG.NRI'
                              * 'FORCAST'
                              * 'Fucks'
                              * 'Linsear.Write'
                              * 'LIW'
                              * 'nWS'
                              * 'nWS.2'
                              * 'nWS.3'
                              * 'nWS4'
                              * 'RIX'
                              * 'Scrabble'
                              * 'SMOG'
                              * 'SMOG.C'
                              * 'SMOG.simple'
                              * 'SMOG.de'
                              * 'Spache'
                              * 'Spache.old'
                              * 'Strain'
                              * 'Traenkle.Bailer'
                              * 'Wheeler.Smith'
                              * 'meanSentenceLength'
                              * 'meanWordSyllables'
                              "
                              )
                            )
                          ),

                          Quantico::BlankRow(12),
                          shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::h3("Readability Usage"))),
                          shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::markdown(
                            "
                            Readability operation is for analyzing text for readability, based on the metrics selected
                            * Choose Data Set: This is your source dataset with text columns to analyze
                            * Text Columns: Select the text columns you want analyzed
                            * Readability Measures: Select at least one readability measure. Each readability measure will produce its own column of scores based on the measure
                            * Remove Hyphens: Text cleaning task
                            * Max Sentence Length: Text cleaning task
                            * Include Intermediate Values: Set to TRUE to have the variables that go into the readability measure returned in your data
                            "
                          )))
                        ),
                        size = "lg",
                        icon = shiny::icon("question"),
                        label = NULL,
                        tooltip = FALSE,
                        right = TRUE,
                        up = FALSE,
                        width = NULL,
                        animate = shinyWidgets::animateOptions(
                          enter = "zoomIn",
                          exit = "fadeOutRightBig"
                        ),
                        inputId = NULL,
                        block = FALSE,
                        no_outline = TRUE
                      )
                    ),

                    # Agg Data Button
                    shiny::column(
                      width = 1L, align = 'right',
                      style = "padding-top: 4px;padding-right: 50px;",
                      shiny::actionButton(
                        inputId = 'NLPButton_Readability',
                        label = 'Run',
                        icon = shiny::icon('chevron-right', lib='font-awesome')
                      )
                    )
                  ),

                  Quantico:::BlankRow(12L),
                  shiny::fluidRow(
                    shiny::column(
                      6L,
                      shinydashboard::box(
                        title = NULL, solidHeader = TRUE, collapsible = FALSE, status = "danger", width = 12L,
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='Readability_SelectData', Label='Choose data set', Choices = Readability_SelectData_Choices, SelectedDefault = Readability_SelectData_Selected, Multiple = TRUE, MaxVars = 1L))),
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::PickerInput(InputID='Readability_TextColumns', Label='Text Columns', Choices = NULL, SelectedDefault = Readability_TextColumns_Selected, Multiple = TRUE, MaxVars = 100L))),
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='Readability_Measures', Label='Readability Measures', Choices = Readability_Measures_Choices, SelectedDefault = Readability_Measures_Selected, Multiple = TRUE, MaxVars = 100L))),
                        Quantico:::BlankRow(12L)
                      )),

                    shiny::column(
                      6L,
                      shinydashboard::box(
                        title = NULL, solidHeader = TRUE, collapsible = FALSE, status = "danger", width = 12L,
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='Readability_RemoveHyphens', Label='Remove Hyphens', Choices = Readability_RemoveHyphens_Choices, SelectedDefault = Readability_RemoveHyphens_Selected, Multiple = TRUE, MaxVars = 1L))),
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::NumericInput(InputID='Readability_MinSentenceLength', Label='Min Sentence Length', Value = Readability_MinSentenceLength_Selected, Min = 1, Max = 100, Step = 1))),
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::NumericInput(InputID='Readability_MaxSentenceLength', Label='Max Sentence Length', Value = Readability_MaxSentenceLength_Selected, Min = 1, Max = 10000, Step = 1))),
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='Readability_Intermediate', Label='Include Intermediate Variables', Choices = Readability_Intermediate_Choices, SelectedDefault = Readability_Intermediate_Selected, Multiple = TRUE, MaxVars = 1L))),
                        Quantico:::BlankRow(12L)
                      )
                    )
                  ),

                  # Readability Button
                  Quantico:::BlankRow(12L),
                  Quantico:::BlankRow(12L),
                  Quantico:::BlankRow(12L),
                  Quantico:::BlankRow(12L),
                  Quantico:::BlankRow(12L)
                )
              ),

              # LexicalDiversity: Create a column of sentiment values ----
              shiny::tabPanel(
                title = "Lexical Diversity",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  Quantico:::BlankRow(12L),
                  shiny::fluidRow(
                    style = ModelHelpFormat,
                    shiny::column(
                      width = 3L,
                      tags$h4(tags$span(tags$b(paste0('Lexical Diversity'))))
                    ),
                    shiny::column(
                      width = 8L,
                      align = "right",
                      shinyWidgets::dropdown(
                        shinydashboard::box(
                          title = NULL, solidHeader = TRUE, collapsible = FALSE, status = "info", width = 12L,
                          shiny::fluidRow(
                            shiny::column(
                              width = 12L,
                              align = "left",
                              shiny::a(name = "lexicaldiversity"),
                              shiny::h1(tags$b("Lexical Diversity")),
                              shiny::p("The Lexical Diversity function provides a lexical diversity score for a variety
                                       of lexical diversity metrics. You can choose to have a single verion returned or
                                       as many as you'd like and they're be returned as new features in your dataset.
                                       Definitions for the below can be found here:"),
                              tags$a(target="_blank", shiny::icon("newspaper"), href="https://cran.r-project.org/web/packages/quanteda.textstats/quanteda.textstats.pdf", "Definitions Link"),
                              shiny::p("The Lexical Diversity measures include: "),
                              shiny::markdown(
                                "
                                * 'TTR'
                                * 'C'
                                * 'R'
                                * 'CTTR'
                                * 'U'
                                * 'S'
                                * 'K'
                                * 'I'
                                * 'D'
                                * 'Vm'
                                * 'Maas'
                                * 'MATTR'
                                * 'MSTTR'
                                "
                              )
                            )
                          ),

                          Quantico::BlankRow(12),
                          shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::h3("Lexical Diversity Usage"))),
                          shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::markdown(
                            "
                            Lexical Diversity operation is for analyzing text for complexity, based on the metrics selected
                            * Choose Data Set: This is your source dataset with text columns to analyze
                            * Text Columns: Select the text columns you want analyzed
                            * Lexical Measures: Select at least one lexical diversity measure. Each measure will produce its own column of scores based on the measure
                            * Remove Hyphens: Text cleaning task
                            * Remove Symbols: Text cleaning task
                            * Remove Punctuation: Text cleaning task
                            * Remove Numbers: Text cleaning task
                            * Log Base: Some of the measures utilize logs in their calculation. Default is natural log but you can select a different base
                            * Moving Avg Window for MATTR: Only applies if you select the MATTR measure
                            * Segment size for MSTTR: Only applies if you select MSTTR measure
                            "
                          )))
                        ),
                        size = "lg",
                        icon = shiny::icon("question"),
                        label = NULL,
                        tooltip = FALSE,
                        right = TRUE,
                        up = FALSE,
                        width = NULL,
                        animate = shinyWidgets::animateOptions(
                          enter = "zoomIn",
                          exit = "fadeOutRightBig"
                        ),
                        inputId = NULL,
                        block = FALSE,
                        no_outline = TRUE
                      )
                    ),

                    # Agg Data Button
                    shiny::column(
                      width = 1L, align = 'right',
                      style = "padding-top: 4px;padding-right: 50px;",
                      shiny::actionButton(
                        inputId = 'NLPButton_LexicalDiversity',
                        label = 'Run',
                        icon = shiny::icon('chevron-right', lib='font-awesome')
                      )
                    )
                  ),

                  Quantico:::BlankRow(12L),
                  shiny::fluidRow(
                    shiny::column(
                      6L,
                      shinydashboard::box(
                        title = NULL, solidHeader = TRUE, collapsible = FALSE, status = "danger", width = 12L,
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='LexicalDiversity_SelectData', Label='Choose data set', Choices = LexicalDiversity_SelectData_Choices, SelectedDefault = LexicalDiversity_SelectData_Selected, Multiple = TRUE, MaxVars = 1L))),
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::PickerInput(InputID='LexicalDiversity_TextColumns', Label='Text Columns', Choices = NULL, SelectedDefault = LexicalDiversity_TextColumns_Selected, Multiple = TRUE, MaxVars = 100L))),
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::PickerInput(InputID='LexicalDiversity_Measures', Label='Lexical Measures', Choices = LexicalDiversity_Measures_Choices, SelectedDefault = LexicalDiversity_Measures_Selected, Multiple = TRUE, MaxVars = 100L))),
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::PickerInput(InputID='LexicalDiversity_RemoveHyphens', Label='Remove Hyphens', Choices = LexicalDiversity_RemoveHyphens_Choices, SelectedDefault = LexicalDiversity_RemoveHyphens_Selected, Multiple = TRUE, MaxVars = 100L))),
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::PickerInput(InputID='LexicalDiversity_RemoveSymbols', Label='Remove Symbols', Choices = LexicalDiversity_RemoveSymbols_Choices, SelectedDefault = LexicalDiversity_RemoveSymbols_Selected, Multiple = TRUE, MaxVars = 100L))),
                        Quantico:::BlankRow(12L))),

                    shiny::column(
                      6L,
                      shinydashboard::box(
                        title = NULL, solidHeader = TRUE, collapsible = FALSE, status = "danger", width = 12L,
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='LexicalDiversity_RemovePunctuation', Label='Remove Punctuation', Choices = LexicalDiversity_RemovePunctuation_Choices, SelectedDefault = LexicalDiversity_RemovePunctuation_Selected, Multiple = TRUE, MaxVars = 100L))),
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='LexicalDiversity_RemoveNumbers', Label='Remove Numbers', Choices = LexicalDiversity_RemoveNumbers_Choices, SelectedDefault = LexicalDiversity_RemoveNumbers_Selected, Multiple = TRUE, MaxVars = 1L))),
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='LexicalDiversity_LogBase', Label='Log Base', Choices = LexicalDiversity_LogBase_Choices, SelectedDefault = LexicalDiversity_LogBase_Selected, Multiple = TRUE, MaxVars = 1L))),
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::NumericInput(InputID='LexicalDiversity_MATTR_Window', Label='Moving Avg Window for MATTR', Value = LexicalDiversity_MATTR_Window_Selected, Min = 1, Max = 100, Step = 1))),
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::NumericInput(InputID='LexicalDiversity_MSTTR', Label='Segment size for MSTTR', Value = LexicalDiversity_MSTTR_Segment_Selected, Min = 1, Max = 100, Step = 1))),
                        Quantico:::BlankRow(12L)

                      )
                    )
                  ),

                  # Readability Button
                  Quantico:::BlankRow(12L),
                  Quantico:::BlankRow(12L),
                  Quantico:::BlankRow(12L),
                  Quantico:::BlankRow(12L),
                  Quantico:::BlankRow(12L)
                )
              )
            ) # end Tab Panel Main ----
          ), # end TagList ----

          footer = shiny::tagList(
            shiny::modalButton(label = "Cancel"),
            shiny::actionButton("NLP_OK", "OK", width = '50px'))))
    })
}

# ----

# ----

# @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ ----
# ::  Machine Learning  ::                                                                                       ----
# @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ ----

#' @title CatBoost_Modal_Fun
#'
#' @description CatBoost Parameters Modal with OK button to close
#'
#' @author Adrian Antico
#' @family ML
#'
#' @param id = 'CatBoost_ID'
#' @param AppWidth = 12L
#'
#' @export
CatBoost_Modal_Fun <- function(id,
                               AppWidth=12L,

                               # Reactives
                               CatBoost_TargetColumnName_Selected = NULL,
                               CatBoost_FeatureColNames_Selected = NULL,
                               CatBoost_WeightsColumnName_Selected = NULL,
                               CatBoost_TransformNumericColumns_Selected = NULL,
                               CatBoost_grid_eval_metric_Selected = NULL,
                               CatBoost_LossFunction_Selected = NULL,
                               CatBoost_EvalMetric_Selected = NULL,

                               # Static
                               CatBoost_TargetType_Choices = NULL,
                               CatBoost_Runs_Choices = NULL,
                               CatBoost_data_Choices = NULL,
                               CatBoost_ValidationData_Choices = NULL,
                               CatBoost_TestData_Choices = NULL,
                               CatBoost_EncodeMethod_Choices = NULL,
                               CatBoost_Methods_Choices = NULL,
                               CatBoost_PassInGrid_Choices = NULL,
                               CatBoost_NThreads_Choices = NULL,
                               CatBoost_task_type_Choices = NULL,
                               CatBoost_NumGPUs_Choices = NULL,
                               CatBoost_TrainOnFull_Choices = NULL,
                               CatBoost_Trees_Choices = NULL,
                               CatBoost_Depth_Choices = NULL,
                               CatBoost_LearningRate_Choices = NULL,
                               CatBoost_L2_Leaf_Reg_Choices = NULL,
                               CatBoost_model_size_reg_Choices = NULL,
                               CatBoost_langevin_Choices = NULL,
                               CatBoost_diffusion_temperature_Choices = NULL,
                               CatBoost_RandomStrength_Choices = NULL,
                               CatBoost_BorderCount_Choices = NULL,
                               CatBoost_RSM_Choices = NULL,
                               CatBoost_BootStrapType_Choices = NULL,
                               CatBoost_GrowPolicy_Choices = NULL,
                               CatBoost_feature_border_type_Choices = NULL,
                               CatBoost_subsample_Choices = NULL,
                               CatBoost_score_function_Choices = NULL,
                               CatBoost_min_data_in_leaf_Choices = NULL,
                               CatBoost_GridTune_Choices = NULL,
                               CatBoost_MaxModelsInGrid_Choices = NULL,
                               CatBoost_MaxRunsWithoutNewWinner_Choices = NULL,
                               CatBoost_MaxRunMinutes_Choices = NULL,
                               CatBoost_BaselineComparison_Choices = NULL,
                               CatBoost_MetricPeriods_Choices = NULL,

                               # Updaters
                               CatBoost_ModelID_Selected = NULL,
                               CatBoost_TargetType_Selected = NULL,
                               CatBoost_Runs_Selected = NULL,
                               CatBoost_data_Selected = NULL,
                               CatBoost_ValidationData_Selected = NULL,
                               CatBoost_TestData_Selected = NULL,
                               CatBoost_EncodeMethod_Selected = NULL,
                               CatBoost_Methods_Selected = NULL,
                               CatBoost_PassInGrid_Selected = NULL,
                               CatBoost_NThreads_Selected = NULL,
                               CatBoost_task_type_Selected = NULL,
                               CatBoost_NumGPUs_Selected = NULL,
                               CatBoost_TrainOnFull_Selected = NULL,
                               CatBoost_Trees_Selected = NULL,
                               CatBoost_Depth_Selected = NULL,
                               CatBoost_LearningRate_Selected = NULL,
                               CatBoost_L2_Leaf_Reg_Selected = NULL,
                               CatBoost_model_size_reg_Selected = NULL,
                               CatBoost_langevin_Selected = NULL,
                               CatBoost_diffusion_temperature_Selected = NULL,
                               CatBoost_RandomStrength_Selected = NULL,
                               CatBoost_BorderCount_Selected = NULL,
                               CatBoost_RSM_Selected = NULL,
                               CatBoost_BootStrapType_Selected = NULL,
                               CatBoost_GrowPolicy_Selected = NULL,
                               CatBoost_feature_border_type_Selected = NULL,
                               CatBoost_subsample_Selected = NULL,
                               CatBoost_score_function_Selected = NULL,
                               CatBoost_min_data_in_leaf_Selected = NULL,
                               CatBoost_GridTune_Selected = NULL,
                               CatBoost_MaxModelsInGrid_Selected = NULL,
                               CatBoost_MaxRunsWithoutNewWinner_Selected = NULL,
                               CatBoost_MaxRunMinutes_Selected = NULL,
                               CatBoost_BaselineComparison_Selected = NULL,
                               CatBoost_MetricPeriods_Selected = NULL,
                               CatBoost_ClassWeights0_Selected = NULL,
                               CatBoost_ClassWeights1_Selected = NULL) {
  shiny::moduleServer(
    id = id,
    module = function(input, output, session) {
      ns <- session$ns
      shiny::showModal(
        shiny::modalDialog(
          title = 'CatBoost Parameters',
          size = "l",
          easyClose = FALSE,
          fade = TRUE,
          shiny::tagList(

            # Top Box ----
            shinydashboard::box(
              title = NULL, solidHeader = TRUE, collapsible = FALSE, status = 'danger', width = AppWidth,
              Quantico::BlankRow(12L),
              shiny::fluidRow(
                shiny::column(
                  width = 12L,
                  align = "right",
                  shinyWidgets::dropdown(
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = "info", width = 12L,
                      shiny::fluidRow(
                        shiny::column(
                          width = 12L,
                          align = "left",
                          shiny::a(name = "catboost"),
                          shiny::h1(tags$b("CatBoost")),
                          shiny::p("The CatBoost ML algorithm is for running regression, classification,
                           and multiclass models."),
                          tags$a(target="_blank", shiny::icon("newspaper"), href="https://catboost.ai/", "CatBoost Background Link"),
                        )
                      ),

                      Quantico::BlankRow(12),
                      Quantico::BlankRow(12),
                      shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::h3("CatBoost Usage"))),
                      Quantico::BlankRow(12),
                      shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::markdown(
                        "
                        ### Data:
                        This is where you define your datasets and variables of interest
                        * Train Data: This is your training dataset. This one is required
                        * Validation Data: Optional. If you have a validation dataset supply that here. If not, one will be created for you and 20% of your data will be allocated to Validation Data unless you specify 'TrainOnFull = TRUE' in the Meta Parameters tab.
                        * Test Data: Optional. If you have a validation dataset supply that here. If not, one will be created for you and 10% of your data will be allocated to Test Data unless you specify 'TrainOnFull = TRUE' in the Meta Parameters tab.
                        * Select Target: This is your dependent variable that you are looking to predict / model
                        * Select Features: These are your independent variables used to help predict your target variable
                        * TrainOnFull: Select TRUE to train on the full dataset instead of utilizing training, validation, and test datasets. This is typically done when you've found a final set of parameters and are ready to build a final model for production.
                        * Character Encoding: If you have character features in your feature set they will be converted to numeric encodings. You can choose which type in this dropdown
                        * Weights Column: if you want your rows weighted for modeling purposes you'll need to have a column with the weights within them to supply here. A common reason to use weighting is for when you have group variables and some of the levels have lower counts than others. The ML models will tend to emphasize the higher record count when building so if you find bias is your outcome predictions, weighting can help to resolve that
                        * Transform Variables: This is to transform your target variable. There is no need to transform your features (independent variables) as monotonic transformations on features with tree based methods make no difference in outcome
                        * Transform Methods: Choose at least one method. The algorithms will determine which transformation among selected will best normalize your target variable and move forward with that one
                        "
                      ))),
                      Quantico::BlankRow(12),
                      shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::markdown(
                        "
                        ### Hardware:
                        This is where you define your datasets and variables of interest
                        * GPU or CPU: If you're running a machine with GPU's available you can select to run with GPU. Note that outcome performance can vary by utilizing GPU vs CPU. You will typically need more Trees when utilizing the GPU selection
                        * Number of GPU's: If you've selected GPU and have access to more than one you can utilize them by increasing this input to the number of GPU's of your choice
                        * Create ModelID: This will attach all model artifacts to a name. If you plan on running multiple models for comparison then set a name to each model to distinguish between then and prevent overwriting an already built model
                        * CPU Threads: This will default to total available threads minus 2. CPU is still utilized even when you select GPU. If you have other processes running at the same time as modeling you will want to lower the CPU Threads count to give all processes a chance to keep running and prevent a queue pool from forming (which can slow down all processes)
                        "
                      ))),
                      Quantico::BlankRow(12),
                      shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::markdown(
                        "
                        ### Model:
                        This is where you define the CatBoost parameters
                        * Number of Trees: Select the number of trees for training the model
                        * Max Tree Depth: Determines the max number of splits each tree can make
                        * Learning Rate: Leave blank for CatBoost to determine the value for you. Otherwise supply a value. Used for reducing the gradient step
                        * L2 Leaf Regularization: L2 Regularization for tree based methods. Higher the value the less likely for the model to overfit, at the expense of potential accuracy
                        * Model Size Regularization: The model size regularization coefficient. The larger the value, the smaller the model size. Another overfitting protection parameter
                        * Langevin Boosting: Enables the Stochastic Gradient Langevin Boosting mode
                        * Diffusion Temperature: The diffusion temperature of the Stochastic Gradient Langevin Boosting mode. Utilize this with Langevin Boosting, otherwise the parameter is ignored
                        * Random Strength: The amount of randomness to use for scoring splits when the tree structure is selected. Use this parameter to avoid overfitting the model
                        * Border Count: The number of splits for numerical features
                        * Random Subspace: Random subspace method. The percentage of features to use at each split selection, when features are selected over again at random
                        * Bootstrap Type: Defines the method for sampling the weights of objects. Used for regularization and training speedup. Link below for details
                        * Grow Policy: 'SymmetricTree' is the only option to use that will return variable importance data. If you're not concerned with that, you can also choose from 'LossGuide' or 'DepthWise'
                        * Min Data in Leaf: The minimum number of training samples in a leaf. CatBoost does not search for new splits in leaves with samples count less than the specified value
                        * Bagging Rate: Sample rate for selected subsets of the rows of the training data for each tree (like a random forest)
                        * Feature Border Type: The quantization mode for numerical features. Link below for details
                        * Score Function: The score type used to select the next split during the tree construction. Links below for details
                        "
                      ))),
                      Quantico::BlankRow(12L),
                      shiny::fluidRow(shiny::column(width = 12L, align = "left", tags$a(target="_blank", shiny::icon("newspaper"), href="https://catboost.ai/en/docs/concepts/algorithm-main-stages_bootstrap-options", "Bootstrap Type Details"))),
                      shiny::fluidRow(shiny::column(width = 12L, align = "left", tags$a(target="_blank", shiny::icon("newspaper"), href="https://catboost.ai/en/docs/concepts/quantization", "Feature Border Type Details"))),
                      shiny::fluidRow(shiny::column(width = 12L, align = "left", tags$a(target="_blank", shiny::icon("newspaper"), href="https://catboost.ai/en/docs/concepts/algorithm-score-functions", "Score Function Details"))),

                      Quantico::BlankRow(12),
                      shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::markdown(
                        "
                        ### Grid Tuning:
                        This is where you define parameters for a hyperparameter search
                        * Grid Tune: Set to TRUE to run grid tuning
                        * Baseline Comparison of Models: 'default' will compare all models to the catboost default settings (with the user supplied number of trees). 'best' will compare all models to the current best performer among all models built in the grid tuning process
                        * Max Run Time (minutes): Set an upper boundary for run time of grid tuning
                        * Runs without a new Winner: Set a value to terminate grid tuning due to lack of new winning models
                        * Max Models: Cap the number of models to test in grid tuning mode
                        "
                      ))),

                      Quantico::BlankRow(12),
                      shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::markdown(
                        "
                        ### Evaluation:
                        This is where you define parameters for a hyperparameter search
                        * Loss Function: The metric to use in training. The specified value also determines the machine learning problem to solve. Some metrics support optional parameters (see the Objectives and metrics section for details on each metric)
                        * Evaluation Metric: The metric used for overfitting detection (if enabled) and best model selection (if enabled). Some metrics support optional parameters (see the Objectives and metrics section for details on each metric)
                        * Trees between Evaluations: Number of trees to build between evaluations for overfitting detection
                        * Class Weight for 0 Class: For Binary Classification models, you can up- or down-weight each class. The default under the hood is 1 for both
                        * Class Weight for 1 Class: For Binary Classification models, you can up- or down-weight each class. The default under the hood is 1 for both
                        * Grid Tuning Evaluation Metric:
                        "
                      ))),

                      Quantico::BlankRow(12L),
                      shiny::fluidRow(shiny::column(width = 12L, align = "left", tags$a(target="_blank", shiny::icon("newspaper"), href="https://catboost.ai/en/docs/concepts/loss-functions", "Loss Functions and Eval Metrics Details")))
                    ),
                    size = "lg",
                    icon = shiny::icon("question"),
                    label = NULL,
                    tooltip = FALSE,
                    right = TRUE,
                    up = FALSE,
                    width = NULL,
                    animate = shinyWidgets::animateOptions(
                      enter = "zoomIn",
                      exit = "fadeOutRightBig"
                    ),
                    inputId = NULL,
                    block = FALSE,
                    no_outline = TRUE
                  )
                )
              ),

              Quantico:::BlankRow(12L),
              shiny::fluidRow(

                # Target Type
                shiny::column(
                  width = 3L,
                  align = 'center',
                  Quantico:::SelectizeInput(InputID = 'CatBoost_TargetType', Label = 'Select Supervised Learning Type', Choices = CatBoost_TargetType_Choices, SelectedDefault = CatBoost_TargetType_Selected, Multiple = TRUE, MaxVars = 1)),
                shiny::column(
                  3L,
                  align = 'center',
                  Quantico:::TextInput(InputID='CatBoost_ModelID', Label='Create Model ID', Value = CatBoost_ModelID_Selected, Placeholder = NULL)),
                shiny::column(
                  width = 3L,
                  align = 'center',
                  Quantico:::NumericInput(InputID = 'CatBoost_Runs', Label = 'Cross Validation Runs', Value = CatBoost_Runs_Selected, Min = 1, Max = 100, Step = 1)
                ),

                # Build Models Button
                shiny::column(
                  width = 3L,
                  shinyjs::useShinyjs(),
                  align = 'center',
                  tags$h3(tags$b('~ Build')),
                  shiny::actionButton(
                    inputId = paste0('BuildModels_CatBoost'),
                    label = paste0('Run'),
                    icon = shiny::icon('chevron-right', lib='font-awesome'))
                )
              ),
              Quantico:::BlankRow(12L)
            ),

            Quantico:::BlankRow(12L),
            Quantico:::BlankRow(12L),

            # Tabs
            shiny::tabsetPanel(
              id = 'CatBoost_TabPanel',
              selected = 'Data',

              # Data Parameters ----
              shiny::tabPanel(
                title = "Data",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shinydashboard::box(
                    title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                    Quantico:::BlankRow(12L),

                    shiny::fluidRow(
                      shiny::column(
                        6L,
                        align = 'center',
                        shinydashboard::box(
                          title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='CatBoost_data', Label='Select Training Data', Choices = CatBoost_data_Choices, SelectedDefault = CatBoost_data_Selected, Multiple = TRUE, MaxVars = 1))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='CatBoost_ValidationData', Label='Select Validation Data', Choices = CatBoost_ValidationData_Choices, SelectedDefault = CatBoost_ValidationData_Selected, Multiple = TRUE, MaxVars = 1))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='CatBoost_TestData', Label='Select Test Data', Choices = CatBoost_TestData_Choices, SelectedDefault = CatBoost_TestData_Selected, Multiple = TRUE, MaxVars = 1))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::PickerInput(InputID='CatBoost_TargetColumnName', Label='Select Target', Choices = CatBoost_TargetColumnName_Selected, SelectedDefault = CatBoost_TargetColumnName_Selected, Multiple = TRUE, MaxVars = 1L))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::PickerInput(InputID='CatBoost_FeatureColNames', Label='Select Features', Choices = CatBoost_FeatureColNames_Selected, SelectedDefault = CatBoost_FeatureColNames_Selected, Multiple = TRUE))),
                          Quantico:::BlankRow(12L)
                        )),

                      shiny::column(
                        6L,
                        align = 'center',
                        shinydashboard::box(
                          title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID = 'CatBoost_TrainOnFull', Label='Train on Full Data', Choices = CatBoost_TrainOnFull_Choices, SelectedDefault = CatBoost_TrainOnFull_Selected, Multiple = TRUE, MaxVars = 1))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='CatBoost_EncodeMethod', Label='Character Encoding', Choices = CatBoost_EncodeMethod_Choices, SelectedDefault = CatBoost_EncodeMethod_Selected, Multiple = TRUE, MaxVars = 1))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::PickerInput(InputID='CatBoost_WeightsColumnName', Label='Weights Column', Choices = CatBoost_WeightsColumnName_Selected, SelectedDefault = CatBoost_WeightsColumnName_Selected, Multiple = TRUE, MaxVars = 1L))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::PickerInput(InputID='CatBoost_TransformNumericColumns', Label='Transform Variables', Choices = CatBoost_TransformNumericColumns_Selected, SelectedDefault = CatBoost_TransformNumericColumns_Selected, Multiple = TRUE))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='CatBoost_Methods', Label='Transform Methods', Choices = CatBoost_Methods_Choices, SelectedDefault = CatBoost_Methods_Selected, Multiple = TRUE, MaxVars = 10))),
                          Quantico:::BlankRow(12L)
                        ))
                    ),

                    Quantico:::BlankRow(12L),
                    Quantico:::BlankRow(12L),
                    Quantico:::BlankRow(12L),
                    Quantico:::BlankRow(12L)))),

              # MetaData Parameters ----
              shiny::tabPanel(
                title = "Hardware",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shinydashboard::box(
                    title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                    Quantico:::BlankRow(12L),

                    shiny::fluidRow(
                      shiny::column(
                        6L,
                        align = 'center',
                        shinydashboard::box(
                          title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID = 'CatBoost_task_type', Label='GPU or CPU', Choices = CatBoost_task_type_Choices, SelectedDefault = CatBoost_task_type_Selected, Multiple = TRUE, MaxVars = 1))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::NumericInput(InputID = 'CatBoost_NumGPUs', Label='Number of GPUs', Value = CatBoost_NumGPUs_Selected, Min = 1, Max = 10, Step = 1))),
                          Quantico:::BlankRow(12L)
                        )),

                      shiny::column(
                        6L,
                        align = 'center',
                        shinydashboard::box(
                          title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::NumericInput(InputID = 'CatBoost_NThreads', Label='CPU Threads', Value = CatBoost_NThreads_Selected, Min = 1, Max = max(1L, parallel::detectCores() - 2L), Step = 1))),
                          Quantico:::BlankRow(12L)
                        )
                      )
                    ),

                    Quantico:::BlankRow(12L),
                    Quantico:::BlankRow(12L),
                    Quantico:::BlankRow(12L),
                    Quantico:::BlankRow(12L)))),

              # ML Parameters ----
              shiny::tabPanel(
                title = "Model",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shinydashboard::box(
                    title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                    Quantico:::BlankRow(12L),

                    shiny::fluidRow(
                      shiny::column(
                        3L,
                        align = 'center',
                        shinydashboard::box(
                          title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::NumericInput(InputID='CatBoost_Trees', Label='Number of Trees', Value = CatBoost_Trees_Selected, Min = 25, Max = 30000, Step = 25))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::NumericInput(InputID='CatBoost_Depth', Label='Max Tree Depth', Value = CatBoost_Depth_Selected, Min = 2, Max = 20, Step = 1))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='CatBoost_LearningRate', Label='Learning Rate', Choices = CatBoost_LearningRate_Choices, SelectedDefault = CatBoost_LearningRate_Selected, Multiple = TRUE, MaxVars = 1))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='CatBoost_L2_Leaf_Reg', Label='L2 Leaf Regularize', Choices = CatBoost_L2_Leaf_Reg_Choices, SelectedDefault = CatBoost_L2_Leaf_Reg_Selected, Multiple = TRUE, MaxVars = 1))),
                          Quantico:::BlankRow(12L)
                        )),

                      shiny::column(
                        3L,
                        align = 'center',
                        shinydashboard::box(
                          title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='CatBoost_model_size_reg', Label='Model Size Regularize', Choices = CatBoost_model_size_reg_Choices, SelectedDefault = CatBoost_model_size_reg_Selected, Multiple = TRUE, MaxVars = 1))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='CatBoost_langevin', Label='Langevin Boosting', Choices = CatBoost_langevin_Choices, SelectedDefault = CatBoost_langevin_Selected, Multiple = TRUE, MaxVars = 1))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='CatBoost_diffusion_temperature', Label='Diffusion Temp', Choices = CatBoost_diffusion_temperature_Choices, SelectedDefault = CatBoost_diffusion_temperature_Selected, Multiple = TRUE, MaxVars = 1))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='CatBoost_RandomStrength', Label='Random Strength', Choices = CatBoost_RandomStrength_Choices, SelectedDefault = CatBoost_RandomStrength_Selected, Multiple = TRUE, MaxVars = 1))),
                          Quantico:::BlankRow(12L)
                        )),

                      shiny::column(
                        3L,
                        align = 'center',
                        shinydashboard::box(
                          title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='CatBoost_BorderCount', Label='Border Count', Choices = CatBoost_BorderCount_Choices, SelectedDefault = CatBoost_BorderCount_Selected, Multiple = TRUE, MaxVars = 1))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='CatBoost_RSM', Label='Random Subspace', Choices = CatBoost_RSM_Choices, SelectedDefault = CatBoost_RSM_Selected, Multiple = TRUE, MaxVars = 1))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='CatBoost_BootStrapType', Label='Bootstrap Type', Choices = CatBoost_BootStrapType_Choices, SelectedDefault = CatBoost_BootStrapType_Selected, Multiple = TRUE, MaxVars = 1))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='CatBoost_GrowPolicy', Label='Grow Policy', Choices = CatBoost_GrowPolicy_Choices, SelectedDefault = CatBoost_GrowPolicy_Selected, Multiple = TRUE, MaxVars = 1))),
                          Quantico:::BlankRow(12L)
                        )),

                      shiny::column(
                        3L,
                        align = 'center',
                        shinydashboard::box(
                          title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='CatBoost_min_data_in_leaf', Label='Min Data Leaf', Choices = CatBoost_min_data_in_leaf_Choices, SelectedDefault = CatBoost_min_data_in_leaf_Selected, Multiple = TRUE, MaxVars = 1))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='CatBoost_subsample', Label='Bagging Rate', Choices = CatBoost_subsample_Choices, SelectedDefault = CatBoost_subsample_Selected, Multiple = TRUE, MaxVars = 1))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='CatBoost_feature_border_type', Label='Feature Border Type', Choices = CatBoost_feature_border_type_Choices, SelectedDefault = CatBoost_feature_border_type_Selected, Multiple = TRUE, MaxVars = 1))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='CatBoost_score_function', Label='Score Function', Choices = CatBoost_score_function_Choices, SelectedDefault = CatBoost_score_function_Selected, Multiple = TRUE, MaxVars = 1))),
                          Quantico:::BlankRow(12L)
                        ))
                    ),

                    Quantico:::BlankRow(12L),
                    Quantico:::BlankRow(12L),
                    Quantico:::BlankRow(12L),
                    Quantico:::BlankRow(12L)))),

              # Grid Tuning Parameters ----
              shiny::tabPanel(
                title = "Grid Tune",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shinydashboard::box(
                    title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                    Quantico:::BlankRow(12L),

                    shiny::fluidRow(
                      shiny::column(
                        6L,
                        align = 'center',
                        shinydashboard::box(
                          title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='CatBoost_GridTune', Label='Grid Tune', Choices = CatBoost_GridTune_Choices, SelectedDefault = CatBoost_GridTune_Selected, Multiple = TRUE, MaxVars = 1))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='CatBoost_BaselineComparison', Label='Baseline Comparison of Models', Choices = CatBoost_BaselineComparison_Choices, SelectedDefault = CatBoost_BaselineComparison_Selected, Multiple = TRUE, MaxVars = 1))),
                          Quantico:::BlankRow(12L)
                        )),

                      shiny::column(
                        6L,
                        align = 'center',
                        shinydashboard::box(
                          title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::NumericInput(InputID='CatBoost_MaxRunMinutes', Label='Max Run Time (mins)', Value = CatBoost_MaxRunMinutes_Selected, Min = 5, Max = 1440, Step = 1))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::NumericInput(InputID='CatBoost_MaxRunsWithoutNewWinner', Label='Runs Without Winner', Value = CatBoost_MaxRunsWithoutNewWinner_Selected, Min = 2, Max = 200, Step = 1))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::NumericInput(InputID='CatBoost_MaxModelsInGrid', Label='Max Models', Value = CatBoost_MaxModelsInGrid_Selected, Min = 2, Max = 1000, Step = 1))),
                          Quantico:::BlankRow(12L)
                        ))
                    ),

                    Quantico:::BlankRow(12L),
                    Quantico:::BlankRow(12L),
                    Quantico:::BlankRow(12L),
                    Quantico:::BlankRow(12L)))),

              # Eval Parameters ----
              shiny::tabPanel(
                title = "Evaluation",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shinydashboard::box(
                    title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                    Quantico:::BlankRow(12L),

                    shiny::fluidRow(
                      shiny::column(
                        6L,
                        align = 'center',
                        shinydashboard::box(
                          title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='CatBoost_LossFunction', Label='Loss Function', Choices = NULL, SelectedDefault = CatBoost_LossFunction_Selected, Multiple = TRUE, MaxVars = 1))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='CatBoost_EvalMetric', Label='Evaluation Metric', Choices = NULL, SelectedDefault = CatBoost_EvalMetric_Selected, Multiple = TRUE, MaxVars = 1))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::NumericInput(InputID='CatBoost_MetricPeriods', Label='Trees between Evals', Value = CatBoost_MetricPeriods_Selected, Min = 1, Max = 100, Step = 1))),
                          Quantico:::BlankRow(12L)
                        )
                      ),

                      shiny::column(
                        6L,
                        align = 'center',
                        shinydashboard::box(
                          title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::NumericInput(InputID='CatBoost_ClassWeights0', Label='Class Weight for 0', Value = CatBoost_ClassWeights0_Selected, Min = 0.01, Max = 1000, Step = 0.01))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::NumericInput(InputID='CatBoost_ClassWeights1', Label='Class Weight for 1', Value = CatBoost_ClassWeights1_Selected, Min = 0.01, Max = 1000, Step = 0.01))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='CatBoost_grid_eval_metric', Label='Evaluation Metric', Choices = NULL, SelectedDefault = CatBoost_grid_eval_metric_Selected, Multiple = TRUE, MaxVars = 1))),
                          Quantico:::BlankRow(12L)
                        )
                      )
                    ),

                    Quantico:::BlankRow(12L),
                    Quantico:::BlankRow(12L),
                    Quantico:::BlankRow(12L),
                    Quantico:::BlankRow(12L)))))), # end TagList

          footer = shiny::tagList(
            shiny::modalButton(label = "Cancel"),
            shiny::actionButton("CatBoost_OK", "OK", width = '50px'))))
    })
}

#' @title XGBoost_Modal_Fun
#'
#' @description XGBoost Parameters Modal with OK button to close
#'
#' @author Adrian Antico
#' @family ML
#'
#' @param id = 'XGBoost_ID'
#' @param AppWidth = 12L
#'
#' @export
XGBoost_Modal_Fun <- function(id, AppWidth=12L,

                              # Reactives
                              XGBoost_TargetColumnName_Selected = NULL,
                              XGBoost_FeatureColNames_Selected = NULL,
                              XGBoost_WeightsColumnName_Selected = NULL,
                              XGBoost_TransformNumericColumns_Selected = NULL,
                              XGBoost_grid_eval_metric_Selected = NULL,
                              XGBoost_LossFunction_Selected = NULL,
                              XGBoost_EvalMetric_Selected = NULL,

                              # Static
                              XGBoost_Runs_Choices = NULL,
                              XGBoost_TargetType_Choices = NULL,
                              XGBoost_data_Choices = NULL,
                              XGBoost_ValidationData_Choices = NULL,
                              XGBoost_TestData_Choices = NULL,
                              XGBoost_EncodeMethod_Choices = NULL,
                              XGBoost_Methods_Choices = NULL,
                              XGBoost_NThreads_Choices = NULL,
                              XGBoost_TreeMethod_Choices = NULL,
                              XGBoost_NumGPUs_Choices = NULL,
                              XGBoost_TrainOnFull_Choices = NULL,
                              XGBoost_Trees_Choices = NULL,
                              XGBoost_max_depth_Choices = NULL,
                              XGBoost_eta_Choices = NULL,
                              XGBoost_min_child_weight_Choices = NULL,
                              XGBoost_subsample_Choices = NULL,
                              XGBoost_colsample_bytree_Choices = NULL,
                              XGBoost_alpha_Choices = NULL,
                              XGBoost_lambda_Choices = NULL,
                              XGBoost_PassInGrid_Choices = NULL,
                              XGBoost_GridTune_Choices = NULL,
                              XGBoost_MaxModelsInGrid_Choices = NULL,
                              XGBoost_MaxRunsWithoutNewWinner_Choices = NULL,
                              XGBoost_MaxRunMinutes_Choices = NULL,
                              XGBoost_BaselineComparison_Choices = NULL,

                              # Updaters
                              XGBoost_ModelID_Selected = NULL,
                              XGBoost_Runs_Selected = NULL,
                              XGBoost_TargetType_Selected = NULL,
                              XGBoost_data_Selected = NULL,
                              XGBoost_ValidationData_Selected = NULL,
                              XGBoost_TestData_Selected = NULL,
                              XGBoost_EncodeMethod_Selected = NULL,
                              XGBoost_Methods_Selected = NULL,
                              XGBoost_NThreads_Selected = NULL,
                              XGBoost_TreeMethod_Selected = NULL,
                              XGBoost_NumGPUs_Selected = NULL,
                              XGBoost_TrainOnFull_Selected = NULL,
                              XGBoost_Trees_Selected = NULL,
                              XGBoost_max_depth_Selected = NULL,
                              XGBoost_eta_Selected = NULL,
                              XGBoost_min_child_weight_Selected = NULL,
                              XGBoost_subsample_Selected = NULL,
                              XGBoost_colsample_bytree_Selected = NULL,
                              XGBoost_alpha_Selected = NULL,
                              XGBoost_lambda_Selected = NULL,
                              XGBoost_PassInGrid_Selected = NULL,
                              XGBoost_GridTune_Selected = NULL,
                              XGBoost_MaxModelsInGrid_Selected = NULL,
                              XGBoost_MaxRunsWithoutNewWinner_Selected = NULL,
                              XGBoost_MaxRunMinutes_Selected = NULL,
                              XGBoost_BaselineComparison_Selected = NULL,
                              XGBoost_ClassWeights0_Selected = NULL,
                              XGBoost_ClassWeights1_Selected = NULL) {

  shiny::moduleServer(
    id = id,
    module = function(input, output, session) {
      ns <- session$ns
      shiny::showModal(
        shiny::modalDialog(
          title = 'XGBoost Parameters',
          size = "l",
          easyClose = FALSE,
          fade = TRUE,
          shiny::tagList(
            shinydashboard::box(
              title = NULL, solidHeader = TRUE, collapsible = FALSE, status = 'danger', width = AppWidth,

              # Top Box ----
              Quantico::BlankRow(12L),
              shiny::fluidRow(
                shiny::column(
                  width = 12L,
                  align = "right",
                  shinyWidgets::dropdown(
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = "info", width = 12L,
                      shiny::fluidRow(
                        shiny::column(
                          width = 12L,
                          align = "left",
                          shiny::a(name = "xgboost"),
                          shiny::h1(tags$b("XGBoost")),
                          shiny::p("The XGBoost ML algorithm is for running regression, classification,
                           and multiclass models."),
                          tags$a(target="_blank", shiny::icon("newspaper"), href="https://xgboost.ai/", "XGBoost Background Link"),
                        )
                      ),

                      Quantico::BlankRow(12),
                      Quantico::BlankRow(12),
                      shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::h3("XGBoost Usage"))),
                      Quantico::BlankRow(12),
                      shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::markdown(
                        "
                        ### Data:
                        This is where you define your datasets and variables of interest
                        * Train Data: This is your training dataset. This one is required
                        * Validation Data: Optional. If you have a validation dataset supply that here. If not, one will be created for you and 20% of your data will be allocated to Validation Data unless you specify 'TrainOnFull = TRUE' in the Meta Parameters tab.
                        * Test Data: Optional. If you have a validation dataset supply that here. If not, one will be created for you and 10% of your data will be allocated to Test Data unless you specify 'TrainOnFull = TRUE' in the Meta Parameters tab.
                        * Select Target: This is your dependent variable that you are looking to predict / model
                        * Select Features: These are your independent variables used to help predict your target variable
                        * TrainOnFull: Select TRUE to train on the full dataset instead of utilizing training, validation, and test datasets. This is typically done when you've found a final set of parameters and are ready to build a final model for production.
                        * Character Encoding: If you have character features in your feature set they will be converted to numeric encodings. You can choose which type in this dropdown
                        * Weights Column: if you want your rows weighted for modeling purposes you'll need to have a column with the weights within them to supply here. A common reason to use weighting is for when you have group variables and some of the levels have lower counts than others. The ML models will tend to emphasize the higher record count when building so if you find bias is your outcome predictions, weighting can help to resolve that
                        * Transform Variables: This is to transform your target variable. There is no need to transform your features (independent variables) as monotonic transformations on features with tree based methods make no difference in outcome
                        * Transform Methods: Choose at least one method. The algorithms will determine which transformation among selected will best normalize your target variable and move forward with that one
                        "
                      ))),
                      Quantico::BlankRow(12),
                      shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::markdown(
                        "
                        ### Hardware:
                        This is where you define your datasets and variables of interest
                        * GPU or CPU: If you're running a machine with GPU's available you can select to run with GPU. Note that outcome performance can vary by utilizing GPU vs CPU. You will typically need more Trees when utilizing the GPU selection
                        * Number of GPU's: If you've selected GPU and have access to more than one you can utilize them by increasing this input to the number of GPU's of your choice
                        * Create ModelID: This will attach all model artifacts to a name. If you plan on running multiple models for comparison then set a name to each model to distinguish between then and prevent overwriting an already built model
                        * CPU Threads: This will default to total available threads minus 2. CPU is still utilized even when you select GPU. If you have other processes running at the same time as modeling you will want to lower the CPU Threads count to give all processes a chance to keep running and prevent a queue pool from forming (which can slow down all processes)
                        "
                      ))),
                      Quantico::BlankRow(12),
                      shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::markdown(
                        "
                        ### Model:
                        This is where you define the XGBoost parameters
                        * Number of Trees: Select the number of trees for training the model
                        * Max Tree Depth: Determines the max number of splits each tree can make
                        * L1 Regularization: L1 Regularization for tree based methods. Higher the value the less likely for the model to overfit, at the expense of potential accuracy
                        * L2 Leaf Regularization: L2 Regularization for tree based methods. Higher the value the less likely for the model to overfit, at the expense of potential accuracy
                        * Row Sample Rate: % of rows to utilize in training per tree
                        * Column Sample Rate: % of columns to utilize in training per tree
                        * Learning Rate: Default is 0.10. Used for reducing the gradient step
                        * Min Child Weight: Minimum number of records in leaves for continued splitting
                        "
                      ))),
                      Quantico::BlankRow(12),
                      shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::markdown(
                        "
                        ### Grid Tuning:
                        This is where you define parameters for a hyperparameter search
                        * Grid Tune: Set to TRUE to run grid tuning
                        * Baseline Comparison of Models: 'default' will compare all models to the catboost default settings (with the user supplied number of trees). 'best' will compare all models to the current best performer among all models built in the grid tuning process
                        * Max Run Time (minutes): Set an upper boundary for run time of grid tuning
                        * Runs without a new Winner: Set a value to terminate grid tuning due to lack of new winning models
                        * Max Models: Cap the number of models to test in grid tuning mode
                        "
                      ))),

                      Quantico::BlankRow(12),
                      shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::markdown(
                        "
                        ### Evaluation:
                        This is where you define parameters for a hyperparameter search
                        * Loss Function: The metric to use in training. The specified value also determines the machine learning problem to solve. Some metrics support optional parameters (see the Objectives and metrics section for details on each metric)
                        * Evaluation Metric: The metric used for overfitting detection (if enabled) and best model selection (if enabled). Some metrics support optional parameters (see the Objectives and metrics section for details on each metric)
                        * Trees between Evaluations: Number of trees to build between evaluations for overfitting detection
                        * Class Weight for 0 Class: For Binary Classification models, you can up- or down-weight each class. The default under the hood is 1 for both
                        * Class Weight for 1 Class: For Binary Classification models, you can up- or down-weight each class. The default under the hood is 1 for both
                        * Grid Tuning Evaluation Metric:
                        "
                      ))),

                      Quantico::BlankRow(12L),
                      shiny::fluidRow(shiny::column(width = 12L, align = "left", tags$a(target="_blank", shiny::icon("newspaper"), href="https://catboost.ai/en/docs/concepts/loss-functions", "Loss Functions and Eval Metrics Details")))
                    ),
                    size = "lg",
                    icon = shiny::icon("question"),
                    label = NULL,
                    tooltip = FALSE,
                    right = TRUE,
                    up = FALSE,
                    width = NULL,
                    animate = shinyWidgets::animateOptions(
                      enter = "zoomIn",
                      exit = "fadeOutRightBig"
                    ),
                    inputId = NULL,
                    block = FALSE,
                    no_outline = TRUE
                  )
                )
              ),

              Quantico:::BlankRow(12L),
              shiny::fluidRow(

                # Target Type
                shiny::column(
                  width = 3L,
                  align = 'center',
                  Quantico:::SelectizeInput(InputID = 'XGBoost_TargetType', Label = 'Select Supervised Learning Type', Choices = XGBoost_TargetType_Choices, SelectedDefault = XGBoost_TargetType_Selected, Multiple = TRUE, MaxVars = 1)),
                shiny::column(
                  width = 3L,
                  align = 'center',
                  Quantico:::TextInput(InputID='XGBoost_ModelID', Label='Create Model ID', Value = XGBoost_ModelID_Selected, Placeholder = NULL)),
                shiny::column(
                  width = 3L,
                  align = 'center',
                  Quantico:::NumericInput(InputID='XGBoost_Runs', Label = 'Cross Validation Runs', Value = XGBoost_Runs_Selected, Min = 1, Max = 100, Step = 1)),

                # Build Models Button
                shiny::column(
                  width = 3L,
                  shinyjs::useShinyjs(),
                  align = 'center',
                  tags$h3(tags$b('~ Build')),
                  shiny::actionButton(
                    inputId = paste0('BuildModels_XGBoost'),
                    label = paste0('Run'),
                    icon = shiny::icon('chevron-right', lib='font-awesome')
                  )
                )
              ),

              Quantico:::BlankRow(12L)
            ),

            Quantico:::BlankRow(12L),
            Quantico:::BlankRow(12L),

            # Tabs
            shiny::tabsetPanel(
              id = 'XGBoost_TabPanel',
              selected = 'Data',

              # Data Parameters ----
              shiny::tabPanel(
                title = "Data",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shinydashboard::box(
                    title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                    Quantico:::BlankRow(12L),
                    shiny::fluidRow(
                      shiny::column(
                        6L,
                        align = 'center',
                        shinydashboard::box(
                          title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='XGBoost_data', Label='Select Training Data', Choices = XGBoost_data_Choices, SelectedDefault = XGBoost_data_Selected, Multiple = TRUE, MaxVars = 1))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='XGBoost_ValidationData', Label='Select Validation Data', Choices = XGBoost_ValidationData_Choices, SelectedDefault = XGBoost_ValidationData_Selected, Multiple = TRUE, MaxVars = 1))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='XGBoost_TestData', Label='Select Test Data', Choices = XGBoost_TestData_Choices, SelectedDefault = XGBoost_TestData_Selected, Multiple = TRUE, MaxVars = 1))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::PickerInput(InputID='XGBoost_TargetColumnName', Label='Select Target', Choices = XGBoost_TargetColumnName_Choices, SelectedDefault = XGBoost_TargetColumnName_Selected, Multiple = TRUE, MaxVars = 1L))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::PickerInput(InputID='XGBoost_FeatureColNames', Label='Select Features', Choices = XGBoost_FeatureColNames_Choices, SelectedDefault = XGBoost_FeatureColNames_Selected, Multiple = TRUE))),
                          Quantico:::BlankRow(12L)
                        )),

                      shiny::column(
                        6L,
                        align = 'center',
                        shinydashboard::box(
                          title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='XGBoost_TrainOnFull', Label='Train on Full Data', Choices = XGBoost_TrainOnFull_Choices, SelectedDefault = XGBoost_TrainOnFull_Selected, Multiple = TRUE, MaxVars = 1))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='XGBoost_EncodeMethod', Label='Character Encoding', Choices = XGBoost_EncodeMethod_Choices, SelectedDefault = XGBoost_EncodeMethod_Selected, Multiple = TRUE, MaxVars = 1))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::PickerInput(InputID='XGBoost_WeightsColumnName', Label='Weights Column', Choices = XGBoost_WeightsColumnName_Choices, SelectedDefault = XGBoost_WeightsColumnName_Selected, Multiple = TRUE, MaxVars = 1L))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::PickerInput(InputID='XGBoost_TransformNumericColumns', Label='Transform Columns', Choices = XGBoost_TransformNumericColumns_Choices, SelectedDefault = XGBoost_TransformNumericColumns_Selected, Multiple = TRUE))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='XGBoost_Methods', Label='Transform Methods', Choices = XGBoost_Methods_Choices, SelectedDefault = XGBoost_Methods_Selected, Multiple = TRUE, MaxVars = 100))),
                          Quantico:::BlankRow(12L)
                        ))
                    ),

                    Quantico:::BlankRow(12L),
                    Quantico:::BlankRow(12L),
                    Quantico:::BlankRow(12L),
                    Quantico:::BlankRow(12L)))),

              # MetaData Parameters ----
              shiny::tabPanel(
                title = "Hardware",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shinydashboard::box(
                    title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                    Quantico:::BlankRow(12L),

                    shiny::fluidRow(
                      shiny::column(
                        6L,
                        align = 'center',
                        shinydashboard::box(
                          title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='XGBoost_TreeMethod', Label='GPU or CPU', Choices = XGBoost_TreeMethod_Choices, SelectedDefault = XGBoost_TreeMethod_Selected, Multiple = TRUE, MaxVars = 1))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::NumericInput(InputID='XGBoost_NumGPUs', Label='Number of GPUs', Value = XGBoost_NumGPUs_Selected, Min = 1, Max = 10, Step = 1))),
                          Quantico:::BlankRow(12L)
                        )),

                      shiny::column(
                        6L,
                        align = 'center',
                        shinydashboard::box(
                          title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::NumericInput(InputID='XGBoost_NThreads', Label='CPU Threads', Value = XGBoost_NThreads_Selected, Min = 1, Max = max(1L, parallel::detectCores() - 2L), Step = 1))),
                          Quantico:::BlankRow(12L)
                        ))
                    ),

                    Quantico:::BlankRow(12L),
                    Quantico:::BlankRow(12L),
                    Quantico:::BlankRow(12L),
                    Quantico:::BlankRow(12L)))),

              # ML Parameters ----
              shiny::tabPanel(
                title = "Model",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shinydashboard::box(
                    title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                    Quantico:::BlankRow(12L),

                    shiny::fluidRow(
                      shiny::column(
                        6L,
                        align = 'center',
                        shinydashboard::box(
                          title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::NumericInput(InputID='XGBoost_Trees', Label='Number of Trees', Value = XGBoost_Trees_Selected, Min = 25, Max = 30000, Step = 25))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::NumericInput(InputID='XGBoost_max_depth', Label='Max Tree Depth', Value = XGBoost_max_depth_Selected, Min = 2, Max = 20, Step = 1))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='XGBoost_alpha', Label='L1 Regularization', Choices = XGBoost_alpha_Choices, SelectedDefault = XGBoost_alpha_Selected, Multiple = TRUE, MaxVars = 1))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='XGBoost_lambda', Label='L2 Regularization', Choices = XGBoost_lambda_Choices, SelectedDefault = XGBoost_lambda_Selected, Multiple = TRUE, MaxVars = 1))),
                          Quantico:::BlankRow(12L)
                        )),

                      shiny::column(
                        6L,
                        align = 'center',
                        shinydashboard::box(
                          title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='XGBoost_subsample', Label='Row Sample Rate', Choices = XGBoost_subsample_Choices, SelectedDefault = XGBoost_subsample_Selected, Multiple = TRUE, MaxVars = 1))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='XGBoost_colsample_bytree', Label='Column Sample Rate', Choices = XGBoost_colsample_bytree_Choices, SelectedDefault = XGBoost_colsample_bytree_Selected, Multiple = TRUE, MaxVars = 1))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='XGBoost_eta', Label='Learning Rate', Choices = XGBoost_eta_Choices, SelectedDefault = XGBoost_eta_Selected, Multiple = TRUE, MaxVars = 1))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='XGBoost_min_child_weight', Label='Min Child Weight', Choices = XGBoost_min_child_weight_Choices, SelectedDefault = XGBoost_min_child_weight_Selected, Multiple = TRUE, MaxVars = 1))),
                          Quantico:::BlankRow(12L)
                        ))
                    ),

                    Quantico:::BlankRow(12L),
                    Quantico:::BlankRow(12L),
                    Quantico:::BlankRow(12L),
                    Quantico:::BlankRow(12L)))),

              # Grid Tuning Parameters ----
              shiny::tabPanel(
                title = "Grid Tune",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shinydashboard::box(
                    title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                    Quantico:::BlankRow(12L),

                    shiny::fluidRow(
                      shiny::column(
                        6L,
                        align = 'center',
                        shinydashboard::box(
                          title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='XGBoost_GridTune', Label='Grid Tune', Choices = XGBoost_GridTune_Choices, SelectedDefault = XGBoost_GridTune_Selected, Multiple = TRUE, MaxVars = 1))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='XGBoost_BaselineComparison', Label='Evaluation Metric', Choices = XGBoost_BaselineComparison_Choices, SelectedDefault = XGBoost_BaselineComparison_Selected, Multiple = TRUE, MaxVars = 1))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='XGBoost_PassInGrid', Label='Previous Grid Data', Choices = XGBoost_PassInGrid_Choices, SelectedDefault = XGBoost_PassInGrid_Selected, Multiple = TRUE, MaxVars = 1))),
                          Quantico:::BlankRow(12L)
                        )),

                      shiny::column(
                        6L,
                        align = 'center',
                        shinydashboard::box(
                          title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::NumericInput(InputID='XGBoost_MaxRunMinutes', Label='Max Run Time (mins)', Value = XGBoost_MaxRunMinutes_Selected, Min = 5, Max = 1440, Step = 1))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::NumericInput(InputID='XGBoost_MaxRunsWithoutNewWinner', Label='Runs Without Winner', Value = XGBoost_MaxRunsWithoutNewWinner_Selected, Min = 2, Max = 200, Step = 1))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::NumericInput(InputID='XGBoost_MaxModelsInGrid', Label='Max Models', Value = XGBoost_MaxModelsInGrid_Selected, Min = 2, Max = 1000, Step = 1))),
                          Quantico:::BlankRow(12L)
                        ))
                    ),

                    Quantico:::BlankRow(12L),
                    Quantico:::BlankRow(12L),
                    Quantico:::BlankRow(12L),
                    Quantico:::BlankRow(12L)))),

              # Eval Parameters ----
              shiny::tabPanel(
                title = "Evaluation",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shinydashboard::box(
                    title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                    Quantico:::BlankRow(12L),

                    shiny::fluidRow(
                      shiny::column(
                        6L,
                        align = 'center',
                        shinydashboard::box(
                          title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='XGBoost_LossFunction', Label='Loss Function', Choices = NULL, Multiple = TRUE, MaxVars = 1))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='XGBoost_EvalMetric', Label='Evaluation Metric', Choices = NULL, Multiple = TRUE, MaxVars = 1))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='XGBoost_grid_eval_metric', Label='Grid Tuning Evaluation Metric', Choices = NULL, Multiple = TRUE, MaxVars = 1))),
                          Quantico:::BlankRow(12L)
                        )),

                      shiny::column(
                        6L,
                        align = 'center',
                        shinydashboard::box(
                          title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::NumericInput(InputID='XGBoost_ClassWeights0', Label='Class Weight for 0', Value = XGBoost_ClassWeights0_Selected, Min = 0.01, Max = 1000, Step = 0.01))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::NumericInput(InputID='XGBoost_ClassWeights1', Label='Class Weight for 1', Value = XGBoost_ClassWeights1_Selected, Min = 0.01, Max = 1000, Step = 0.01))),
                          Quantico:::BlankRow(12L)
                        ))
                    ),

                    Quantico:::BlankRow(12L),
                    Quantico:::BlankRow(12L),
                    Quantico:::BlankRow(12L),
                    Quantico:::BlankRow(12L)))))), # end TagList

          footer = shiny::tagList(
            shiny::modalButton(label = "Cancel"),
            shiny::actionButton("XGBoost_OK", "OK", width = '50px'))))
    })
}

#' @title LightGBM_Modal_Fun
#'
#' @description LightGBM Parameters Modal with OK button to close
#'
#' @author Adrian Antico
#' @family ML
#'
#' @param id = 'LightGBM_ID'
#' @param AppWidth = 12L
#'
#' @export
LightGBM_Modal_Fun <- function(id,
                               AppWidth=12L,

                               # Reactives
                               LightGBM_TargetColumnName_Selected = NULL,
                               LightGBM_FeatureColNames_Selected = NULL,
                               LightGBM_WeightsColumnName_Selected = NULL,
                               LightGBM_TransformNumericColumns_Selected = NULL,
                               LightGBM_grid_eval_metric_Selected = NULL,
                               LightGBM_metric_Selected = NULL,

                               # Statics
                               LightGBM_Runs_Choices = NULL,
                               LightGBM_TargetType_Choices = NULL,
                               LightGBM_data_Choices = NULL,
                               LightGBM_ValidationData_Choices = NULL,
                               LightGBM_TestData_Choices = NULL,
                               LightGBM_EncodeMethod_Choices = NULL,
                               LightGBM_Methods_Choices = NULL,
                               LightGBM_NThreads_Choices = NULL,
                               LightGBM_device_type_Choices = NULL,
                               LightGBM_NumGPUs_Choices = NULL,
                               LightGBM_TrainOnFull_Choices = NULL,
                               LightGBM_ModelID_Choices = NULL,
                               LightGBM_Trees_Choices = NULL,
                               LightGBM_max_depth_Choices = NULL,
                               LightGBM_eta_Choices = NULL,
                               LightGBM_min_data_in_leaf_Choices = NULL,
                               LightGBM_num_leaves_Choices = NULL,
                               LightGBM_bagging_fraction_Choices = NULL,
                               LightGBM_feature_fraction_Choices = NULL,
                               LightGBM_feature_fraction_bynode_Choices = NULL,
                               LightGBM_lambda_l1_Choices = NULL,
                               LightGBM_lambda_l2_Choices = NULL,
                               LightGBM_PassInGrid_Choices = NULL,
                               LightGBM_GridTune_Choices = NULL,
                               LightGBM_MaxModelsInGrid_Choices = NULL,
                               LightGBM_MaxRunsWithoutNewWinner_Choices = NULL,
                               LightGBM_MaxRunMinutes_Choices = NULL,
                               LightGBM_BaselineComparison_Choices = NULL,

                               # Updaters
                               LightGBM_ModelID_Selected = NULL,
                               LightGBM_Runs_Selected = NULL,
                               LightGBM_TargetType_Selected = NULL,
                               LightGBM_data_Selected = NULL,
                               LightGBM_ValidationData_Selected = NULL,
                               LightGBM_TestData_Selected = NULL,
                               LightGBM_EncodeMethod_Selected = NULL,
                               LightGBM_Methods_Selected = NULL,
                               LightGBM_NThreads_Selected = NULL,
                               LightGBM_device_type_Selected = NULL,
                               LightGBM_NumGPUs_Selected = NULL,
                               LightGBM_TrainOnFull_Selected = NULL,
                               LightGBM_Trees_Selected = NULL,
                               LightGBM_max_depth_Selected = NULL,
                               LightGBM_eta_Selected = NULL,
                               LightGBM_min_data_in_leaf_Selected = NULL,
                               LightGBM_num_leaves_Selected = NULL,
                               LightGBM_bagging_fraction_Selected = NULL,
                               LightGBM_feature_fraction_Selected = NULL,
                               LightGBM_feature_fraction_bynode_Selected = NULL,
                               LightGBM_lambda_l1_Selected = NULL,
                               LightGBM_lambda_l2_Selected = NULL,
                               LightGBM_PassInGrid_Selected = NULL,
                               LightGBM_GridTune_Selected = NULL,
                               LightGBM_MaxModelsInGrid_Selected = NULL,
                               LightGBM_MaxRunsWithoutNewWinner_Selected = NULL,
                               LightGBM_MaxRunMinutes_Selected = NULL,
                               LightGBM_BaselineComparison_Selected = NULL,
                               LightGBM_ClassWeights0_Selected = NULL,
                               LightGBM_ClassWeights1_Selected = NULL) {

  shiny::moduleServer(
    id = id,
    module = function(input, output, session) {
      ns <- session$ns
      shiny::showModal(
        shiny::modalDialog(
          title = 'LightGBM Parameters',
          size = "l",
          easyClose = FALSE,
          fade = TRUE,
          shiny::tagList(
            shinydashboard::box(
              title = NULL, solidHeader = TRUE, collapsible = FALSE, status = 'danger', width = AppWidth,

              # Top Box ----
              Quantico::BlankRow(12L),
              shiny::fluidRow(
                shiny::column(
                  width = 12L,
                  align = "right",
                  shinyWidgets::dropdown(
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = "info", width = 12L,
                      shiny::fluidRow(
                        shiny::column(
                          width = 12L,
                          align = "left",
                          shiny::a(name = "lightgbm"),
                          shiny::h1(tags$b("LightGBM")),
                          shiny::p("The LightGBM ML algorithm is for running regression, classification,
                           and multiclass models."),
                          tags$a(target="_blank", shiny::icon("newspaper"), href="https://lightgbm.readthedocs.io/en/latest/", "LightGBM Background Link"),
                        )
                      ),

                      Quantico::BlankRow(12),
                      Quantico::BlankRow(12),
                      shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::h3("LightGBM Usage"))),
                      Quantico::BlankRow(12),
                      shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::markdown(
                        "
                        ### Data:
                        This is where you define your datasets and variables of interest
                        * Train Data: This is your training dataset. This one is required
                        * Validation Data: Optional. If you have a validation dataset supply that here. If not, one will be created for you and 20% of your data will be allocated to Validation Data unless you specify 'TrainOnFull = TRUE' in the Meta Parameters tab.
                        * Test Data: Optional. If you have a validation dataset supply that here. If not, one will be created for you and 10% of your data will be allocated to Test Data unless you specify 'TrainOnFull = TRUE' in the Meta Parameters tab.
                        * Select Target: This is your dependent variable that you are looking to predict / model
                        * Select Features: These are your independent variables used to help predict your target variable
                        * TrainOnFull: Select TRUE to train on the full dataset instead of utilizing training, validation, and test datasets. This is typically done when you've found a final set of parameters and are ready to build a final model for production.
                        * Character Encoding: If you have character features in your feature set they will be converted to numeric encodings. You can choose which type in this dropdown
                        * Weights Column: if you want your rows weighted for modeling purposes you'll need to have a column with the weights within them to supply here. A common reason to use weighting is for when you have group variables and some of the levels have lower counts than others. The ML models will tend to emphasize the higher record count when building so if you find bias is your outcome predictions, weighting can help to resolve that
                        * Transform Variables: This is to transform your target variable. There is no need to transform your features (independent variables) as monotonic transformations on features with tree based methods make no difference in outcome
                        * Transform Methods: Choose at least one method. The algorithms will determine which transformation among selected will best normalize your target variable and move forward with that one
                        "
                      ))),
                      Quantico::BlankRow(12),
                      shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::markdown(
                        "
                        ### Hardware:
                        This is where you define your datasets and variables of interest
                        * GPU or CPU: If you're running a machine with GPU's available you can select to run with GPU. Note that outcome performance can vary by utilizing GPU vs CPU. You will typically need more Trees when utilizing the GPU selection
                        * Number of GPU's: If you've selected GPU and have access to more than one you can utilize them by increasing this input to the number of GPU's of your choice
                        * Create ModelID: This will attach all model artifacts to a name. If you plan on running multiple models for comparison then set a name to each model to distinguish between then and prevent overwriting an already built model
                        * CPU Threads: This will default to total available threads minus 2. CPU is still utilized even when you select GPU. If you have other processes running at the same time as modeling you will want to lower the CPU Threads count to give all processes a chance to keep running and prevent a queue pool from forming (which can slow down all processes)
                        "
                      ))),
                      Quantico::BlankRow(12),
                      shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::markdown(
                        "
                        ### Model:
                        This is where you define the LightGBM parameters
                        * Number of Trees: Select the number of trees for training the model
                        * Max Tree Depth: Determines the max number of splits each tree can make
                        * Row Sample Rate: % of rows to utilize in training per tree
                        * L1 Regularization: L1 Regularization for tree based methods. Higher the value the less likely for the model to overfit, at the expense of potential accuracy
                        * L2 Leaf Regularization: L2 Regularization for tree based methods. Higher the value the less likely for the model to overfit, at the expense of potential accuracy
                        * Min Child Weight: Minimum number of records in leaves for continued splitting
                        * Learning Rate: Default is 0.10. Used for reducing the gradient step
                        * Column Sample Rate by Tree: % of columns to utilize in training per tree
                        * Column Sample Rate by Node: % of columns to utilize in training per split
                        * Number of Leaves: You can set the maximum number of leaves for a given tree
                        "
                      ))),
                      Quantico::BlankRow(12),
                      shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::markdown(
                        "
                        ### Grid Tuning:
                        This is where you define parameters for a hyperparameter search
                        * Grid Tune: Set to TRUE to run grid tuning
                        * Baseline Comparison of Models: 'default' will compare all models to the catboost default settings (with the user supplied number of trees). 'best' will compare all models to the current best performer among all models built in the grid tuning process
                        * Max Run Time (minutes): Set an upper boundary for run time of grid tuning
                        * Runs without a new Winner: Set a value to terminate grid tuning due to lack of new winning models
                        * Max Models: Cap the number of models to test in grid tuning mode
                        "
                      ))),

                      Quantico::BlankRow(12),
                      shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::markdown(
                        "
                        ### Evaluation:
                        This is where you define parameters for a hyperparameter search
                        * Loss Function: The metric to use in training. The specified value also determines the machine learning problem to solve. Some metrics support optional parameters (see the Objectives and metrics section for details on each metric)
                        * Evaluation Metric: The metric used for overfitting detection (if enabled) and best model selection (if enabled). Some metrics support optional parameters (see the Objectives and metrics section for details on each metric)
                        * Trees between Evaluations: Number of trees to build between evaluations for overfitting detection
                        * Class Weight for 0 Class: For Binary Classification models, you can up- or down-weight each class. The default under the hood is 1 for both
                        * Class Weight for 1 Class: For Binary Classification models, you can up- or down-weight each class. The default under the hood is 1 for both
                        * Grid Tuning Evaluation Metric:
                        "
                      ))),

                      Quantico::BlankRow(12L),
                      shiny::fluidRow(shiny::column(width = 12L, align = "left", tags$a(target="_blank", shiny::icon("newspaper"), href="https://catboost.ai/en/docs/concepts/loss-functions", "Loss Functions and Eval Metrics Details")))
                    ),
                    size = "lg",
                    icon = shiny::icon("question"),
                    label = NULL,
                    tooltip = FALSE,
                    right = TRUE,
                    up = FALSE,
                    width = NULL,
                    animate = shinyWidgets::animateOptions(
                      enter = "zoomIn",
                      exit = "fadeOutRightBig"
                    ),
                    inputId = NULL,
                    block = FALSE,
                    no_outline = TRUE
                  )
                )
              ),

              Quantico:::BlankRow(12L),
              shiny::fluidRow(

                # Target Type
                shiny::column(
                  width = 3L,
                  align = 'center',
                  Quantico:::SelectizeInput(InputID = 'LightGBM_TargetType', Label = 'Select Supervised Learning Type', Choices = LightGBM_TargetType_Choices, SelectedDefault = LightGBM_TargetType_Selected, Multiple = TRUE, MaxVars = 1)),
                shiny::column(
                  width = 3L,
                  align = 'center',
                  Quantico:::TextInput(InputID='LightGBM_ModelID', Label='Create Model ID', Value = LightGBM_ModelID_Selected)),
                shiny::column(
                  width = 3L,
                  align = 'center',
                  Quantico:::NumericInput(InputID='LightGBM_Runs', Label = 'Cross Validation Runs', Value = LightGBM_Runs_Selected, Min = 1, Max = 100, Step = 1)),

                # Build Models Button
                shiny::column(
                  width = 3L,
                  shinyjs::useShinyjs(),
                  align = 'center',
                  tags$h3(tags$b('~ Build')),
                  shiny::actionButton(
                    inputId = paste0('BuildModels_LightGBM'),
                    label = paste0('Run'),
                    icon = shiny::icon('chevron-right', lib='font-awesome')
                  )
                )
              ),

              Quantico:::BlankRow(12L)
            ),

            Quantico:::BlankRow(12L),
            Quantico:::BlankRow(12L),

            # Tabs
            shiny::tabsetPanel(
              id = 'LightGBM_TabPanel',
              selected = 'Data',

              # Data args ----
              shiny::tabPanel(
                title = "Data",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shinydashboard::box(
                    title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                    Quantico:::BlankRow(12L),
                    shiny::fluidRow(
                      shiny::column(
                        6L,
                        align = 'center',
                        shinydashboard::box(
                          title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='LightGBM_data', Label='Select Training Data', Choices = LightGBM_data_Choices, SelectedDefault = LightGBM_data_Selected, Multiple = TRUE, MaxVars = 1))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='LightGBM_ValidationData', Label='Select Validation Data', Choices = LightGBM_ValidationData_Choices, SelectedDefault = LightGBM_ValidationData_Selected, Multiple = TRUE, MaxVars = 1))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='LightGBM_TestData', Label='Select Test Data', Choices = LightGBM_TestData_Choices, SelectedDefault = LightGBM_TestData_Selected, Multiple = TRUE, MaxVars = 1))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::PickerInput(InputID='LightGBM_TargetColumnName', Label='Select Target', Choices = NULL, SelectedDefault = LightGBM_TargetColumnName_Selected, Multiple = TRUE, MaxVars = 1L))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::PickerInput(InputID='LightGBM_FeatureColNames', Label='Select Features', Choices = NULL, SelectedDefault = LightGBM_FeatureColNames_Selected, Multiple = TRUE))),
                          Quantico:::BlankRow(12L)
                        )),

                      shiny::column(
                        6L,
                        align = 'center',
                        shinydashboard::box(
                          title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='LightGBM_TrainOnFull', Label='Train on Full Data', Choices = LightGBM_TrainOnFull_Choices, SelectedDefault = LightGBM_TrainOnFull_Selected, Multiple = TRUE, MaxVars = 1))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='LightGBM_EncodeMethod', Label='Character Encoding', Choices = LightGBM_EncodeMethod_Choices, SelectedDefault = LightGBM_EncodeMethod_Selected, Multiple = TRUE, MaxVars = 1))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::PickerInput(InputID='LightGBM_WeightsColumnName', Label='Weights Column', Choices = NULL, SelectedDefault = LightGBM_WeightsColumnName_Selected, Multiple = TRUE, MaxVars = 1L))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::PickerInput(InputID='LightGBM_TransformNumericColumns', Label='Transform Columns', Choices = NULL, SelectedDefault = LightGBM_TransformNumericColumns_Selected, Multiple = TRUE))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='LightGBM_Methods', Label='Transform Methods', Choices = LightGBM_Methods_Choices, SelectedDefault = LightGBM_Methods_Selected, Multiple = TRUE, MaxVars = 100))),
                          Quantico:::BlankRow(12L)
                        ))
                    ),

                    Quantico:::BlankRow(12L),
                    Quantico:::BlankRow(12L),
                    Quantico:::BlankRow(12L),
                    Quantico:::BlankRow(12L)))),

              # MetaData Parameters ----
              shiny::tabPanel(
                title = "Hardware",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shinydashboard::box(
                    title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                    Quantico:::BlankRow(12L),

                    shiny::fluidRow(
                      shiny::column(
                        6L,
                        align = 'center',
                        shinydashboard::box(
                          title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='LightGBM_device_type', Label='Task Type', Choices = LightGBM_device_type_Choices, SelectedDefault = LightGBM_device_type_Selected, Multiple = TRUE, MaxVars = 1))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::NumericInput(InputID='LightGBM_NumGPUs', Label='Number of GPUs', Value = LightGBM_NumGPUs_Selected, Min = 1, Max = 10, Step = 1))),
                          Quantico:::BlankRow(12L)
                        )),

                      shiny::column(
                        6L,
                        align = 'center',
                        shinydashboard::box(
                          title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::NumericInput(InputID='LightGBM_NThreads', Label='CPU Threads', Value = LightGBM_NThreads_Selected, Min = 1, Max = max(1L, parallel::detectCores() - 2L), Step = 1))),
                          Quantico:::BlankRow(12L)
                        )
                      )
                    ),

                    Quantico:::BlankRow(12L),
                    Quantico:::BlankRow(12L),
                    Quantico:::BlankRow(12L),
                    Quantico:::BlankRow(12L)))),

              # ML Parameters
              shiny::tabPanel(
                title = "Model",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shinydashboard::box(
                    title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                    Quantico:::BlankRow(12L),

                    shiny::fluidRow(
                      shiny::column(
                        6L,
                        align = 'center',
                        shinydashboard::box(
                          title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::NumericInput(InputID='LightGBM_Trees', Label='Number of Trees', Value = LightGBM_Trees_Selected, Min = 25, Max = 30000, Step = 25))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::NumericInput(InputID='LightGBM_max_depth', Label='Max Tree Depth', Value = LightGBM_max_depth_Selected, Min = 2, Max = 20, Step = 1))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='LightGBM_bagging_fraction', Label='Row Sample Rate', Choices = LightGBM_bagging_fraction_Choices, SelectedDefault = LightGBM_bagging_fraction_Selected, Multiple = TRUE, MaxVars = 1))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='LightGBM_lambda_l2', Label='Lambda L2', Choices = LightGBM_lambda_l2_Choices, SelectedDefault = LightGBM_lambda_l2_Selected, Multiple = TRUE, MaxVars = 1))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='LightGBM_lambda_l1', Label='Lambda L1', Choices = LightGBM_lambda_l1_Choices, SelectedDefault = LightGBM_lambda_l1_Selected, Multiple = TRUE, MaxVars = 1))),
                          Quantico:::BlankRow(12L)
                        )),

                      shiny::column(
                        6L,
                        align = 'center',
                        shinydashboard::box(
                          title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='LightGBM_min_data_in_leaf', Label='Min Child Weight', Choices = LightGBM_min_data_in_leaf_Choices, SelectedDefault = LightGBM_min_data_in_leaf_Selected, Multiple = TRUE, MaxVars = 1))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='LightGBM_eta', Label='Learning Rate', Choices = LightGBM_eta_Choices, SelectedDefault = LightGBM_eta_Selected, Multiple = TRUE, MaxVars = 1))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='LightGBM_feature_fraction', Label='ColSample Rate by Tree', Choices = LightGBM_feature_fraction_Choices, SelectedDefault = LightGBM_feature_fraction_Selected, Multiple = TRUE, MaxVars = 1))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='LightGBM_feature_fraction_bynode', Label='ColSample Rate by Node', Choices = LightGBM_feature_fraction_bynode_Choices, SelectedDefault = LightGBM_feature_fraction_bynode_Selected, Multiple = TRUE, MaxVars = 1))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='LightGBM_num_leaves', Label='Number of Leaves', Choices = LightGBM_num_leaves_Choices, SelectedDefault = LightGBM_num_leaves_Selected, Multiple = TRUE, MaxVars = 1))),
                          Quantico:::BlankRow(12L)
                        ))
                    ),

                    Quantico:::BlankRow(12L),
                    Quantico:::BlankRow(12L),
                    Quantico:::BlankRow(12L),
                    Quantico:::BlankRow(12L)))),

              # Grid Tuning Parameters
              shiny::tabPanel(
                title = "Grid Tune",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shinydashboard::box(
                    title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                    Quantico:::BlankRow(12L),

                    shiny::fluidRow(
                      shiny::column(
                        6L,
                        align = 'center',
                        shinydashboard::box(
                          title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='LightGBM_GridTune', Label='Grid Tune', Choices = LightGBM_GridTune_Choices, SelectedDefault = LightGBM_GridTune_Selected, Multiple = TRUE, MaxVars = 1))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='LightGBM_grid_eval_metric', Label='Evaluation Metric', Choices = NULL, SelectedDefault = LightGBM_grid_eval_metric_Selected, Multiple = TRUE, MaxVars = 1))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='LightGBM_PassInGrid', Label='Previous Grid Data', Choices = LightGBM_PassInGrid_Choices, SelectedDefault = LightGBM_PassInGrid_Selected, Multiple = TRUE, MaxVars = 100))),
                          Quantico:::BlankRow(12L)
                        )),

                      shiny::column(
                        6L,
                        align = 'center',
                        shinydashboard::box(
                          title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::NumericInput(InputID='LightGBM_MaxRunMinutes', Label='Max Run Time (mins)', Value = LightGBM_MaxRunMinutes_Selected, Min = 5, Max = 1440, Step = 1))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::NumericInput(InputID='LightGBM_MaxRunsWithoutNewWinner', Label='Runs Without Winner', Value = LightGBM_MaxRunsWithoutNewWinner_Selected, Min = 2, Max = 200, Step = 1))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::NumericInput(InputID='LightGBM_MaxModelsInGrid', Label='Max Models', Value = LightGBM_MaxModelsInGrid_Selected, Min = 2, Max = 1000, Step = 1))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='LightGBM_BaselineComparison', Label='Baseline Comparison', Choices = LightGBM_BaselineComparison_Choices, SelectedDefault = LightGBM_BaselineComparison_Selected, Multiple = TRUE, MaxVars = 1))),
                          Quantico:::BlankRow(12L)

                        )
                      )
                    ),

                    Quantico:::BlankRow(12L),
                    Quantico:::BlankRow(12L),
                    Quantico:::BlankRow(12L),
                    Quantico:::BlankRow(12L)))),

              # Eval Parameters
              shiny::tabPanel(
                title = "Evaluation",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shinydashboard::box(
                    title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                    Quantico:::BlankRow(12L),

                    shiny::fluidRow(
                      shiny::column(
                        6L,
                        align = 'center',
                        shinydashboard::box(
                          title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='LightGBM_metric', Label='Loss Function', Choices = NULL, SelectedDefault = LightGBM_metric_Selected, Multiple = TRUE, MaxVars = 1))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', shiny::uiOutput('LightGBM_EvalMetric'))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', shiny::uiOutput('LightGBM_MetricPeriods'))),
                          Quantico:::BlankRow(12L)
                        )),

                      shiny::column(
                        6L,
                        align = 'center',
                        shinydashboard::box(
                          title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::NumericInput(InputID='LightGBM_ClassWeights0', Label='Class Weight for 0', Value = LightGBM_ClassWeights0_Selected, Min = 0.01, Max = 1000, Step = 0.01))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::NumericInput(InputID='LightGBM_ClassWeights1', Label='Class Weight for 1', Value = LightGBM_ClassWeights1_Selected, Min = 0.01, Max = 1000, Step = 0.01))),
                          Quantico:::BlankRow(12L)
                        )
                      )
                    ),

                    Quantico:::BlankRow(12L),
                    Quantico:::BlankRow(12L),
                    Quantico:::BlankRow(12L),
                    Quantico:::BlankRow(12L)))))), # end TagList

          footer = shiny::tagList(
            shiny::modalButton(label = "Cancel"),
            shiny::actionButton("LightGBM_OK", "OK", width = '50px'))))
    })
}

#' @title H2O_DRF_Modal_Fun
#'
#' @description H2O DRF Parameters Modal with OK button to close
#'
#' @author Adrian Antico
#' @family ML
#'
#' @param id = 'H2O_DRF_ID'
#' @param AppWidth = 12L
#'
#' @export
H2O_DRF_Modal_Fun <- function(id,
                              AppWidth=12L,

                              # Reactives
                              H2O_DRF_eval_metric_Selected = NULL,
                              H2O_DRF_TargetColumnName_Selected = NULL,
                              H2O_DRF_FeatureColNames_Selected = NULL,
                              H2O_DRF_TransformNumericColumns_Selected = NULL,
                              H2O_DRF_WeightsColumn_Selected = NULL,

                              # Statics
                              H2O_DRF_Runs_Choices = NULL,
                              H2O_DRF_TargetType_Choices = NULL,
                              H2O_DRF_data_Choices = NULL,
                              H2O_DRF_ValidationData_Choices = NULL,
                              H2O_DRF_TestData_Choices = NULL,
                              H2O_DRF_EncodeMethod_Choices = NULL,
                              H2O_DRF_Methods_Choices = NULL,
                              H2O_DRF_NThreads_Choices = NULL,
                              H2O_DRF_MaxMem_Choices = NULL,
                              H2O_DRF_TrainOnFull_Choices = NULL,
                              H2O_DRF_Trees_Choices = NULL,
                              H2O_DRF_MaxDepth_Choices = NULL,
                              H2O_DRF_SampleRate_Choices = NULL,
                              H2O_DRF_MTries_Choices = NULL,
                              H2O_DRF_ColSampleRatePerTree_Choices = NULL,
                              H2O_DRF_MinRows_Choices = NULL,
                              H2O_DRF_NBinsCats_Choices = NULL,
                              H2O_DRF_NBinsTopLevel_Choices = NULL,
                              H2O_DRF_HistogramType_Choices = NULL,
                              H2O_DRF_CategoricalEncoding_Choices = NULL,
                              H2O_DRF_StoppingRounds_Choices = NULL,
                              H2O_DRF_GridTune_Choices = NULL,
                              H2O_DRF_MaxModelsInGrid_Choices = NULL,

                              # Updaters
                              H2O_DRF_ModelID_Selected = NULL,
                              H2O_DRF_Runs_Selected = NULL,
                              H2O_DRF_TargetType_Selected = NULL,
                              H2O_DRF_data_Selected = NULL,
                              H2O_DRF_ValidationData_Selected = NULL,
                              H2O_DRF_TestData_Selected = NULL,
                              H2O_DRF_EncodeMethod_Selected = NULL,
                              H2O_DRF_Methods_Selected = NULL,
                              H2O_DRF_NThreads_Selected = NULL,
                              H2O_DRF_MaxMem_Selected = NULL,
                              H2O_DRF_TrainOnFull_Selected = NULL,
                              H2O_DRF_Trees_Selected = NULL,
                              H2O_DRF_MaxDepth_Selected = NULL,
                              H2O_DRF_SampleRate_Selected = NULL,
                              H2O_DRF_MTries_Selected = NULL,
                              H2O_DRF_ColSampleRatePerTree_Selected = NULL,
                              H2O_DRF_MinRows_Selected = NULL,
                              H2O_DRF_NBinsCats_Selected = NULL,
                              H2O_DRF_NBinsTopLevel_Selected = NULL,
                              H2O_DRF_HistogramType_Selected = NULL,
                              H2O_DRF_CategoricalEncoding_Selected = NULL,
                              H2O_DRF_StoppingRounds_Selected = NULL,
                              H2O_DRF_GridTune_Selected = NULL,
                              H2O_DRF_MaxModelsInGrid_Selected = NULL,
                              H2O_DRF_ClassWeights0_Selected = NULL,
                              H2O_DRF_ClassWeights1_Selected = NULL) {

  shiny::moduleServer(
    id = id,
    module = function(input, output, session) {
      ns <- session$ns
      shiny::showModal(
        shiny::modalDialog(
          title = 'H2O-DRF Parameters',
          size = "l",
          easyClose = FALSE,
          fade = TRUE,
          shiny::tagList(
            shinydashboard::box(
              title = NULL, solidHeader = TRUE, collapsible = FALSE, status = 'danger', width = AppWidth,

              # Top Box ----
              Quantico::BlankRow(12L),
              shiny::fluidRow(
                shiny::column(
                  width = 12L,
                  align = "right",
                  shinyWidgets::dropdown(
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = "info", width = 12L,
                      shiny::fluidRow(
                        shiny::column(
                          width = 12L,
                          align = "left",
                          shiny::a(name = "h2odrf"),
                          shiny::h1(tags$b("H2O-DRF")),
                          shiny::p("The H2O-DRF ML algorithm is for running regression, classification,
                           and multiclass models."),
                          tags$a(target="_blank", shiny::icon("newspaper"), href="https://docs.h2o.ai/h2o/latest-stable/h2o-docs/data-science/drf.html", "H2O-DRF Background Link"),
                        )
                      ),

                      Quantico::BlankRow(12),
                      shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::h3("H2O-DRF Usage"))),
                      Quantico::BlankRow(12),
                      shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::markdown(
                        "
                        ### Data:
                        This is where you define your datasets and variables of interest
                        * Train Data: This is your training dataset. This one is required
                        * Validation Data: Optional. If you have a validation dataset supply that here. If not, one will be created for you and 20% of your data will be allocated to Validation Data unless you specify 'TrainOnFull = TRUE' in the Meta Parameters tab.
                        * Test Data: Optional. If you have a validation dataset supply that here. If not, one will be created for you and 10% of your data will be allocated to Test Data unless you specify 'TrainOnFull = TRUE' in the Meta Parameters tab.
                        * Select Target: This is your dependent variable that you are looking to predict / model
                        * Select Features: These are your independent variables used to help predict your target variable
                        * TrainOnFull: Select TRUE to train on the full dataset instead of utilizing training, validation, and test datasets. This is typically done when you've found a final set of parameters and are ready to build a final model for production.
                        * Character Encoding: If you have character features in your feature set they will be converted to numeric encodings. You can choose which type in this dropdown
                        * Weights Column: if you want your rows weighted for modeling purposes you'll need to have a column with the weights within them to supply here. A common reason to use weighting is for when you have group variables and some of the levels have lower counts than others. The ML models will tend to emphasize the higher record count when building so if you find bias is your outcome predictions, weighting can help to resolve that
                        * Transform Variables: This is to transform your target variable. There is no need to transform your features (independent variables) as monotonic transformations on features with tree based methods make no difference in outcome
                        * Transform Methods: Choose at least one method. The algorithms will determine which transformation among selected will best normalize your target variable and move forward with that one
                        "
                      ))),
                      Quantico::BlankRow(12),
                      shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::markdown(
                        "
                        ### Hardware:
                        This is where you define your datasets and variables of interest
                        * CPU Threads: Number of CPU threads to utilize for training
                        * Create ModelID: This will attach all model artifacts to a name. If you plan on running multiple models for comparison then set a name to each model to distinguish between then and prevent overwriting an already built model
                        * Max Memory: This will default to total available threads minus 2. CPU is still utilized even when you select GPU. If you have other processes running at the same time as modeling you will want to lower the CPU Threads count to give all processes a chance to keep running and prevent a queue pool from forming (which can slow down all processes)
                        "
                      ))),
                      Quantico::BlankRow(12),
                      shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::markdown(
                        "
                        ### Model:
                        This is where you define the H2O-DRF parameters
                        * Number of Trees: Select the number of trees for training the model
                        * Max Tree Depth: Determines the max number of splits each tree can make
                        * Row Sample Rate: % of rows to utilize in training per tree
                        * Column Sample Rate: % of columns to utilize in training per split
                        * Column Sample Rate per Tree: % of columns to utilize in training per tree
                        * Min Rows per Leaf: Minimum number of records in leaves for continued splitting
                        * Bins for Categorical Variables: Number of bins for group variable levels. Fewer bins means that more group levels will be combined
                        * Bins Top Level Categorical Variables: Number of bins for group variable levels at the top level of each tree. Fewer bins means that more group levels will be combined
                        * Histogram Type: Methods for creating splits on numeric variables
                        * Categorical Encoding: H2O's encoding methods for categorical variables
                        * Stopping Rounds: Stops training when model performance doesnt improve for the specified number of training rounds, based on a simple moving average
                        "
                      ))),
                      Quantico::BlankRow(12),
                      shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::markdown(
                        "
                        ### Grid Tuning:
                        This is where you define parameters for a hyperparameter search
                        * Grid Tune: Set to TRUE to run grid tuning
                        * Max Models: Cap the number of models to test in grid tuning mode
                        "
                      ))),

                      Quantico::BlankRow(12),
                      shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::markdown(
                        "
                        ### Evaluation:
                        This is where you define parameters for a hyperparameter search
                        * Loss Function: The metric to use in training. The specified value also determines the machine learning problem to solve. Some metrics support optional parameters (see the Objectives and metrics section for details on each metric)
                        * Class Weight for 0 Class: For Binary Classification models, you can up- or down-weight each class. The default under the hood is 1 for both
                        * Class Weight for 1 Class: For Binary Classification models, you can up- or down-weight each class. The default under the hood is 1 for both
                        "
                      ))),

                      Quantico::BlankRow(12L),
                      shiny::fluidRow(shiny::column(width = 12L, align = "left", tags$a(target="_blank", shiny::icon("newspaper"), href="https://docs.h2o.ai/h2o/latest-stable/h2o-docs/data-science/drf.html", "H2O DRF Parameter Docs")))
                    ),
                    size = "lg",
                    icon = shiny::icon("question"),
                    label = NULL,
                    tooltip = FALSE,
                    right = TRUE,
                    up = FALSE,
                    width = NULL,
                    animate = shinyWidgets::animateOptions(
                      enter = "zoomIn",
                      exit = "fadeOutRightBig"
                    ),
                    inputId = NULL,
                    block = FALSE,
                    no_outline = TRUE
                  )
                )
              ),

              Quantico:::BlankRow(12L),
              shiny::fluidRow(

                # Target Type
                shiny::column(
                  width = 3L,
                  align = 'center',
                  Quantico:::SelectizeInput(InputID = 'H2O_DRF_TargetType', Label = 'Select Supervised Learning Type', Choices = H2O_DRF_TargetType_Choices, SelectedDefault = H2O_DRF_TargetType_Selected, Multiple = TRUE, MaxVars = 1)),
                shiny::column(
                  width = 3L,
                  align = 'center',
                  Quantico:::TextInput(InputID='H2O_DRF_ModelID', Label='Create Model ID', Value = H2O_DRF_ModelID_Selected)),
                shiny::column(
                  width = 3L,
                  align = 'center',
                  Quantico:::NumericInput(InputID='H2O_DRF_Runs', Label = 'Cross Validation Runs', Value = H2O_DRF_Runs_Selected, Min = 1, Max = 100, Step = 1)),

                # Build Models Button
                shiny::column(
                  width = 3L,
                  shinyjs::useShinyjs(),
                  align = 'center',
                  tags$h3(tags$b('~ Build')),
                  shiny::actionButton(
                    inputId = paste0('BuildModels_H2O_DRF'),
                    label = paste0('Run'),
                    icon = shiny::icon('chevron-right', lib='font-awesome')
                  )
                )
              ),

              Quantico:::BlankRow(12L)
            ),

            Quantico:::BlankRow(12L),
            Quantico:::BlankRow(12L),

            # Tabs
            shiny::tabsetPanel(
              id = 'H2O_DRF_TabPanel',
              selected = 'Data',

              # Data Params ----
              shiny::tabPanel(
                title = "Data",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shinydashboard::box(
                    title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                    Quantico:::BlankRow(12L),
                    shiny::fluidRow(
                      shiny::column(
                        6L,
                        align = 'center',
                        shinydashboard::box(
                          title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='H2O_DRF_data', Label='Select Training Data', Choices = H2O_DRF_data_Choices, SelectedDefault = H2O_DRF_data_Selected, Multiple = TRUE, MaxVars = 1))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='H2O_DRF_ValidationData', Label='Select Validation Data', Choices = H2O_DRF_ValidationData_Choices, SelectedDefault = H2O_DRF_ValidationData_Selected, Multiple = TRUE, MaxVars = 1))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='H2O_DRF_TestData', Label='Select Test Data', Choices = H2O_DRF_TestData_Choices, SelectedDefault = H2O_DRF_TestData_Selected, Multiple = TRUE, MaxVars = 1))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::PickerInput(InputID='H2O_DRF_TargetColumnName', Label='Select Target', Choices = NULL, SelectedDefault = H2O_DRF_TargetColumnName_Selected, Multiple = TRUE, MaxVars = 1L))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::PickerInput(InputID='H2O_DRF_FeatureColNames', Label='Select Features', Choices = NULL, SelectedDefault = H2O_DRF_FeatureColNames_Selected, Multiple = TRUE))),
                          Quantico:::BlankRow(12L)
                        )),

                      shiny::column(
                        6L,
                        align = 'center',
                        shinydashboard::box(
                          title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='H2O_DRF_TrainOnFull', Label='Train on Full Data', Choices = H2O_DRF_TrainOnFull_Choices, SelectedDefault = H2O_DRF_TrainOnFull_Selected, Multiple = TRUE, MaxVars = 1))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='H2O_DRF_EncodeMethod', Label='Character Encoding', Choices = H2O_DRF_EncodeMethod_Choices, SelectedDefault = H2O_DRF_EncodeMethod_Selected, Multiple = TRUE, MaxVars = 1))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::PickerInput(InputID='H2O_DRF_WeightsColumn', Label='Weights Column', Choices = NULL, SelectedDefault = H2O_DRF_WeightsColumn_Selected, Multiple = TRUE, MaxVars = 1L))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::PickerInput(InputID='H2O_DRF_TransformNumericColumns', Label='Transform Columns', Choices = NULL, SelectedDefault = H2O_DRF_TransformNumericColumns_Selected, Multiple = TRUE))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='H2O_DRF_Methods', Label='Transform Methods', Choices = H2O_DRF_Methods_Choices, SelectedDefault = H2O_DRF_Methods_Selected, Multiple = TRUE, MaxVars = 100))),
                          Quantico:::BlankRow(12L)
                        ))
                    ),

                    Quantico:::BlankRow(12L),
                    Quantico:::BlankRow(12L),
                    Quantico:::BlankRow(12L),
                    Quantico:::BlankRow(12L)))),

              # MetaData Parameters ----
              shiny::tabPanel(
                title = "Hardware",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shinydashboard::box(
                    title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                    Quantico:::BlankRow(12L),

                    shiny::fluidRow(
                      shiny::column(
                        6L,
                        align = 'center',
                        shinydashboard::box(
                          title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::NumericInput(InputID='H2O_DRF_NThreads', Label='CPU Threads', Value = H2O_DRF_NThreads_Selected, Min = 1, Max = max(1L, parallel::detectCores() - 2L), Step = 1))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='H2O_DRF_MaxMem', Label='Max Memory', Choices = H2O_DRF_MaxMem_Choices, SelectedDefault = H2O_DRF_MaxMem_Selected, Multiple = TRUE, MaxVars = 1))),
                          Quantico:::BlankRow(12L)
                        )
                      )
                    ),

                    Quantico:::BlankRow(12L),
                    Quantico:::BlankRow(12L),
                    Quantico:::BlankRow(12L),
                    Quantico:::BlankRow(12L)))),

              # ML Parameters ----
              shiny::tabPanel(
                title = "Model",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shinydashboard::box(
                    title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                    Quantico:::BlankRow(12L),

                    shiny::fluidRow(
                      shiny::column(
                        4L,
                        align = 'center',
                        shinydashboard::box(
                          title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::NumericInput(InputID='H2O_DRF_Trees', Label='Number of Trees', Value = H2O_DRF_Trees_Selected, Min = 25, Max = 30000, Step = 25))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::NumericInput(InputID='H2O_DRF_MaxDepth', Label='Max Tree Depth', Value = H2O_DRF_MaxDepth_Selected, Min = 2, Max = 20, Step = 1))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='H2O_DRF_SampleRate', Label='Row Sample Rate', Choices = H2O_DRF_SampleRate_Choices, SelectedDefault = H2O_DRF_SampleRate_Selected, Multiple = TRUE, MaxVars = 1))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='H2O_DRF_MTries', Label='Col Sample Rate', Choices = H2O_DRF_MTries_Choices, SelectedDefault = H2O_DRF_MTries_Selected, Multiple = TRUE, MaxVars = 1))),
                          Quantico:::BlankRow(12L)
                        )),

                      shiny::column(
                        4L,
                        align = 'center',
                        shinydashboard::box(
                          title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='H2O_DRF_ColSampleRatePerTree', Label='Col Sample Rate per Tree', Choices = H2O_DRF_ColSampleRatePerTree_Choices, SelectedDefault = H2O_DRF_ColSampleRatePerTree_Selected, Multiple = TRUE, MaxVars = 1))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='H2O_DRF_MinRows', Label='Min Rows per Leaf', Choices = H2O_DRF_MinRows_Choices, SelectedDefault = H2O_DRF_MinRows_Selected, Multiple = TRUE, MaxVars = 1))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='H2O_DRF_NBinsCats', Label='Bins for Categoricals', Choices = H2O_DRF_NBinsCats_Choices, SelectedDefault = H2O_DRF_NBinsCats_Selected, Multiple = TRUE, MaxVars = 1))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='H2O_DRF_NBinsTopLevel', Label='Bins Top Level Cats', Choices = H2O_DRF_NBinsTopLevel_Choices, SelectedDefault = H2O_DRF_NBinsTopLevel_Selected, Multiple = TRUE, MaxVars = 1))),
                          Quantico:::BlankRow(12L)
                        )),

                      shiny::column(
                        4L,
                        align = 'center',
                        shinydashboard::box(
                          title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='H2O_DRF_HistogramType', Label='Histogram Type', Choices = H2O_DRF_HistogramType_Choices, SelectedDefault = H2O_DRF_HistogramType_Selected, Multiple = TRUE, MaxVars = 1))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='H2O_DRF_CategoricalEncoding', Label='Categorical Encoding', Choices = H2O_DRF_CategoricalEncoding_Choices, SelectedDefault = H2O_DRF_CategoricalEncoding_Selected, Multiple = TRUE, MaxVars = 1))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='H2O_DRF_StoppingRounds', Label='Stopping Rounds', Choices = H2O_DRF_StoppingRounds_Choices, SelectedDefault = H2O_DRF_StoppingRounds_Selected, Multiple = TRUE, MaxVars = 1))),
                          Quantico:::BlankRow(12L)
                        ))
                    ),

                    Quantico:::BlankRow(12L),
                    Quantico:::BlankRow(12L),
                    Quantico:::BlankRow(12L),
                    Quantico:::BlankRow(12L)))),

              # Grid Tuning Parameters ----
              shiny::tabPanel(
                title = "Grid Tune",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shinydashboard::box(
                    title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                    Quantico:::BlankRow(12L),

                    shiny::fluidRow(
                      shiny::column(
                        6L,
                        align = 'center',
                        shinydashboard::box(
                          title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='H2O_DRF_GridTune', Label='Grid Tune', Choices = H2O_DRF_GridTune_Choices, SelectedDefault = H2O_DRF_GridTune_Selected, Multiple = TRUE, MaxVars = 1))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::NumericInput(InputID='H2O_DRF_MaxModelsInGrid', Label='Max Models', Value = H2O_DRF_MaxModelsInGrid_Selected, Min = 2, Max = 1000, Step = 1))),
                          Quantico:::BlankRow(12L)
                        ))
                    ),

                    Quantico:::BlankRow(12L),
                    Quantico:::BlankRow(12L),
                    Quantico:::BlankRow(12L),
                    Quantico:::BlankRow(12L)))),

              # Eval Parameters ----
              shiny::tabPanel(
                title = "Evaluation",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shinydashboard::box(
                    title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                    Quantico:::BlankRow(12L),
                    shiny::fluidRow(
                      shiny::column(
                        6L,
                        align = 'center',
                        shinydashboard::box(
                          title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='H2O_DRF_eval_metric', Label='Loss Function', Choices = NULL, SelectedDefault = H2O_DRF_eval_metric_Selected, Multiple = TRUE, MaxVars = 1))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::NumericInput(InputID='H2O_DRF_ClassWeights0', Label='Class Weight for 0', Value = H2O_DRF_ClassWeights0_Selected, Min = 0.01, Max = 1000, Step = 0.01))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::NumericInput(InputID='H2O_DRF_ClassWeights1', Label='Class Weight for 1', Value = H2O_DRF_ClassWeights1_Selected, Min = 0.01, Max = 1000, Step = 0.01))),
                          Quantico:::BlankRow(12L)
                        ))
                    ),

                    Quantico:::BlankRow(12L),
                    Quantico:::BlankRow(12L),
                    Quantico:::BlankRow(12L),
                    Quantico:::BlankRow(12L))))
            )), # end TagList

          footer = shiny::tagList(
            shiny::modalButton(label = "Cancel"),
            shiny::actionButton("H2O_DRF_OK", "OK", width = '50px'))))
    })
}

#' @title H2O_GBM_Modal_Fun
#'
#' @description H2O GBM Parameters Modal with OK button to close
#'
#' @author Adrian Antico
#' @family ML
#'
#' @param id = 'H2O_GBM_ID'
#' @param AppWidth = 12L
#'
#' @export
H2O_GBM_Modal_Fun <- function(id,
                              AppWidth=12L,

                              # Reactives
                              H2O_GBM_eval_metric_Selected = NULL,
                              H2O_GBM_TargetColumnName_Selected = NULL,
                              H2O_GBM_FeatureColNames_Selected = NULL,
                              H2O_GBM_TransformNumericColumns_Selected = NULL,
                              H2O_GBM_WeightsColumn_Selected = NULL,

                              # Statics
                              H2O_GBM_Runs_Choices = NULL,
                              H2O_GBM_TargetType_Choices = NULL,
                              H2O_GBM_data_Choices = NULL,
                              H2O_GBM_ValidationData_Choices = NULL,
                              H2O_GBM_TestData_Choices = NULL,
                              H2O_GBM_EncodeMethod_Choices = NULL,
                              H2O_GBM_Methods_Choices = NULL,
                              H2O_GBM_NThreads_Choices = NULL,
                              H2O_GBM_MaxMem_Choices = NULL,
                              H2O_GBM_TrainOnFull_Choices = NULL,
                              H2O_GBM_Trees_Choices = NULL,
                              H2O_GBM_MaxDepth_Choices = NULL,
                              H2O_GBM_SampleRate_Choices = NULL,
                              H2O_GBM_ColSampleRatePerTree_Choices = NULL,
                              H2O_GBM_LearnRate_Choices = NULL,
                              H2O_GBM_LearnRateAnnealing_Choices = NULL,
                              H2O_GBM_MinRows_Choices = NULL,
                              H2O_GBM_NBinsCats_Choices = NULL,
                              H2O_GBM_NBinsTopLevel_Choices = NULL,
                              H2O_GBM_HistogramType_Choices = NULL,
                              H2O_GBM_CategoricalEncoding_Choices = NULL,
                              H2O_GBM_StoppingRounds_Choices = NULL,
                              H2O_GBM_GridTune_Choices = NULL,
                              H2O_GBM_MaxModelsInGrid_Choices = NULL,

                              # Updaters
                              H2O_GBM_ModelID_Selected = NULL,
                              H2O_GBM_Runs_Selected = NULL,
                              H2O_GBM_TargetType_Selected = NULL,
                              H2O_GBM_data_Selected = NULL,
                              H2O_GBM_ValidationData_Selected = NULL,
                              H2O_GBM_TestData_Selected = NULL,
                              H2O_GBM_EncodeMethod_Selected = NULL,
                              H2O_GBM_Methods_Selected = NULL,
                              H2O_GBM_NThreads_Selected = NULL,
                              H2O_GBM_MaxMem_Selected = NULL,
                              H2O_GBM_TrainOnFull_Selected = NULL,
                              H2O_GBM_Trees_Selected = NULL,
                              H2O_GBM_MaxDepth_Selected = NULL,
                              H2O_GBM_SampleRate_Selected = NULL,
                              H2O_GBM_LearnRate_Selected = NULL,
                              H2O_GBM_LearnRateAnnealing_Selected = NULL,
                              H2O_GBM_MTries_Selected = NULL,
                              H2O_GBM_ColSampleRatePerTree_Selected = NULL,
                              H2O_GBM_MinRows_Selected = NULL,
                              H2O_GBM_NBinsCats_Selected = NULL,
                              H2O_GBM_NBinsTopLevel_Selected = NULL,
                              H2O_GBM_HistogramType_Selected = NULL,
                              H2O_GBM_CategoricalEncoding_Selected = NULL,
                              H2O_GBM_StoppingRounds_Selected = NULL,
                              H2O_GBM_GridTune_Selected = NULL,
                              H2O_GBM_MaxModelsInGrid_Selected = NULL,
                              H2O_GBM_Distribution_Selected = NULL,
                              H2O_GBM_ClassWeights0_Selected = NULL,
                              H2O_GBM_ClassWeights1_Selected = NULL) {

  shiny::moduleServer(
    id = id,
    module = function(input, output, session) {
      ns <- session$ns
      shiny::showModal(
        shiny::modalDialog(
          title = 'H2O-GBM Parameters',
          size = "l",
          easyClose = FALSE,
          fade = TRUE,
          shiny::tagList(
            shinydashboard::box(
              title = NULL, solidHeader = TRUE, collapsible = FALSE, status = 'danger', width = AppWidth,

              # Top Box ----
              Quantico::BlankRow(12L),
              shiny::fluidRow(
                shiny::column(
                  width = 12L,
                  align = "right",
                  shinyWidgets::dropdown(
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = "info", width = 12L,
                      shiny::fluidRow(
                        shiny::column(
                          width = 12L,
                          align = "left",
                          shiny::a(name = "h2ogbm"),
                          shiny::h1(tags$b("H2O-GBM")),
                          shiny::p("The H2O-GBM ML algorithm is for running regression, classification,
                           and multiclass models."),
                          tags$a(target="_blank", shiny::icon("newspaper"), href="https://docs.h2o.ai/h2o/latest-stable/h2o-docs/data-science/gbm.html", "H2O-GBM Background Link"),
                        )
                      ),

                      Quantico::BlankRow(12),
                      shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::h3("H2O-GBM Usage"))),
                      Quantico::BlankRow(12),
                      shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::markdown(
                        "
                        ### Data:
                        This is where you define your datasets and variables of interest
                        * Train Data: This is your training dataset. This one is required
                        * Validation Data: Optional. If you have a validation dataset supply that here. If not, one will be created for you and 20% of your data will be allocated to Validation Data unless you specify 'TrainOnFull = TRUE' in the Meta Parameters tab.
                        * Test Data: Optional. If you have a validation dataset supply that here. If not, one will be created for you and 10% of your data will be allocated to Test Data unless you specify 'TrainOnFull = TRUE' in the Meta Parameters tab.
                        * Select Target: This is your dependent variable that you are looking to predict / model
                        * Select Features: These are your independent variables used to help predict your target variable
                        * TrainOnFull: Select TRUE to train on the full dataset instead of utilizing training, validation, and test datasets. This is typically done when you've found a final set of parameters and are ready to build a final model for production.
                        * Character Encoding: If you have character features in your feature set they will be converted to numeric encodings. You can choose which type in this dropdown
                        * Weights Column: if you want your rows weighted for modeling purposes you'll need to have a column with the weights within them to supply here. A common reason to use weighting is for when you have group variables and some of the levels have lower counts than others. The ML models will tend to emphasize the higher record count when building so if you find bias is your outcome predictions, weighting can help to resolve that
                        * Transform Variables: This is to transform your target variable. There is no need to transform your features (independent variables) as monotonic transformations on features with tree based methods make no difference in outcome
                        * Transform Methods: Choose at least one method. The algorithms will determine which transformation among selected will best normalize your target variable and move forward with that one
                        "
                      ))),
                      Quantico::BlankRow(12),
                      shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::markdown(
                        "
                        ### Hardware:
                        This is where you define your datasets and variables of interest
                        * CPU Threads: Number of CPU threads to utilize for training
                        * Create ModelID: This will attach all model artifacts to a name. If you plan on running multiple models for comparison then set a name to each model to distinguish between then and prevent overwriting an already built model
                        * Max Memory: This will default to total available threads minus 2. CPU is still utilized even when you select GPU. If you have other processes running at the same time as modeling you will want to lower the CPU Threads count to give all processes a chance to keep running and prevent a queue pool from forming (which can slow down all processes)
                        "
                      ))),
                      Quantico::BlankRow(12),
                      shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::markdown(
                        "
                        ### Model:
                        This is where you define the H2O-GBM parameters
                        * Number of Trees: Select the number of trees for training the model
                        * Max Tree Depth: Determines the max number of splits each tree can make
                        * Row Sample Rate: % of rows to utilize in training per tree
                        * Column Sample Rate: % of columns to utilize in training per split
                        * Learning Rate: Used for reducing the gradient step
                        * Learning Rate Annealing: Specifies to reduce the Learning Rate by this factor after every tree
                        * Column Sample Rate per Tree: % of columns to utilize in training per tree
                        * Bins for Categorical Variables: Number of bins for group variable levels. Fewer bins means that more group levels will be combined
                        * Min Rows per Leaf: Minimum number of records in leaves for continued splitting
                        * Histogram Type: Methods for creating splits on numeric variables
                        * Categorical Encoding: H2O's encoding methods for categorical variables
                        * Stopping Rounds: Stops training when model performance doesnt improve for the specified number of training rounds, based on a simple moving average
                        * Bins Top Level Categorical Variables: Number of bins for group variable levels at the top level of each tree. Fewer bins means that more group levels will be combined
                        "
                      ))),
                      Quantico::BlankRow(12),
                      shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::markdown(
                        "
                        ### Grid Tuning:
                        This is where you define parameters for a hyperparameter search
                        * Grid Tune: Set to TRUE to run grid tuning
                        * Max Models: Cap the number of models to test in grid tuning mode
                        "
                      ))),

                      Quantico::BlankRow(12),
                      shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::markdown(
                        "
                        ### Evaluation:
                        This is where you define parameters for a hyperparameter search
                        * Loss Function: The metric to use in training. The specified value also determines the machine learning problem to solve. Some metrics support optional parameters (see the Objectives and metrics section for details on each metric)
                        * Class Weight for 0 Class: For Binary Classification models, you can up- or down-weight each class. The default under the hood is 1 for both
                        * Class Weight for 1 Class: For Binary Classification models, you can up- or down-weight each class. The default under the hood is 1 for both
                        "
                      ))),

                      Quantico::BlankRow(12L),
                      shiny::fluidRow(shiny::column(width = 12L, align = "left", tags$a(target="_blank", shiny::icon("newspaper"), href="https://docs.h2o.ai/h2o/latest-stable/h2o-docs/data-science/gbm.html", "H2O GBM Parameter Docs")))
                    ),
                    size = "lg",
                    icon = shiny::icon("question"),
                    label = NULL,
                    tooltip = FALSE,
                    right = TRUE,
                    up = FALSE,
                    width = NULL,
                    animate = shinyWidgets::animateOptions(
                      enter = "zoomIn",
                      exit = "fadeOutRightBig"
                    ),
                    inputId = NULL,
                    block = FALSE,
                    no_outline = TRUE
                  )
                )
              ),

              Quantico:::BlankRow(12L),
              shiny::fluidRow(

                # Target Type
                shiny::column(
                  width = 3L,
                  align = 'center',
                  Quantico:::SelectizeInput(InputID = 'H2O_GBM_TargetType', Label = 'Select Supervised Learning Type', Choices = H2O_GBM_TargetType_Choices, SelectedDefault = H2O_GBM_TargetType_Selected, Multiple = TRUE, MaxVars = 1)),
                shiny::column(
                  width = 3L,
                  align = 'center',
                  Quantico:::TextInput(InputID='H2O_GBM_ModelID', Label='Create Model ID', Value = H2O_GBM_ModelID_Selected)),
                shiny::column(
                  width = 3L,
                  align = 'center',
                  Quantico:::NumericInput(InputID = 'H2O_GBM_Runs', Label = 'Cross Validation Runs', Value = H2O_GBM_Runs_Selected, Min = 1, Max = 100, Step = 1)
                ),

                # Build Models Button
                shiny::column(
                  width = 3L,
                  shinyjs::useShinyjs(),
                  align = 'center',
                  tags$h3(tags$b('~ Build')),
                  shiny::actionButton(
                    inputId = paste0('BuildModels_H2O_GBM'),
                    label = paste0('Run'),
                    icon = shiny::icon('chevron-right', lib='font-awesome')
                  )
                )
              ),

              Quantico:::BlankRow(12L)),

            Quantico:::BlankRow(12L),
            Quantico:::BlankRow(12L),

            # Tabs
            shiny::tabsetPanel(
              id = 'H2O_GBM_TabPanel',
              selected = 'Data',

              # Params
              shiny::tabPanel(
                title = "Data",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shinydashboard::box(
                    title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                    Quantico:::BlankRow(12L),
                    shiny::fluidRow(
                      shiny::column(
                        6L,
                        align = 'center',
                        shinydashboard::box(
                          title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='H2O_GBM_data', Label='Select Training Data', Choices = H2O_GBM_data_Choices, SelectedDefault = H2O_GBM_data_Selected, Multiple = TRUE, MaxVars = 1))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='H2O_GBM_ValidationData', Label='Select Validation Data', Choices = H2O_GBM_ValidationData_Choices, SelectedDefault = H2O_GBM_ValidationData_Selected, Multiple = TRUE, MaxVars = 1))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='H2O_GBM_TestData', Label='Select Test Data', Choices = H2O_GBM_TestData_Choices, SelectedDefault = H2O_GBM_TestData_Selected, Multiple = TRUE, MaxVars = 1))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::PickerInput(InputID='H2O_GBM_TargetColumnName', Label='Select Target', Choices = NULL, SelectedDefault = H2O_GBM_TargetColumnName_Selected, Multiple = TRUE, MaxVars = 1L))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::PickerInput(InputID='H2O_GBM_FeatureColNames', Label='Select Features', Choices = NULL, SelectedDefault = H2O_GBM_FeatureColNames_Selected, Multiple = TRUE))),
                          Quantico:::BlankRow(12L)
                        )),

                      shiny::column(
                        6L,
                        align = 'center',
                        shinydashboard::box(
                          title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='H2O_GBM_TrainOnFull', Label='Train on Full Data', Choices = H2O_GBM_TrainOnFull_Choices, SelectedDefault = H2O_GBM_TrainOnFull_Selected, Multiple = TRUE, MaxVars = 1))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='H2O_GBM_EncodeMethod', Label='Character Encoding', Choices = H2O_GBM_EncodeMethod_Choices, SelectedDefault = H2O_GBM_EncodeMethod_Selected, Multiple = TRUE, MaxVars = 1))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::PickerInput(InputID='H2O_GBM_WeightsColumn', Label='Weights Column', Choices = NULL, SelectedDefault = H2O_GBM_WeightsColumn_Selected, Multiple = TRUE, MaxVars = 1L))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::PickerInput(InputID='H2O_GBM_TransformNumericColumns', Label='Transform Columns', Choices = NULL, SelectedDefault = H2O_GBM_TransformNumericColumns_Selected, Multiple = TRUE))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='H2O_GBM_Methods', Label='Transform Methods', Choices = H2O_GBM_Methods_Choices, SelectedDefault = H2O_GBM_Methods_Selected, Multiple = TRUE, MaxVars = 100))),
                          Quantico:::BlankRow(12L)
                        ))
                    ),

                    Quantico:::BlankRow(12L),
                    Quantico:::BlankRow(12L),
                    Quantico:::BlankRow(12L),
                    Quantico:::BlankRow(12L)))),

              # MetaData Parameters
              shiny::tabPanel(
                title = "Hardware",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shinydashboard::box(
                    title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                    Quantico:::BlankRow(12L),

                    shiny::fluidRow(
                      shiny::column(
                        6L,
                        align = 'center',
                        shinydashboard::box(
                          title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::NumericInput(InputID='H2O_GBM_NThreads', Label='CPU Threads', Value = H2O_GBM_NThreads_Selected, Min = 1, Max = max(1L, parallel::detectCores() - 2L), Step = 1))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='H2O_GBM_MaxMem', Label='Max Memory', Choices = H2O_GBM_MaxMem_Choices, SelectedDefault = H2O_GBM_MaxMem_Selected, Multiple = TRUE, MaxVars = 1))),
                          Quantico:::BlankRow(12L)
                        )
                      )
                    ),

                    Quantico:::BlankRow(12L),
                    Quantico:::BlankRow(12L),
                    Quantico:::BlankRow(12L),
                    Quantico:::BlankRow(12L)))),

              # ML Parameters
              shiny::tabPanel(
                title = "Model",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shinydashboard::box(
                    title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                    Quantico:::BlankRow(12L),


                    shiny::fluidRow(
                      shiny::column(
                        4L,
                        align = 'center',
                        shinydashboard::box(
                          title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::NumericInput(InputID = 'H2O_GBM_Trees', Label='Number of Trees', Value = H2O_GBM_Trees_Selected, Min = 25, Max = 30000, Step = 25))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::NumericInput(InputID = 'H2O_GBM_MaxDepth', Label='Max Tree Depth', Value = H2O_GBM_MaxDepth_Selected, Min = 2, Max = 20, Step = 1))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID = 'H2O_GBM_SampleRate', Label='Row Sample Rate', Choices = H2O_GBM_SampleRate_Choices, SelectedDefault = H2O_GBM_SampleRate_Selected, Multiple = TRUE, MaxVars = 1))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID = 'H2O_GBM_LearnRate', Label='Learning Rate', Choices = H2O_GBM_LearnRate_Choices, SelectedDefault = H2O_GBM_LearnRate_Selected, Multiple = TRUE, MaxVars = 1))),
                          Quantico:::BlankRow(12L)
                        )),

                      shiny::column(
                        4L,
                        align = 'center',
                        shinydashboard::box(
                          title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID = 'H2O_GBM_ColSampleRatePerTree', Label='Col Sample Rate per Tree', Choices = H2O_GBM_ColSampleRatePerTree_Choices, SelectedDefault = H2O_GBM_ColSampleRatePerTree_Selected, Multiple = TRUE, MaxVars = 1))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID = 'H2O_GBM_NBinsCats', Label='Bins for Categoricals', Choices = H2O_GBM_NBinsCats_Choices, SelectedDefault = H2O_GBM_NBinsCats_Selected, Multiple = TRUE, MaxVars = 1))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID = 'H2O_GBM_MinRows', Label='Min Rows per Leaf', Choices = H2O_GBM_MinRows_Choices, SelectedDefault = H2O_GBM_MinRows_Selected, Multiple = TRUE, MaxVars = 1))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID = 'H2O_GBM_LearnRateAnnealing', Label='Learn Rate Annealing', Choices = H2O_GBM_LearnRateAnnealing_Choices, SelectedDefault = H2O_GBM_LearnRateAnnealing_Selected, Multiple = TRUE, MaxVars = 1))),
                          Quantico:::BlankRow(12L)
                        )),

                      shiny::column(
                        4L,
                        align = 'center',
                        shinydashboard::box(
                          title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID = 'H2O_GBM_HistogramType', Label='Histogram Type', Choices = H2O_GBM_HistogramType_Choices, SelectedDefault = H2O_GBM_HistogramType_Selected, Multiple = TRUE, MaxVars = 1))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID = 'H2O_GBM_CategoricalEncoding', Label='Encoding Type', Choices = H2O_GBM_CategoricalEncoding_Choices, SelectedDefault = H2O_GBM_CategoricalEncoding_Selected, Multiple = TRUE, MaxVars = 1))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID = 'H2O_GBM_StoppingRounds', Label='Stopping Rounds', Choices = H2O_GBM_StoppingRounds_Choices, SelectedDefault = H2O_GBM_StoppingRounds_Selected, Multiple = TRUE, MaxVars = 1))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID = 'H2O_GBM_NBinsTopLevel', Label='Bins Top Level Cats', Choices = H2O_GBM_NBinsTopLevel_Choices, SelectedDefault = H2O_GBM_NBinsTopLevel_Selected, Multiple = TRUE, MaxVars = 1))),
                          Quantico:::BlankRow(12L)
                        ))
                    ),

                    Quantico:::BlankRow(12L),
                    Quantico:::BlankRow(12L),
                    Quantico:::BlankRow(12L),
                    Quantico:::BlankRow(12L)))),

              # Grid Tuning Parameters
              shiny::tabPanel(
                title = "Grid Tune",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shinydashboard::box(
                    title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                    Quantico:::BlankRow(12L),
                    shiny::fluidRow(
                      shiny::column(
                        6L,
                        align = 'center',
                        shinydashboard::box(
                          title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='H2O_GBM_GridTune', Label='Grid Tune', Choices = H2O_GBM_GridTune_Choices, SelectedDefault = H2O_GBM_GridTune_Selected, Multiple = TRUE, MaxVars = 1))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::NumericInput(InputID='H2O_GBM_MaxModelsInGrid', Label='Max Models', Value = H2O_GBM_MaxModelsInGrid_Selected, Min = 2, Max = 1000, Step = 1))),
                          Quantico:::BlankRow(12L)
                        ))
                    ),

                    Quantico:::BlankRow(12L),
                    Quantico:::BlankRow(12L),
                    Quantico:::BlankRow(12L),
                    Quantico:::BlankRow(12L)))),

              # Eval Parameters
              shiny::tabPanel(
                title = "Evaluation",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shinydashboard::box(
                    title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                    Quantico:::BlankRow(12L),
                    shiny::fluidRow(
                      shiny::column(
                        6L,
                        align = 'center',
                        shinydashboard::box(
                          title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='H2O_GBM_Distribution', Label='Loss Function', Choices = NULL, SelectedDefault = H2O_GBM_Distribution_Selected, Multiple = TRUE, MaxVars = 1))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::NumericInput(InputID='H2O_GBM_ClassWeights0', Label='Class Weight for 0', Value = H2O_GBM_ClassWeights0_Selected, Min = 0.01, Max = 1000, Step = 0.01))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::NumericInput(InputID='H2O_GBM_ClassWeights1', Label='Class Weight for 1', Value = H2O_GBM_ClassWeights1_Selected, Min = 0.01, Max = 1000, Step = 0.01))),
                          Quantico:::BlankRow(12L)
                        ))
                    ),

                    Quantico:::BlankRow(12L),
                    Quantico:::BlankRow(12L),
                    Quantico:::BlankRow(12L),
                    Quantico:::BlankRow(12L))))

            )), # end TagList

          footer = shiny::tagList(
            shiny::modalButton(label = "Cancel"),
            shiny::actionButton("H2O_GBM_OK", "OK", width = '50px'))))
    })
}

#' @title H2O_GLM_Modal_Fun
#'
#' @description H2O GLM Parameters Modal with OK button to close
#'
#' @author Adrian Antico
#' @family ML
#'
#' @param id = 'H2O_GLM_ID'
#' @param AppWidth = 12L
#'
#' @export
H2O_GLM_Modal_Fun <- function(id,
                              AppWidth=12L,

                              # Reactives
                              H2O_GLM_TargetColumnName_Selected = NULL,
                              H2O_GLM_FeatureColNames_Selected = NULL,
                              H2O_GLM_TransformNumericColumns_Selected = NULL,
                              H2O_GLM_WeightsColumn_Selected = NULL,
                              H2O_GLM_Distribution_Selected = NULL,
                              H2O_GLM_Link_Selected = NULL,
                              H2O_GLM_eval_metric_Selected = NULL,

                              # Statics
                              H2O_GLM_Runs_Choices = NULL,
                              H2O_GLM_TargetType_Choices = NULL,
                              H2O_GLM_data_Choices = NULL,
                              H2O_GLM_ValidationData_Choices = NULL,
                              H2O_GLM_TestData_Choices = NULL,
                              H2O_GLM_EncodeMethod_Choices = NULL,
                              H2O_GLM_Methods_Choices = NULL,
                              H2O_GLM_NThreads_Choices = NULL,
                              H2O_GLM_MaxMem_Choices = NULL,
                              H2O_GLM_TrainOnFull_Choices = NULL,
                              H2O_GLM_Solver_Choices = NULL,
                              H2O_GLM_Alpha_Choices = NULL,
                              H2O_GLM_Lambda_Choices = NULL,
                              H2O_GLM_LambdaSearch_Choices = NULL,
                              H2O_GLM_NLambdas_Choices = NULL,
                              H2O_GLM_Standardize_Choices = NULL,
                              H2O_GLM_RemoveCollinearColumns_Choices = NULL,
                              H2O_GLM_InterceptInclude_Choices = NULL,
                              H2O_GLM_NonNegativeCoefficients_Choices = NULL,
                              H2O_GLM_TweedieLinkPower_Choices = NULL,
                              H2O_GLM_TweedieVariancePower_Choices = NULL,
                              H2O_GLM_GridTune_Choices = NULL,
                              H2O_GLM_MaxModelsInGrid_Choices = NULL,

                              # Updaters
                              H2O_GLM_ModelID_Selected = NULL,
                              H2O_GLM_Runs_Selected = NULL,
                              H2O_GLM_TargetType_Selected = NULL,
                              H2O_GLM_data_Selected = NULL,
                              H2O_GLM_ValidationData_Selected = NULL,
                              H2O_GLM_TestData_Selected = NULL,
                              H2O_GLM_EncodeMethod_Selected = NULL,
                              H2O_GLM_Methods_Selected = NULL,
                              H2O_GLM_NThreads_Selected = NULL,
                              H2O_GLM_MaxMem_Selected = NULL,
                              H2O_GLM_TrainOnFull_Selected = NULL,
                              H2O_GLM_Solver_Selected = NULL,
                              H2O_GLM_Alpha_Selected = NULL,
                              H2O_GLM_Lambda_Selected = NULL,
                              H2O_GLM_LambdaSearch_Selected = NULL,
                              H2O_GLM_NLambdas_Selected = NULL,
                              H2O_GLM_Standardize_Selected = NULL,
                              H2O_GLM_RemoveCollinearColumns_Selected = NULL,
                              H2O_GLM_InterceptInclude_Selected = NULL,
                              H2O_GLM_NonNegativeCoefficients_Selected = NULL,
                              H2O_GLM_TweedieLinkPower_Selected = NULL,
                              H2O_GLM_TweedieVariancePower_Selected = NULL,
                              H2O_GLM_GridTune_Selected = NULL,
                              H2O_GLM_MaxModelsInGrid_Selected = NULL,
                              H2O_GLM_ClassWeights0_Selected = NULL,
                              H2O_GLM_ClassWeights1_Selected = NULL) {

  shiny::moduleServer(
    id = id,
    module = function(input, output, session) {
      ns <- session$ns
      shiny::showModal(
        shiny::modalDialog(
          title = 'H2O-GLM Parameters',
          size = "l",
          easyClose = FALSE,
          fade = TRUE,
          shiny::tagList(
            shinydashboard::box(
              title = NULL, solidHeader = TRUE, collapsible = FALSE, status = 'danger', width = AppWidth,

              # Top Box ----
              Quantico::BlankRow(12L),
              shiny::fluidRow(
                shiny::column(
                  width = 12L,
                  align = "right",
                  shinyWidgets::dropdown(
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = "info", width = 12L,
                      shiny::fluidRow(
                        shiny::column(
                          width = 12L,
                          align = "left",
                          shiny::a(name = "h2oglm"),
                          shiny::h1(tags$b("H2O-GLM")),
                          shiny::p("The H2O-GLM ML algorithm is for running heirarchical regression models"),
                          tags$a(shiny::icon("newspaper"), href="https://docs.h2o.ai/h2o/latest-stable/h2o-docs/data-science/glm.html", "H2O-GLM Background Link"),
                        )
                      ),

                      Quantico::BlankRow(12),
                      shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::h3("H2O-GLM Usage"))),
                      Quantico::BlankRow(12),
                      shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::markdown(
                        "
                        ### Data:
                        This is where you define your datasets and variables of interest
                        * Train Data: This is your training dataset. This one is required
                        * Validation Data: Optional. If you have a validation dataset supply that here. If not, one will be created for you and 20% of your data will be allocated to Validation Data unless you specify 'TrainOnFull = TRUE' in the Meta Parameters tab.
                        * Test Data: Optional. If you have a validation dataset supply that here. If not, one will be created for you and 10% of your data will be allocated to Test Data unless you specify 'TrainOnFull = TRUE' in the Meta Parameters tab.
                        * Select Target: This is your dependent variable that you are looking to predict / model
                        * Select Features: These are your independent variables used to help predict your target variable
                        * TrainOnFull: Select TRUE to train on the full dataset instead of utilizing training, validation, and test datasets. This is typically done when you've found a final set of parameters and are ready to build a final model for production.
                        * Character Encoding: If you have character features in your feature set they will be converted to numeric encodings. You can choose which type in this dropdown
                        * Weights Column: if you want your rows weighted for modeling purposes you'll need to have a column with the weights within them to supply here. A common reason to use weighting is for when you have group variables and some of the levels have lower counts than others. The ML models will tend to emphasize the higher record count when building so if you find bias is your outcome predictions, weighting can help to resolve that
                        * Transform Variables: This is to transform your target variable. There is no need to transform your features (independent variables) as monotonic transformations on features with tree based methods make no difference in outcome
                        * Transform Methods: Choose at least one method. The algorithms will determine which transformation among selected will best normalize your target variable and move forward with that one
                        "
                      ))),
                      Quantico::BlankRow(12),
                      shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::markdown(
                        "
                        ### Hardware:
                        This is where you define your datasets and variables of interest
                        * CPU Threads: Number of CPU threads to utilize for training
                        * Create ModelID: This will attach all model artifacts to a name. If you plan on running multiple models for comparison then set a name to each model to distinguish between then and prevent overwriting an already built model
                        * Max Memory: This will default to total available threads minus 2. CPU is still utilized even when you select GPU. If you have other processes running at the same time as modeling you will want to lower the CPU Threads count to give all processes a chance to keep running and prevent a queue pool from forming (which can slow down all processes)
                        "
                      ))),
                      Quantico::BlankRow(12),
                      shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::markdown(
                        "
                        ### Model:
                        This is where you define the H2O-GLM parameters
                        * Solver: 'IRSLM' is the default for model interpretation purposes
                        * Alpha: L1 Regularization; defaults to 0 for model interpretation purposes
                        * Lambda: L2 Regularization; defaults to 0 for model interpretation purposes
                        * Random Dist: Gaussian only
                        * Standardize: defaults to FALSE for model interpretation purposes
                        * Remove Collinear Columns: defaults to FALSE for model interpretation purposes
                        * Include Intercept: defaults to TRUE for model interpretation purposes
                        * Non Negative Coefficients: defaults to FALSE for model interpretation purposes
                        "
                      ))),
                      Quantico::BlankRow(12),
                      shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::markdown(
                        "
                        ### Grid Tuning:
                        This is where you define parameters for a hyperparameter search
                        * Grid Tune: Set to TRUE to run grid tuning
                        * Max Models: Cap the number of models to test in grid tuning mode
                        "
                      ))),

                      Quantico::BlankRow(12),
                      shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::markdown(
                        "
                        ### Evaluation:
                        This is where you define parameters for a hyperparameter search
                        * Loss Function: The metric to use in training. The specified value also determines the machine learning problem to solve. Some metrics support optional parameters (see the Objectives and metrics section for details on each metric)
                        * Class Weight for 0 Class: For Binary Classification models, you can up- or down-weight each class. The default under the hood is 1 for both
                        * Class Weight for 1 Class: For Binary Classification models, you can up- or down-weight each class. The default under the hood is 1 for both
                        "
                      ))),

                      Quantico::BlankRow(12L),
                      shiny::fluidRow(shiny::column(width = 12L, align = "left", tags$a(target="_blank", shiny::icon("newspaper"), href="https://docs.h2o.ai/h2o/latest-stable/h2o-docs/data-science/glm.html", "H2O GLM Parameter Docs")))
                    ),
                    size = "lg",
                    icon = shiny::icon("question"),
                    label = NULL,
                    tooltip = FALSE,
                    right = TRUE,
                    up = FALSE,
                    width = NULL,
                    animate = shinyWidgets::animateOptions(
                      enter = "zoomIn",
                      exit = "fadeOutRightBig"
                    ),
                    inputId = NULL,
                    block = FALSE,
                    no_outline = TRUE
                  )
                )
              ),

              Quantico:::BlankRow(12L),
              shiny::fluidRow(

                # Target Type
                shiny::column(
                  width = 3L,
                  align = 'center',
                  Quantico:::SelectizeInput(InputID='H2O_GLM_TargetType', Label = 'Select Supervised Learning Type', Choices = H2O_GLM_TargetType_Choices, SelectedDefault = H2O_GLM_TargetType_Selected, Multiple = TRUE, MaxVars = 1)),
                shiny::column(
                  width = 3L,
                  align = 'center',
                  Quantico:::TextInput(InputID='H2O_GLM_ModelID', Label='Create Model ID', Value = H2O_GLM_ModelID_Selected)),
                shiny::column(
                  width = 3L,
                  align = 'center',
                  Quantico:::NumericInput(InputID='H2O_GLM_Runs', Label = 'Cross Validation Runs', Value = H2O_GLM_Runs_Selected, Min = 1, Max = 100, Step = 1)),

                # Build Models Button
                shiny::column(
                  width = 3L,
                  shinyjs::useShinyjs(),
                  align = 'center',
                  tags$h3(tags$b('~ Build')),
                  shiny::actionButton(
                    inputId = paste0('BuildModels_H2O_GLM'),
                    label = paste0('Run'),
                    icon = shiny::icon('chevron-right', lib='font-awesome')
                  )
                )
              ),

              Quantico:::BlankRow(12L)),

            Quantico:::BlankRow(12L),
            Quantico:::BlankRow(12L),

            # Tabs
            shiny::tabsetPanel(
              id = 'H2O_GLM_TabPanel',
              selected = 'Data',

              # Params
              shiny::tabPanel(
                title = "Data",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shinydashboard::box(
                    title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                    Quantico:::BlankRow(12L),
                    shiny::fluidRow(
                      shiny::column(
                        6L,
                        align = 'center',
                        shinydashboard::box(
                          title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='H2O_GLM_data', Label='Select Training Data', Choices = H2O_GLM_data_Choices, SelectedDefault = H2O_GLM_data_Selected, Multiple = TRUE, MaxVars = 1))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='H2O_GLM_ValidationData', Label='Select Validation Data', Choices = H2O_GLM_ValidationData_Choices, SelectedDefault = H2O_GLM_ValidationData_Selected, Multiple = TRUE, MaxVars = 1))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='H2O_GLM_TestData', Label='Select Test Data', Choices = H2O_GLM_TestData_Choices, SelectedDefault = H2O_GLM_TestData_Selected, Multiple = TRUE, MaxVars = 1))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::PickerInput(InputID='H2O_GLM_TargetColumnName', Label='Select Target', Choices = NULL, SelectedDefault = H2O_GLM_TargetColumnName_Selected, Multiple = TRUE, MaxVars = 1L))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::PickerInput(InputID='H2O_GLM_FeatureColNames', Label='Select Features', Choices = NULL, SelectedDefault = H2O_GLM_FeatureColNames_Selected, Multiple = TRUE))),
                          Quantico:::BlankRow(12L)
                        )),

                      shiny::column(
                        6L,
                        align = 'center',
                        shinydashboard::box(
                          title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='H2O_GLM_TrainOnFull', Label='Train on Full Data', Choices = H2O_GLM_TrainOnFull_Choices, SelectedDefault = H2O_GLM_TrainOnFull_Selected, Multiple = TRUE, MaxVars = 1))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::PickerInput(InputID='H2O_GLM_WeightsColumn', Label='Weights Column', Choices = NULL, SelectedDefault = H2O_GLM_WeightsColumn_Selected, Multiple = TRUE, MaxVars = 1L))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::PickerInput(InputID='H2O_GLM_TransformNumericColumns', Label='Transform Columns', Choices = NULL, SelectedDefault = H2O_GLM_TransformNumericColumns_Selected, Multiple = TRUE))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='H2O_GLM_Methods', Label='Transform Methods', Choices = H2O_GLM_Methods_Choices, SelectedDefault = H2O_GLM_Methods_Selected, Multiple = TRUE, MaxVars = 100))),
                          Quantico:::BlankRow(12L)
                        ))
                    ),


                    Quantico:::BlankRow(12L),
                    Quantico:::BlankRow(12L),
                    Quantico:::BlankRow(12L),
                    Quantico:::BlankRow(12L)))),

              # MetaData Parameters
              shiny::tabPanel(
                title = "Hardware",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shinydashboard::box(
                    title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                    Quantico:::BlankRow(12L),

                    shiny::fluidRow(
                      shiny::column(
                        6L,
                        align = 'center',
                        shinydashboard::box(
                          title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::NumericInput(InputID='H2O_GLM_NThreads', Label='CPU Threads', Value = H2O_GLM_NThreads_Selected, Min = 1, Max = max(1L, parallel::detectCores() - 2L), Step = 1))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='H2O_GLM_MaxMem', Label='Task Type', Choices = H2O_GLM_MaxMem_Choices, SelectedDefault = H2O_GLM_MaxMem_Selected, Multiple = TRUE, MaxVars = 1))),
                          Quantico:::BlankRow(12L)
                        )
                      )
                    ),

                    Quantico:::BlankRow(12L),
                    Quantico:::BlankRow(12L),
                    Quantico:::BlankRow(12L),
                    Quantico:::BlankRow(12L)))),

              # ML Parameters
              shiny::tabPanel(
                title = "Model",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shinydashboard::box(
                    title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                    Quantico:::BlankRow(12L),
                    shiny::fluidRow(
                      shiny::column(
                        6L,
                        align = 'center',
                        shinydashboard::box(
                          title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='H2O_GLM_Solver', Label='Sovler', Choices = H2O_GLM_Solver_Choices, SelectedDefault = H2O_GLM_Solver_Selected, Multiple = TRUE, MaxVars = 1))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='H2O_GLM_Alpha', Label='Alpha', Choices = H2O_GLM_Alpha_Choices, SelectedDefault = H2O_GLM_Alpha_Selected, Multiple = TRUE, MaxVars = 1))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='H2O_GLM_Lambda', Label='Lambda', Choices = H2O_GLM_Lambda_Choices, SelectedDefault = H2O_GLM_Lambda_Selected, Multiple = TRUE, MaxVars = 1))),
                          Quantico:::BlankRow(12L)
                        )),

                      shiny::column(
                        6L,
                        align = 'center',
                        shinydashboard::box(
                          title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='H2O_GLM_Standardize', Label='Standardize', Choices = H2O_GLM_Standardize_Choices, SelectedDefault = H2O_GLM_Standardize_Selected, Multiple = TRUE, MaxVars = 1))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='H2O_GLM_RemoveCollinearColumns', Label='Remove Collinear Cols', Choices = H2O_GLM_RemoveCollinearColumns_Choices, SelectedDefault = H2O_GLM_RemoveCollinearColumns_Selected, Multiple = TRUE, MaxVars = 1))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='H2O_GLM_InterceptInclude', Label='Include Intercept', Choices = H2O_GLM_InterceptInclude_Choices, SelectedDefault = H2O_GLM_InterceptInclude_Selected, Multiple = TRUE, MaxVars = 1))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='H2O_GLM_NonNegativeCoefficients', Label='Non Negative Coeff', Choices = H2O_GLM_NonNegativeCoefficients_Choices, SelectedDefault = H2O_GLM_NonNegativeCoefficients_Selected, Multiple = TRUE, MaxVars = 1))),
                          Quantico:::BlankRow(12L)
                        ))
                    ),

                    Quantico:::BlankRow(12L),
                    Quantico:::BlankRow(12L),
                    Quantico:::BlankRow(12L),
                    Quantico:::BlankRow(12L)))),

              # Grid Tuning Parameters
              shiny::tabPanel(
                title = "Grid Tune",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shinydashboard::box(
                    title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                    Quantico:::BlankRow(12L),
                    shiny::fluidRow(
                      shiny::column(
                        6L,
                        align = 'center',
                        shinydashboard::box(
                          title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='H2O_GLM_GridTune', Label='Grid Tune', Choices = H2O_GLM_GridTune_Choices, SelectedDefault = H2O_GLM_GridTune_Selected, Multiple = TRUE, MaxVars = 1))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::NumericInput(InputID='H2O_GLM_MaxModelsInGrid', Label='Max Models', Value = H2O_GLM_MaxModelsInGrid_Selected, Min = 2, Max = 1000, Step = 1))),
                          Quantico:::BlankRow(12L)
                        ))
                    ),

                    Quantico:::BlankRow(12L),
                    Quantico:::BlankRow(12L),
                    Quantico:::BlankRow(12L),
                    Quantico:::BlankRow(12L)))),

              # Eval Parameters
              shiny::tabPanel(
                title = "Evaluation",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shinydashboard::box(
                    title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                    Quantico:::BlankRow(12L),
                    shiny::fluidRow(
                      shiny::column(
                        6L,
                        align = 'center',
                        shinydashboard::box(
                          title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                          Quantico:::BlankRow(12L),

                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='H2O_GLM_Distribution', Label='Distribution', Choices = NULL, SelectedDefault = H2O_GLM_Distribution_Selected, Multiple = TRUE, MaxVars = 1))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='H2O_GLM_Link', Label='Link', Choices = NULL, SelectedDefault = H2O_GLM_Link_Selected, Multiple = TRUE, MaxVars = 1))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='H2O_GLM_TweedieLinkPower', Label='Tweedie Link Power', Choices = H2O_GLM_TweedieLinkPower_Choices, SelectedDefault = H2O_GLM_TweedieLinkPower_Selected, Multiple = TRUE, MaxVars = 1))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='H2O_GLM_TweedieVariancePower', Label='Tweedie Var Power', Choices = H2O_GLM_TweedieVariancePower_Choices, SelectedDefault = H2O_GLM_TweedieVariancePower_Selected, Multiple = TRUE, MaxVars = 1))),
                          Quantico:::BlankRow(12L)
                        )),
                      shiny::column(
                        6L,
                        align = 'center',
                        shinydashboard::box(
                          title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='H2O_GLM_eval_metric', Label='Eval Metric', Choices = NULL, SelectedDefault = H2O_GLM_eval_metric_Selected, Multiple = TRUE, MaxVars = 1))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::NumericInput(InputID='H2O_GLM_ClassWeights0', Label='Class Weight for 0', Value = H2O_GLM_ClassWeights0_Selected, Min = 0.01, Max = 1000, Step = 0.01))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::NumericInput(InputID='H2O_GLM_ClassWeights1', Label='Class Weight for 1', Value = H2O_GLM_ClassWeights1_Selected, Min = 0.01, Max = 1000, Step = 0.01))),
                          Quantico:::BlankRow(12L)
                        ))
                    ),

                    Quantico:::BlankRow(12L),
                    Quantico:::BlankRow(12L),
                    Quantico:::BlankRow(12L),
                    Quantico:::BlankRow(12L)))))), # end TagList

          footer = shiny::tagList(
            shiny::modalButton(label = "Cancel"),
            shiny::actionButton("H2O_GLM_OK", "OK", width = '50px'))))
    })
}

#' @title H2O_HGLM_Modal_Fun
#'
#' @description H2O HGLM Parameters Modal with OK button to close
#'
#' @author Adrian Antico
#' @family ML
#'
#' @param id = 'H2O_HGLM_ID'
#' @param AppWidth = 12L
#'
#' @export
H2O_HGLM_Modal_Fun <- function(id,
                               AppWidth=12L,

                               # Reactives
                               H2O_HGLM_TargetColumnName_Selected = NULL,
                               H2O_HGLM_FeatureColNames_Selected = NULL,
                               H2O_HGLM_RandomColNumbers_Selected = NULL,
                               H2O_HGLM_TransformNumericColumns_Selected = NULL,
                               H2O_HGLM_WeightsColumn_Selected = NULL,
                               H2O_HGLM_Distribution_Selected = NULL,
                               H2O_HGLM_Link_Selected = NULL,
                               H2O_HGLM_eval_metric_Selected = NULL,

                               # Statics
                               H2O_HGLM_Runs_Choices = NULL,
                               H2O_HGLM_TargetType_Choices = NULL,
                               H2O_HGLM_data_Choices = NULL,
                               H2O_HGLM_ValidationData_Choices = NULL,
                               H2O_HGLM_TestData_Choices = NULL,
                               H2O_HGLM_EncodeMethod_Choices = NULL,
                               H2O_HGLM_Methods_Choices = NULL,
                               H2O_HGLM_NThreads_Choices = NULL,
                               H2O_HGLM_MaxMem_Choices = NULL,
                               H2O_HGLM_TrainOnFull_Choices = NULL,
                               H2O_HGLM_Solver_Choices = NULL,
                               H2O_HGLM_Alpha_Choices = NULL,
                               H2O_HGLM_Lambda_Choices = NULL,
                               H2O_HGLM_LambdaSearch_Choices = NULL,
                               H2O_HGLM_NLambdas_Choices = NULL,
                               H2O_HGLM_Standardize_Choices = NULL,
                               H2O_HGLM_RemoveCollinearColumns_Choices = NULL,
                               H2O_HGLM_InterceptInclude_Choices = NULL,
                               H2O_HGLM_NonNegativeCoefficients_Choices = NULL,
                               H2O_HGLM_RandomDistribution_Choices = NULL,
                               H2O_HGLM_RandomLink_Choices = NULL,
                               H2O_HGLM_TweedieLinkPower_Choices = NULL,
                               H2O_HGLM_TweedieVariancePower_Choices = NULL,
                               H2O_HGLM_GridTune_Choices = NULL,
                               H2O_HGLM_MaxModelsInGrid_Choices = NULL,

                               # Updaters
                               H2O_HGLM_ModelID_Selected = NULL,
                               H2O_HGLM_Runs_Selected = NULL,
                               H2O_HGLM_TargetType_Selected = NULL,
                               H2O_HGLM_data_Selected = NULL,
                               H2O_HGLM_ValidationData_Selected = NULL,
                               H2O_HGLM_TestData_Selected = NULL,
                               H2O_HGLM_EncodeMethod_Selected = NULL,
                               H2O_HGLM_Methods_Selected = NULL,
                               H2O_HGLM_NThreads_Selected = NULL,
                               H2O_HGLM_MaxMem_Selected = NULL,
                               H2O_HGLM_TrainOnFull_Selected = NULL,
                               H2O_HGLM_Solver_Selected = NULL,
                               H2O_HGLM_Alpha_Selected = NULL,
                               H2O_HGLM_Lambda_Selected = NULL,
                               H2O_HGLM_LambdaSearch_Selected = NULL,
                               H2O_HGLM_NLambdas_Selected = NULL,
                               H2O_HGLM_Standardize_Selected = NULL,
                               H2O_HGLM_RemoveCollinearColumns_Selected = NULL,
                               H2O_HGLM_InterceptInclude_Selected = NULL,
                               H2O_HGLM_NonNegativeCoefficients_Selected = NULL,
                               H2O_HGLM_RandomDistribution_Selected = NULL,
                               H2O_HGLM_RandomLink_Selected = NULL,
                               H2O_HGLM_TweedieLinkPower_Selected = NULL,
                               H2O_HGLM_TweedieVariancePower_Selected = NULL,
                               H2O_HGLM_GridTune_Selected = NULL,
                               H2O_HGLM_MaxModelsInGrid_Selected = NULL,
                               H2O_HGLM_ClassWeights0_Selected = NULL,
                               H2O_HGLM_ClassWeights1_Selected = NULL) {

  shiny::moduleServer(
    id = id,
    module = function(input, output, session) {
      ns <- session$ns
      shiny::showModal(
        shiny::modalDialog(
          title = 'H2O-HGLM Parameters',
          size = "l",
          easyClose = FALSE,
          fade = TRUE,
          shiny::tagList(
            shinydashboard::box(
              title = NULL, solidHeader = TRUE, collapsible = FALSE, status = 'danger', width = AppWidth,

              # Top Box ----
              Quantico::BlankRow(12L),
              shiny::fluidRow(
                shiny::column(
                  width = 12L,
                  align = "right",
                  shinyWidgets::dropdown(
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = "info", width = 12L,
                      shiny::fluidRow(
                        shiny::column(
                          width = 12L,
                          align = "left",
                          shiny::a(name = "h2oglm"),
                          shiny::h1(tags$b("H2O-GLM")),
                          shiny::p("The H2O-GLM ML algorithm is for running heirarchical regression models"),
                          tags$a(shiny::icon("newspaper"), href="https://docs.h2o.ai/h2o/latest-stable/h2o-docs/data-science/glm.html", "H2O-GLM Background Link"),
                        )
                      ),

                      Quantico::BlankRow(12),
                      shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::h3("H2O-GLM Usage"))),
                      Quantico::BlankRow(12),
                      shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::markdown(
                        "
                        ### Data:
                        This is where you define your datasets and variables of interest
                        * Train Data: Only training data for this model type, which is used for regression inference
                        * Select Target: This is your dependent variable that you are looking to predict / model
                        * Select Features: These are your independent variables used to help predict your target variable
                        * TrainOnFull: Select TRUE to train on the full dataset instead of utilizing training, validation, and test datasets. This is typically done when you've found a final set of parameters and are ready to build a final model for production.
                        * Character Encoding: If you have character features in your feature set they will be converted to numeric encodings. You can choose which type in this dropdown
                        * Weights Column: if you want your rows weighted for modeling purposes you'll need to have a column with the weights within them to supply here. A common reason to use weighting is for when you have group variables and some of the levels have lower counts than others. The ML models will tend to emphasize the higher record count when building so if you find bias is your outcome predictions, weighting can help to resolve that
                        * Transform Variables: This is to transform your target variable. There is no need to transform your features (independent variables) as monotonic transformations on features with tree based methods make no difference in outcome
                        * Transform Methods: Choose at least one method. The algorithms will determine which transformation among selected will best normalize your target variable and move forward with that one
                        "
                      ))),
                      Quantico::BlankRow(12),
                      shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::markdown(
                        "
                        ### Hardware:
                        This is where you define your datasets and variables of interest
                        * CPU Threads: Number of CPU threads to utilize for training
                        * Create ModelID: This will attach all model artifacts to a name. If you plan on running multiple models for comparison then set a name to each model to distinguish between then and prevent overwriting an already built model
                        * Max Memory: This will default to total available threads minus 2. CPU is still utilized even when you select GPU. If you have other processes running at the same time as modeling you will want to lower the CPU Threads count to give all processes a chance to keep running and prevent a queue pool from forming (which can slow down all processes)
                        "
                      ))),
                      Quantico::BlankRow(12),
                      shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::markdown(
                        "
                        ### Model:
                        This is where you define the H2O-HGLM parameters
                        * Solver: 'IRSLM' is the default for model interpretation purposes
                        * Alpha: L1 Regularization; defaults to 0 for model interpretation purposes
                        * Lambda: L2 Regularization; defaults to 0 for model interpretation purposes
                        * Standardize: defaults to FALSE for model interpretation purposes
                        * Remove Collinear Columns: defaults to FALSE for model interpretation purposes
                        * Include Intercept: defaults to TRUE for model interpretation purposes
                        * Non Negative Coefficients: defaults to FALSE for model interpretation purposes
                        "
                      ))),
                      Quantico::BlankRow(12),
                      shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::markdown(
                        "
                        ### Grid Tuning:
                        This is where you define parameters for a hyperparameter search
                        * Grid Tune: Set to TRUE to run grid tuning
                        * Max Models: Cap the number of models to test in grid tuning mode
                        "
                      ))),

                      Quantico::BlankRow(12),
                      shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::markdown(
                        "
                        ### Evaluation:
                        This is where you define parameters for a hyperparameter search
                        * Loss Function: The metric to use in training. The specified value also determines the machine learning problem to solve. Some metrics support optional parameters (see the Objectives and metrics section for details on each metric)
                        * Class Weight for 0 Class: For Binary Classification models, you can up- or down-weight each class. The default under the hood is 1 for both
                        * Class Weight for 1 Class: For Binary Classification models, you can up- or down-weight each class. The default under the hood is 1 for both
                        "
                      ))),

                      Quantico::BlankRow(12L),
                      shiny::fluidRow(shiny::column(width = 12L, align = "left", tags$a(target="_blank", shiny::icon("newspaper"), href="https://docs.h2o.ai/h2o/latest-stable/h2o-docs/data-science/glm.html#hierarchical-glm", "H2O HGLM Parameter Docs")))
                    ),
                    size = "lg",
                    icon = shiny::icon("question"),
                    label = NULL,
                    tooltip = FALSE,
                    right = TRUE,
                    up = FALSE,
                    width = NULL,
                    animate = shinyWidgets::animateOptions(
                      enter = "zoomIn",
                      exit = "fadeOutRightBig"
                    ),
                    inputId = NULL,
                    block = FALSE,
                    no_outline = TRUE
                  )
                )
              ),

              Quantico:::BlankRow(12L),
              shiny::fluidRow(

                # Target Type
                shiny::column(
                  width = 3L,
                  align = 'center',
                  Quantico:::SelectizeInput(InputID='H2O_HGLM_TargetType', Label = 'Select Supervised Learning Type', Choices = H2O_HGLM_TargetType_Choices, SelectedDefault = H2O_HGLM_TargetType_Selected, Multiple = TRUE, MaxVars = 1)),
                shiny::column(
                  width = 3L,
                  align = 'center',
                  Quantico:::TextInput(InputID='H2O_HGLM_ModelID', Label='Create Model ID', Value = H2O_HGLM_ModelID_Selected)),
                shiny::column(
                  width = 3L,
                  align = 'center',
                  Quantico:::NumericInput(InputID='H2O_HGLM_Runs', Label = 'Cross Validation Runs', Value = H2O_HGLM_Runs_Selected, Min = 1, Max = 100, Step = 1)),

                # Build Models Button
                shiny::column(
                  width = 3L,
                  shinyjs::useShinyjs(),
                  align = 'center',
                  tags$h3(tags$b('~ Build')),
                  shiny::actionButton(
                    inputId = paste0('BuildModels_H2O_HGLM'),
                    label = paste0('Run'),
                    icon = shiny::icon('chevron-right', lib='font-awesome')
                  )
                )
              ),


              Quantico:::BlankRow(12L)),

            Quantico:::BlankRow(12L),
            Quantico:::BlankRow(12L),

            # Tabs
            shiny::tabsetPanel(
              id = 'H2O_HGLM_TabPanel',
              selected = 'Data',

              # Data ----
              shiny::tabPanel(
                title = "Data",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shinydashboard::box(
                    title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                    Quantico:::BlankRow(12L),
                    shiny::fluidRow(
                      shiny::column(
                        6L,
                        align = 'center',
                        shinydashboard::box(
                          title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='H2O_HGLM_data', Label='Select Training Data', Choices = H2O_HGLM_data_Choices, SelectedDefault = H2O_HGLM_data_Selected, Multiple = TRUE, MaxVars = 1))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::PickerInput(InputID='H2O_HGLM_TargetColumnName', Label='Select Target', Choices = NULL, SelectedDefault = H2O_HGLM_TargetColumnName_Selected, Multiple = TRUE, MaxVars = 1L))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::PickerInput(InputID='H2O_HGLM_FeatureColNames', Label='Select Features', Choices = NULL, SelectedDefault = H2O_HGLM_FeatureColNames_Selected, Multiple = TRUE))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::PickerInput(InputID = 'H2O_HGLM_RandomColNumbers', Label='Random Effects', Choices = NULL, SelectedDefault = H2O_HGLM_RandomColNumbers_Selected, Multiple = TRUE, MaxVars = 1L))),
                          Quantico:::BlankRow(12L)
                        )),

                      shiny::column(
                        6L,
                        align = 'center',
                        shinydashboard::box(
                          title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='H2O_HGLM_TrainOnFull', Label='Train on Full Data', Choices = H2O_HGLM_TrainOnFull_Choices, SelectedDefault = H2O_HGLM_TrainOnFull_Selected, Multiple = TRUE, MaxVars = 1))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::PickerInput(InputID='H2O_HGLM_WeightsColumn', Label='Weights Column', Choices = NULL, SelectedDefault = H2O_HGLM_WeightsColumn_Selected, Multiple = TRUE, MaxVars = 1L))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::PickerInput(InputID='H2O_HGLM_TransformNumericColumns', Label='Transform Columns', Choices = NULL, SelectedDefault = H2O_HGLM_TransformNumericColumns_Selected, Multiple = TRUE))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='H2O_HGLM_Methods', Label='Transform Methods', Choices = H2O_HGLM_Methods_Choices, SelectedDefault = H2O_HGLM_Methods_Selected, Multiple = TRUE, MaxVars = 100))),
                          Quantico:::BlankRow(12L)
                        ))
                    ),


                    Quantico:::BlankRow(12L),
                    Quantico:::BlankRow(12L),
                    Quantico:::BlankRow(12L),
                    Quantico:::BlankRow(12L)))),

              # MetaData Parameters ----
              shiny::tabPanel(
                title = "Hardware",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shinydashboard::box(
                    title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                    Quantico:::BlankRow(12L),

                    shiny::fluidRow(
                      shiny::column(
                        6L,
                        align = 'center',
                        shinydashboard::box(
                          title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::NumericInput(InputID='H2O_HGLM_NThreads', Label='CPU Threads', Value = H2O_HGLM_NThreads_Selected, Min = 1, Max = max(1L, parallel::detectCores() - 2L), Step = 1))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='H2O_HGLM_MaxMem', Label='Task Type', Choices = H2O_HGLM_MaxMem_Choices, SelectedDefault = H2O_HGLM_MaxMem_Selected, Multiple = TRUE, MaxVars = 1))),
                          Quantico:::BlankRow(12L)
                        )
                      )
                    ),

                    Quantico:::BlankRow(12L),
                    Quantico:::BlankRow(12L),
                    Quantico:::BlankRow(12L),
                    Quantico:::BlankRow(12L)))),

              # ML Parameters ----
              shiny::tabPanel(
                title = "Model",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shinydashboard::box(
                    title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                    Quantico:::BlankRow(12L),

                    shiny::fluidRow(
                      shiny::column(
                        6L,
                        align = 'center',
                        shinydashboard::box(
                          title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='H2O_HGLM_Solver', Label='Sovler', Choices = H2O_HGLM_Solver_Choices, SelectedDefault = H2O_HGLM_Solver_Selected, Multiple = TRUE, MaxVars = 1))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='H2O_HGLM_Alpha', Label='Alpha', Choices = H2O_HGLM_Alpha_Choices, SelectedDefault = H2O_HGLM_Alpha_Selected, Multiple = TRUE, MaxVars = 1))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='H2O_HGLM_Lambda', Label='Lambda', Choices = H2O_HGLM_Lambda_Choices, SelectedDefault = H2O_HGLM_Lambda_Selected, Multiple = TRUE, MaxVars = 1))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID = 'H2O_HGLM_RandomDistribution', Label='Random Dist', Choices = H2O_HGLM_RandomDistribution_Choices, SelectedDefault = H2O_HGLM_RandomDistribution_Selected, Multiple = TRUE, MaxVars = 1))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID = 'H2O_HGLM_RandomLink', Label='Random Effects Link', Choices = H2O_HGLM_RandomLink_Choices, SelectedDefault = H2O_HGLM_RandomLink_Selected, Multiple = TRUE, MaxVars = 1))),
                          Quantico:::BlankRow(12L)
                        )),

                      shiny::column(
                        6L,
                        align = 'center',
                        shinydashboard::box(
                          title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='H2O_HGLM_Standardize', Label='Standardize', Choices = H2O_HGLM_Standardize_Choices, SelectedDefault = H2O_HGLM_Standardize_Selected, Multiple = TRUE, MaxVars = 1))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='H2O_HGLM_RemoveCollinearColumns', Label='Remove Collinear Cols', Choices = H2O_HGLM_RemoveCollinearColumns_Choices, SelectedDefault = H2O_HGLM_RemoveCollinearColumns_Selected, Multiple = TRUE, MaxVars = 1))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='H2O_HGLM_InterceptInclude', Label='Include Intercept', Choices = H2O_HGLM_InterceptInclude_Choices, SelectedDefault = H2O_HGLM_InterceptInclude_Selected, Multiple = TRUE, MaxVars = 1))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='H2O_HGLM_NonNegativeCoefficients', Label='Non Negative Coeff', Choices = H2O_HGLM_NonNegativeCoefficients_Choices, SelectedDefault = H2O_HGLM_NonNegativeCoefficients_Selected, Multiple = TRUE, MaxVars = 1))),
                          Quantico:::BlankRow(12L)
                        ))
                    ),

                    Quantico:::BlankRow(12L),
                    Quantico:::BlankRow(12L),
                    Quantico:::BlankRow(12L),
                    Quantico:::BlankRow(12L)))),

              # # Grid Tuning Parameters ----
              # shiny::tabPanel(
              #   title = "Grid Tune",
              #   icon = shiny::icon('code'),
              #   Quantico:::BlankRow(12L),
              #   shiny::fluidRow(
              #     shinydashboard::box(
              #       title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
              #       Quantico:::BlankRow(12L),
              #
              #       shiny::fluidRow(
              #         shiny::column(
              #           6L,
              #           align = 'center',
              #           shinydashboard::box(
              #             title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
              #             Quantico:::BlankRow(12L),
              #             shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='H2O_HGLM_GridTune', Label='Grid Tune', Choices = H2O_HGLM_GridTune_Choices, SelectedDefault = H2O_HGLM_GridTune_Selected, Multiple = TRUE, MaxVars = 1))),
              #             Quantico:::BlankRow(12L),
              #             shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::NumericInput(InputID='H2O_HGLM_MaxModelsInGrid', Label='Max Models', Value = H2O_HGLM_MaxModelsInGrid_Selected, Min = 2, Max = 1000, Step = 1))),
              #             Quantico:::BlankRow(12L)
              #           ))
              #       ),
              #
              #       Quantico:::BlankRow(12L),
              #       Quantico:::BlankRow(12L),
              #       Quantico:::BlankRow(12L),
              #       Quantico:::BlankRow(12L)))),

              # Eval Parameters ----
              shiny::tabPanel(
                title = "Evaluation",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shinydashboard::box(
                    title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                    Quantico:::BlankRow(12L),

                    shiny::fluidRow(
                      # shiny::column(
                      #   6L,
                      #   align = 'center',
                      #   shinydashboard::box(
                      #     title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                      #     Quantico:::BlankRow(12L),
                      #     shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='H2O_HGLM_Distribution', Label='Distribution', Choices = NULL, SelectedDefault = H2O_HGLM_Distribution_Selected, Multiple = TRUE, MaxVars = 1))),
                      #     Quantico:::BlankRow(12L),
                      #     shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='H2O_HGLM_Link', Label='Link', Choices = NULL, SelectedDefault = H2O_HGLM_Link_Selected, Multiple = TRUE, MaxVars = 1))),
                      #     Quantico:::BlankRow(12L),
                      #     shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='H2O_HGLM_TweedieLinkPower', Label='Tweedie Link Power', Choices = H2O_HGLM_TweedieLinkPower_Choices, SelectedDefault = H2O_HGLM_TweedieLinkPower_Selected, Multiple = TRUE, MaxVars = 1))),
                      #     Quantico:::BlankRow(12L),
                      #     shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='H2O_HGLM_TweedieVariancePower', Label='Tweedie Var Power', Choices = H2O_HGLM_TweedieVariancePower_Choices, SelectedDefault = H2O_HGLM_TweedieVariancePower_Selected, Multiple = TRUE, MaxVars = 1))),
                      #     Quantico:::BlankRow(12L)
                      #   )),
                      shiny::column(
                        6L,
                        align = 'center',
                        shinydashboard::box(
                          title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='H2O_HGLM_eval_metric', Label='Eval Metric', Choices = NULL, SelectedDefault = H2O_HGLM_eval_metric_Selected, Multiple = TRUE, MaxVars = 1))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::NumericInput(InputID='H2O_HGLM_ClassWeights0', Label='Class Weight for 0', Value = H2O_HGLM_ClassWeights0_Selected, Min = 0.01, Max = 1000, Step = 0.01))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::NumericInput(InputID='H2O_HGLM_ClassWeights1', Label='Class Weight for 1', Value = H2O_HGLM_ClassWeights1_Selected, Min = 0.01, Max = 1000, Step = 0.01))),
                          Quantico:::BlankRow(12L)
                        ))
                    ),

                    Quantico:::BlankRow(12L),
                    Quantico:::BlankRow(12L),
                    Quantico:::BlankRow(12L),
                    Quantico:::BlankRow(12L)))))), # end TagList

          footer = shiny::tagList(
            shiny::modalButton(label = "Cancel"),
            shiny::actionButton("H2O_HGLM_OK", "OK", width = '50px'))))
    })
}

#' @title CausalMediation_Modal_Fun
#'
#' @description Causal Mediation Parameters Modal with OK button to close
#'
#' @author Adrian Antico
#' @family ML
#'
#' @param id = 'CausalMediation_ID'
#' @param AppWidth = 12L
#'
#' @export
CausalMediation_Modal_Fun <- function(id,
                                      AppWidth=12L,

                                      # Reactives
                                      CausalMediation_OutcomeTargetVariable_Selected = NULL,
                                      CausalMediation_TreatmentVariable_Selected = NULL,
                                      CausalMediation_MediatorVariable_Selected = NULL,
                                      CausalMediation_SurvivalEventVariable_Selected = NULL,
                                      CausalMediation_Covariates_Selected = NULL,
                                      CausalMediation_OM_MediatorCovariates_Selected = NULL,
                                      CausalMediation_OM_TreatmentCovariates_Selected = NULL,
                                      CausalMediation_MM_TreatmentCovariates_Selected = NULL,

                                      # Statics
                                      CausalMediation_data_Choices = NULL,
                                      CausalMediation_OutcomeTargetType_Choices = NULL,
                                      CausalMediation_MediatorTargetType_Choices = NULL,
                                      CausalMediation_TreatmentMediatorInteraction_Choices = NULL,
                                      CausalMediation_RemoveNA_Choices = NULL,
                                      CausalMediation_CaseControlSourceData_Choices = NULL,
                                      CausalMediation_Treated_ReferenceIndicator_Choices = NULL,
                                      CausalMediation_UnTreated_ReferenceIndicator_Choices = NULL,
                                      CausalMediation_Mediator_ControlDirectEffectLevel_Choices = NULL,
                                      CausalMediation_Covariate_NaturalDirectIndirect_Choices = NULL,

                                      # Updaters
                                      CausalMediation_data_Selected = NULL,
                                      CausalMediation_OutcomeTargetType_Selected = NULL,
                                      CausalMediation_MediatorTargetType_Selected = NULL,
                                      CausalMediation_TreatmentMediatorInteraction_Selected = NULL,
                                      CausalMediation_RemoveNA_Selected = NULL,
                                      CausalMediation_CaseControlSourceData_Selected = NULL,
                                      CausalMediation_Treated_ReferenceIndicator_Selected = NULL,
                                      CausalMediation_UnTreated_ReferenceIndicator_Selected = NULL,
                                      CausalMediation_Mediator_ControlDirectEffectLevel_Selected = NULL,
                                      CausalMediation_Covariate_NaturalDirectIndirect_Selected = NULL) {

  shiny::moduleServer(
    id = id,
    module = function(input, output, session) {
      ns <- session$ns
      shiny::showModal(
        shiny::modalDialog(
          title = 'Causal Mediation Parameters',
          size = "l",
          easyClose = FALSE,
          fade = TRUE,
          shiny::tagList(
            shinydashboard::box(
              title = NULL, solidHeader = TRUE, collapsible = FALSE, status = 'danger', width = AppWidth,

              Quantico::BlankRow(12L),
              shiny::fluidRow(
                shiny::column(
                  width = 12L,
                  align = "right",
                  shinyWidgets::dropdown(
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = "info", width = 12L,
                      shiny::fluidRow(
                        shiny::column(
                          width = 12L,
                          align = "left",
                          shiny::a(name = "causalmediation"),
                          shiny::h1(tags$b("Causal Mediation")),
                          shiny::p("The Causal Mediation algorithm is for generating causing inference for
                           regression, classification, and survival models."),
                          tags$a(target="_blank", shiny::icon("newspaper"), href="https://cran.r-project.org/web/packages/regmedint/index.html", "Causal Mediation Background Link"),
                        )
                      ),

                      Quantico::BlankRow(12),
                      shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::h3("Causal Mediation Usage"))),
                      Quantico::BlankRow(12),
                      shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::markdown(
                        "
                        ### Variables:
                        This is where you define your variables for causal meditation
                        * Choose data set: This is your training dataset
                        * Outcome Target: regmedint yvar; Outcome variable name. If you're utilizing a survival model this should be the time variable for the survival outcome models
                        * Treatment Variable: regmedint avar; Treatment variable name
                        * Mediator Variable: regmedint mvar; Mediator variable name
                        * Survival Event Variable: regmedint eventvar; Only required for survival outcome regression models. Note that the coding is 1 for event and 0 for censoring, following the R survival package convention
                        * Outcome Target Covariates: regmedint cvar; Covariate names (features / independent variables / confounders)
                        * Outcome Treatment Covariates: Treatment & Covariates interaction variables for the treatment model
                        * Mediation Treatment Covariates: Treatment & Covariates interaction variables for the mediation model
                        * Outcome Mediator Covariates: Treatment & Covariates interaction variables for the outcome model
                        * Treatment Mediator Interaction: regmedint interaction; logical indicating the presense of a treatment & mediator interaction term in the outcome model
                        * Case Control Data: If the data comes from a case-control study then set this to TRUE
                        "
                      ))),
                      Quantico::BlankRow(12),
                      shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::markdown(
                        "
                        ### Evaluation Values:
                        This is where you define your covariate values that you want evaluated
                        * Mediation Untreated Value: a0; The reference level of treatment variable that is considered 'untreated' or 'unexposed'
                        * Remove NA's
                        * Mediation Treated Value: a1; The reference level of treatment variable that is considered 'treated' or 'exposed'
                        * Mediator Control Direct Level: m_cde; Mediator level at which controlled direct effect is evaluated at
                        * Natural Direct Effect: c_cond; One value for each cvar. Covariate levels at which natural direct and indirect effects are evaluated at
                        "
                      ))),
                      Quantico::BlankRow(12),
                      shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::markdown(
                        "
                        ### Model Types:
                        This is where you define your model types
                        * Outcome Target Type: regmedint yreg; Choose from
                          * 'linear'
                          * 'logistic'
                          * 'loglinear'
                          * 'poisson'
                          * 'negbin'
                          * 'survCox'
                          * 'survAFT_exp'
                          * 'survAFT_weibull'
                        * Mediator Target Type: regmedint mreg; Choose from
                          * 'linear'
                          * 'logistic'
                        "
                      ))),
                      Quantico::BlankRow(12L),
                      shiny::fluidRow(shiny::column(12L, align = "left", shiny::tags$img(src = "https://github.com/AdrianAntico/prettydoc/blob/main/Images/CausalMediationData.PNG?raw=true", alt = "Quantico", `data-view-component` = "true", height="100%", width="100%"))),
                      Quantico::BlankRow(12L),
                      shiny::fluidRow(shiny::column(12L, align = "left", shiny::markdown(
                        "
                        ## Example Data Columns:

                        ### Variables:
                        * Outcome Target = 'y'
                        * Treatment Variable = 'x'
                        * Mediator Variable = 'm'
                        * Outcome Target Covariates = 'c'
                        * Survival Event Variable = 'event'
                        * Treatment Mediator Interaction = TRUE
                        * Case Control Data = FALSE

                        ### Evaluation Values:
                        * Mediation Untreated Value = 0
                        * Mediation Treated Value = 1
                        * Mediator Control Direct Level = 1
                        * Natural Direct Effect = 0.5

                        ### Model Types:
                        * Mediator Target Type = 'logistic'
                        * Outcome Target Type = 'survAFT_weibull'"
                      ))),

                      Quantico::BlankRow(12L),
                      shiny::fluidRow(shiny::column(width = 12L, align = "left", tags$a(target="_blank", shiny::icon("newspaper"), href="https://www.hsph.harvard.edu/tyler-vanderweele/tools-and-tutorials/", "Causal Mediation Background Learning")))
                    ),
                    size = "lg",
                    icon = shiny::icon("question"),
                    label = NULL,
                    tooltip = FALSE,
                    right = TRUE,
                    up = FALSE,
                    width = NULL,
                    animate = shinyWidgets::animateOptions(
                      enter = "zoomIn",
                      exit = "fadeOutRightBig"
                    ),
                    inputId = NULL,
                    block = FALSE,
                    no_outline = TRUE
                  )
                )
              ),

              Quantico:::BlankRow(12L),
              shiny::fluidRow(

                # Data
                shiny::column(
                  width = 4L,
                  align = 'center',
                  Quantico:::SelectizeInput(InputID='CausalMediation_data', Label='Choose data set', Choices = CausalMediation_data_Choices, SelectedDefault = CausalMediation_data_Selected, Multiple = TRUE, MaxVars = 100)),

                # Build Button
                shiny::column(
                  width = 4L,
                  shinyjs::useShinyjs(),
                  align = 'center',
                  tags$h3(tags$b('~ Build')),
                  shiny::actionButton(
                    inputId = paste0('BuildModels_CausalMediation'),
                    label = paste0('Run'),
                    icon = shiny::icon('chevron-right', lib='font-awesome')))
              ),
              Quantico:::BlankRow(12L)
            ),

            Quantico:::BlankRow(12L),
            Quantico:::BlankRow(12L),

            # Tabs
            shiny::tabsetPanel(
              id = 'CausalMediation_TabPanel',
              selected = 'Model Variables',

              # Standard Plots
              shiny::tabPanel(
                title = "Model Variables",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shinydashboard::box(
                    title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                    Quantico:::BlankRow(12L),

                    shiny::fluidRow(
                      shiny::column(
                        6L,
                        align = 'center',
                        shinydashboard::box(
                          title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::PickerInput(InputID='CausalMediation_OutcomeTargetVariable', Label='Outcome Target', Choices = NULL, SelectedDefault = CausalMediation_OutcomeTargetVariable_Selected, Multiple = TRUE, MaxVars = 1L))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::PickerInput(InputID='CausalMediation_TreatmentVariable', Label='Treatment Variable', Choices = NULL, SelectedDefault = CausalMediation_TreatmentVariable_Selected, Multiple = TRUE, MaxVars = 1L))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::PickerInput(InputID='CausalMediation_MediatorVariable', Label='Mediator Variable', Choices = NULL, SelectedDefault = CausalMediation_MediatorVariable_Selected, Multiple = TRUE, MaxVars = 1L))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::PickerInput(InputID='CausalMediation_SurvivalEventVariable', Label='Survival Event Variable', Choices = NULL, SelectedDefault = CausalMediation_SurvivalEventVariable_Selected, Multiple = TRUE))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::PickerInput(InputID='CausalMediation_Covariates', Label='Outcome Target Covariates', Choices = NULL, SelectedDefault = CausalMediation_Covariates_Selected, Multiple = TRUE))),

                        )),

                      shiny::column(
                        6L,
                        align = 'center',
                        shinydashboard::box(
                          title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::PickerInput(InputID='CausalMediation_TreatmentMediatorInteraction', Label='Treatment Mediator Interaction', Choices = CausalMediation_TreatmentMediatorInteraction_Choices, SelectedDefault = CausalMediation_TreatmentMediatorInteraction_Selected, Multiple = TRUE))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::PickerInput(InputID='CausalMediation_OM_TreatmentCovariates', Label='Outcome Treatment Covariates', Choices = NULL, SelectedDefault = CausalMediation_OM_TreatmentCovariates_Selected, Multiple = TRUE))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::PickerInput(InputID='CausalMediation_MM_TreatmentCovariates', Label='Mediation Treatment Covariates', Choices = NULL, SelectedDefault = CausalMediation_MM_TreatmentCovariates_Selected, Multiple = TRUE))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::PickerInput(InputID='CausalMediation_OM_MediatorCovariates', Label='Outcome Mediator Covariates', Choices = NULL, SelectedDefault = CausalMediation_OM_MediatorCovariates_Selected, Multiple = TRUE))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='CausalMediation_CaseControlSourceData', Label='Case Control Data', Choices = CausalMediation_CaseControlSourceData_Choices, SelectedDefault = CausalMediation_CaseControlSourceData_Selected, Multiple = TRUE, MaxVars = 100))),
                          Quantico:::BlankRow(12L)
                        )
                      )
                    ),

                    Quantico:::BlankRow(12L),
                    Quantico:::BlankRow(12L),
                    Quantico:::BlankRow(12L),
                    Quantico:::BlankRow(12L)
                  )
                )
              ),

              # Evaluation Values
              shiny::tabPanel(
                title = "Evaluation Values",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shinydashboard::box(
                    title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                    Quantico:::BlankRow(12L),
                    shiny::fluidRow(
                      shiny::column(
                        6L,
                        align = 'center',
                        shinydashboard::box(
                          title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='CausalMediation_Treated_ReferenceIndicator', Label='Mediation Treated Value', Choices = CausalMediation_Treated_ReferenceIndicator_Choices, SelectedDefault = CausalMediation_Treated_ReferenceIndicator_Selected, Multiple = TRUE))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='CausalMediation_RemoveNA', Label="Remove NA's", Choices = CausalMediation_RemoveNA_Choices, SelectedDefault = CausalMediation_RemoveNA_Selected, Multiple = TRUE, MaxVars = 1))),
                          Quantico:::BlankRow(12L)
                        )
                      )
                    ),

                    shiny::fluidRow(
                      shiny::column(
                        6L,
                        align = 'center',
                        shinydashboard::box(
                          title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='CausalMediation_UnTreated_ReferenceIndicator', Label='Mediation Untreated Value', Choices = CausalMediation_UnTreated_ReferenceIndicator_Choices, SelectedDefault = CausalMediation_UnTreated_ReferenceIndicator_Selected, Multiple = TRUE))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='CausalMediation_Mediator_ControlDirectEffectLevel', Label='Mediator Control Direct Level', Choices = CausalMediation_Mediator_ControlDirectEffectLevel_Choices, SelectedDefault = CausalMediation_Mediator_ControlDirectEffectLevel_Selected, Multiple = TRUE, MaxVars = 1))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='CausalMediation_Covariate_NaturalDirectIndirect', Label='Natural Direct Effect', Choices = CausalMediation_Covariate_NaturalDirectIndirect_Choices, SelectedDefault = CausalMediation_Covariate_NaturalDirectIndirect_Selected, Multiple = TRUE, MaxVars = 1))),
                          Quantico:::BlankRow(12L)
                        )
                      )
                    ),

                    Quantico:::BlankRow(12L),
                    Quantico:::BlankRow(12L),
                    Quantico:::BlankRow(12L),
                    Quantico:::BlankRow(12L)
                  )
                )
              ),

              # Model Types
              shiny::tabPanel(
                title = "Model Types",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shinydashboard::box(
                    title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                    Quantico:::BlankRow(12L),
                    shiny::fluidRow(
                      shiny::column(
                        6L,
                        align = 'center',
                        shinydashboard::box(
                          title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::PickerInput(InputID='CausalMediation_OutcomeTargetType', Label='Outcome Target Type', Choices = CausalMediation_OutcomeTargetType_Choices, SelectedDefault = CausalMediation_OutcomeTargetType_Selected, Multiple = TRUE, MaxVars = 1L))),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID='CausalMediation_MediatorTargetType', Label='Mediator Target Type', Choices = CausalMediation_MediatorTargetType_Choices, SelectedDefault = CausalMediation_MediatorTargetType_Selected, Multiple = TRUE, MaxVars = 1)))
                        )
                      )
                    ),

                    Quantico:::BlankRow(12L),
                    Quantico:::BlankRow(12L),
                    Quantico:::BlankRow(12L),
                    Quantico:::BlankRow(12L)
                  )
                )
              ),

              # Additional Specs
              shiny::tabPanel(
                title = "Additional Specs",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shinydashboard::box(
                    title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,

                    Quantico:::BlankRow(12L)
                  )
                )
              )
            )
          ), # end TagList

          footer = shiny::tagList(
            shiny::modalButton(label = "Cancel"),
            shiny::actionButton("CausalMediation_OK", "OK", width = '50px'))))
    })
}

# ----

# ----

# @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ ----
# ::  ML Scoring  ::                                                                                             ----
# @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ ----
MLScoring_Modal_Fun <- function(id = 'ScoreMLID',
                                AppWidth=12L,

                                # Statics
                                ScoreML_Model_Choices = NULL,
                                ScoreML_Data_Choices = NULL,
                                ScoreML_ReturnFeatures_Choices = NULL,
                                ScoreML_ReturnShapVals_Choices = NULL,

                                # Updaters
                                ScoreML_Model_Selected = NULL,
                                ScoreML_Data_Selected = NULL,
                                ScoreML_ReturnFeatures_Selected = NULL,
                                ScoreML_ReturnShapVals_Selected = NULL) {

  shiny::moduleServer(
    id = id,
    module = function(input, output, session) {
      ns <- session$ns
      shiny::showModal(
        shiny::modalDialog(
          title = 'ML Scoring',
          size = "l",
          easyClose = FALSE,
          fade = TRUE,
          shiny::tagList(
            Quantico:::BlankRow(12L),
            shiny::fluidRow(
              shinydashboard::box(
                title = NULL, solidHeader = TRUE, collapsible = FALSE, status = 'danger', width = 12L,
                Quantico:::BlankRow(12L),

                shiny::fluidRow(
                  shiny::column(
                    width = 3L, align = 'center',
                    Quantico::SelectizeInput(InputID = 'ScoreML_Model', Label = 'Select Model', Choices = ScoreML_Model_Choices, SelectedDefault = ScoreML_Model_Selected, Multiple = FALSE)
                  ),
                  shiny::column(
                    width = 3L, align = 'center',
                    Quantico::SelectizeInput(InputID = 'ScoreML_Data', Label = 'Select Data', Choices = ScoreML_Data_Choices, SelectedDefault = ScoreML_Data_Selected)
                  ),
                  shiny::column(
                    width = 2L, align = 'center',
                    Quantico::SelectizeInput(InputID = 'ScoreML_ReturnFeatures', Label = 'Return Features', Choices = ScoreML_ReturnFeatures_Choices, SelectedDefault = ScoreML_ReturnFeatures_Selected, Multiple = FALSE)
                  ),
                  shiny::column(
                    width = 2L, align = 'center',
                    Quantico::SelectizeInput(InputID = 'ScoreML_ReturnShapVals', Label = 'Return Shap Vals', Choices = ScoreML_ReturnShapVals_Choices, SelectedDefault = ScoreML_ReturnShapVals_Selected, Multiple = FALSE)
                  ),

                  # Build Models Button
                  shiny::column(
                    width = 2L,
                    shinyjs::useShinyjs(),
                    align = 'center',
                    tags$h3(tags$b('~ Build')),
                    shiny::actionButton(
                      inputId = paste0('ScoreML_Run'),
                      label = paste0('Run'),
                      icon = shiny::icon('chevron-right', lib='font-awesome'))
                  )
                ),

                Quantico:::BlankRow(12L),
                Quantico:::BlankRow(12L)

              ) # box
            ) # fluidRow
          ), # tagList

          footer = shiny::tagList(
            shiny::modalButton(label = "Cancel"),
            shiny::actionButton("ScoreML_OK", "OK", width = '50px'))))
    })
}

# ----

# ----

# @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ ----
# ::  Inference  ::                                                                                              ----
# @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ ----

#' @title Normality_Modal_Fun
#'
#' @description Inference operations
#'
#' @author Adrian Antico
#' @family Inference
#'
#' @param id = 'Normality_Modal_Fun'
#' @param AppWidth = 12L
#'
#' @export
Normality_Modal_Fun <- function(id,
                                AppWidth=12L,

                                # Reactives
                                Normality_YVars_Selected = NULL,

                                # Statics
                                Normality_SelectData_Choices = NULL,

                                # Updaters
                                Normality_SelectData_Selected = NULL,
                                Normality_InferenceID_Selected = NULL,
                                SampleSize.ADT_Selected = NULL,
                                Samples.ADT_Selected = NULL,
                                SampleSize.CVMT_Selected = NULL,
                                Samples.CVMT_Selected = NULL,
                                SampleSize.KST_Selected = NULL,
                                Samples.KST_Selected = NULL,
                                SampleSize.ST_Selected = NULL,
                                Samples.ST_Selected = NULL,
                                SampleSize.JBT_Selected = NULL,
                                Samples.JBT_Selected = NULL,
                                SampleSize.AT_Selected = NULL,
                                Samples.AT_Selected = NULL) {

  shiny::moduleServer(
    id = id,
    module = function(input, output, session) {
      ns <- session$ns
      shiny::showModal(
        shiny::modalDialog(
          title = 'Normality Testing',
          size = "l",
          easyClose = FALSE,
          fade = TRUE,
          shiny::tagList(

            Quantico:::BlankRow(12L),

            # Tabs
            shiny::tabsetPanel(
              id = 'Normality_TabPanel',
              selected = 'Normality Tests',

              # Normality Tests ----
              shiny::tabPanel(
                title = "Normality Tests",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  style = ModelHelpFormat,
                  Quantico:::BlankRow(12L),
                  shiny::fluidRow(
                    shiny::column(
                      width = 3L,
                      tags$h4(tags$span(tags$b(paste0('Normality Tests'))))
                    ),
                    shiny::column(
                      width = 8L,
                      align = "right",
                      shinyWidgets::dropdown(
                        shinydashboard::box(
                          title = NULL, solidHeader = TRUE, collapsible = FALSE, status = "info", width = 12L,
                          shiny::fluidRow(
                            shiny::column(
                              width = 12L,
                              align = "left",
                              shiny::h1(tags$b("Normality Tests")),
                              shiny::p("The Normality Tests operation runs through six different normality tests
                                        and compiles the metrics and generates a few plots to help visualize the
                                        results.")
                            )
                          ),

                          Quantico::BlankRow(12),
                          shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::h3("Normality Tests Usage"))),
                          shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::markdown(
                            "
                              Normality Tests operation runs through six different normality tests. If Samples_ are greater than one then the metrics reported are the average of the metrics generated.
                              * Choose data set: This is the dataset you want to utilize for the operation
                              * YVars: select the variables you want tested
                              * SampleSize.ADT Sample size for the Anderson Darling Test
                              * Samples.ADT Bootstrap samples for the Anderson Darling Test
                              * SampleSize.CVMT Sample size for the Cramer Von Mises Test
                              * Samples.CVMT Bootstrap samples for the Cramer Von Mises Test
                              * SampleSize.KST Sample size for the Kolmogorov Smirnov Test
                              * Samples.KST Bootstrap samples for the Kolmogorov Smirnov Test
                              * SampleSize.ST Sample size for the Shapiro Test
                              * Samples.ST Bootstrap samples for the Shapiro Test
                              * SampleSize.JBT Sample size for the Jarque Bera Test
                              * Samples.JBT Bootstrap samples for the Jarque Bera Test
                              * SampleSize.AT Sample size for the Agostino Test
                              * Samples.AT Bootstrap samples for the Agostino Test
                              "
                          )))
                        ),
                        size = "lg",
                        icon = shiny::icon("question"),
                        label = NULL,
                        tooltip = FALSE,
                        right = TRUE,
                        up = FALSE,
                        width = NULL,
                        animate = shinyWidgets::animateOptions(
                          enter = "zoomIn",
                          exit = "fadeOutRightBig"
                        ),
                        inputId = NULL,
                        block = FALSE,
                        no_outline = TRUE
                      )
                    ),

                    # Normality Tests Button
                    shiny::column(
                      width = 1L, align = 'right',
                      style = "padding-top: 4px;padding-right: 50px;",
                      shiny::actionButton(
                        inputId = 'Inference_Normality_Execute',
                        label = 'Run',
                        icon = shiny::icon('chevron-right', lib='font-awesome')
                      )
                    )
                  ),

                  Quantico:::BlankRow(12L),
                  shiny::fluidRow(
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = "danger", width = 12L,
                      Quantico::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(
                          4L, align = "center",
                          Quantico:::SelectizeInput(InputID='Normality_SelectData', Label='Choose data set', Choices = Normality_SelectData_Choices, SelectedDefault = Normality_SelectData_Selected, Multiple = TRUE, MaxVars = 1)),
                        shiny::column(
                          4L, align = "center",
                          Quantico:::PickerInput(InputID='Normality_YVars', Label='Variables', Choices = NULL, SelectedDefault = Normality_YVars_Selected, Multiple = TRUE, MaxVars = 100L)
                        ),
                        shiny::column(
                          4L, align = "center",
                          Quantico:::TextInput(InputID='Normality_InferenceID', Label='Inference ID', Value = Normality_InferenceID_Selected, Placeholder = "INF_Normality")
                        )
                      )
                    )
                  ),

                  Quantico::BlankRow(12L),
                  shiny::fluidRow(
                    shiny::column(
                      6L, align = "center",
                      shinydashboard::box(
                        title = NULL, solidHeader = TRUE, collapsible = FALSE, status = "danger", width = 12L,
                        Quantico::BlankRow(12L),
                        shiny::fluidRow(
                          shiny::column(
                            6L,
                            Quantico:::NumericInput(InputID='SampleSize.ADT', Label='ADT Sample Size', Value = SampleSize.ADT_Selected, Min = 8, Max = 1000000, Step = 100)
                          ),
                          shiny::column(
                            6L,
                            Quantico:::NumericInput(InputID='Samples.ADT', Label='ADT Iterations', Value = Samples.ADT_Selected, Min = 1, Max = 1000, Step = 1)
                          )
                        ),
                        Quantico::BlankRow(12L),
                        shiny::fluidRow(
                          shiny::column(
                            6L,
                            Quantico:::NumericInput(InputID='SampleSize.CVMT', Label='CVMT Sample Size',  Value = SampleSize.CVMT_Selected, Min = 8, Max = 1000000, Step = 100)
                          ),
                          shiny::column(
                            6L,
                            Quantico:::NumericInput(InputID='Samples.CVMT', Label='CVMT Iterations',  Value = Samples.CVMT_Selected, Min = 1, Max = 1000, Step = 1)
                          )
                        ),
                        Quantico::BlankRow(12L),
                        shiny::fluidRow(
                          shiny::column(
                            6L,
                            Quantico:::NumericInput(InputID='SampleSize.KST', Label='KST Sample Size', Value = SampleSize.KST_Selected, Min = 8, Max = 1000000, Step = 100)
                          ),
                          shiny::column(
                            6L,
                            Quantico:::NumericInput(InputID='Samples.KST', Label='KST Iterations', Value = Samples.KST_Selected, Min = 1, Max = 1000, Step = 1)
                          )
                        ),
                        Quantico::BlankRow(12L)
                      )
                    ),

                    shiny::column(
                      6L, align = "center",
                      shinydashboard::box(
                        title = NULL, solidHeader = TRUE, collapsible = FALSE, status = "danger", width = 12L,
                        Quantico::BlankRow(12L),
                        shiny::fluidRow(
                          shiny::column(
                            6L,
                            Quantico:::NumericInput(InputID='SampleSize.ST', Label='ST Sample Size', Value = SampleSize.ST_Selected, Min = 8, Max = 5000, Step = 100)
                          ),
                          shiny::column(
                            6L,
                            Quantico:::NumericInput(InputID='Samples.ST', Label='ST Iterations', Value = Samples.ST_Selected, Min = 1, Max = 1000, Step = 1)
                          )
                        ),
                        Quantico::BlankRow(12L),
                        shiny::fluidRow(
                          shiny::column(
                            6L,
                            Quantico:::NumericInput(InputID='SampleSize.JBT', Label='JBT Sample Size',  Value = SampleSize.JBT_Selected, Min = 8, Max = 1000000, Step = 100)
                          ),
                          shiny::column(
                            6L,
                            Quantico:::NumericInput(InputID='Samples.JBT', Label='JBT Iterations',  Value = Samples.JBT_Selected, Min = 1, Max = 1000, Step = 1)
                          )
                        ),
                        Quantico::BlankRow(12L),
                        shiny::fluidRow(
                          shiny::column(
                            6L,
                            Quantico:::NumericInput(InputID='SampleSize.AT', Label='AT Sample Size', Value = SampleSize.AT_Selected, Min = 8, Max = 46340, Step = 100)
                          ),
                          shiny::column(
                            6L,
                            Quantico:::NumericInput(InputID='Samples.AT', Label='AT Iterations', Value = Samples.AT_Selected, Min = 1, Max = 1000, Step = 1)
                          )
                        ),
                        Quantico::BlankRow(12L)
                      )
                    )
                  ),

                  # Blank space
                  Quantico:::BlankRow(12L),
                  Quantico:::BlankRow(12L),
                  Quantico:::BlankRow(12L),
                  Quantico:::BlankRow(12L),
                  Quantico:::BlankRow(12L)
                )
              )
            ) # end Tab Panel Main
          ), # end TagList

          footer = shiny::tagList(
            shiny::modalButton(label = "Cancel"),
            shiny::actionButton("Normality_OK", "OK", width = '50px'))))

    })
}

#' @title Correlation_Modal_Fun
#'
#' @description Inference operations
#'
#' @author Adrian Antico
#' @family Inference
#'
#' @param id = 'Correlation_Modal_Fun'
#' @param AppWidth = 12L
#'
#' @export
Correlation_Modal_Fun <- function(id = "Inference_CorrelationID",
                                  AppWidth=12L,

                                  # Reactives
                                  Correlation_CorrVars_Selected = NULL,
                                  Correlation_DateVar_Selected = NULL,

                                  # Statics
                                  Correlation_SelectData_Choices = NULL,
                                  Correlation_P_Adjust_Choices = NULL,
                                  Correlation_Bayesian_Choices = NULL,
                                  Correlation_Bayesian_Prior_Choices = NULL,
                                  Correlation_MultiLevel_Choices = NULL,
                                  Correlation_Include_Factors_Choices = NULL,
                                  Correlation_Partial_Choices = NULL,
                                  Correlation_Partial_Bayesian_Choices = NULL,

                                  # Updaters
                                  Correlation_SelectData_Selected = NULL,
                                  Correlation_InferenceID_Selected = NULL,
                                  Correlation_SampleSize_Selected = NULL,
                                  Correlation_P_Adjust_Selected = NULL,
                                  Correlation_Bayesian_Selected = NULL,
                                  Correlation_Bayesian_Prior_Selected = NULL,
                                  Correlation_MultiLevel_Selected = NULL,
                                  Correlation_Include_Factors_Selected = NULL,
                                  Correlation_Partial_Selected = NULL,
                                  Correlation_Partial_Bayesian_Selected = NULL) {

  shiny::moduleServer(
    id = id,
    module = function(input, output, session) {
      ns <- session$ns
      shiny::showModal(
        shiny::modalDialog(
          title = 'Correlation Testing',
          size = "l",
          easyClose = FALSE,
          fade = TRUE,
          shiny::tagList(

            Quantico:::BlankRow(12L),

            # Tabs
            shiny::tabsetPanel(
              id = 'Correlation_TabPanel',
              selected = 'Correlation Tests',

              # Correlation Tests ----
              shiny::tabPanel(
                title = "Correlation Tests",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  style = ModelHelpFormat,
                  Quantico:::BlankRow(12L),
                  shiny::fluidRow(
                    shiny::column(
                      width = 3L,
                      tags$h4(tags$span(tags$b(paste0('Correlation Tests'))))
                    ),
                    shiny::column(
                      width = 8L,
                      align = "right",
                      shinyWidgets::dropdown(
                        shinydashboard::box(
                          title = NULL, solidHeader = TRUE, collapsible = FALSE, status = "info", width = 12L,
                          shiny::fluidRow(
                            shiny::column(
                              width = 12L,
                              align = "left",
                              shiny::h1(tags$b("Correlation Tests")),
                              shiny::p("Correlation Tests operation generates correlations, confidence intervals, statistics for evaluation, and plots for inspection.")
                            )
                          ),

                          Quantico::BlankRow(12),
                          shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::h3("Correlation Tests Usage"))),
                          shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::markdown(
                            "
                              Correlation Tests operation generates correlations, confidence intervals, statistics for evaluation, and plots for inspection.
                              * Choose data set: This is the dataset you want to utilize for the operation
                              * CorrVars: select the variables you want tested
                              "
                          )))
                        ),
                        size = "lg",
                        icon = shiny::icon("question"),
                        label = NULL,
                        tooltip = FALSE,
                        right = TRUE,
                        up = FALSE,
                        width = NULL,
                        animate = shinyWidgets::animateOptions(
                          enter = "zoomIn",
                          exit = "fadeOutRightBig"
                        ),
                        inputId = NULL,
                        block = FALSE,
                        no_outline = TRUE
                      )
                    ),

                    # Correlation Tests Button
                    shiny::column(
                      width = 1L, align = 'right',
                      style = "padding-top: 4px;padding-right: 50px;",
                      shiny::actionButton(
                        inputId = 'Inference_Correlation_Execute',
                        label = 'Run',
                        icon = shiny::icon('chevron-right', lib='font-awesome')
                      )
                    )
                  ),

                  Quantico:::BlankRow(12L),
                  shiny::fluidRow(
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = "danger", width = 12L,
                      Quantico::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(
                          3L, align = "center",
                          Quantico:::SelectizeInput(InputID='Correlation_SelectData', Label='Choose data set', Choices = Correlation_SelectData_Choices, SelectedDefault = Correlation_SelectData_Selected, Multiple = TRUE, MaxVars = 1)
                        ),
                        shiny::column(
                          3L, align = "center",
                          Quantico:::PickerInput(InputID='Correlation_CorrVars', Label='Variables', Choices = NULL, SelectedDefault = Correlation_CorrVars_Selected, Multiple = TRUE, MaxVars = 100L)
                        ),
                        shiny::column(
                          3L, align = "center",
                          Quantico:::PickerInput(InputID='Correlation_DateVar', Label='Date Variable', Choices = NULL, SelectedDefault = Correlation_DateVar_Selected, Multiple = TRUE, MaxVars = 100L)
                        ),
                        shiny::column(
                          3L, align = "center",
                          Quantico:::TextInput(InputID='Correlation_InferenceID', Label='Inference ID', Value = Correlation_InferenceID_Selected, Placeholder = "INF_Correlation")
                        )
                      )
                    )
                  ),

                  Quantico::BlankRow(12L),
                  shiny::fluidRow(
                    shiny::column(
                      12L, align = "center",
                      shinydashboard::box(
                        title = NULL, solidHeader = TRUE, collapsible = FALSE, status = "danger", width = 12L,
                        Quantico::BlankRow(12L),
                        shiny::fluidRow(
                          shiny::column(
                            3L,
                            Quantico:::NumericInput(InputID='Correlation_SampleSize', Label='Sample Size', Value = Correlation_SampleSize_Selected, Min = 30, Max = 1000000, Step = 100)
                          ),
                          shiny::column(
                            3L,
                            Quantico:::SelectizeInput(InputID='Correlation_P_Adjust', Label='P-Value Adj', Choices = Correlation_P_Adjust_Choices, SelectedDefault = Correlation_P_Adjust_Selected, Multiple = FALSE)
                          ),
                          shiny::column(
                            3L,
                            Quantico:::SelectizeInput(InputID='Correlation_Bayesian', Label='Bayesian', Choices = Correlation_Bayesian_Choices, SelectedDefault = Correlation_Bayesian_Selected, Multiple = FALSE)
                          ),
                          shiny::column(
                            3L,
                            Quantico:::SelectizeInput(InputID='Correlation_Bayesian_Prior', Label='Bayesian Prior', Choices = Correlation_Bayesian_Prior_Choices, SelectedDefault = Correlation_Bayesian_Prior_Selected, Multiple = FALSE)
                          )
                        ),
                        Quantico::BlankRow(12L),
                        shiny::fluidRow(
                          shiny::column(
                            3L,
                            Quantico:::SelectizeInput(InputID='Correlation_MultiLevel', Label='Multilevel', Choices = Correlation_MultiLevel_Choices, SelectedDefault = Correlation_MultiLevel_Selected, Multiple = FALSE)
                          ),
                          shiny::column(
                            3L,
                            Quantico:::SelectizeInput(InputID='Correlation_Include_Factors', Label='Include Factors',  Choices = Correlation_Include_Factors_Choices, SelectedDefault = Correlation_Include_Factors_Selected, Multiple = FALSE)
                          ),
                          shiny::column(
                            3L,
                            Quantico:::SelectizeInput(InputID='Correlation_Partial', Label='Partial Corr',  Choices = Correlation_Partial_Choices, SelectedDefault = Correlation_Partial_Selected, Multiple = FALSE)
                          ),
                          shiny::column(
                            3L,
                            Quantico:::SelectizeInput(InputID='Correlation_Partial_Bayesian', Label='Partial Bayes',  Choices = Correlation_Partial_Bayesian_Choices, SelectedDefault = Correlation_Partial_Bayesian_Selected, Multiple = FALSE)
                          ),
                        ),
                        Quantico::BlankRow(12L)
                      )
                    )
                  ),

                  # Blank space
                  Quantico:::BlankRow(12L),
                  Quantico:::BlankRow(12L),
                  Quantico:::BlankRow(12L),
                  Quantico:::BlankRow(12L),
                  Quantico:::BlankRow(12L)
                )
              )
            ) # end Tab Panel Main
          ), # end TagList

          footer = shiny::tagList(
            shiny::modalButton(label = "Cancel"),
            shiny::actionButton("Correlation_OK", "OK", width = '50px'))))

    })
}

#' @title OneSampleTTest_Modal_Fun
#'
#' @description Inference operations
#'
#' @author Adrian Antico
#' @family Inference
#'
#' @param id = 'OneSampleTTest_Modal_Fun'
#' @param AppWidth = 12L
#'
#' @export
OneSampleTTest_Modal_Fun <- function(id,
                                     AppWidth=12L,

                                     # Reactives
                                     OneSampleTTest_Variable_Selected = NULL,

                                     # Statics
                                     OneSampleTTest_SelectData_Choices = NULL,
                                     OneSampleTTest_Alternative_Choices = NULL,

                                     # Updaters
                                     OneSampleTTest_SelectData_Selected = NULL,
                                     OneSampleTTest_InferenceID_Selected = NULL,
                                     OneSampleTTest_NullValue_Selected = NULL,
                                     OneSampleTTest_Alternative_Selected = NULL,
                                     OneSampleTTest_ConfidenceLevel_Selected = NULL,
                                     OneSampleTTest_Samples_Selected = NULL,
                                     OneSampleTTest_SampleSize_Selected = NULL) {

  shiny::moduleServer(
    id = id,
    module = function(input, output, session) {
      ns <- session$ns
      shiny::showModal(
        shiny::modalDialog(
          title = 'One Sample T-Test',
          size = "l",
          easyClose = FALSE,
          fade = TRUE,
          shiny::tagList(

            Quantico:::BlankRow(12L),

            # Tabs
            shiny::tabsetPanel(
              id = 'OneSampleTTest_TabPanel',
              selected = 'One Sample T-Test',

              # One Sample T-Test ----
              shiny::tabPanel(
                title = "One Sample T-Test",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  style = ModelHelpFormat,
                  Quantico:::BlankRow(12L),
                  shiny::fluidRow(
                    shiny::column(
                      width = 3L,
                      tags$h4(tags$span(tags$b(paste0('One Sample T-Test'))))
                    ),
                    shiny::column(
                      width = 8L,
                      align = "right",
                      shinyWidgets::dropdown(
                        shinydashboard::box(
                          title = NULL, solidHeader = TRUE, collapsible = FALSE, status = "info", width = 12L,
                          shiny::fluidRow(
                            shiny::column(
                              width = 12L,
                              align = "left",
                              shiny::h1(tags$b("One Sample T-Test")),
                              shiny::p("The One Sample T-Test operation runs a one sample t-test per specifications provided by the user.")
                            )
                          ),

                          Quantico::BlankRow(12),
                          shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::h3("One Sample T-Test Usage"))),
                          shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::markdown(
                            "
                              One Sample T-Test operation runs a one sample t-test per specifications provided by the user.
                              * Choose data set: This is the dataset you want to utilize for the operation
                              * Variable: Select the variable to test
                              * NullValue: assumed difference from population mean
                              * Alternative: choose from 'two.sided',
                              * ConfidenceLevel: value to set for test
                              * SampleSize: Number of records to utilize from the dataset
                              * Samples: Boostrap iteration count
                              "
                          )))
                        ),
                        size = "lg",
                        icon = shiny::icon("question"),
                        label = NULL,
                        tooltip = FALSE,
                        right = TRUE,
                        up = FALSE,
                        width = NULL,
                        animate = shinyWidgets::animateOptions(
                          enter = "zoomIn",
                          exit = "fadeOutRightBig"
                        ),
                        inputId = NULL,
                        block = FALSE,
                        no_outline = TRUE
                      )
                    ),

                    # 1STTest Button
                    shiny::column(
                      width = 1L, align = 'right',
                      style = "padding-top: 4px;padding-right: 50px;",
                      shiny::actionButton(
                        inputId = 'Inference_1STTest_Execute',
                        label = 'Run',
                        icon = shiny::icon('chevron-right', lib='font-awesome')
                      )
                    )
                  ),

                  Quantico:::BlankRow(12L),
                  shiny::fluidRow(
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = "danger", width = 12L,
                      Quantico::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(
                          4L, align = "center",
                          Quantico:::SelectizeInput(InputID='OneSampleTTest_SelectData', Label='Choose data set', Choices = OneSampleTTest_SelectData_Choices, SelectedDefault = OneSampleTTest_SelectData_Selected, Multiple = TRUE, MaxVars = 1)),
                        shiny::column(
                          4L, align = "center",
                          Quantico:::PickerInput(InputID='OneSampleTTest_Variable', Label='Variable', Choices = NULL, SelectedDefault = OneSampleTTest_Variable_Selected, Multiple = TRUE, MaxVars = 1L)
                        ),
                        shiny::column(
                          4L, align = "center",
                          Quantico:::TextInput(InputID='OneSampleTTest_InferenceID', Label='Inference ID', Value = OneSampleTTest_InferenceID_Selected, Placeholder = "INF_OneSampleTTest")
                        )
                      )
                    )
                  ),

                  Quantico::BlankRow(12L),
                  shiny::fluidRow(
                    shiny::column(
                      12L, align = "center",
                      shinydashboard::box(
                        title = NULL, solidHeader = TRUE, collapsible = FALSE, status = "danger", width = 12L,
                        Quantico::BlankRow(12L),
                        shiny::fluidRow(
                          shiny::column(
                            6L,
                            Quantico:::NumericInput(InputID='OneSampleTTest_Samples', Label='Iterations', Value = OneSampleTTest_Samples_Selected, Min = 1, Max = 1000, Step = 1)
                          ),
                          shiny::column(
                            6L,
                            Quantico:::NumericInput(InputID='OneSampleTTest_SampleSize', Label='Sample Size', Value = OneSampleTTest_SampleSize_Selected, Min = 8, Max = 1000000, Step = 1)
                          )
                        ),
                        Quantico::BlankRow(12L),
                        shiny::fluidRow(
                          shiny::column(
                            6L,
                            Quantico:::NumericInput(InputID='OneSampleTTest_NullValue', Label='Null Hypothesis Value',  Value = OneSampleTTest_NullValue_Selected, Step = 0.001)
                          ),
                          shiny::column(
                            6L,
                            Quantico:::SelectizeInput(InputID='OneSampleTTest_Alternative', Label='Alternative', Choices = OneSampleTTest_Alternative_Choices, SelectedDefault = OneSampleTTest_Alternative_Selected, Multiple = FALSE)
                          )
                        ),
                        Quantico::BlankRow(12L),
                        shiny::fluidRow(
                          shiny::column(
                            6L,
                            Quantico:::NumericInput(InputID='OneSampleTTest_ConfidenceLevel', Label='Confidence Level', Value = OneSampleTTest_ConfidenceLevel_Selected, Min = 0.80, Max = 0.9999, Step = 0.001)
                          )
                        ),
                        Quantico::BlankRow(12L)
                      )
                    )
                  ),

                  # Blank space
                  Quantico:::BlankRow(12L),
                  Quantico:::BlankRow(12L),
                  Quantico:::BlankRow(12L),
                  Quantico:::BlankRow(12L),
                  Quantico:::BlankRow(12L)
                )
              )
            ) # end Tab Panel Main
          ), # end TagList

          footer = shiny::tagList(
            shiny::modalButton(label = "Cancel"),
            shiny::actionButton("OneSampleTTest_OK", "OK", width = '50px'))))

    })
}

#' @title TwoSampleTTest_Modal_Fun
#'
#' @description Inference operations
#'
#' @author Adrian Antico
#' @family Inference
#'
#' @param id = 'TwoSampleTTest_Modal_Fun'
#' @param AppWidth = 12L
#'
#' @export
TwoSampleTTest_Modal_Fun <- function(id,
                                     AppWidth=12L,

                                     # Reactives
                                     TwoSampleTTest_Variable1_Selected = NULL,
                                     TwoSampleTTest_Variable2_Selected = NULL,

                                     # Statics
                                     TwoSampleTTest_SelectData_Choices = NULL,
                                     TwoSampleTTest_Alternative_Choices = NULL,
                                     TwoSampleTTest_Paired_Choices = NULL,
                                     TwoSampleTTest_EqualVariance_Choices = NULL,

                                     # Updaters
                                     TwoSampleTTest_SelectData_Selected = NULL,
                                     TwoSampleTTest_InferenceID_Selected = NULL,
                                     TwoSampleTTest_Paired_Selected = NULL,
                                     TwoSampleTTest_EqualVariance_Selected = NULL,
                                     TwoSampleTTest_NullValue_Selected = NULL,
                                     TwoSampleTTest_Alternative_Selected = NULL,
                                     TwoSampleTTest_ConfidenceLevel_Selected = NULL,
                                     TwoSampleTTest_Samples_Selected = NULL,
                                     TwoSampleTTest_SampleSize_Selected = NULL) {

  shiny::moduleServer(
    id = id,
    module = function(input, output, session) {
      ns <- session$ns
      shiny::showModal(
        shiny::modalDialog(
          title = 'Two Sample T-Test',
          size = "l",
          easyClose = FALSE,
          fade = TRUE,
          shiny::tagList(

            Quantico:::BlankRow(12L),

            # Tabs
            shiny::tabsetPanel(
              id = 'TwoSampleTTest_TabPanel',
              selected = 'Two Sample T-Test',

              # Two Sample T-Test ----
              shiny::tabPanel(
                title = "Two Sample T-Test",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  style = ModelHelpFormat,
                  Quantico:::BlankRow(12L),
                  shiny::fluidRow(
                    shiny::column(
                      width = 3L,
                      tags$h4(tags$span(tags$b(paste0('Two Sample T-Test'))))
                    ),
                    shiny::column(
                      width = 8L,
                      align = "right",
                      shinyWidgets::dropdown(
                        shinydashboard::box(
                          title = NULL, solidHeader = TRUE, collapsible = FALSE, status = "info", width = 12L,
                          shiny::fluidRow(
                            shiny::column(
                              width = 12L,
                              align = "left",
                              shiny::h1(tags$b("Two Sample T-Test")),
                              shiny::p("The Two Sample T-Test operation runs a two sample t-test per specifications provided by the user.")
                            )
                          ),

                          Quantico::BlankRow(12),
                          shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::h3("Two Sample T-Test Usage"))),
                          shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::markdown(
                            "
                              Two Sample T-Test operation runs a two sample t-test per specifications provided by the user.
                              * Choose data set: This is the dataset you want to utilize for the operation
                              * Variable1: Select the variable to test
                              * Variable2: Select the variable to test
                              * Paired: set to TRUE for paired t-test
                              * EqualVariance: set to TRUE for an assumed equal variance
                              * NullValue: assumed difference from population mean
                              * Alternative: choose from 'two.sided',
                              * ConfidenceLevel: value to set for test
                              * SampleSize: Number of records to utilize from the dataset
                              * Samples: Boostrap iteration count
                              "
                          )))
                        ),
                        size = "lg",
                        icon = shiny::icon("question"),
                        label = NULL,
                        tooltip = FALSE,
                        right = TRUE,
                        up = FALSE,
                        width = NULL,
                        animate = shinyWidgets::animateOptions(
                          enter = "zoomIn",
                          exit = "fadeOutRightBig"
                        ),
                        inputId = NULL,
                        block = FALSE,
                        no_outline = TRUE
                      )
                    ),

                    # 2STTest Button
                    shiny::column(
                      width = 1L, align = 'right',
                      style = "padding-top: 4px;padding-right: 50px;",
                      shiny::actionButton(
                        inputId = 'Inference_2STTest_Execute',
                        label = 'Run',
                        icon = shiny::icon('chevron-right', lib='font-awesome')
                      )
                    )
                  ),

                  Quantico:::BlankRow(12L),
                  shiny::fluidRow(
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = "danger", width = 12L,
                      Quantico::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(
                          3L, align = "center",
                          Quantico:::SelectizeInput(InputID='TwoSampleTTest_SelectData', Label='Choose data set', Choices = TwoSampleTTest_SelectData_Choices, SelectedDefault = TwoSampleTTest_SelectData_Selected, Multiple = TRUE, MaxVars = 1)),
                        shiny::column(
                          3L, align = "center",
                          Quantico:::PickerInput(InputID='TwoSampleTTest_Variable1', Label='Variable 1', Choices = NULL, SelectedDefault = TwoSampleTTest_Variable1_Selected, Multiple = TRUE, MaxVars = 1L)
                        ),
                        shiny::column(
                          3L, align = "center",
                          Quantico:::PickerInput(InputID='TwoSampleTTest_Variable2', Label='Variable 2', Choices = NULL, SelectedDefault = TwoSampleTTest_Variable2_Selected, Multiple = TRUE, MaxVars = 1L)
                        ),
                        shiny::column(
                          3L, align = "center",
                          Quantico:::TextInput(InputID='TwoSampleTTest_InferenceID', Label='Inference ID', Value = TwoSampleTTest_InferenceID_Selected, Placeholder = "INF_TwoSampleTTest")
                        )
                      )
                    )
                  ),

                  Quantico::BlankRow(12L),
                  shiny::fluidRow(
                    shiny::column(
                      12L, align = "center",
                      shinydashboard::box(
                        title = NULL, solidHeader = TRUE, collapsible = FALSE, status = "danger", width = 12L,
                        Quantico::BlankRow(12L),
                        shiny::fluidRow(
                          shiny::column(
                            6L,
                            Quantico:::NumericInput(InputID='TwoSampleTTest_Samples', Label='Iterations', Value = TwoSampleTTest_Samples_Selected, Min = 1, Max = 1000, Step = 1)
                          ),
                          shiny::column(
                            6L,
                            Quantico:::NumericInput(InputID='TwoSampleTTest_SampleSize', Label='Sample Size', Value = TwoSampleTTest_SampleSize_Selected, Min = 8, Max = 1000000, Step = 1)
                          )
                        ),
                        Quantico::BlankRow(12L),
                        shiny::fluidRow(
                          shiny::column(
                            6L,
                            Quantico:::NumericInput(InputID='TwoSampleTTest_NullValue', Label='Null Hypothesis Value',  Value = TwoSampleTTest_NullValue_Selected, Step = 0.001)
                          ),
                          shiny::column(
                            6L,
                            Quantico:::SelectizeInput(InputID='TwoSampleTTest_Alternative', Label='Alternative', Choices = TwoSampleTTest_Alternative_Choices, SelectedDefault = TwoSampleTTest_Alternative_Selected, Multiple = FALSE)
                          )
                        ),
                        Quantico::BlankRow(12L),
                        shiny::fluidRow(
                          shiny::column(
                            6L,
                            Quantico:::NumericInput(InputID='TwoSampleTTest_ConfidenceLevel', Label='Confidence Level', Value = TwoSampleTTest_ConfidenceLevel_Selected, Min = 0.80, Max = 0.9999, Step = 0.001)
                          ),
                          shiny::column(
                            6L,
                            Quantico:::SelectizeInput(InputID='TwoSampleTTest_Paired', Label='Paired T-Test', Choices = TwoSampleTTest_Paired_Choices, SelectedDefault = TwoSampleTTest_Paired_Selected, Multiple = FALSE)
                          )
                        ),
                        Quantico::BlankRow(12L),
                        shiny::fluidRow(
                          shiny::column(
                            6L,
                            Quantico:::SelectizeInput(InputID='TwoSampleTTest_EqualVariance', Label='Equal Variance', Choices = TwoSampleTTest_EqualVariance_Choices, SelectedDefault = TwoSampleTTest_EqualVariance_Selected, Multiple = FALSE)
                          )
                        ),
                        Quantico::BlankRow(12L)
                      )
                    )
                  ),

                  # Blank space
                  Quantico:::BlankRow(12L),
                  Quantico:::BlankRow(12L),
                  Quantico:::BlankRow(12L),
                  Quantico:::BlankRow(12L),
                  Quantico:::BlankRow(12L)
                )
              )
            ) # end Tab Panel Main
          ), # end TagList

          footer = shiny::tagList(
            shiny::modalButton(label = "Cancel"),
            shiny::actionButton("TwoSampleTTest_OK", "OK", width = '50px'))))

    })
}

#' @title FTest_Modal_Fun
#'
#' @description Inference operations
#'
#' @author Adrian Antico
#' @family Inference
#'
#' @param id = 'FTest_Modal_Fun'
#' @param AppWidth = 12L
#'
#' @export
FTest_Modal_Fun <- function(id,
                            AppWidth=12L,

                            # Reactives
                            FTest_Variable1_Selected = NULL,
                            FTest_Variable2_Selected = NULL,

                            # Statics
                            FTest_SelectData_Choices = NULL,
                            FTest_Alternative_Choices = NULL,

                            # Updaters
                            FTest_SelectData_Selected = NULL,
                            FTest_InferenceID_Selected = NULL,
                            FTest_RatioVariances_Selected = NULL,
                            FTest_Alternative_Selected = NULL,
                            FTest_ConfidenceLevel_Selected = NULL,
                            FTest_Samples_Selected = NULL,
                            FTest_SampleSize_Selected = NULL) {

  shiny::moduleServer(
    id = id,
    module = function(input, output, session) {
      ns <- session$ns
      shiny::showModal(
        shiny::modalDialog(
          title = 'F-Test',
          size = "l",
          easyClose = FALSE,
          fade = TRUE,
          shiny::tagList(

            Quantico:::BlankRow(12L),

            # Tabs
            shiny::tabsetPanel(
              id = 'FTest_TabPanel',
              selected = 'F-Test',

              # F-Test ----
              shiny::tabPanel(
                title = "F-Test",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  style = ModelHelpFormat,
                  Quantico:::BlankRow(12L),
                  shiny::fluidRow(
                    shiny::column(
                      width = 3L,
                      tags$h4(tags$span(tags$b(paste0('F-Test'))))
                    ),
                    shiny::column(
                      width = 8L,
                      align = "right",
                      shinyWidgets::dropdown(
                        shinydashboard::box(
                          title = NULL, solidHeader = TRUE, collapsible = FALSE, status = "info", width = 12L,
                          shiny::fluidRow(
                            shiny::column(
                              width = 12L,
                              align = "left",
                              shiny::h1(tags$b("F-Test")),
                              shiny::p("The F-Test operation runs an F-test per specifications provided by the user.")
                            )
                          ),

                          Quantico::BlankRow(12),
                          shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::h3("F-Test Usage"))),
                          shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::markdown(
                            "
                              F-Test operation runs an F-test per specifications provided by the user.
                              * Choose data set: This is the dataset you want to utilize for the operation
                              * Variable1: Select the variable to test
                              * Variable2: Select the variable to test
                              * RatioVariances: H0 value for the ratio of variances
                              * Alternative: choose from 'two.sided',
                              * ConfidenceLevel: value to set for test
                              * SampleSize: Number of records to utilize from the dataset
                              * Samples: Boostrap iteration count
                              "
                          )))
                        ),
                        size = "lg",
                        icon = shiny::icon("question"),
                        label = NULL,
                        tooltip = FALSE,
                        right = TRUE,
                        up = FALSE,
                        width = NULL,
                        animate = shinyWidgets::animateOptions(
                          enter = "zoomIn",
                          exit = "fadeOutRightBig"
                        ),
                        inputId = NULL,
                        block = FALSE,
                        no_outline = TRUE
                      )
                    ),

                    # FTest Button
                    shiny::column(
                      width = 1L, align = 'right',
                      style = "padding-top: 4px;padding-right: 50px;",
                      shiny::actionButton(
                        inputId = 'Inference_FTest_Execute',
                        label = 'Run',
                        icon = shiny::icon('chevron-right', lib='font-awesome')
                      )
                    )
                  ),

                  Quantico:::BlankRow(12L),
                  shiny::fluidRow(
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = "danger", width = 12L,
                      Quantico::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(
                          3L, align = "center",
                          Quantico:::SelectizeInput(InputID='FTest_SelectData', Label='Choose data set', Choices = FTest_SelectData_Choices, SelectedDefault = FTest_SelectData_Selected, Multiple = TRUE, MaxVars = 1)),
                        shiny::column(
                          3L, align = "center",
                          Quantico:::PickerInput(InputID='FTest_Variable1', Label='Variable 1', Choices = NULL, SelectedDefault = FTest_Variable1_Selected, Multiple = TRUE, MaxVars = 1L)
                        ),
                        shiny::column(
                          3L, align = "center",
                          Quantico:::PickerInput(InputID='FTest_Variable2', Label='Variable 2', Choices = NULL, SelectedDefault = FTest_Variable2_Selected, Multiple = TRUE, MaxVars = 1L)
                        ),
                        shiny::column(
                          3L, align = "center",
                          Quantico:::TextInput(InputID='FTest_InferenceID', Label='Inference ID', Value = FTest_InferenceID_Selected, Placeholder = "INF_FTest")
                        )
                      )
                    )
                  ),

                  Quantico::BlankRow(12L),
                  shiny::fluidRow(
                    shiny::column(
                      12L, align = "center",
                      shinydashboard::box(
                        title = NULL, solidHeader = TRUE, collapsible = FALSE, status = "danger", width = 12L,
                        Quantico::BlankRow(12L),
                        shiny::fluidRow(
                          shiny::column(
                            6L,
                            Quantico:::NumericInput(InputID='FTest_Samples', Label='Iterations', Value = FTest_Samples_Selected, Min = 1, Max = 1000, Step = 1)
                          ),
                          shiny::column(
                            6L,
                            Quantico:::NumericInput(InputID='FTest_SampleSize', Label='Sample Size', Value = FTest_SampleSize_Selected, Min = 8, Max = 1000000, Step = 1)
                          )
                        ),
                        Quantico::BlankRow(12L),
                        shiny::fluidRow(
                          shiny::column(
                            6L,
                            Quantico:::NumericInput(InputID='FTest_RatioVariances', Label='H0 Ratio of Variances',  Value = FTest_RatioVariances_Selected, Step = 0.001)
                          ),
                          shiny::column(
                            6L,
                            Quantico:::SelectizeInput(InputID='FTest_Alternative', Label='Alternative', Choices = FTest_Alternative_Choices, SelectedDefault = FTest_Alternative_Selected, Multiple = FALSE)
                          )
                        ),
                        Quantico::BlankRow(12L),
                        shiny::fluidRow(
                          shiny::column(
                            6L,
                            Quantico:::NumericInput(InputID='FTest_ConfidenceLevel', Label='Confidence Level', Value = FTest_ConfidenceLevel_Selected, Min = 0.80, Max = 0.9999, Step = 0.001)
                          )
                        ),
                        Quantico::BlankRow(12L)
                      )
                    )
                  ),

                  # Blank space
                  Quantico:::BlankRow(12L),
                  Quantico:::BlankRow(12L),
                  Quantico:::BlankRow(12L),
                  Quantico:::BlankRow(12L),
                  Quantico:::BlankRow(12L)
                )
              )
            ) # end Tab Panel Main
          ), # end TagList

          footer = shiny::tagList(
            shiny::modalButton(label = "Cancel"),
            shiny::actionButton("FTest_OK", "OK", width = '50px'))))

    })
}

#' @title ChiSquareTest_Modal_Fun
#'
#' @description Inference operations
#'
#' @author Adrian Antico
#' @family Inference
#'
#' @param id = 'ChiSquareTest_Modal_Fun'
#' @param AppWidth = 12L
#'
#' @export
ChiSquareTest_Modal_Fun <- function(id,
                            AppWidth=12L,

                            # Reactives
                            ChiSquareTest_Variable1_Selected = NULL,
                            ChiSquareTest_Variable2_Selected = NULL,

                            # Statics
                            ChiSquareTest_SelectData_Choices = NULL,
                            ChiSquareTest_Alternative_Choices = NULL,

                            # Updaters
                            ChiSquareTest_SelectData_Selected = NULL,
                            ChiSquareTest_InferenceID_Selected = NULL,
                            ChiSquareTest_Alternative_Selected = NULL,
                            ChiSquareTest_ConfidenceLevel_Selected = NULL,
                            ChiSquareTest_Samples_Selected = NULL,
                            ChiSquareTest_SampleSize_Selected = NULL) {

  shiny::moduleServer(
    id = id,
    module = function(input, output, session) {
      ns <- session$ns
      shiny::showModal(
        shiny::modalDialog(
          title = 'ChiSq-Test',
          size = "l",
          easyClose = FALSE,
          fade = TRUE,
          shiny::tagList(

            Quantico:::BlankRow(12L),

            # Tabs
            shiny::tabsetPanel(
              id = 'ChiSquareTest_TabPanel',
              selected = 'Chi-Squared Test',

              # ChiSq-Test ----
              shiny::tabPanel(
                title = "Chi-Squared Test",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  style = ModelHelpFormat,
                  Quantico:::BlankRow(12L),
                  shiny::fluidRow(
                    shiny::column(
                      width = 3L,
                      tags$h4(tags$span(tags$b(paste0('Chi-Squared Test'))))
                    ),
                    shiny::column(
                      width = 8L,
                      align = "right",
                      shinyWidgets::dropdown(
                        shinydashboard::box(
                          title = NULL, solidHeader = TRUE, collapsible = FALSE, status = "info", width = 12L,
                          shiny::fluidRow(
                            shiny::column(
                              width = 12L,
                              align = "left",
                              shiny::h1(tags$b("Chi-Squared Test")),
                              shiny::p("The Chi-Squared Test operation runs an F-test per specifications provided by the user.")
                            )
                          ),

                          Quantico::BlankRow(12),
                          shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::h3("Chi-Squared Test Usage"))),
                          shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::markdown(
                            "
                              Chi-Squared Test operation runs an chi-squared test per specifications provided by the user.
                              * Choose data set: This is the dataset you want to utilize for the operation
                              * Variable1: Select the variable to test
                              * Variable2: Select the variable to test
                              * Alternative: choose from 'two.sided',
                              * ConfidenceLevel: value to set for test
                              * SampleSize: Number of records to utilize from the dataset
                              * Samples: Boostrap iteration count
                              "
                          )))
                        ),
                        size = "lg",
                        icon = shiny::icon("question"),
                        label = NULL,
                        tooltip = FALSE,
                        right = TRUE,
                        up = FALSE,
                        width = NULL,
                        animate = shinyWidgets::animateOptions(
                          enter = "zoomIn",
                          exit = "fadeOutRightBig"
                        ),
                        inputId = NULL,
                        block = FALSE,
                        no_outline = TRUE
                      )
                    ),

                    # ChiSquaredTest Button
                    shiny::column(
                      width = 1L, align = 'right',
                      style = "padding-top: 4px;padding-right: 50px;",
                      shiny::actionButton(
                        inputId = 'Inference_ChiSquaredTest_Execute',
                        label = 'Run',
                        icon = shiny::icon('chevron-right', lib='font-awesome')
                      )
                    )
                  ),

                  Quantico:::BlankRow(12L),
                  shiny::fluidRow(
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = "danger", width = 12L,
                      Quantico::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(
                          3L, align = "center",
                          Quantico:::SelectizeInput(InputID='ChiSquareTest_SelectData', Label='Choose data set', Choices = ChiSquareTest_SelectData_Choices, SelectedDefault = ChiSquareTest_SelectData_Selected, Multiple = TRUE, MaxVars = 1)),
                        shiny::column(
                          3L, align = "center",
                          Quantico:::PickerInput(InputID='ChiSquareTest_Variable1', Label='Variable 1', Choices = NULL, SelectedDefault = ChiSquareTest_Variable1_Selected, Multiple = TRUE, MaxVars = 1L)
                        ),
                        shiny::column(
                          3L, align = "center",
                          Quantico:::PickerInput(InputID='ChiSquareTest_Variable2', Label='Variable 2', Choices = NULL, SelectedDefault = ChiSquareTest_Variable2_Selected, Multiple = TRUE, MaxVars = 1L)
                        ),
                        shiny::column(
                          3L, align = "center",
                          Quantico:::TextInput(InputID='ChiSquareTest_InferenceID', Label='Inference ID', Value = ChiSquareTest_InferenceID_Selected, Placeholder = "INF_ChiSquareTest")
                        )
                      )
                    )
                  ),

                  Quantico::BlankRow(12L),
                  shiny::fluidRow(
                    shiny::column(
                      12L, align = "center",
                      shinydashboard::box(
                        title = NULL, solidHeader = TRUE, collapsible = FALSE, status = "danger", width = 12L,
                        Quantico::BlankRow(12L),
                        shiny::fluidRow(
                          shiny::column(
                            6L,
                            Quantico:::NumericInput(InputID='ChiSquareTest_Samples', Label='Iterations', Value = ChiSquareTest_Samples_Selected, Min = 1, Max = 1000, Step = 1)
                          ),
                          shiny::column(
                            6L,
                            Quantico:::NumericInput(InputID='ChiSquareTest_SampleSize', Label='Sample Size', Value = ChiSquareTest_SampleSize_Selected, Min = 8, Max = 1000000, Step = 100)
                          )
                        ),
                        Quantico::BlankRow(12L),
                        shiny::fluidRow(
                          shiny::column(
                            6L,
                            Quantico:::NumericInput(InputID='ChiSquareTest_ConfidenceLevel', Label='Confidence Level', Value = ChiSquareTest_ConfidenceLevel_Selected, Min = 0.80, Max = 0.9999, Step = 0.001)
                          ),
                          shiny::column(
                            6L,
                            Quantico:::SelectizeInput(InputID='ChiSquareTest_Alternative', Label='Alternative', Choices = ChiSquareTest_Alternative_Choices, SelectedDefault = ChiSquareTest_Alternative_Selected, Multiple = FALSE)
                          )
                        ),
                        Quantico::BlankRow(12L)
                      )
                    )
                  ),

                  # Blank space
                  Quantico:::BlankRow(12L),
                  Quantico:::BlankRow(12L),
                  Quantico:::BlankRow(12L),
                  Quantico:::BlankRow(12L),
                  Quantico:::BlankRow(12L)
                )
              )
            ) # end Tab Panel Main
          ), # end TagList

          footer = shiny::tagList(
            shiny::modalButton(label = "Cancel"),
            shiny::actionButton("ChiSquareTest_OK", "OK", width = '50px'))))

    })
}

# ----

# ----

# @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ ----
# ::  Forecasting  ::                                                                                            ----
# @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ ----

#' @title TBATS_Modal_Fun
#'
#' @description TBATS Parameters Modal with OK button to close
#'
#' @author Adrian Antico
#' @family ML
#'
#' @param id = 'TBATS_ID'
#' @param AppWidth = 12L
#'
#' @export
TBATS_Modal_Fun <- function(id,
                           AppWidth=12L,

                           # Reactives
                           ModelID_Selected = NULL,
                           TargetColumnName_Selected = NULL,
                           DateColumnName_Selected = NULL,

                           # Statics
                           RunMode_Choices = NULL,
                           ArgsList_Choices = NULL,
                           data_Choices = NULL,
                           TimeUnit_Choices = NULL,
                           FCPeriods_Choices = NULL,
                           EvaluationMetric_Choices = NULL,
                           MaxLags_Choices = NULL,
                           MaxMovingAverages_Choices = NULL,
                           TrainWeighting_Choices = NULL,
                           DebugMode_Choices = NULL,

                           # Updaters
                           data_Selected = NULL,
                           ArgsList_Selected = NULL,
                           RunMode_Selected = NULL,
                           TimeUnit_Selected = NULL,
                           FCPeriods_Selected = NULL,
                           EvaluationMetric_Selected = NULL,
                           MaxLags_Selected = NULL,
                           MaxMovingAverages_Selected = NULL,
                           TrainWeighting_Selected = NULL,
                           DebugMode_Selected = NULL) {

  shiny::moduleServer(
    id = id,
    module = function(input, output, session) {
      ns <- session$ns
      shiny::showModal(
        shiny::modalDialog(
          title = 'TBATS FC Parameters',
          size = "l",
          easyClose = FALSE,
          fade = TRUE,
          shiny::tagList(

            # Top Box ----
            shinydashboard::box(
              title = NULL, solidHeader = TRUE, collapsible = FALSE, status = 'danger', width = AppWidth,
              shiny::fluidRow(
                shiny::column(
                  width = 12L,
                  align = "right",
                  shinyWidgets::dropdown(
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = "info", width = 12L,
                      shiny::fluidRow(
                        shiny::column(
                          width = 12L,
                          align = "left",
                          shiny::a(name = "forecasting"),
                          shiny::h2(tags$b("Forecasting")),
                          shiny::p("Single Series Forecasting is generating forecasts for individual series. The TBATS forecasting grid tuner
                                   is model testing framework for TBATS (Exponential smoothing state space model with Box-Cox transformation,
                                   ARMA errors, Trend and Seasonal components). Model evaluation is done by blending the training error and
                                   the validation error from testing the model on out of sample data. The bandit algorithm compares the
                                   performance of the current build against the previous builds which starts with the classic nnetar model
                                   from the forecast package. Depending on how many lags, moving averages, trend, damped trend, seasonal periods, and transformations you test the
                                   number of combinations of features to test begins to approach 10,000 different combinations of settings.
                                   The function tests out lags, moving averages, trend, damped trend, seasonal periods, and transformations.
                                   The forecast process begins by retraining the model with the settings that produced the best performance.
                                   If the model fails to build, for whatever reason, the next best buildable model is rebuilt."))),

                      Quantico::BlankRow(12),
                      shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::h3("Run Modes:"))),
                      shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::markdown(
                        "
                        There are various Run modes to training, backtesting, and forecasting:
                        * Grid Tune: Grid tuning will evaluate many different models and underlying data structure assumptions. For new time series modeling projects it's advisable to utilize this functionality
                        * Forecast: The mode is for generating forecasts
                        "
                      ))),
                      Quantico::BlankRow(12),
                      shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::h3("Forecasting Usage"))),
                      shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::markdown(
                        "
                        ### Parameters
                        * Select Run Mode: Choose from Grid Tune or Forecast. Grid Tuning is for model evaluation of the many possible configurations. Forecast is to generate a single forecast from a single model specification
                        * Tuning Grid: This is from the Grid Tuning operation. If you saved one previously you can upload it and supply it here. When this is supplied, and you run forecast mode, a forecast will be generated for you. You do not have to supply parameter values to the inputs when you want this functionality utilized
                        * Refresh: If you ran a Grid Tune and want to see the grid tune output as an option for supplying to the Tuning Grid input, click refresh. Alternatively, closing out of the modal and coming back in will also expose the new option
                        * Model ID: Provide a name for your grid tuning or forecasting model. If you supply the same name as a previous model built in session, it will be overwritten
                        * Forecast Periods: The number of periods to use for both evalution purposes and forecast purposes
                        * Target Variable: Variable you are looking to forecast
                        * Date Variable: Date variable that defines your time series
                        * Select Data: Your time series data set
                        * Time Unit: Defines the granularity of your data time series. E.g. daily data has a data point for each day within your series
                        * Evaluation Metric: This is for forecasting mode when you supply a tuning grid.
                        * Max Lags: In grid tuning mode, this will define the maximum number of lags to utilize even though lower values will also be tested. In forecast mode, this will define the max of the lags that are defined (if 5 is selected then 1 though 5 will be utilized)
                        * Max Moving Averages: In grid tuning mode, this will define the maximum number of moving averages to utilize even though lower values will also be tested. In forecast mode, this will define the max of the moving averages that are defined (if 5 is selected then 1 though 5 will be utilized)
                        * Max Seasonal Periods: In grid tuning mode, this will define the maximum number of seasonal lags to utilize even though lower values will also be tested. In forecast mode, this will define the max of the seasonal lags that are defined (if 5 is selected then 1 though 5 will be utilized)
                        "
                      )))
                    ),

                    size = "lg",
                    icon = shiny::icon("question"),
                    label = NULL,
                    tooltip = FALSE,
                    right = TRUE,
                    up = FALSE,
                    width = NULL,
                    animate = shinyWidgets::animateOptions(
                      enter = "zoomIn",
                      exit = "fadeOutRightBig"
                    ),
                    inputId = NULL,
                    block = FALSE,
                    no_outline = TRUE
                  )
                )
              ),
              Quantico:::BlankRow(12L),
              shiny::fluidRow(
                shiny::column(
                  width = 3L, align = 'center',
                  Quantico:::SelectizeInput(InputID = 'TBATS_RunMode', Label = 'Select Run Mode', Choices = RunMode_Choices, SelectedDefault = RunMode_Selected, Multiple = TRUE, MaxVars = 1)),
                shiny::column(
                  width = 3L, align = 'center',
                  Quantico:::SelectizeInput(InputID = "TBATS_ArgsList", Label = "Tuning Grid", Choices = ArgsList_Choices, SelectedDefault = ArgsList_Selected, Multiple = TRUE, MaxVars = 100L)
                ),
                shiny::column(
                  width = 5L),
                shiny::column(
                  width = 1L, align = "center",
                  shiny::actionButton(
                    inputId = paste0('BuildModels_TBATS'), label = paste0('Run'), icon = shiny::icon('chevron-right', lib='font-awesome')
                  )
                )
              ),

              Quantico::BlankRow(12L),
              shiny::tabsetPanel(
                id = 'TBATS_TabPanel',
                selected = 'Data',

                # Step 1: Data Parameters ----
                shiny::tabPanel(
                  title = "Data",
                  icon = shiny::icon('code'),
                  Quantico:::BlankRow(12L),
                  shiny::fluidRow(
                    shiny::column(
                      6L,
                      shinydashboard::box(
                        title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                        Quantico:::BlankRow(12L),
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(
                          shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID = 'TBATS_Data', Label = 'Select Data', Choices = data_Choices, SelectedDefault = data_Selected, Multiple = TRUE, MaxVars = 1L))
                        ),
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(
                          shiny::column(12L, align = 'center', Quantico:::PickerInput(InputID = "TBATS_TargetColumnName", Label = "Target Variable", Choices = NULL, SelectedDefault = TargetColumnName_Selected, Multiple = TRUE, MaxVars = 1L))
                        ),
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(
                          shiny::column(12L, align = 'center', Quantico:::PickerInput(InputID = "TBATS_DateColumnName", Label = "Date Variable", Choices = NULL, SelectedDefault = DateColumnName_Selected, Multiple = TRUE, MaxVars = 1L))
                        ),
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(
                          shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID = "TBATS_TimeUnit", Label = "Time Unit: is your data daily, weekly, monthly, or something else?", Choices = TimeUnit_Choices, SelectedDefault = TimeUnit_Selected, Multiple = FALSE))
                        ),
                        Quantico:::BlankRow(12L),
                        Quantico:::BlankRow(12L)
                      )
                    ),

                    shiny::column(
                      6L,
                      shinydashboard::box(
                        title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(
                          shiny::column(12L, align = 'center', Quantico:::TextInput(InputID = 'TBATS_ModelID', Label="Model ID", Value = ModelID_Selected))
                        ),
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(
                          shiny::column(12L, align = 'center', Quantico:::NumericInput(InputID = "TBATS_FCPeriods", Label = "Forecast Periods", Min = 0, Max = 3600, Step = 1, Value = FCPeriods_Selected))
                        ),
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(
                          shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID = "TBATS_EvaluationMetric", Label = "Evaluation Metric", Choices = EvaluationMetric_Choices, SelectedDefault = EvaluationMetric_Selected, Multiple = FALSE))
                        ),
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(
                          shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID = "TBATS_TrainWeighting", Label = "Train/Test Metrics Blending: Train Weight", Choices = TrainWeighting_Choices, SelectedDefault = TrainWeighting_Selected, Multiple = FALSE))
                        ),
                        Quantico:::BlankRow(12L),
                        Quantico:::BlankRow(12L)
                      )
                    )
                  )
                ),

                # Step 2: Feature Engineering ----
                shiny::tabPanel(
                  title = "Feature Engineering",
                  icon = shiny::icon('code'),
                  Quantico:::BlankRow(12L),
                  shiny::fluidRow(
                    shiny::column(
                      6L,
                      shinydashboard::box(
                        title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(
                          shiny::column(12L, align = 'center', Quantico:::NumericInput(InputID = "TBATS_MaxLags", Label = "Max Lags", Min = 0, Max = 3600, Step = 1, Value = MaxLags_Selected))
                        ),
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(
                          shiny::column(12L, align = 'center', Quantico:::NumericInput(InputID = "TBATS_MaxMovingAverages", Label = "Max Moving Averages", Min = 0, Max = 3600, Step = 1, Value = MaxMovingAverages_Selected))
                        ),
                        Quantico:::BlankRow(12L),
                        Quantico:::BlankRow(12L)
                      )
                    )
                  )
                )
              )
            )
          ),
          # end TagList
          Quantico:::BlankRow(12L),
          footer = shiny::tagList(
            shiny::modalButton(label = "Cancel"),
            shiny::actionButton("TBATS_OK", "OK", width = '50px'))
        )
      )
    }
  )
}

#' @title Sarima_Modal_Fun
#'
#' @description Sarima Parameters Modal with OK button to close
#'
#' @author Adrian Antico
#' @family ML
#'
#' @param id = 'Sarima_ID'
#' @param AppWidth = 12L
#'
#' @export
Sarima_Modal_Fun <- function(id,
                             AppWidth=12L,

                             # Reactives
                             ModelID_Selected = NULL,
                             TargetColumnName_Selected = NULL,
                             DateColumnName_Selected = NULL,

                             # Statics
                             RunMode_Choices = NULL,
                             ArgsList_Choices = NULL,
                             data_Choices = NULL,
                             TimeUnit_Choices = NULL,
                             FCPeriods_Choices = NULL,
                             EvaluationMetric_Choices = NULL,
                             MaxLags_Choices = NULL,
                             MaxSeasonalLags_Choices = NULL,
                             MaxMovingAverages_Choices = NULL,
                             MaxSeasonalMovingAverages_Choices = NULL,
                             MaxFourierPairs_Choices = NULL,
                             TrainWeighting_Choices = NULL,
                             MaxConsecutiveFails_Choices = NULL,
                             MaxNumberModels_Choices = NULL,
                             MaxRunTimeMinutes_Choices = NULL,
                             DebugMode_Choices = NULL,

                             # Updaters
                             data_Selected = NULL,
                             ArgsList_Selected = NULL,
                             RunMode_Selected = NULL,
                             TimeUnit_Selected = NULL,
                             FCPeriods_Selected = NULL,
                             EvaluationMetric_Selected = NULL,
                             MaxLags_Selected = NULL,
                             MaxSeasonalLags_Selected = NULL,
                             MaxMovingAverages_Selected = NULL,
                             MaxSeasonalMovingAverages_Selected = NULL,
                             MaxFourierPairs_Selected = NULL,
                             TrainWeighting_Selected = NULL,
                             MaxConsecutiveFails_Selected = NULL,
                             MaxNumberModels_Selected = NULL,
                             MaxRunTimeMinutes_Selected = NULL,
                             DebugMode_Selected = NULL) {

  shiny::moduleServer(
    id = id,
    module = function(input, output, session) {
      ns <- session$ns
      shiny::showModal(
        shiny::modalDialog(
          title = 'SARIMA FC Parameters',
          size = "l",
          easyClose = FALSE,
          fade = TRUE,
          shiny::tagList(

            # Top Box ----
            shinydashboard::box(
              title = NULL, solidHeader = TRUE, collapsible = FALSE, status = 'danger', width = AppWidth,
              shiny::fluidRow(
                shiny::column(
                  width = 12L,
                  align = "right",
                  shinyWidgets::dropdown(
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = "info", width = 12L,
                      shiny::fluidRow(
                        shiny::column(
                          width = 12L,
                          align = "left",
                          shiny::a(name = "forecasting"),
                          shiny::h2(tags$b("Forecasting")),
                          shiny::p("Single Series Forecasting is generating forecasts for individual series. The SARIMA grid tuner comprises of a
                                   multi-armed bandit model testing framework for SARIMA models (seasonal autoregression integrated moving average).
                                   Randomized probability matching is the underlying bandit algorithm. Model evaluation is done by blending the
                                   training error and the validation error (per user specification) from testing the model on out of sample data.
                                   The bandit algorithm compares the performance of the current build against the previous builds which starts
                                   with the classic auto.arima from the forecast package. Depending on how many lags, moving averages, seasonal
                                   lags and moving averages you test the number of combinations of features to test begins to approach 100,000
                                   different combinations of settings. The function tests out transformations, differencing, and variations of
                                   the lags and moving averages. The parameter space is broken up into various buckets that are increasing in
                                   sophistication. The bandit algorithm samples from those buckets and based on many rounds of testing it
                                   determines which buckets to generate samples from more frequently based on the models performance coming from
                                   that bucket. The forecast process begins by retraining the model with the settings that produced the best
                                   performance from grid tuning. If the model fails to build, for whatever reason, the next best buildable model
                                   is rebuilt"))),

                      Quantico::BlankRow(12),
                      shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::h3("Run Modes:"))),
                      shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::markdown(
                        "
                        There are various Run modes to training, backtesting, and forecasting:
                        * Grid Tune: Grid tuning will evaluate many different models and underlying data structure assumptions. For new time series modeling projects it's advisable to utilize this functionality
                        * Forecast: The mode is for generating forecasts
                        "
                      ))),
                      Quantico::BlankRow(12),
                      shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::h3("Forecasting Usage"))),
                      shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::markdown(
                        "
                        ### Parameters
                        * Select Run Mode: Choose from Grid Tune or Forecast. Grid Tuning is for model evaluation of the many possible configurations. Forecast is to generate a single forecast from a single model specification
                        * Tuning Grid: This is from the Grid Tuning operation. If you saved one previously you can upload it and supply it here. When this is supplied, and you run forecast mode, a forecast will be generated for you. You do not have to supply parameter values to the inputs when you want this functionality utilized
                        * Refresh: If you ran a Grid Tune and want to see the grid tune output as an option for supplying to the Tuning Grid input, click refresh. Alternatively, closing out of the modal and coming back in will also expose the new option
                        * Model ID: Provide a name for your grid tuning or forecasting model. If you supply the same name as a previous model built in session, it will be overwritten
                        * Forecast Periods: The number of periods to use for both evalution purposes and forecast purposes
                        * Target Variable: Variable you are looking to forecast
                        * Date Variable: Date variable that defines your time series
                        * Select Data: Your time series data set
                        * Time Unit: Defines the granularity of your data time series. E.g. daily data has a data point for each day within your series
                        * Evaluation Metric: This is for forecasting mode when you supply a tuning grid.
                        * Max Lags: In grid tuning mode, this will define the maximum number of lags to utilize even though lower values will also be tested. In forecast mode, this will define the max of the lags that are defined (if 5 is selected then 1 though 5 will be utilized)
                        * Max Seasonal Lags: In grid tuning mode, this will define the maximum number of seasonal lags to utilize even though lower values will also be tested. In forecast mode, this will define the max of the seasonal lags that are defined (if 5 is selected then 1 though 5 will be utilized)
                        * Max Moving Averages: In grid tuning mode, this will define the maximum number of moving averages to utilize even though lower values will also be tested. In forecast mode, this will define the max of the moving averages that are defined (if 5 is selected then 1 though 5 will be utilized)
                        * Max Seasonal Moving Averages: In grid tuning mode, this will define the maximum number of seasonal moving averages to utilize even though lower values will also be tested. In forecast mode, this will define the max of the seasonal moving averages that are defined (if 5 is selected then 1 though 5 will be utilized)
                        #* Max Run Time: this for each parameter group created
                        "
                      )))
                    ),

                    size = "lg",
                    icon = shiny::icon("question"),
                    label = NULL,
                    tooltip = FALSE,
                    right = TRUE,
                    up = FALSE,
                    width = NULL,
                    animate = shinyWidgets::animateOptions(
                      enter = "zoomIn",
                      exit = "fadeOutRightBig"
                    ),
                    inputId = NULL,
                    block = FALSE,
                    no_outline = TRUE
                  )
                )
              ),
              Quantico:::BlankRow(12L),
              shiny::fluidRow(
                shiny::column(
                  width = 3L, align = 'center',
                  Quantico:::SelectizeInput(InputID = 'SARIMA_RunMode', Label = 'Select Run Mode', Choices = RunMode_Choices, SelectedDefault = RunMode_Selected, Multiple = TRUE, MaxVars = 1)),
                shiny::column(
                  width = 3L, align = 'center',
                  Quantico:::SelectizeInput(InputID = "SARIMA_ArgsList", Label = "Select Model", Choices = ArgsList_Choices, SelectedDefault = ArgsList_Selected, Multiple = TRUE, MaxVars = 100L)
                ),
                shiny::column(width = 5L),
                shiny::column(
                  width = 1L, align = "center",
                  shiny::actionButton(
                    inputId = paste0('BuildModels_SARIMA'), label = paste0('Run'), icon = shiny::icon('chevron-right', lib='font-awesome')
                  )
                )
              ),

              Quantico::BlankRow(12L),
              shiny::tabsetPanel(
                id = 'SARIMA_TabPanel',
                selected = 'Data',

                # Step 1: Data Parameters ----
                shiny::tabPanel(
                  title = "Data",
                  icon = shiny::icon('code'),
                  Quantico:::BlankRow(12L),
                  shiny::fluidRow(
                    shiny::column(
                      6L,
                      shinydashboard::box(
                        title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                        Quantico:::BlankRow(12L),
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(
                          shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID = 'SARIMA_Data', Label = 'Select Data', Choices = data_Choices, SelectedDefault = data_Selected, Multiple = TRUE, MaxVars = 1L))
                        ),
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(
                          shiny::column(12L, align = 'center', Quantico:::PickerInput(InputID = "SARIMA_TargetColumnName", Label = "Target Variable", Choices = NULL, SelectedDefault = TargetColumnName_Selected, Multiple = TRUE, MaxVars = 1L))
                        ),
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(
                          shiny::column(12L, align = 'center', Quantico:::PickerInput(InputID = "SARIMA_DateColumnName", Label = "Date Variable", Choices = NULL, SelectedDefault = DateColumnName_Selected, Multiple = TRUE, MaxVars = 1L))
                        ),
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(
                          shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID = "SARIMA_TimeUnit", Label = "Time Unit: is your data daily, weekly, monthly, or something else?", Choices = TimeUnit_Choices, SelectedDefault = TimeUnit_Selected, Multiple = TRUE, MaxVars = 1L))
                        ),
                        Quantico:::BlankRow(12L),
                        Quantico:::BlankRow(12L)
                      )
                    ),

                    shiny::column(
                      6L,
                      shinydashboard::box(
                        title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(
                          shiny::column(12L, align = 'center', Quantico:::TextInput(InputID = 'SARIMA_ModelID', Label="Create Model ID", Value = ModelID_Selected))
                        ),
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(
                          shiny::column(12L, align = 'center', Quantico:::NumericInput(InputID = "SARIMA_FCPeriods", Label = "Forecast Periods", Min = 0, Max = 3600, Step = 1, Value = FCPeriods_Selected))
                        ),
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(
                          shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID = "SARIMA_EvaluationMetric", Label = "Evaluation Metric", Choices = EvaluationMetric_Choices, SelectedDefault = EvaluationMetric_Selected, Multiple = TRUE, MaxVars = 1L))
                        ),
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(
                          shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID = "SARIMA_TrainWeighting", Label = "Train/Test Metrics Blending: Train Weight", Choices = TrainWeighting_Choices, SelectedDefault = TrainWeighting_Selected, Multiple = TRUE, MaxVars = 1L))
                        ),
                        Quantico:::BlankRow(12L),
                        Quantico:::BlankRow(12L)
                      )
                    )
                  )
                ),

                # Step 2: Feature Engineering ----
                shiny::tabPanel(
                  title = "Feature Engineering",
                  icon = shiny::icon('code'),
                  Quantico:::BlankRow(12L),
                  shiny::fluidRow(
                    shiny::column(
                      6L,
                      shinydashboard::box(
                        title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(
                          shiny::column(12L, align = 'center', Quantico:::NumericInput(InputID = "SARIMA_MaxLags", Label = "Max Lags", Min = 0, Max = 3600, Step = 1, Value = MaxLags_Selected))
                        ),
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(
                          shiny::column(12L, align = 'center', Quantico:::NumericInput(InputID = "SARIMA_MaxSeasonalLags", Label = "Max Seasonal Lags", Min = 0, Max = 10, Step = 1, Value = MaxSeasonalLags_Selected))
                        ),
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(
                          shiny::column(12L, align = 'center', Quantico:::NumericInput(InputID = "SARIMA_MaxFourierPairs", Label = "Max Fourier Pairs", Min = 0, Max = 2, Step = 1, Value = MaxFourierPairs_Selected))
                        ),
                        Quantico:::BlankRow(12L),
                        Quantico:::BlankRow(12L)
                      )
                    ),
                    shiny::column(
                      6L,
                      shinydashboard::box(
                        title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(
                          shiny::column(12L, align = 'center', Quantico:::NumericInput(InputID = "SARIMA_MaxMovingAverages", Label = "Max Moving Average",  Min = 0, Max = 3600, Step = 1, Value = MaxMovingAverages_Selected))
                        ),
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(
                          shiny::column(12L, align = 'center', Quantico:::NumericInput(InputID = "SARIMA_MaxSeasonalMovingAverages", Label = "Max Seasonal Moving Average",  Min = 0, Max = 10, Step = 1, Value = MaxSeasonalMovingAverages_Selected))
                        ),
                        Quantico:::BlankRow(12L),
                        Quantico:::BlankRow(12L)
                      )
                    )
                  )
                ),

                # Step 3: Grid Tuning ----
                shiny::tabPanel(
                  title = "Grid Tuning",
                  icon = shiny::icon('code'),
                  Quantico:::BlankRow(12L),
                  shiny::fluidRow(
                    shiny::column(
                      6L,
                      shinydashboard::box(
                        title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(
                          shiny::column(12L, align = 'center', Quantico:::NumericInput(InputID = "SARIMA_MaxRunTimeMinutes", Label = "Max Run Time in Minutes", Min = 0, Max = 3600, Step = 1, Value = MaxRunTimeMinutes_Selected))
                        ),
                        Quantico:::BlankRow(12L),
                        Quantico:::BlankRow(12L)
                      )
                    ),
                    shiny::column(
                      6L,
                      shinydashboard::box(
                        title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(
                          shiny::column(12L, align = 'center', Quantico:::NumericInput(InputID = "SARIMA_MaxConsecutiveFails", Label = "Max Consecutive Failures", Min = 0, Max = 3600, Step = 1, Value = MaxConsecutiveFails_Selected))
                        ),
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(
                          shiny::column(12L, align = 'center', Quantico:::NumericInput(InputID = "SARIMA_MaxNumberModels", Label = "Max Number of Models", Min = 0, Max = 3600, Step = 1, Value = MaxNumberModels_Selected))
                        ),
                        Quantico:::BlankRow(12L),
                        Quantico:::BlankRow(12L)
                      )
                    )
                  )
                )
              )
            )
          ),

          # end TagList
          Quantico:::BlankRow(12L),
          footer = shiny::tagList(
            shiny::modalButton(label = "Cancel"),
            shiny::actionButton("SARIMA_OK", "OK", width = '50px'))
        )
      )
    }
  )
}

#' @title ETS_Modal_Fun
#'
#' @description ETS Parameters Modal with OK button to close
#'
#' @author Adrian Antico
#' @family ML
#'
#' @param id = 'ETS_ID'
#' @param AppWidth = 12L
#'
#' @export
ETS_Modal_Fun <- function(id,
                          AppWidth=12L,

                          # Reactives
                          ModelID_Selected = NULL,
                          TargetColumnName_Selected = NULL,
                          DateColumnName_Selected = NULL,

                          # Statics
                          RunMode_Choices = NULL,
                          ArgsList_Choices = NULL,
                          data_Choices = NULL,
                          TimeUnit_Choices = NULL,
                          FCPeriods_Choices = NULL,
                          EvaluationMetric_Choices = NULL,
                          TrainWeighting_Choices = NULL,
                          DebugMode_Choices = NULL,

                          # Updaters
                          data_Selected = NULL,
                          ArgsList_Selected = NULL,
                          RunMode_Selected = NULL,
                          TimeUnit_Selected = NULL,
                          FCPeriods_Selected = NULL,
                          EvaluationMetric_Selected = NULL,
                          TrainWeighting_Selected = NULL,
                          DebugMode_Selected = NULL) {

  shiny::moduleServer(
    id = id,
    module = function(input, output, session) {
      ns <- session$ns
      shiny::showModal(
        shiny::modalDialog(
          title = 'ETS FC Parameters',
          size = "l",
          easyClose = FALSE,
          fade = TRUE,
          shiny::tagList(

            # Top Box ----
            shinydashboard::box(
              title = NULL, solidHeader = TRUE, collapsible = FALSE, status = 'danger', width = AppWidth,
              shiny::fluidRow(
                shiny::column(
                  width = 12L,
                  align = "right",
                  shinyWidgets::dropdown(
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = "info", width = 12L,
                      shiny::fluidRow(
                        shiny::column(
                          width = 12L,
                          align = "left",
                          shiny::a(name = "forecasting"),
                          shiny::h2(tags$b("Forecasting")),
                          shiny::p("Single Series Forecasting is generating forecasts for individual series. The ETS forecasting grid tuner
                                   is model testing framework for ETS (Exponential smoothing state space model with Box-Cox transformation,
                                   ARMA errors, Trend and Seasonal components). Model evaluation is done by blending the training error and
                                   the validation error from testing the model on out of sample data. The bandit algorithm compares the
                                   performance of the current build against the previous builds which starts with the classic nnetar model
                                   from the forecast package. Depending on how many different error types, trend types, seasonality types, damped trend, alpha, beta, phi, and transformations, you test the
                                   number of combinations of features to test begins to approach 10,000 different combinations of settings.
                                   The function tests out error types, trend types, seasonality types, damped trend, alpha, beta, phi, and transformations.
                                   The forecast process begins by retraining the model with the settings that produced the best performance.
                                   If the model fails to build, for whatever reason, the next best buildable model is rebuilt."))),

                      Quantico::BlankRow(12),
                      shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::h3("Run Modes:"))),
                      shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::markdown(
                        "
                        There are various Run modes to training, backtesting, and forecasting:
                        * Grid Tune: Grid tuning will evaluate many different models and underlying data structure assumptions. For new time series modeling projects it's advisable to utilize this functionality
                        * Forecast: The mode is for generating forecasts
                        "
                      ))),
                      Quantico::BlankRow(12),
                      shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::h3("Forecasting Usage"))),
                      shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::markdown(
                        "
                        ### Parameters
                        * Select Run Mode: Choose from Grid Tune or Forecast. Grid Tuning is for model evaluation of the many possible configurations. Forecast is to generate a single forecast from a single model specification
                        * Tuning Grid: This is from the Grid Tuning operation. If you saved one previously you can upload it and supply it here. When this is supplied, and you run forecast mode, a forecast will be generated for you. You do not have to supply parameter values to the inputs when you want this functionality utilized
                        * Refresh: If you ran a Grid Tune and want to see the grid tune output as an option for supplying to the Tuning Grid input, click refresh. Alternatively, closing out of the modal and coming back in will also expose the new option
                        * Model ID: Provide a name for your grid tuning or forecasting model. If you supply the same name as a previous model built in session, it will be overwritten
                        * Forecast Periods: The number of periods to use for both evalution purposes and forecast purposes
                        * Target Variable: Variable you are looking to forecast
                        * Date Variable: Date variable that defines your time series
                        * Select Data: Your time series data set
                        * Time Unit: Defines the granularity of your data time series. E.g. daily data has a data point for each day within your series
                        * Evaluation Metric: This is for forecasting mode when you supply a tuning grid.
                        "
                      )))
                    ),

                    size = "lg",
                    icon = shiny::icon("question"),
                    label = NULL,
                    tooltip = FALSE,
                    right = TRUE,
                    up = FALSE,
                    width = NULL,
                    animate = shinyWidgets::animateOptions(
                      enter = "zoomIn",
                      exit = "fadeOutRightBig"
                    ),
                    inputId = NULL,
                    block = FALSE,
                    no_outline = TRUE
                  )
                )
              ),
              Quantico:::BlankRow(12L),
              shiny::fluidRow(
                shiny::column(
                  width = 3L, align = 'center',
                  Quantico:::SelectizeInput(InputID = 'ETS_RunMode', Label = 'Select Run Mode', Choices = RunMode_Choices, SelectedDefault = RunMode_Selected, Multiple = TRUE, MaxVars = 1)),
                shiny::column(
                  width = 3L, align = 'center',
                  Quantico:::SelectizeInput(InputID = "ETS_ArgsList", Label = "Tuning Grid", Choices = ArgsList_Choices, SelectedDefault = ArgsList_Selected, Multiple = TRUE, MaxVars = 100L)
                ),
                shiny::column(width = 5L),
                shiny::column(
                  width = 1L, align = "center",
                  shiny::actionButton(
                    inputId = paste0('BuildModels_ETS'), label = paste0('Run'), icon = shiny::icon('chevron-right', lib='font-awesome')
                  )
                )
              ),

              Quantico::BlankRow(12L),
              shiny::tabsetPanel(
                id = 'ETS_TabPanel',
                selected = 'Data',

                # Step 1: Data Parameters ----
                shiny::tabPanel(
                  title = "Data",
                  icon = shiny::icon('code'),
                  Quantico:::BlankRow(12L),
                  shiny::fluidRow(
                    shiny::column(
                      6L,
                      shinydashboard::box(
                        title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                        Quantico:::BlankRow(12L),
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(
                          shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID = 'ETS_Data', Label = 'Select Data', Choices = data_Choices, SelectedDefault = data_Selected, Multiple = TRUE, MaxVars = 1L))
                        ),
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(
                          shiny::column(12L, align = 'center', Quantico:::PickerInput(InputID = "ETS_TargetColumnName", Label = "Target Variable", Choices = NULL, SelectedDefault = TargetColumnName_Selected, Multiple = TRUE, MaxVars = 1L))
                        ),
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(
                          shiny::column(12L, align = 'center', Quantico:::PickerInput(InputID = "ETS_DateColumnName", Label = "Date Variable", Choices = NULL, SelectedDefault = DateColumnName_Selected, Multiple = TRUE, MaxVars = 1L))
                        ),
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(
                          shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID = "ETS_TimeUnit", Label = "Time Unit: is your data daily, weekly, monthly, or something else?", Choices = TimeUnit_Choices, SelectedDefault = TimeUnit_Selected, Multiple = FALSE))
                        ),
                        Quantico:::BlankRow(12L),
                        Quantico:::BlankRow(12L)
                      )
                    ),

                    shiny::column(
                      6L,
                      shinydashboard::box(
                        title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(
                          shiny::column(12L, align = 'center', Quantico:::TextInput(InputID = 'ETS_ModelID', Label="Model ID", Value = ModelID_Selected))
                        ),
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(
                          shiny::column(12L, align = 'center', Quantico:::NumericInput(InputID = "ETS_FCPeriods", Label = "Forecast Periods", Min = 0, Max = 3600, Step = 1, Value = FCPeriods_Selected))
                        ),
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(
                          shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID = "ETS_EvaluationMetric", Label = "Evaluation Metric", Choices = EvaluationMetric_Choices, SelectedDefault = EvaluationMetric_Selected, Multiple = FALSE))
                        ),
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(
                          shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID = "ETS_TrainWeighting", Label = "Train/Test Metrics Blending: Train Weight", Choices = TrainWeighting_Choices, SelectedDefault = TrainWeighting_Selected, Multiple = FALSE))
                        ),
                        Quantico:::BlankRow(12L),
                        Quantico:::BlankRow(12L)
                      )
                    )
                  )
                )
              )
            )
          ),
          # end TagList
          Quantico:::BlankRow(12L),
          footer = shiny::tagList(
            shiny::modalButton(label = "Cancel"),
            shiny::actionButton("ETS_OK", "OK", width = '50px'))
        )
      )
    }
  )
}

#' @title ARFIMA_Modal_Fun
#'
#' @description ARFIMA Parameters Modal with OK button to close
#'
#' @author Adrian Antico
#' @family ML
#'
#' @param id = 'ARFIMA_ID'
#' @param AppWidth = 12L
#'
#' @export
ARFIMA_Modal_Fun <- function(id,
                            AppWidth=12L,

                            # Reactives
                            ModelID_Selected = NULL,
                            TargetColumnName_Selected = NULL,
                            DateColumnName_Selected = NULL,

                            # Statics
                            RunMode_Choices = NULL,
                            ArgsList_Choices = NULL,
                            data_Choices = NULL,
                            TimeUnit_Choices = NULL,
                            FCPeriods_Choices = NULL,
                            EvaluationMetric_Choices = NULL,
                            TrainWeighting_Choices = NULL,
                            DebugMode_Choices = NULL,

                            # Updaters
                            data_Selected = NULL,
                            ArgsList_Selected = NULL,
                            RunMode_Selected = NULL,
                            TimeUnit_Selected = NULL,
                            FCPeriods_Selected = NULL,
                            EvaluationMetric_Selected = NULL,
                            MaxLags_Selected = NULL,
                            MaxMovingAverages_Selected = NULL,
                            TrainWeighting_Selected = NULL,
                            DebugMode_Selected = NULL) {

  shiny::moduleServer(
    id = id,
    module = function(input, output, session) {
      ns <- session$ns
      shiny::showModal(
        shiny::modalDialog(
          title = 'ARFIMA FC Parameters',
          size = "l",
          easyClose = FALSE,
          fade = TRUE,
          shiny::tagList(

            # Top Box ----
            shinydashboard::box(
              title = NULL, solidHeader = TRUE, collapsible = FALSE, status = 'danger', width = AppWidth,
              shiny::fluidRow(
                shiny::column(
                  width = 12L,
                  align = "right",
                  shinyWidgets::dropdown(
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = "info", width = 12L,
                      shiny::fluidRow(
                        shiny::column(
                          width = 12L,
                          align = "left",
                          shiny::a(name = "forecasting"),
                          shiny::h2(tags$b("Forecasting")),
                          shiny::p("Single Series Forecasting is generating forecasts for individual series. The ARFIMA forecasting grid tuner
                                   is model testing framework for ARFIMA (Lags, Moving Averages, Transformations, and Fractional Differencing). Model evaluation is done by blending the training error and
                                   the validation error from testing the model on out of sample data. The bandit algorithm compares the
                                   performance of the current build against the previous builds which starts with the classic nnetar model
                                   from the forecast package. Depending on how many lags, moving averages, transformations, and fractional differencing you test the
                                   number of combinations of features to test begins to approach 10,000 different combinations of settings.
                                   The function tests out lags, moving averages, transformations, and fractional differencing.
                                   The forecast process begins by retraining the model with the settings that produced the best performance.
                                   If the model fails to build, for whatever reason, the next best buildable model is rebuilt."))),

                      Quantico::BlankRow(12),
                      shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::h3("Run Modes:"))),
                      shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::markdown(
                        "
                        There are various Run modes to training, backtesting, and forecasting:
                        * Grid Tune: Grid tuning will evaluate many different models and underlying data structure assumptions. For new time series modeling projects it's advisable to utilize this functionality
                        * Forecast: The mode is for generating forecasts
                        "
                      ))),
                      Quantico::BlankRow(12),
                      shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::h3("Forecasting Usage"))),
                      shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::markdown(
                        "
                        ### Parameters
                        * Select Run Mode: Choose from Grid Tune or Forecast. Grid Tuning is for model evaluation of the many possible configurations. Forecast is to generate a single forecast from a single model specification
                        * Tuning Grid: This is from the Grid Tuning operation. If you saved one previously you can upload it and supply it here. When this is supplied, and you run forecast mode, a forecast will be generated for you. You do not have to supply parameter values to the inputs when you want this functionality utilized
                        * Refresh: If you ran a Grid Tune and want to see the grid tune output as an option for supplying to the Tuning Grid input, click refresh. Alternatively, closing out of the modal and coming back in will also expose the new option
                        * Model ID: Provide a name for your grid tuning or forecasting model. If you supply the same name as a previous model built in session, it will be overwritten
                        * Forecast Periods: The number of periods to use for both evalution purposes and forecast purposes
                        * Target Variable: Variable you are looking to forecast
                        * Date Variable: Date variable that defines your time series
                        * Select Data: Your time series data set
                        * Time Unit: Defines the granularity of your data time series. E.g. daily data has a data point for each day within your series
                        * Evaluation Metric: This is for forecasting mode when you supply a tuning grid.
                        * Max Lags: In grid tuning mode, this will define the maximum number of lags to utilize even though lower values will also be tested. In forecast mode, this will define the max of the lags that are defined (if 5 is selected then 1 though 5 will be utilized)
                        * Max Moving Averages: In grid tuning mode, this will define the maximum number of moving averages to utilize even though lower values will also be tested. In forecast mode, this will define the max of the moving averages that are defined (if 5 is selected then 1 though 5 will be utilized)
                        * Max Seasonal Periods: In grid tuning mode, this will define the maximum number of seasonal lags to utilize even though lower values will also be tested. In forecast mode, this will define the max of the seasonal lags that are defined (if 5 is selected then 1 though 5 will be utilized)
                        "
                      )))
                    ),

                    size = "lg",
                    icon = shiny::icon("question"),
                    label = NULL,
                    tooltip = FALSE,
                    right = TRUE,
                    up = FALSE,
                    width = NULL,
                    animate = shinyWidgets::animateOptions(
                      enter = "zoomIn",
                      exit = "fadeOutRightBig"
                    ),
                    inputId = NULL,
                    block = FALSE,
                    no_outline = TRUE
                  )
                )
              ),
              Quantico:::BlankRow(12L),
              shiny::fluidRow(
                shiny::column(
                  width = 3L, align = 'center',
                  Quantico:::SelectizeInput(InputID = 'ARFIMA_RunMode', Label = 'Select Run Mode', Choices = RunMode_Choices, SelectedDefault = RunMode_Selected, Multiple = TRUE, MaxVars = 1)),
                shiny::column(
                  width = 3L, align = 'center',
                  Quantico:::SelectizeInput(InputID = "ARFIMA_ArgsList", Label = "Tuning Grid", Choices = ArgsList_Choices, SelectedDefault = ArgsList_Selected, Multiple = TRUE, MaxVars = 100L)
                ),
                shiny::column(width = 5L),
                shiny::column(
                  width = 1L, align = "center",
                  shiny::actionButton(
                    inputId = paste0('BuildModels_ARFIMA'), label = paste0('Run'), icon = shiny::icon('chevron-right', lib='font-awesome')
                  )
                )
              ),

              Quantico::BlankRow(12L),
              shiny::tabsetPanel(
                id = 'ARFIMA_TabPanel',
                selected = 'Data',

                # Step 1: Data Parameters ----
                shiny::tabPanel(
                  title = "Data",
                  icon = shiny::icon('code'),
                  Quantico:::BlankRow(12L),
                  shiny::fluidRow(
                    shiny::column(
                      6L,
                      shinydashboard::box(
                        title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                        Quantico:::BlankRow(12L),
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(
                          shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID = 'ARFIMA_Data', Label = 'Select Data', Choices = data_Choices, SelectedDefault = data_Selected, Multiple = TRUE, MaxVars = 1L))
                        ),
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(
                          shiny::column(12L, align = 'center', Quantico:::PickerInput(InputID = "ARFIMA_TargetColumnName", Label = "Target Variable", Choices = NULL, SelectedDefault = TargetColumnName_Selected, Multiple = TRUE, MaxVars = 1L))
                        ),
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(
                          shiny::column(12L, align = 'center', Quantico:::PickerInput(InputID = "ARFIMA_DateColumnName", Label = "Date Variable", Choices = NULL, SelectedDefault = DateColumnName_Selected, Multiple = TRUE, MaxVars = 1L))
                        ),
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(
                          shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID = "ARFIMA_TimeUnit", Label = "Time Unit: is your data daily, weekly, monthly, or something else?", Choices = TimeUnit_Choices, SelectedDefault = TimeUnit_Selected, Multiple = FALSE))
                        ),
                        Quantico:::BlankRow(12L),
                        Quantico:::BlankRow(12L)
                      )
                    ),

                    shiny::column(
                      6L,
                      shinydashboard::box(
                        title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(
                          shiny::column(12L, align = 'center', Quantico:::TextInput(InputID = 'ARFIMA_ModelID', Label="Model ID", Value = ModelID_Selected))
                        ),
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(
                          shiny::column(12L, align = 'center', Quantico:::NumericInput(InputID = "ARFIMA_FCPeriods", Label = "Forecast Periods", Min = 0, Max = 3600, Value = FCPeriods_Selected, Step = 1))
                        ),
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(
                          shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID = "ARFIMA_EvaluationMetric", Label = "Evaluation Metric", Choices = EvaluationMetric_Choices, SelectedDefault = EvaluationMetric_Selected, Multiple = FALSE))
                        ),
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(
                          shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID = "ARFIMA_TrainWeighting", Label = "Train/Test Metrics Blending: Train Weight", Choices = TrainWeighting_Choices, SelectedDefault = TrainWeighting_Selected, Multiple = FALSE))
                        ),
                        Quantico:::BlankRow(12L),
                        Quantico:::BlankRow(12L)
                      )
                    )
                  )
                ),

                # Step 2: Feature Engineering ----
                shiny::tabPanel(
                  title = "Feature Engineering",
                  icon = shiny::icon('code'),
                  Quantico:::BlankRow(12L),
                  shiny::fluidRow(
                    shiny::column(
                      6L,
                      shinydashboard::box(
                        title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(
                          shiny::column(12L, align = 'center', Quantico:::NumberInput(InputID = "ARFIMA_MaxLags", Label = "Max Lags", Min = 0, Max = 3600, Step = 1, Value = MaxLags_Selected))
                        ),
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(
                          shiny::column(12L, align = 'center', Quantico:::NumberInput(InputID = "ARFIMA_MaxMovingAverages", Label = "Max Moving Averages", Min = 0, Max = 3600, Step = 1, Value = MaxMovingAverages_Selected))
                        ),
                        Quantico:::BlankRow(12L),
                        Quantico:::BlankRow(12L)
                      )
                    )
                  )
                )
              )
            )
          ),
          # end TagList
          Quantico:::BlankRow(12L),
          footer = shiny::tagList(
            shiny::modalButton(label = "Cancel"),
            shiny::actionButton("ARFIMA_OK", "OK", width = '50px'))
        )
      )
    }
  )
}

#' @title NNET_Modal_Fun
#'
#' @description NNET Parameters Modal with OK button to close
#'
#' @author Adrian Antico
#' @family ML
#'
#' @param id = 'NNET_ID'
#' @param AppWidth = 12L
#'
#' @export
NNET_Modal_Fun <- function(id,
                           AppWidth=12L,

                           # Reactives
                           ModelID_Selected = NULL,
                           TargetColumnName_Selected = NULL,
                           DateColumnName_Selected = NULL,

                           # Statics
                           RunMode_Choices = NULL,
                           ArgsList_Choices = NULL,
                           data_Choices = NULL,
                           TimeUnit_Choices = NULL,
                           FCPeriods_Choices = NULL,
                           EvaluationMetric_Choices = NULL,
                           MaxLags_Choices = NULL,
                           MaxSeasonalLags_Choices = NULL,
                           MaxFourierPairs_Choices = NULL,
                           TrainWeighting_Choices = NULL,
                           MaxConsecutiveFails_Choices = NULL,
                           MaxNumberModels_Choices = NULL,
                           MaxRunTimeMinutes_Choices = NULL,
                           DebugMode_Choices = NULL,

                           # Updaters
                           data_Selected = NULL,
                           ArgsList_Selected = NULL,
                           RunMode_Selected = NULL,
                           TimeUnit_Selected = NULL,
                           FCPeriods_Selected = NULL,
                           EvaluationMetric_Selected = NULL,
                           MaxLags_Selected = NULL,
                           MaxSeasonalLags_Selected = NULL,
                           MaxFourierPairs_Selected = NULL,
                           TrainWeighting_Selected = NULL,
                           MaxConsecutiveFails_Selected = NULL,
                           MaxNumberModels_Selected = NULL,
                           MaxRunTimeMinutes_Selected = NULL,
                           DebugMode_Selected = NULL) {

  shiny::moduleServer(
    id = id,
    module = function(input, output, session) {
      ns <- session$ns
      shiny::showModal(
        shiny::modalDialog(
          title = 'NNET FC Parameters',
          size = "l",
          easyClose = FALSE,
          fade = TRUE,
          shiny::tagList(

            # Top Box ----
            shinydashboard::box(
              title = NULL, solidHeader = TRUE, collapsible = FALSE, status = 'danger', width = AppWidth,
              shiny::fluidRow(
                shiny::column(
                  width = 12L,
                  align = "right",
                  shinyWidgets::dropdown(
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = "info", width = 12L,
                      shiny::fluidRow(
                        shiny::column(
                          width = 12L,
                          align = "left",
                          shiny::a(name = "forecasting"),
                          shiny::h2(tags$b("Forecasting")),
                          shiny::p("Single Series Forecasting is generating forecasts for individual series. The NNET forecasting grid tuner
                                   is a multi-armed bandit model testing framework for AR and SAR NNets. Randomized probability matching is
                                   the underlying bandit algorithm. Model evaluation is done by blending the training error and the validation
                                   error (per user specification) from testing the model on out of sample data. The bandit algorithm compares
                                   the performance of the current build against the previous builds which starts with the classic nnetar model
                                   from the forecast package. Depending on how many lags, seasonal lags, and fourier pairs you test the number
                                   of combinations of features to test begins to approach 10,000 different combinations of settings. The function
                                   tests out transformations, differencing, and variations of the lags, and seasonal lags The parameter space is
                                   broken up into various buckets that are increasing in sophistication. The bandit algorithm samples from those
                                   buckets and based on many rounds of testing it determines which buckets to generate samples from more frequently
                                   based on the models performance coming from that bucket. All of the models have performance data collected
                                   on them. The forecasting process begins by retraining the model with the settings that produced the best
                                   performance. If the model fails to build, for whatever reason, the next best buildable model is rebuilt"))),

                      Quantico::BlankRow(12),
                      shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::h3("Run Modes:"))),
                      shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::markdown(
                        "
                        There are various Run modes to training, backtesting, and forecasting:
                        * Grid Tune: Grid tuning will evaluate many different models and underlying data structure assumptions. For new time series modeling projects it's advisable to utilize this functionality
                        * Forecast: The mode is for generating forecasts
                        "
                      ))),
                      Quantico::BlankRow(12),
                      shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::h3("Forecasting Usage"))),
                      shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::markdown(
                        "
                        ### Parameters
                        * Select Run Mode: Choose from Grid Tune or Forecast. Grid Tuning is for model evaluation of the many possible configurations. Forecast is to generate a single forecast from a single model specification
                        * Tuning Grid: This is from the Grid Tuning operation. If you saved one previously you can upload it and supply it here. When this is supplied, and you run forecast mode, a forecast will be generated for you. You do not have to supply parameter values to the inputs when you want this functionality utilized
                        * Refresh: If you ran a Grid Tune and want to see the grid tune output as an option for supplying to the Tuning Grid input, click refresh. Alternatively, closing out of the modal and coming back in will also expose the new option
                        * Model ID: Provide a name for your grid tuning or forecasting model. If you supply the same name as a previous model built in session, it will be overwritten
                        * Forecast Periods: The number of periods to use for both evalution purposes and forecast purposes
                        * Target Variable: Variable you are looking to forecast
                        * Date Variable: Date variable that defines your time series
                        * Select Data: Your time series data set
                        * Time Unit: Defines the granularity of your data time series. E.g. daily data has a data point for each day within your series
                        * Evaluation Metric: This is for forecasting mode when you supply a tuning grid.
                        * Max Lags: In grid tuning mode, this will define the maximum number of lags to utilize even though lower values will also be tested. In forecast mode, this will define the max of the lags that are defined (if 5 is selected then 1 though 5 will be utilized)
                        * Max Seasonal Lags: In grid tuning mode, this will define the maximum number of seasonal lags to utilize even though lower values will also be tested. In forecast mode, this will define the max of the seasonal lags that are defined (if 5 is selected then 1 though 5 will be utilized)
                        "
                      )))
                    ),

                    size = "lg",
                    icon = shiny::icon("question"),
                    label = NULL,
                    tooltip = FALSE,
                    right = TRUE,
                    up = FALSE,
                    width = NULL,
                    animate = shinyWidgets::animateOptions(
                      enter = "zoomIn",
                      exit = "fadeOutRightBig"
                    ),
                    inputId = NULL,
                    block = FALSE,
                    no_outline = TRUE
                  )
                )
              ),
              Quantico:::BlankRow(12L),
              shiny::fluidRow(
                shiny::column(
                  width = 3L, align = 'center',
                  Quantico:::SelectizeInput(InputID = 'NNET_RunMode', Label = 'Select Run Mode', Choices = RunMode_Choices, SelectedDefault = RunMode_Selected, Multiple = TRUE, MaxVars = 1)),
                shiny::column(
                  width = 3L, align = 'center',
                  Quantico:::SelectizeInput(InputID = "NNET_ArgsList", Label = "Tuning Grid", Choices = ArgsList_Choices, SelectedDefault = ArgsList_Selected, Multiple = TRUE, MaxVars = 100L)
                ),
                shiny::column(width = 5L),
                shiny::column(
                  width = 1L, align = "center",
                  shiny::actionButton(
                    inputId = paste0('BuildModels_NNET'), label = paste0('Run'), icon = shiny::icon('chevron-right', lib='font-awesome')
                  )
                )
              ),

              Quantico::BlankRow(12L),
              shiny::tabsetPanel(
                id = 'NNET_TabPanel',
                selected = 'Data',

                # Step 1: Data Parameters ----
                shiny::tabPanel(
                  title = "Data",
                  icon = shiny::icon('code'),
                  Quantico:::BlankRow(12L),
                  shiny::fluidRow(
                    shiny::column(
                      6L,
                      shinydashboard::box(
                        title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                        Quantico:::BlankRow(12L),
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(
                          shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID = 'NNET_Data', Label = 'Select Data', Choices = data_Choices, SelectedDefault = data_Selected, Multiple = TRUE, MaxVars = 1L))
                        ),
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(
                          shiny::column(12L, align = 'center', Quantico:::PickerInput(InputID = "NNET_TargetColumnName", Label = "Target Variable", Choices = NULL, SelectedDefault = TargetColumnName_Selected, Multiple = TRUE, MaxVars = 1L))
                        ),
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(
                          shiny::column(12L, align = 'center', Quantico:::PickerInput(InputID = "NNET_DateColumnName", Label = "Date Variable", Choices = NULL, SelectedDefault = DateColumnName_Selected, Multiple = TRUE, MaxVars = 1L))
                        ),
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(
                          shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID = "NNET_TimeUnit", Label = "Time Unit: is your data daily, weekly, monthly, or something else?", Choices = TimeUnit_Choices, SelectedDefault = TimeUnit_Selected, Multiple = FALSE))
                        ),
                        Quantico:::BlankRow(12L),
                        Quantico:::BlankRow(12L)
                      )
                    ),

                    shiny::column(
                      6L,
                      shinydashboard::box(
                        title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(
                          shiny::column(12L, align = 'center', Quantico:::TextInput(InputID = 'NNET_ModelID', Label="Model ID", Value = ModelID_Selected))
                        ),
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(
                          shiny::column(12L, align = 'center', Quantico:::NumericInput(InputID = "NNET_FCPeriods", Label = "Forecast Periods", Min = 0, Max = 3600, Step = 1, Value = FCPeriods_Selected))
                        ),
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(
                          shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID = "NNET_EvaluationMetric", Label = "Evaluation Metric", Choices = EvaluationMetric_Choices, SelectedDefault = EvaluationMetric_Selected, Multiple = FALSE))
                        ),
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(
                          shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID = "NNET_TrainWeighting", Label = "Train/Test Metrics Blending: Train Weight", Choices = TrainWeighting_Choices, SelectedDefault = TrainWeighting_Selected, Multiple = FALSE))
                        ),
                        Quantico:::BlankRow(12L),
                        Quantico:::BlankRow(12L)
                      )
                    )
                  )
                ),

                # Step 2: Feature Engineering ----
                shiny::tabPanel(
                  title = "Feature Engineering",
                  icon = shiny::icon('code'),
                  Quantico:::BlankRow(12L),
                  shiny::fluidRow(
                    shiny::column(
                      6L,
                      shinydashboard::box(
                        title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(
                          shiny::column(12L, align = 'center', Quantico:::NumericInput(InputID = "NNET_MaxLags", Label = "Max Lags", Min = 0, Max = 3600, Step = 1, Value = MaxLags_Selected))
                        ),
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(
                          shiny::column(12L, align = 'center', Quantico:::NumericInput(InputID = "NNET_MaxSeasonalLags", Label = "Max Seasonal Lags", Min = 0, Max = 10, Step = 1, Value = MaxSeasonalLags_Selected))
                        ),
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(
                          shiny::column(12L, align = 'center', Quantico:::NumericInput(InputID = "NNET_MaxFourierPairs", Label = "Max Fourier Pairs", Min = 0, Max = 2, Step = 1, Value = MaxFourierPairs_Selected))
                        ),
                        Quantico:::BlankRow(12L),
                        Quantico:::BlankRow(12L)
                      )
                    )
                  )
                ),

                # Step 3: Grid Tuning ----
                shiny::tabPanel(
                  title = "Grid Tuning",
                  icon = shiny::icon('code'),
                  Quantico:::BlankRow(12L),
                  shiny::fluidRow(
                    shiny::column(
                      6L,
                      shinydashboard::box(
                        title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(
                          shiny::column(12L, align = 'center', Quantico:::NumericInput(InputID = "NNET_MaxRunTimeMinutes", Label = "Max Run Time in Minutes", Min = 0, Max = 3600, Step = 1, Value = MaxRunTimeMinutes_Selected))
                        ),
                        Quantico:::BlankRow(12L),
                        Quantico:::BlankRow(12L)
                      )
                    ),
                    shiny::column(
                      6L,
                      shinydashboard::box(
                        title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(
                          shiny::column(12L, align = 'center', Quantico:::NumericInput(InputID = "NNET_MaxConsecutiveFails", Label = "Max Consecutive Failures", Min = 0, Max = 1000, Step = 1, Value = MaxConsecutiveFails_Selected))
                        ),
                        Quantico:::BlankRow(12L),
                        shiny::fluidRow(
                          shiny::column(12L, align = 'center', Quantico:::NumericInput(InputID = "NNET_MaxNumberModels", Label = "Max Number of Models", Min = 0, Max = 10000, Step = 1, Value = MaxNumberModels_Selected))
                        ),
                        Quantico:::BlankRow(12L),
                        Quantico:::BlankRow(12L)
                      )
                    )
                  )
                )
              )
            )
          ),

          # end TagList
          Quantico:::BlankRow(12L),
          footer = shiny::tagList(
            shiny::modalButton(label = "Cancel"),
            shiny::actionButton("NNET_OK", "OK", width = '50px'))
        )
      )
    }
  )
}

#' @title CatBoostCARMA_Modal_Fun
#'
#' @description CatBoost CARMA Parameters Modal with OK button to close
#'
#' @author Adrian Antico
#' @family ML
#'
#' @param id = 'CatBoostCARMA_ID'
#' @param AppWidth = 12L
#'
#' @export
CatBoostCARMA_Modal_Fun <- function(id,
                                    AppWidth=12L,

                                    # Reactives
                                    CatBoostCARMA_TargetColumnName_Selected = NULL,
                                    CatBoostCARMA_DateColumnName_Selected = NULL,
                                    CatBoostCARMA_GroupVariables_Selected = NULL,
                                    CatBoostCARMA_ModelID_Selected = NULL,

                                    # Statics
                                    CatBoostCARMA_RunMode_Choices = NULL,
                                    CatBoostCARMA_ArgsList_Choices = NULL,
                                    CatBoostCARMA_TrainData_Choices = NULL,
                                    CatBoostCARMA_ValidationData_Choices = NULL,
                                    CatBoostCARMA_XREGS_Choices = NULL,
                                    CatBoostCARMA_TimeUnit_Choices = NULL,
                                    CatBoostCARMA_FCPeriods_Choices = NULL,
                                    CatBoostCARMA_EncodingMethod_Choices = NULL,
                                    CatBoostCARMA_ZeroPadSeries_Choices = NULL,
                                    CatBoostCARMA_Methods_Choices = NULL,
                                    CatBoostCARMA_Difference_Choices = NULL,
                                    CatBoostCARMA_TimeWeights_Choices = NULL,
                                    CatBoostCARMA_NonNegativePred_Choices = NULL,
                                    CatBoostCARMA_RoundPreds_Choices = NULL,
                                    CatBoostCARMA_TaskType_Choices = NULL,
                                    CatBoostCARMA_NumGPU_Choices = NULL,
                                    CatBoostCARMA_SaveModel_Choices = NULL,
                                    CatBoostCARMA_CalendarVariables_Choices = NULL,
                                    CatBoostCARMA_HolidayVariables_Choices = NULL,
                                    CatBoostCARMA_Lookback_Choices = NULL,
                                    CatBoostCARMA_TimeTrend_Choices = NULL,
                                    CatBoostCARMA_AnomalyDetection_HighThreshold_Choices = NULL,
                                    CatBoostCARMA_AnomalyDetection_LowThreshold_Choices = NULL,
                                    CatBoostCARMA_Lags_Choices = NULL,
                                    CatBoostCARMA_MovingAverages_Choices = NULL,
                                    CatBoostCARMA_MovingSD_Choices = NULL,
                                    CatBoostCARMA_MovingSkew_Choices = NULL,
                                    CatBoostCARMA_MovingKurt_Choices = NULL,
                                    CatBoostCARMA_MovingQuantiles_Choices = NULL,
                                    CatBoostCARMA_Quantiles_Selected_Choices = NULL,
                                    CatBoostCARMA_DataTruncate_Choices = NULL,
                                    CatBoostCARMA_NTrees_Choices = NULL,
                                    CatBoostCARMA_Depth_Choices = NULL,
                                    CatBoostCARMA_Langevin_Choices = NULL,
                                    CatBoostCARMA_DiffusionTemperature_Choices = NULL,
                                    CatBoostCARMA_SubSample_Choices = NULL,
                                    CatBoostCARMA_BootStrapType_Choices = NULL,
                                    CatBoostCARMA_L2_Leaf_Reg_Choices = NULL,
                                    CatBoostCARMA_LearningRate_Choices = NULL,
                                    CatBoostCARMA_ModelSizeReg_Choices = NULL,
                                    CatBoostCARMA_MinDataInLeaf_Choices = NULL,
                                    CatBoostCARMA_RandomStrength_Choices = NULL,
                                    CatBoostCARMA_RSM_Choices = NULL,
                                    CatBoostCARMA_BorderCount_Choices = NULL,
                                    CatBoostCARMA_GrowPolicy_Choices = NULL,
                                    CatBoostCARMA_FeatureBorderType_Choices = NULL,
                                    CatBoostCARMA_ScoreFunction_Choices = NULL,
                                    CatBoostCARMA_CrossEvalModelUpdate_Choices = NULL,
                                    CatBoostCARMA_CrossEvalValuesUpdate_Choices = NULL,
                                    CatBoostCARMA_CrossEvalModelUpdateFreq_Choices = NULL,
                                    CatBoostCARMA_CrossEvalValuesUpdateFreq_Choices = NULL,
                                    CatBoostCARMA_EvalMetric_Choices = NULL,
                                    CatBoostCARMA_EvalMetricValue_Choices = NULL,
                                    CatBoostCARMA_LossFunction_Choices = NULL,
                                    CatBoostCARMA_LossFunctionValue_Choices = NULL,

                                    # Updaters
                                    CatBoostCARMA_RunMode_Selected = NULL,
                                    CatBoostCARMA_ArgsList_Selected = NULL,
                                    CatBoostCARMA_TrainData_Selected = NULL,
                                    CatBoostCARMA_ValidationData_Selected = NULL,
                                    CatBoostCARMA_XREGS_Selected = NULL,
                                    CatBoostCARMA_TimeUnit_Selected = NULL,
                                    CatBoostCARMA_FCPeriods_Selected = NULL,
                                    CatBoostCARMA_EncodingMethod_Selected = NULL,
                                    CatBoostCARMA_ZeroPadSeries_Selected = NULL,
                                    CatBoostCARMA_Methods_Selected = NULL,
                                    CatBoostCARMA_Difference_Selected = NULL,
                                    CatBoostCARMA_TimeWeights_Selected = NULL,
                                    CatBoostCARMA_NonNegativePred_Selected = NULL,
                                    CatBoostCARMA_RoundPreds_Selected = NULL,
                                    CatBoostCARMA_TaskType_Selected = NULL,
                                    CatBoostCARMA_NumGPU_Selected = NULL,
                                    CatBoostCARMA_SaveModel_Selected = NULL,
                                    CatBoostCARMA_CalendarVariables_Selected = NULL,
                                    CatBoostCARMA_HolidayVariables_Selected = NULL,
                                    CatBoostCARMA_Lookback_Selected = NULL,
                                    CatBoostCARMA_TimeTrend_Selected = NULL,
                                    CatBoostCARMA_AnomalyDetection_HighThreshold_Selected = NULL,
                                    CatBoostCARMA_AnomalyDetection_LowThreshold_Selected = NULL,
                                    CatBoostCARMA_Lags_Selected = NULL,
                                    CatBoostCARMA_MovingAverages_Selected = NULL,
                                    CatBoostCARMA_MovingSD_Selected = NULL,
                                    CatBoostCARMA_MovingSkew_Selected = NULL,
                                    CatBoostCARMA_MovingKurt_Selected = NULL,
                                    CatBoostCARMA_MovingQuantiles_Selected = NULL,
                                    CatBoostCARMA_Quantiles_Selected_Selected = NULL,
                                    CatBoostCARMA_DataTruncate_Selected = NULL,
                                    CatBoostCARMA_NTrees_Selected = NULL,
                                    CatBoostCARMA_Depth_Selected = NULL,
                                    CatBoostCARMA_Langevin_Selected = NULL,
                                    CatBoostCARMA_DiffusionTemperature_Selected = NULL,
                                    CatBoostCARMA_SubSample_Selected = NULL,
                                    CatBoostCARMA_BootStrapType_Selected = NULL,
                                    CatBoostCARMA_L2_Leaf_Reg_Selected = NULL,
                                    CatBoostCARMA_LearningRate_Selected = NULL,
                                    CatBoostCARMA_ModelSizeReg_Selected = NULL,
                                    CatBoostCARMA_MinDataInLeaf_Selected = NULL,
                                    CatBoostCARMA_RandomStrength_Selected = NULL,
                                    CatBoostCARMA_RSM_Selected = NULL,
                                    CatBoostCARMA_BorderCount_Selected = NULL,
                                    CatBoostCARMA_GrowPolicy_Selected = NULL,
                                    CatBoostCARMA_FeatureBorderType_Selected = NULL,
                                    CatBoostCARMA_ScoreFunction_Selected = NULL,
                                    CatBoostCARMA_CrossEvalModelUpdate_Selected = NULL,
                                    CatBoostCARMA_CrossEvalValuesUpdate_Selected = NULL,
                                    CatBoostCARMA_CrossEvalModelUpdateFreq_Selected = NULL,
                                    CatBoostCARMA_CrossEvalValuesUpdateFreq_Selected = NULL,
                                    CatBoostCARMA_EvalMetric_Selected = NULL,
                                    CatBoostCARMA_EvalMetricValue_Selected = NULL,
                                    CatBoostCARMA_LossFunction_Selected = NULL,
                                    CatBoostCARMA_LossFunctionValue_Selected = NULL) {

  shiny::moduleServer(
    id = id,
    module = function(input, output, session) {
      ns <- session$ns
      shiny::showModal(
        shiny::modalDialog(
          title = 'CatBoost FC Parameters',
          size = "l",
          easyClose = FALSE,
          fade = TRUE,
          shiny::tagList(

            # Top Box ----
            shinydashboard::box(
              title = NULL, solidHeader = TRUE, collapsible = FALSE, status = 'danger', width = AppWidth,

              shiny::fluidRow(
                shiny::column(
                  width = 12L,
                  align = "right",
                  shinyWidgets::dropdown(
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = "info", width = 12L,
                      shiny::fluidRow(
                        shiny::column(
                          width = 12L,
                          align = "left",
                          shiny::a(name = "forecasting"),
                          shiny::h2(tags$b("Forecasting")),
                          shiny::p("Forecasting is a vitally important aspect of this software. It's important that you know how to
                             utilize the functionality as intended. Below are all of the algorithms with descriptions about
                             how to use each and every one for each of their intended uses. If you've done forecasting in the
                             past you'll find that the methods provided are as feature rich as you've encountered, if at all.
                             There are serveral forecasting use cases covered in this software, including:"))),


                      Quantico::BlankRow(12),
                      shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::h3("Run Modes:"))),
                      shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::markdown(
                        "
                      There are various Run modes to training, backtesting, and forecasting:
                      * Train Model: This is equivalent to building an ML model
                      * Retrain Existing Model: This is for retraining a model that's already been built before. Perhaps you simply want an updated model but not a new forecast at the moment
                      * Backtest: This task will train a new model (if FC ArgsList is not supplied) and generate an N-Period ahead forecast that will be evaluated using Validation Data supplied by the user. If you don't have a Validation dataset, go to Data Wrangling and subset rows based on a time variable. The subset data will be your Training Data and your original dataset will be the Validation Data
                      * Feature Engineering Test: This task will loop through various builds starting from the most simple up to a moderately sophisticated models. An evaluation table is generated that you can view in the Tables tab when the procedure is complete. Evaluation metrics are based on the Backtest method. Features tested are below and are in order. If a feature is beneficial it will remain in the models trained thereafter:
                        1. LogPlus1 vs None: this will test whether a target variable transformation is beneficial
                        2. Series Difference vs None: this will test whether utilizing Differencing your series is useful
                        3. Calendar Variables vs None: this will test whether utilizing Calendar Variables is useful
                        4. Holiday Variable vs None: this will test whether utilizing Holiday Variables is useful
                        5. Credibility vs Target Encoding : this will test whether a target encoding is better than a credibility encoding
                        6. Time Weights vs None: this will test whether utilizing Time Weighting is useful
                        7. Anomaly Detection vs None: this will test whether utilizing Anomaly Detection is useful
                        8. Time Trend Variable vs None: this will test whether utilizing a Time Trend Variable is useful
                        9. Lag 1 vs None: this will test whether utilizing Lags are useful (user supplies the lags and if none are set then a lag1 is tested)
                      * Backtest Cross Evaluation: Once you have a good model designed you can mock production by running this procedure. Here, you'll set the data refresh rate and the model update rate. Performance measure are returned in a data.table once the procedure is finished.
                      * Forecast: if you have a trained model you can call it to generate a forecast for you
                      * Retrain + Forecast: if you have a model you can refresh it and have it generate a forecast for you
                      "
                      ))),
                      Quantico::BlankRow(12),
                      shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::h3("Features Engineering:"))),
                      shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::markdown(
                        "
                      * Single shot backtesting over a defined horizon
                      * Roll forward backtesting over a defined horizon
                      * Series filling for any missing gaps
                      * Lags
                      * Moving averages
                      * Calendar variables
                      * Holiday variables
                      * Holiday lookback window for extended effects
                      * Target transformation
                      * Categorical variable encoding
                      * Differencing
                      * Exongenous regressors (user supplied)
                      * Time trend variable
                      * Anomaly detection as variables
                      * Data truncation testing for NA produced by rolling stats
                      * All the ML hyperparameters that come with the underlying ML algorithms
                      "
                      ))),

                      Quantico::BlankRow(12),
                      shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::h3("Forecasting Usage"))),

                      shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::markdown(
                        "
                    ### General Parameters
                    * ModelID: Use this to identify output among competing models
                    * FCPeriods: use this for forecasting and backtesting. Not used for training
                    * TimeUnit: define the time granularity of your data set
                    * Train Data and Validation Data: training data is used for the ML training process. Validation Data is only used for backtesting
                    * TargetColumnName: Value column that you are forecasting
                    * DateColumnName: Date variable in your data
                    * GroupVariables: List out group variables from lowest grain to highest grain. E.g. Customer, Sku, Brand
                    * EncodingMethod: Use if you have group variables listed
                    * ZeroPadSeries: Fill missing values. Use dynamic to deal with irregular start and end dates across group variables
                    * Methods: Target transformations are extremely helpful for panel data forecasting
                    * Difference: Use if your series have significant trend
                    * TimeWeights: attach more importance to the most recent records in your data
                    * NonNegativePred: prevent the model from predicting negative values
                    * RoundPreds: round predictions to integer values
                    * SaveModel: Use this to bypass ML training for backtesting and forecasting, unless you want a new model
                    * Task Type: utilize GPU or CPU for the ML Training. With GPU, you typically need more trees, more depth, less regularization, etc. CPU typically generates better results using defaults.
                    * Number of GPUs: if you have access to more than one GPU and would like to use it, specify the number of GPUs you want to allocate for ML Training
                    * CalendarVariables: Capture calendar effects within your forecast
                    * HolidayVariables: Capture holiday effects within your forecast
                    * Lookback: used for HolidayVariables: has there been a holiday in the last N days? N is the Lookback value.
                    * TimeTrend: add a time trend variable. Perhaps this alleviates trend issues in your forecast. If not, consider differencing the target variable
                    * Data Truncate: When lags or rolling stats are created, NA's are generated for rows where a full window lookback is not available. E.g. a 10-period moving average on data with only 5 periods: all five periods will be NA
                    * Lags: past values represented on the rows holding the current values. We're looking to utilize information from the past to help predict the future.
                    * Moving Averages: generated using the lag1-Target Variable.
                    * Moving Quantiles: If you beieve the particular percentiles of past values are useful for predicting future states, then include these. E.g. median = 50th percentile
                    * Moving Standard Deviation: If you beieve the volatility of past values are useful for predicting future states, then include these.
                    * Moving Skew: If you beieve the skew of past values are useful for predicting future states, then include these.
                    * Moving Kurtosis: If you beieve the kurtosis of past values are useful for predicting future states, then include these.
                    * CrossEvalModelUpdate: Set to TRUE to enable model updating
                    * CrossEvalModelUpdateFreq: frequency of model updating in cross eval backtesting run mode
                    * CrossEvalValuesUpdate: Set to TRUE to enable data updating
                    * CrossEvalValuesUpdateFreq: frequency of data updating in cross eval backtesting run mode
                    "
                      )))
                    ),

                    size = "lg",
                    icon = shiny::icon("question"),
                    label = NULL,
                    tooltip = FALSE,
                    right = TRUE,
                    up = FALSE,
                    width = NULL,
                    animate = shinyWidgets::animateOptions(
                      enter = "zoomIn",
                      exit = "fadeOutRightBig"
                    ),
                    inputId = NULL,
                    block = FALSE,
                    no_outline = TRUE
                  )
                )
              ),

              Quantico:::BlankRow(12L),
              shiny::fluidRow(
                shiny::column(
                  width = 3L, align = 'center',
                  Quantico:::SelectizeInput(InputID = 'CatBoostCARMA_RunMode', Label = 'Select Run Mode', Choices = CatBoostCARMA_RunMode_Choices, SelectedDefault = CatBoostCARMA_RunMode_Selected, Multiple = TRUE, MaxVars = 1)),
                shiny::column(
                  width = 2L, align = 'center', tags$h3(tags$b('Build FC')),
                  shiny::actionButton(inputId = paste0('BuildModels_CatBoostCARMA'), label = paste0('Run'), icon = shiny::icon('chevron-right', lib='font-awesome'))),
                shiny::column(width = 2L),
                shiny::column(
                  width = 2L, shinyjs::useShinyjs(), align = 'center', tags$h3(tags$b('Refresh')),
                  shiny::actionButton(inputId = paste0('CatBoostCARMA_RefreshInputs'), label = paste0('Run'), icon = shiny::icon('chevron-right', lib='font-awesome'))),
                shiny::column(
                  width = 3L, align = 'center',
                  Quantico:::SelectizeInput(InputID = "CatBoostCARMA_ArgsList", Label = "Existing Models", Choices = CatBoostCARMA_ArgsList_Choices, SelectedDefault = CatBoostCARMA_ArgsList_Selected, Multiple = TRUE, MaxVars = 100L)))), # box

            Quantico:::BlankRow(12L),
            Quantico:::BlankRow(12L),

            # Tabs
            shiny::tabsetPanel(
              id = 'CatBoostCARMA_TabPanel',
              selected = 'Data',

              # Step 1: Data Parameters ----
              shiny::tabPanel(
                title = "Data",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shiny::column(
                    6L,
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(12L, align = 'center', Quantico:::TextInput(InputID = 'CatBoostCARMA_ModelID', Label="Model ID", Value = CatBoostCARMA_ModelID_Selected))
                      ),
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(12L, align = 'center', Quantico:::NumericInput(InputID = "CatBoostCARMA_FCPeriods", Label = "Forecast Periods", Value = CatBoostCARMA_FCPeriods_Selected, Min = 1L, Max = 100000L, Step = 1L))
                      ),
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID = "CatBoostCARMA_TimeUnit", Label = "Time Unit: is your data daily, weekly, monthly, or something else?", Choices = CatBoostCARMA_TimeUnit_Choices, SelectedDefault = CatBoostCARMA_TimeUnit_Selected, Multiple = TRUE, MaxVars = 1L))
                      ),
                      Quantico:::BlankRow(12L),
                      Quantico:::BlankRow(12L)
                    )
                  ),

                  shiny::column(
                    6L,
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID = 'CatBoostCARMA_TrainData', Label = 'Select Train Data', Choices = CatBoostCARMA_TrainData_Choices, SelectedDefault = CatBoostCARMA_TrainData_Selected, Multiple = TRUE, MaxVars = 1L))
                      ),
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID = 'CatBoostCARMA_ValidationData', Label = 'Select Validation Data: used for backtesting, not model training', Choices = CatBoostCARMA_ValidationData_Choices, SelectedDefault = CatBoostCARMA_ValidationData_Selected, Multiple = TRUE, MaxVars = 1L))
                      ),
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID = 'CatBoostCARMA_XREGS', Label = 'Exogenous Regressors (XREGS)', Choices = CatBoostCARMA_XREGS_Choices, SelectedDefault = CatBoostCARMA_XREGS_Selected, Multiple = TRUE, MaxVars = 1L))
                      ),
                      Quantico:::BlankRow(12L),
                      Quantico:::BlankRow(12L)
                    )
                  )
                )
              ),

              # Step 2: Variables ----
              shiny::tabPanel(
                title = "Variables",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shiny::column(
                    6L,
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,

                      # Data Names
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(12L, align = 'center', Quantico:::PickerInput(InputID = "CatBoostCARMA_TargetColumnName", Label = "Target Variable", Choices = NULL, SelectedDefault = CatBoostCARMA_TargetColumnName_Selected, Multiple = TRUE, MaxVars = 1L))
                      ),
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(12L, align = 'center', Quantico:::PickerInput(InputID = "CatBoostCARMA_DateColumnName", Label = "Date Variable", Choices = NULL, SelectedDefault = CatBoostCARMA_DateColumnName_Selected, Multiple = TRUE, MaxVars = 1L))
                      ),
                      Quantico:::BlankRow(12L),
                      Quantico:::BlankRow(12L)
                    )
                  ),

                  shiny::column(
                    6L,
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,

                      # Data Names
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(12L, align = 'center', Quantico:::PickerInput(InputID = "CatBoostCARMA_GroupVariables", Label = "Group Variables: <lowest grain to highest grain> e.g. customer, sku, catfood", Choices = NULL, SelectedDefault = CatBoostCARMA_GroupVariables_Selected, Multiple = TRUE, MaxVars = 100L))
                      ),
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID = "CatBoostCARMA_EncodingMethod", Label = "Categorical Encoding", Choices = CatBoostCARMA_EncodingMethod_Choices, SelectedDefault = CatBoostCARMA_EncodingMethod_Selected, Multiple = TRUE, MaxVars = 1L))
                      ),
                      Quantico:::BlankRow(12L),
                      Quantico:::BlankRow(12L)
                    )
                  )
                ),
                Quantico:::BlankRow(12L),
                Quantico:::BlankRow(12L)
              ),

              # Step 3: Series Structure ----
              shiny::tabPanel(
                title = "Series Structure",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shiny::column(
                    6L,
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                      Quantico::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID = "CatBoostCARMA_ZeroPadSeries", Label = "Series Fill Options: use if you have missing dates in any of your series", Choices = CatBoostCARMA_ZeroPadSeries_Choices, SelectedDefault = CatBoostCARMA_ZeroPadSeries_Selected, Multiple = TRUE, MaxVars = 1L))
                      ),
                      Quantico::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID = "CatBoostCARMA_Methods", Label = "Target transformations", Choices = CatBoostCARMA_Methods_Choices, SelectedDefault = CatBoostCARMA_Methods_Selected, Multiple = TRUE, MaxVars = 100L))
                      ),
                      Quantico::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID = "CatBoostCARMA_Difference", Label = "Target Differencing", Choices = CatBoostCARMA_Difference_Choices, SelectedDefault = CatBoostCARMA_Difference_Selected, Multiple = TRUE, MaxVars = 1L))
                      ),
                      Quantico:::BlankRow(12L),
                      Quantico:::BlankRow(12L)
                    )
                  ),

                  shiny::column(
                    6L,
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                      Quantico::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(12L, align = 'center', Quantico:::NumericInput(InputID = "CatBoostCARMA_TimeWeights", Label = "Time weights: Weighting = (time weights) ^ Days Back from Current", Value = CatBoostCARMA_TimeWeights_Selected, Min = 0.01, Max = 1, Step = 0.0001))
                      ),
                      Quantico::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID = "CatBoostCARMA_NonNegativePred", Label = "Do not allow for negative predictions", Choices = CatBoostCARMA_NonNegativePred_Choices, SelectedDefault = CatBoostCARMA_NonNegativePred_Selected, Multiple = TRUE, MaxVars = 1L))
                      ),
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID = "CatBoostCARMA_RoundPreds", Label = "Round predictions to integers", Choices = CatBoostCARMA_RoundPreds_Choices, SelectedDefault = CatBoostCARMA_RoundPreds_Selected, Multiple = TRUE, MaxVars = 1L))
                      ),
                      Quantico:::BlankRow(12L),
                      Quantico:::BlankRow(12L)
                    )
                  )
                )
              ),

              # Step 4: Production Parameters ----
              shiny::tabPanel(
                title = "Production",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shiny::column(
                    6L,
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID = "CatBoostCARMA_SaveModel", Label = "Save Model", Choices = CatBoostCARMA_SaveModel_Choices, SelectedDefault = CatBoostCARMA_SaveModel_Selected, Multiple = TRUE, MaxVars = 1L))
                      ),
                      Quantico:::BlankRow(12L),
                      Quantico:::BlankRow(12L)
                    )
                  ),
                  shiny::column(
                    6L,
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID = "CatBoostCARMA_TaskType", Label = "Train Models with GPU or CPU", Choices = CatBoostCARMA_TaskType_Choices, SelectedDefault = CatBoostCARMA_TaskType_Selected, Multiple = TRUE, MaxVars = 1L))
                      ),
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(12L, align = 'center', Quantico:::NumericInput(InputID = "CatBoostCARMA_NumGPU", Label = "Number of GPUs Available for Training", Value = CatBoostCARMA_NumGPU_Selected, Min = 1, Max = 10, Step = 1))
                      ),
                      Quantico:::BlankRow(12L),
                      Quantico:::BlankRow(12L)
                    )
                  )
                )
              ),

              # Step 5: Feature Engineering ----
              shiny::tabPanel(
                title = "Feature Engineering 1",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shiny::column(
                    6L,
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                      Quantico:::BlankRow(11L),
                      shiny::fluidRow(
                        shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID = "CatBoostCARMA_CalendarVariables", Label = "Calendar variables", Choices = CatBoostCARMA_CalendarVariables_Choices, SelectedDefault = CatBoostCARMA_CalendarVariables_Selected, Multiple = TRUE, MaxVars = 100L))
                      ),
                      Quantico:::BlankRow(11L),
                      shiny::fluidRow(
                        shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID = "CatBoostCARMA_HolidayVariables", Label = "Holiday variables", Choices = CatBoostCARMA_HolidayVariables_Choices, SelectedDefault = CatBoostCARMA_HolidayVariables_Selected, Multiple = TRUE, MaxVars = 100L))
                      ),
                      Quantico:::BlankRow(11L),
                      shiny::fluidRow(
                        shiny::column(12L, align = 'center', Quantico:::NumericInput(InputID = "CatBoostCARMA_Lookback", Label = "Holiday Window (days)", Value = CatBoostCARMA_Lookback_Selected, Min = 1, Max = 50, Step = 1))
                      ),
                      Quantico:::BlankRow(12L),
                      Quantico:::BlankRow(12L)
                    )
                  ),

                  shiny::column(
                    6L,
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                      Quantico:::BlankRow(11L),
                      shiny::fluidRow(shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID = "CatBoostCARMA_TimeTrend", Label = "Time trend", Choices = CatBoostCARMA_TimeTrend_Choices, SelectedDefault = CatBoostCARMA_TimeTrend_Selected, Multiple = TRUE, MaxVars = 1L))),
                      Quantico:::BlankRow(11L),
                      shiny::fluidRow(
                        shiny::column(6L, align = 'center', Quantico:::SelectizeInput(InputID = "CatBoostCARMA_AnomalyDetection_HighThreshold", Label = "Select tstat for upper threshold", Choices = CatBoostCARMA_AnomalyDetection_HighThreshold_Choices, SelectedDefault = CatBoostCARMA_AnomalyDetection_HighThreshold_Selected, Multiple = TRUE, MaxVars = 100L)),
                        shiny::column(6L, align = 'center', Quantico:::SelectizeInput(InputID = "CatBoostCARMA_AnomalyDetection_LowThreshold", Label = "Select tstat for Lower threshold", Choices = CatBoostCARMA_AnomalyDetection_LowThreshold_Choices, SelectedDefault = CatBoostCARMA_AnomalyDetection_LowThreshold_Selected, Multiple = TRUE, MaxVars = 100L))),
                      Quantico:::BlankRow(12L),
                      Quantico:::BlankRow(12L)
                    )
                  )
                ),
                Quantico:::BlankRow(12L),
                Quantico:::BlankRow(12L)
              ),

              # Step 6: Feature Engineering ----
              shiny::tabPanel(
                title = "Feature Engineering 2",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shiny::column(
                    6L,
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID = "CatBoostCARMA_Lags", Label = "Select Lags", Choices = CatBoostCARMA_Lags_Choices, SelectedDefault = CatBoostCARMA_Lags_Selected, Multiple = TRUE, MaxVars = 1000L))
                      ),
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID = "CatBoostCARMA_MovingAverages", Label = "Select Moving Averages", Choices = CatBoostCARMA_MovingAverages_Choices, SelectedDefault = CatBoostCARMA_MovingAverages_Selected, Multiple = TRUE, MaxVars = 1000L))
                      ),
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID = "CatBoostCARMA_MovingSD", Label = "Select Standard Deviations", Choices = CatBoostCARMA_MovingSD_Choices, SelectedDefault = CatBoostCARMA_MovingSD_Selected, Multiple = TRUE, MaxVars = 1000L))
                      ),
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID = "CatBoostCARMA_MovingKurt", Label = "Select Kurtosis", Choices = CatBoostCARMA_MovingKurt_Choices, SelectedDefault = CatBoostCARMA_MovingKurt_Selected, Multiple = TRUE, MaxVars = 1000L))
                      ),
                      Quantico:::BlankRow(12L),
                      Quantico:::BlankRow(12L)
                    )
                  ),
                  shiny::column(
                    6L,
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID = "CatBoostCARMA_MovingSkew", Label = "Select Skewness", Choices = CatBoostCARMA_MovingSkew_Choices, SelectedDefault = CatBoostCARMA_MovingSkew_Selected, Multiple = TRUE, MaxVars = 1000L))
                      ),
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID = "CatBoostCARMA_Quantiles_Selected", Label = "Select percentiles", Choices = CatBoostCARMA_Quantiles_Selected_Choices, SelectedDefault = CatBoostCARMA_Quantiles_Selected_Selected, Multiple = TRUE, MaxVars = 100L))
                      ),
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID = "CatBoostCARMA_DataTruncate", Label = "Truncate NA's: Remove rows where lags and rolling stats produced NA's", Choices = CatBoostCARMA_DataTruncate_Choices, SelectedDefault = CatBoostCARMA_DataTruncate_Selected, Multiple = TRUE, MaxVars = 1L))
                      ),
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID = "CatBoostCARMA_MovingQuantiles", Label = "Select windows", Choices = CatBoostCARMA_MovingQuantiles_Choices, SelectedDefault = CatBoostCARMA_MovingQuantiles_Selected, Multiple = TRUE, MaxVars = 1000L))
                      ),
                      Quantico:::BlankRow(12L),
                      Quantico:::BlankRow(12L)
                    )
                  )
                ),
                Quantico:::BlankRow(12L),
                Quantico:::BlankRow(12L)
              ),

              # Step 7: ML Parameters 1 ----
              shiny::tabPanel(
                title = "ML Parameters 1",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shiny::column(
                    6L,
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(12L, align = 'center', Quantico:::NumericInput(InputID = "CatBoostCARMA_NTrees", Label="Number of trees", Value = CatBoostCARMA_NTrees_Selected, Min = 50, Max = 30000, Step = 25))
                      ),
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(12L, align = 'center', Quantico:::NumericInput(InputID = "CatBoostCARMA_Depth", Label = "Depth", Value = CatBoostCARMA_Depth_Selected, Min = 4, Max = 20, Step = 1))
                      ),
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID = "CatBoostCARMA_Langevin", Label = "Langevin boosting", Choices = CatBoostCARMA_Langevin_Choices, SelectedDefault = CatBoostCARMA_Langevin_Selected, Multiple = TRUE, MaxVars = 1L))
                      ),
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(12L, align = 'center', Quantico:::NumericInput(InputID = "CatBoostCARMA_DiffusionTemperature", Label = "Diffusion temperature", Value = CatBoostCARMA_DiffusionTemperature_Selected, Min = 1000, Max = 50000, Step = 100))
                      ),
                      Quantico:::BlankRow(12L),
                      Quantico:::BlankRow(12L)
                    )
                  ),
                  shiny::column(
                    6L,
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID = "CatBoostCARMA_SubSample", Label = "Subsample", Choices = CatBoostCARMA_SubSample_Choices, SelectedDefault = CatBoostCARMA_SubSample_Selected, Multiple = TRUE, MaxVars = 1L))
                      ),
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID = "CatBoostCARMA_BootStrapType", Label = "Boot strap type", Choices = CatBoostCARMA_BootStrapType_Choices, SelectedDefault = CatBoostCARMA_BootStrapType_Selected, Multiple = TRUE, MaxVars = 1L))
                      ),
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID = "CatBoostCARMA_L2_Leaf_Reg", Label = "L2 leaf regularization", Choices = CatBoostCARMA_L2_Leaf_Reg_Choices, SelectedDefault = CatBoostCARMA_L2_Leaf_Reg_Selected, Multiple = TRUE, MaxVars = 1L))
                      ),
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID = "CatBoostCARMA_LearningRate", Label = "Learning rate", Choices = CatBoostCARMA_LearningRate_Choices, SelectedDefault = CatBoostCARMA_LearningRate_Selected, Multiple = TRUE, MaxVars = 1L))
                      ),
                      Quantico:::BlankRow(12L),
                      Quantico:::BlankRow(12L)
                    )
                  )
                ),
                Quantico:::BlankRow(12L),
                Quantico:::BlankRow(12L)
              ),

              # Step 8: ML Parameters 2 ----
              shiny::tabPanel(
                title = "ML Parameters 2",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shiny::column(
                    6L,
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID = "CatBoostCARMA_ModelSizeReg", Label = "Model size regularization", Choices = CatBoostCARMA_ModelSizeReg_Choices, SelectedDefault = CatBoostCARMA_ModelSizeReg_Selected, Multiple = TRUE, MaxVars = 1L))
                      ),
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID = "CatBoostCARMA_MinDataInLeaf", Label = "Min data in leaf", Choices = CatBoostCARMA_MinDataInLeaf_Choices, SelectedDefault = CatBoostCARMA_MinDataInLeaf_Selected, Multiple = TRUE, MaxVars = 1L))
                      ),
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID = "CatBoostCARMA_RandomStrength", Label = "Random strength", Choices = CatBoostCARMA_RandomStrength_Choices, SelectedDefault = CatBoostCARMA_RandomStrength_Selected, Multiple = TRUE, MaxVars = 1L))
                      ),
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID = "CatBoostCARMA_RSM", Label = "Random subspace method", Choices = CatBoostCARMA_RSM_Choices, SelectedDefault = CatBoostCARMA_RSM_Selected, Multiple = TRUE, MaxVars = 1L))
                      ),
                      Quantico:::BlankRow(12L),
                      Quantico:::BlankRow(12L)
                    )
                  ),
                  shiny::column(
                    6L,
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID = "CatBoostCARMA_BorderCount", Label = "Border count", Choices = CatBoostCARMA_BorderCount_Choices, SelectedDefault = CatBoostCARMA_BorderCount_Selected, Multiple = TRUE, MaxVars = 1L))
                      ),
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID = "CatBoostCARMA_GrowPolicy", Label = "Grow policy", Choices = CatBoostCARMA_GrowPolicy_Choices, SelectedDefault = CatBoostCARMA_GrowPolicy_Selected, Multiple = TRUE, MaxVars = 1L))
                      ),
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID = "CatBoostCARMA_FeatureBorderType", Label = "Feature border type", Choices = CatBoostCARMA_FeatureBorderType_Choices, SelectedDefault = CatBoostCARMA_FeatureBorderType_Selected, Multiple = TRUE, MaxVars = 1L))
                      ),
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID = "CatBoostCARMA_ScoreFunction", Label = "Score function", Choices = CatBoostCARMA_ScoreFunction_Choices, SelectedDefault = CatBoostCARMA_ScoreFunction_Selected, Multiple = TRUE, MaxVars = 1L))
                      ),
                      Quantico:::BlankRow(12L),
                      Quantico:::BlankRow(12L)
                    )
                  )
                ),
                Quantico:::BlankRow(12L),
                Quantico:::BlankRow(12L)
              ),

              # Step 9: Eval Metrics ----
              shiny::tabPanel(
                title = "Evaluation",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shiny::column(
                    6L,
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID = "CatBoostCARMA_EvalMetric", Label = "Eval metric for feature selection", Choices = CatBoostCARMA_EvalMetric_Choices, SelectedDefault = CatBoostCARMA_EvalMetric_Selected, Multiple = TRUE, MaxVars = 1L))
                      ),
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID = "CatBoostCARMA_LossFunction", Label = "Loss function for model", Choices = CatBoostCARMA_LossFunction_Choices, SelectedDefault = CatBoostCARMA_LossFunction_Selected, Multiple = TRUE, MaxVars = 1L))
                      ),
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID = "CatBoostCARMA_EvalMetricValue", Label = "Eval metric value", Choices = CatBoostCARMA_EvalMetricValue_Choices, SelectedDefault = CatBoostCARMA_EvalMetricValue_Selected, Multiple = TRUE, MaxVars = 1L))
                      ),
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID = "CatBoostCARMA_LossFunctionValue", Label = "Loss function value", Choices = CatBoostCARMA_LossFunctionValue_Choices, SelectedDefault = CatBoostCARMA_LossFunctionValue_Selected, Multiple = TRUE, MaxVars = 1L))
                      ),
                      Quantico:::BlankRow(12L),
                      Quantico:::BlankRow(12L)
                    )
                  ),
                  shiny::column(
                    6L,
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID = "CatBoostCARMA_CrossEvalModelUpdate", Label = "Cross-Eval: Model Update", Choices = CatBoostCARMA_CrossEvalModelUpdate_Choices, SelectedDefault = CatBoostCARMA_CrossEvalModelUpdate_Selected, Multiple = TRUE, MaxVars = 1L, Debug = Debug))
                      ),
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID = "CatBoostCARMA_CrossEvalValuesUpdate", Label = "Cross-Eval: Values Update", Choices = CatBoostCARMA_CrossEvalValuesUpdate_Choices, SelectedDefault = CatBoostCARMA_CrossEvalValuesUpdate_Selected, Multiple = TRUE, MaxVars = 1L, Debug = Debug))
                      ),
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID = "CatBoostCARMA_CrossEvalModelUpdateFreq", Label = "Cross-Eval: Model Update Freq", Choices = CatBoostCARMA_CrossEvalModelUpdateFreq_Choices, SelectedDefault = CatBoostCARMA_CrossEvalModelUpdateFreq_Selected, Multiple = TRUE, MaxVars = 1L, Debug = Debug))
                      ),
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID = "CatBoostCARMA_CrossEvalValuesUpdateFreq", Label = "Cross-Eval: Values Update Freq", Choices = CatBoostCARMA_CrossEvalValuesUpdateFreq_Choices, SelectedDefault = CatBoostCARMA_CrossEvalValuesUpdateFreq_Selected, Multiple = TRUE, MaxVars = 1L, Debug = Debug))
                      ),
                      Quantico:::BlankRow(12L),
                      Quantico:::BlankRow(12L)
                    )
                  )
                )
              )
            )
          ), # end TagList
          footer = shiny::tagList(
            shiny::modalButton(label = "Cancel"),
            shiny::actionButton("CatBoostCARMA_OK", "OK", width = '50px'))))
    })
}

#' @title XGBoostCARMA_Modal_Fun
#'
#' @description XGBoost CARMA Parameters Modal with OK button to close
#'
#' @author Adrian Antico
#' @family ML
#'
#' @param id = 'XGBoostCARMA_ID'
#' @param AppWidth = 12L
#'
#' @export
XGBoostCARMA_Modal_Fun <- function(id,
                                   AppWidth=12L,

                                   # Reactives
                                   XGBoostCARMA_ModelID_Selected = NULL,
                                   XGBoostCARMA_TargetColumnName_Selected = NULL,
                                   XGBoostCARMA_DateColumnName_Selected = NULL,
                                   XGBoostCARMA_GroupVariables_Selected = NULL,

                                   # Statics
                                   XGBoostCARMA_RunMode_Choices = NULL,
                                   XGBoostCARMA_TimeUnit_Choices = NULL,
                                   XGBoostCARMA_FCPeriods_Choices = NULL,
                                   XGBoostCARMA_TaskType_Choices = NULL,
                                   XGBoostCARMA_NumGPU_Choices = NULL,
                                   XGBoostCARMA_SaveModel_Choices = NULL,
                                   XGBoostCARMA_ArgsList_Choices = NULL,
                                   XGBoostCARMA_TimeWeights_Choices = NULL,
                                   XGBoostCARMA_Methods_Choices = NULL,
                                   XGBoostCARMA_Difference_Choices = NULL,
                                   XGBoostCARMA_NonNegativePred_Choices = NULL,
                                   XGBoostCARMA_RoundPreds_Choices = NULL,
                                   XGBoostCARMA_CalendarVariables_Choices = NULL,
                                   XGBoostCARMA_HolidayVariables_Choices = NULL,
                                   XGBoostCARMA_Lookback_Choices = NULL,
                                   XGBoostCARMA_Lags_Choices = NULL,
                                   XGBoostCARMA_MovingAverages_Choices = NULL,
                                   XGBoostCARMA_MovingSD_Choices = NULL,
                                   XGBoostCARMA_MovingSkew_Choices = NULL,
                                   XGBoostCARMA_MovingKurt_Choices = NULL,
                                   XGBoostCARMA_MovingQuantiles_Choices = NULL,
                                   XGBoostCARMA_Quantiles_Selected_Choices = NULL,
                                   XGBoostCARMA_AnomalyDetection_HighThreshold_Choices = NULL,
                                   XGBoostCARMA_AnomalyDetection_LowThreshold_Choices = NULL,
                                   XGBoostCARMA_TimeTrend_Choices = NULL,
                                   XGBoostCARMA_DataTruncate_Choices = NULL,
                                   XGBoostCARMA_EncodingMethod_Choices = NULL,
                                   XGBoostCARMA_ZeroPadSeries_Choices = NULL,
                                   XGBoostCARMA_CrossEvalModelUpdate_Choices = NULL,
                                   XGBoostCARMA_CrossEvalValuesUpdate_Choices = NULL,
                                   XGBoostCARMA_CrossEvalModelUpdateFreq_Choices = NULL,
                                   XGBoostCARMA_CrossEvalValuesUpdateFreq_Choices = NULL,
                                   XGBoostCARMA_EvalMetric_Choices = NULL,
                                   XGBoostCARMA_LossFunction_Choices = NULL,
                                   XGBoostCARMA_TrainData_Choices = NULL,
                                   XGBoostCARMA_ValidationData_Choices = NULL,
                                   XGBoostCARMA_XREGS_Choices = NULL,
                                   XGBoostCARMA_NTrees_Choices = NULL,
                                   XGBoostCARMA_MaxDepth_Choices = NULL,
                                   XGBoostCARMA_LearningRate_Choices = NULL,
                                   XGBoostCARMA_MinChildWeight_Choices = NULL,
                                   XGBoostCARMA_SubSample_Choices = NULL,
                                   XGBoostCARMA_ColSampleByTree_Choices = NULL,
                                   XGBoostCARMA_lambda_Choices = NULL,
                                   XGBoostCARMA_alpha_Choices = NULL,

                                   # Updaters
                                   XGBoostCARMA_RunMode_Selected = NULL,
                                   XGBoostCARMA_TimeUnit_Selected = NULL,
                                   XGBoostCARMA_FCPeriods_Selected = NULL,
                                   XGBoostCARMA_TaskType_Selected = NULL,
                                   XGBoostCARMA_NumGPU_Selected = NULL,
                                   XGBoostCARMA_SaveModel_Selected = NULL,
                                   XGBoostCARMA_ArgsList_Selected = NULL,
                                   XGBoostCARMA_TimeWeights_Selected = NULL,
                                   XGBoostCARMA_Methods_Selected = NULL,
                                   XGBoostCARMA_Difference_Selected = NULL,
                                   XGBoostCARMA_NonNegativePred_Selected = NULL,
                                   XGBoostCARMA_RoundPreds_Selected = NULL,
                                   XGBoostCARMA_CalendarVariables_Selected = NULL,
                                   XGBoostCARMA_HolidayVariables_Selected = NULL,
                                   XGBoostCARMA_Lookback_Selected = NULL,
                                   XGBoostCARMA_Lags_Selected = NULL,
                                   XGBoostCARMA_MovingAverages_Selected = NULL,
                                   XGBoostCARMA_MovingSD_Selected = NULL,
                                   XGBoostCARMA_MovingSkew_Selected = NULL,
                                   XGBoostCARMA_MovingKurt_Selected = NULL,
                                   XGBoostCARMA_MovingQuantiles_Selected = NULL,
                                   XGBoostCARMA_Quantiles_Selected_Selected = NULL,
                                   XGBoostCARMA_AnomalyDetection_HighThreshold_Selected = NULL,
                                   XGBoostCARMA_AnomalyDetection_LowThreshold_Selected = NULL,
                                   XGBoostCARMA_TimeTrend_Selected = NULL,
                                   XGBoostCARMA_DataTruncate_Selected = NULL,
                                   XGBoostCARMA_EncodingMethod_Selected = NULL,
                                   XGBoostCARMA_ZeroPadSeries_Selected = NULL,
                                   XGBoostCARMA_CrossEvalModelUpdate_Selected = NULL,
                                   XGBoostCARMA_CrossEvalValuesUpdate_Selected = NULL,
                                   XGBoostCARMA_CrossEvalModelUpdateFreq_Selected = NULL,
                                   XGBoostCARMA_CrossEvalValuesUpdateFreq_Selected = NULL,
                                   XGBoostCARMA_EvalMetric_Selected = NULL,
                                   XGBoostCARMA_LossFunction_Selected = NULL,
                                   XGBoostCARMA_TrainData_Selected = NULL,
                                   XGBoostCARMA_ValidationData_Selected = NULL,
                                   XGBoostCARMA_XREGS_Selected = NULL,
                                   XGBoostCARMA_NTrees_Selected = NULL,
                                   XGBoostCARMA_MaxDepth_Selected = NULL,
                                   XGBoostCARMA_LearningRate_Selected = NULL,
                                   XGBoostCARMA_MinChildWeight_Selected = NULL,
                                   XGBoostCARMA_SubSample_Selected = NULL,
                                   XGBoostCARMA_ColSampleByTree_Selected = NULL,
                                   XGBoostCARMA_lambda_Selected = NULL,
                                   XGBoostCARMA_alpha_Selected = NULL) {

  shiny::moduleServer(
    id = id,
    module = function(input, output, session) {
      ns <- session$ns
      shiny::showModal(
        shiny::modalDialog(
          title = 'XGBoost FC Parameters',
          size = "l",
          easyClose = FALSE,
          fade = TRUE,
          shiny::tagList(

            # Top Box ----
            shinydashboard::box(
              title = NULL, solidHeader = TRUE, collapsible = FALSE, status = 'danger', width = AppWidth,

              shiny::fluidRow(
                shiny::column(
                  width = 12L,
                  align = "right",
                  shinyWidgets::dropdown(
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = "info", width = 12L,
                      shiny::fluidRow(
                        shiny::column(
                          width = 12L,
                          align = "left",
                          shiny::a(name = "forecasting"),
                          shiny::h2(tags$b("Forecasting")),
                          shiny::p("Forecasting is a vitally important aspect of this software. It's important that you know how to
                             utilize the functionality as intended. Below are all of the algorithms with descriptions about
                             how to use each and every one for each of their intended uses. If you've done forecasting in the
                             past you'll find that the methods provided are as feature rich as you've encountered, if at all.
                             There are serveral forecasting use cases covered in this software, including:"))),


                      Quantico::BlankRow(12),
                      shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::h3("Run Modes:"))),
                      shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::markdown(
                        "
                      There are various Run modes to training, backtesting, and forecasting:
                      * Train Model: This is equivalent to building an ML model
                      * Retrain Existing Model: This is for retraining a model that's already been built before. Perhaps you simply want an updated model but not a new forecast at the moment
                      * Backtest: This task will train a new model (if FC ArgsList is not supplied) and generate an N-Period ahead forecast that will be evaluated using Validation Data supplied by the user. If you don't have a Validation dataset, go to Data Wrangling and subset rows based on a time variable. The subset data will be your Training Data and your original dataset will be the Validation Data
                      * Feature Engineering Test: This task will loop through various builds starting from the most simple up to a moderately sophisticated models. An evaluation table is generated that you can view in the Tables tab when the procedure is complete. Evaluation metrics are based on the Backtest method. Features tested are below and are in order. If a feature is beneficial it will remain in the models trained thereafter:
                        1. LogPlus1 vs None: this will test whether a target variable transformation is beneficial
                        2. Series Difference vs None: this will test whether utilizing Differencing your series is useful
                        3. Calendar Variables vs None: this will test whether utilizing Calendar Variables is useful
                        4. Holiday Variable vs None: this will test whether utilizing Holiday Variables is useful
                        5. Credibility vs Target Encoding : this will test whether a target encoding is better than a credibility encoding
                        6. Time Weights vs None: this will test whether utilizing Time Weighting is useful
                        7. Anomaly Detection vs None: this will test whether utilizing Anomaly Detection is useful
                        8. Time Trend Variable vs None: this will test whether utilizing a Time Trend Variable is useful
                        9. Lag 1 vs None: this will test whether utilizing Lags are useful (user supplies the lags and if none are set then a lag1 is tested)
                      * Backtest Cross Evaluation: Once you have a good model designed you can mock production by running this procedure. Here, you'll set the data refresh rate and the model update rate. Performance measure are returned in a data.table once the procedure is finished.
                      * Forecast: if you have a trained model you can call it to generate a forecast for you
                      * Retrain + Forecast: if you have a model you can refresh it and have it generate a forecast for you
                      "
                      ))),
                      Quantico::BlankRow(12),
                      shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::h3("Features Engineering:"))),
                      shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::markdown(
                        "
                      * Single shot backtesting over a defined horizon
                      * Roll forward backtesting over a defined horizon
                      * Series filling for any missing gaps
                      * Lags
                      * Moving averages
                      * Calendar variables
                      * Holiday variables
                      * Holiday lookback window for extended effects
                      * Target transformation
                      * Categorical variable encoding
                      * Differencing
                      * Exongenous regressors (user supplied)
                      * Time trend variable
                      * Anomaly detection as variables
                      * Data truncation testing for NA produced by rolling stats
                      * All the ML hyperparameters that come with the underlying ML algorithms
                      "
                      ))),

                      Quantico::BlankRow(12),
                      shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::h3("Forecasting Usage"))),

                      shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::markdown(
                        "
                    ### General Parameters
                    * ModelID: Use this to identify output among competing models
                    * FCPeriods: use this for forecasting and backtesting. Not used for training
                    * TimeUnit: define the time granularity of your data set
                    * Train Data and Validation Data: training data is used for the ML training process. Validation Data is only used for backtesting
                    * TargetColumnName: Value column that you are forecasting
                    * DateColumnName: Date variable in your data
                    * GroupVariables: List out group variables from lowest grain to highest grain. E.g. Customer, Sku, Brand
                    * EncodingMethod: Use if you have group variables listed
                    * ZeroPadSeries: Fill missing values. Use dynamic to deal with irregular start and end dates across group variables
                    * Methods: Target transformations are extremely helpful for panel data forecasting
                    * Difference: Use if your series have significant trend
                    * TimeWeights: attach more importance to the most recent records in your data
                    * NonNegativePred: prevent the model from predicting negative values
                    * RoundPreds: round predictions to integer values
                    * SaveModel: Use this to bypass ML training for backtesting and forecasting, unless you want a new model
                    * Task Type: utilize GPU or CPU for the ML Training. With GPU, you typically need more trees, more depth, less regularization, etc. CPU typically generates better results using defaults.
                    * Number of GPUs: if you have access to more than one GPU and would like to use it, specify the number of GPUs you want to allocate for ML Training
                    * CalendarVariables: Capture calendar effects within your forecast
                    * HolidayVariables: Capture holiday effects within your forecast
                    * Lookback: used for HolidayVariables: has there been a holiday in the last N days? N is the Lookback value.
                    * TimeTrend: add a time trend variable. Perhaps this alleviates trend issues in your forecast. If not, consider differencing the target variable
                    * Data Truncate: When lags or rolling stats are created, NA's are generated for rows where a full window lookback is not available. E.g. a 10-period moving average on data with only 5 periods: all five periods will be NA
                    * Lags: past values represented on the rows holding the current values. We're looking to utilize information from the past to help predict the future.
                    * Moving Averages: generated using the lag1-Target Variable.
                    * Moving Quantiles: If you beieve the particular percentiles of past values are useful for predicting future states, then include these. E.g. median = 50th percentile
                    * Moving Standard Deviation: If you beieve the volatility of past values are useful for predicting future states, then include these.
                    * Moving Skew: If you beieve the skew of past values are useful for predicting future states, then include these.
                    * Moving Kurtosis: If you beieve the kurtosis of past values are useful for predicting future states, then include these.
                    * CrossEvalModelUpdate: Set to TRUE to enable model updating
                    * CrossEvalModelUpdateFreq: frequency of model updating in cross eval backtesting run mode
                    * CrossEvalValuesUpdate: Set to TRUE to enable data updating
                    * CrossEvalValuesUpdateFreq: frequency of data updating in cross eval backtesting run mode
                    "
                      )))
                    ),

                    size = "lg",
                    icon = shiny::icon("question"),
                    label = NULL,
                    tooltip = FALSE,
                    right = TRUE,
                    up = FALSE,
                    width = NULL,
                    animate = shinyWidgets::animateOptions(
                      enter = "zoomIn",
                      exit = "fadeOutRightBig"
                    ),
                    inputId = NULL,
                    block = FALSE,
                    no_outline = TRUE
                  )
                )
              ),

              Quantico:::BlankRow(12L),
              shiny::fluidRow(
                shiny::column(
                  width = 3L, align = 'center',
                  Quantico:::SelectizeInput(InputID = 'XGBoostCARMA_RunMode', Label = 'Select Run Mode', Choices = XGBoostCARMA_RunMode_Choices, SelectedDefault = XGBoostCARMA_RunMode_Selected, Multiple = TRUE, MaxVars = 1)),
                shiny::column(
                  width = 2L, align = 'center', tags$h3(tags$b('Build FC')),
                  shiny::actionButton(inputId = paste0('BuildModels_XGBoostCARMA'), label = paste0('Run'), icon = shiny::icon('chevron-right', lib='font-awesome'))),
                shiny::column(width = 2L),
                shiny::column(
                  width = 2L, shinyjs::useShinyjs(), align = 'center', tags$h3(tags$b('Refresh')),
                  shiny::actionButton(inputId = paste0('XGBoostCARMA_RefreshInputs'), label = paste0('Run'), icon = shiny::icon('chevron-right', lib='font-awesome'))),
                shiny::column(
                  width = 3L, align = 'center',
                  Quantico:::SelectizeInput(InputID = "XGBoostCARMA_ArgsList", Label = "Existing Models", Choices = XGBoostCARMA_ArgsList_Choices, SelectedDefault = XGBoostCARMA_ArgsList_Selected, Multiple = TRUE, MaxVars = 100L)))), # box

            Quantico:::BlankRow(12L),
            Quantico:::BlankRow(12L),

            # Tabs
            shiny::tabsetPanel(
              id = 'XGBoostCARMA_TabPanel',
              selected = 'Data',

              # Data Parameters ----
              shiny::tabPanel(
                title = "Data",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shiny::column(
                    6L,
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(12L, align = 'center', Quantico:::TextInput(InputID = 'XGBoostCARMA_ModelID', Label="Model ID", Value = XGBoostCARMA_ModelID_Selected))
                      ),
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(12L, align = 'center', Quantico:::NumericInput(InputID = "XGBoostCARMA_FCPeriods", Label = "Forecast Periods", Value = XGBoostCARMA_FCPeriods_Selected, Min = 1L, Max = 100000L, Step = 1L))
                      ),
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID = "XGBoostCARMA_TimeUnit", Label = "Time Unit: is your data daily, weekly, monthly, or something else?", Choices = XGBoostCARMA_TimeUnit_Choices, SelectedDefault = XGBoostCARMA_TimeUnit_Selected, Multiple = TRUE, MaxVars = 1L))
                      ),
                      Quantico:::BlankRow(12L)
                    )
                  ),

                  shiny::column(
                    6L,
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID = 'XGBoostCARMA_TrainData', Label = 'Select Train Data', Choices = XGBoostCARMA_TrainData_Choices, SelectedDefault = XGBoostCARMA_TrainData_Selected, Multiple = TRUE, MaxVars = 1L))
                      ),
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID = 'XGBoostCARMA_ValidationData', Label = 'Select Validation Data: used for backtesting, not model training', Choices = XGBoostCARMA_ValidationData_Choices, SelectedDefault = XGBoostCARMA_ValidationData_Selected, Multiple = TRUE, MaxVars = 1L))
                      ),
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID = 'XGBoostCARMA_XREGS', Label = 'Exogenous Regressors (XREGS)', Choices = XGBoostCARMA_XREGS_Choices, SelectedDefault = XGBoostCARMA_XREGS_Selected, Multiple = TRUE, MaxVars = 1L))
                      ),
                      Quantico:::BlankRow(12L)
                    )
                  )
                )
              ),

              # Variables ----
              shiny::tabPanel(
                title = "Variables",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shiny::column(
                    6L,
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(12L, align = 'center', Quantico:::PickerInput(InputID = "XGBoostCARMA_TargetColumnName", Label = "Target Variable", Choices = NULL, SelectedDefault = XGBoostCARMA_TargetColumnName_Selected, Multiple = TRUE, MaxVars = 1L))
                      ),
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(12L, align = 'center', Quantico:::PickerInput(InputID = "XGBoostCARMA_DateColumnName", Label = "Date Variable", Choices = NULL, SelectedDefault = XGBoostCARMA_DateColumnName_Selected, Multiple = TRUE, MaxVars = 1L))
                      ),
                      Quantico:::BlankRow(12L),
                      Quantico:::BlankRow(12L)
                    )
                  ),
                  shiny::column(
                    6L,
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(12L, align = 'center', Quantico:::PickerInput(InputID = "XGBoostCARMA_GroupVariables", Label = "Group Variables", Choices = NULL, SelectedDefault = XGBoostCARMA_GroupVariables_Selected, Multiple = TRUE, MaxVars = 100L))
                      ),
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID = "XGBoostCARMA_EncodingMethod", Label = "Categorical Encoding", Choices = XGBoostCARMA_EncodingMethod_Choices, SelectedDefault = XGBoostCARMA_EncodingMethod_Selected, Multiple = TRUE, MaxVars = 1L))
                      ),
                      Quantico:::BlankRow(12L),
                      Quantico:::BlankRow(12L)
                    )
                  )
                )
              ),

              # Series Structure ----
              shiny::tabPanel(
                title = "Series Structure",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shiny::column(
                    6L,
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                      Quantico::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID = "XGBoostCARMA_ZeroPadSeries", Label = "Series Fill Options: use if you have missing dates in any of your series", Choices = XGBoostCARMA_ZeroPadSeries_Choices, SelectedDefault = XGBoostCARMA_ZeroPadSeries_Selected, Multiple = TRUE, MaxVars = 1L))
                      ),
                      Quantico::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID = "XGBoostCARMA_Methods", Label = "Target transformations", Choices = XGBoostCARMA_Methods_Choices, SelectedDefault = XGBoostCARMA_Methods_Selected, Multiple = TRUE, MaxVars = 100L))
                      ),
                      Quantico::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID = "XGBoostCARMA_Difference", Label = "Target Differencing", Choices = XGBoostCARMA_Difference_Choices, SelectedDefault = XGBoostCARMA_Difference_Selected, Multiple = TRUE, MaxVars = 1L))
                      ),
                      Quantico::BlankRow(12L),
                      Quantico::BlankRow(12L)
                    )
                  ),
                  shiny::column(
                    6L,
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                      Quantico::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(12L, align = 'center', Quantico:::NumericInput(InputID = "XGBoostCARMA_TimeWeights", Label = "Time weights: Weighting = (time weights) ^ Days Back from Current", Value = XGBoostCARMA_TimeWeights_Selected, Min = 0.01, Max = 1, Step = 0.0001))
                      ),
                      Quantico::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID = "XGBoostCARMA_NonNegativePred", Label = "Do not allow for negative predictions", Choices = XGBoostCARMA_NonNegativePred_Choices, SelectedDefault = XGBoostCARMA_NonNegativePred_Selected, Multiple = TRUE, MaxVars = 1L))
                      ),
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID = "XGBoostCARMA_RoundPreds", Label = "Round predictions to integers", Choices = XGBoostCARMA_RoundPreds_Choices, SelectedDefault = XGBoostCARMA_RoundPreds_Selected, Multiple = TRUE, MaxVars = 1L))
                      ),
                      Quantico:::BlankRow(12L),
                      Quantico:::BlankRow(12L)
                    )
                  )
                )
              ),

              # Production Parameters ----
              shiny::tabPanel(
                title = "Production",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shiny::column(
                    6L,
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID = "XGBoostCARMA_SaveModel", Label = "Save Model", Choices = XGBoostCARMA_SaveModel_Choices, SelectedDefault = XGBoostCARMA_SaveModel_Selected, Multiple = TRUE, MaxVars = 1L))
                      ),
                      Quantico:::BlankRow(12L),
                      Quantico:::BlankRow(12L)
                    )
                  ),
                  shiny::column(
                    6L,
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID = "XGBoostCARMA_TaskType", Label = "Train Models with GPU or CPU", Choices = XGBoostCARMA_TaskType_Choices, SelectedDefault = XGBoostCARMA_TaskType_Selected, Multiple = TRUE, MaxVars = 1L))
                      ),
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(12L, align = 'center', Quantico:::NumericInput(InputID = "XGBoostCARMA_NumGPU", Label = "Number of GPUs Available for Training", Value = XGBoostCARMA_NumGPU_Selected, Min = 1, Max = 10, Step = 1))
                      ),
                      Quantico:::BlankRow(12L),
                      Quantico:::BlankRow(12L)
                    )
                  )
                )
              ),

              # Feature Engineering ----
              shiny::tabPanel(
                title = "Feature Engineering 1",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shiny::column(
                    6L,
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                      Quantico:::BlankRow(11L),
                      shiny::fluidRow(
                        shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID = "XGBoostCARMA_CalendarVariables", Label = "Calendar variables", Choices = XGBoostCARMA_CalendarVariables_Choices, SelectedDefault = XGBoostCARMA_CalendarVariables_Selected, Multiple = TRUE, MaxVars = 100L))
                      ),
                      Quantico:::BlankRow(11L),
                      shiny::fluidRow(
                        shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID = "XGBoostCARMA_HolidayVariables", Label = "Holiday variables", Choices = XGBoostCARMA_HolidayVariables_Choices, SelectedDefault = XGBoostCARMA_HolidayVariables_Selected, Multiple = TRUE, MaxVars = 100L))
                      ),
                      Quantico:::BlankRow(11L),
                      Quantico:::BlankRow(11L)
                    )
                  ),
                  shiny::column(
                    6L,
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                      Quantico:::BlankRow(11L),
                      shiny::fluidRow(
                        shiny::column(12L, align = 'center', Quantico:::NumericInput(InputID = "XGBoostCARMA_Lookback", Label = "Holiday Window (days)", Value = XGBoostCARMA_Lookback_Selected, Min = 1, Max = 50, Step = 1))
                      ),
                      Quantico:::BlankRow(11L),
                      shiny::fluidRow(
                        shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID = "XGBoostCARMA_TimeTrend", Label = "Time trend", Choices = XGBoostCARMA_TimeTrend_Choices, SelectedDefault = XGBoostCARMA_TimeTrend_Selected, Multiple = TRUE, MaxVars = 1L))
                      ),
                      Quantico:::BlankRow(11L),
                      shiny::fluidRow(
                        shiny::column(6L, align = 'center', Quantico:::SelectizeInput(InputID = "XGBoostCARMA_AnomalyDetection_HighThreshold", Label = "Select tstat for upper threshold", Choices = XGBoostCARMA_AnomalyDetection_HighThreshold_Choices, SelectedDefault = XGBoostCARMA_AnomalyDetection_HighThreshold_Selected, Multiple = TRUE, MaxVars = 1L)),
                        shiny::column(6L, align = 'center', Quantico:::SelectizeInput(InputID = "XGBoostCARMA_AnomalyDetection_LowThreshold", Label = "Select tstat for Lower threshold", Choices = XGBoostCARMA_AnomalyDetection_LowThreshold_Choices, SelectedDefault = XGBoostCARMA_AnomalyDetection_LowThreshold_Selected, Multiple = TRUE, MaxVars = 1L))
                      ),
                      Quantico:::BlankRow(11L),
                      Quantico:::BlankRow(11L)
                    )
                  )
                )
              ),

              # Feature Engineering ----
              shiny::tabPanel(
                title = "Feature Engineering 2",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shiny::column(
                    6L,
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID = "XGBoostCARMA_Lags", Label = "Select Lags", Choices = XGBoostCARMA_Lags_Choices, SelectedDefault = XGBoostCARMA_Lags_Selected, Multiple = TRUE, MaxVars = 1000L))
                      ),
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID = "XGBoostCARMA_MovingAverages", Label = "Select Moving Averages", Choices = XGBoostCARMA_MovingAverages_Choices, SelectedDefault = XGBoostCARMA_MovingAverages_Selected, Multiple = TRUE, MaxVars = 1000L))
                      ),
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID = "XGBoostCARMA_MovingSD", Label = "Select Standard Deviations", Choices = XGBoostCARMA_MovingSD_Choices, SelectedDefault = XGBoostCARMA_MovingSD_Selected, Multiple = TRUE, MaxVars = 1000L))
                      ),
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID = "XGBoostCARMA_MovingKurt", Label = "Select Kurtosis", Choices = XGBoostCARMA_MovingKurt_Choices, SelectedDefault = XGBoostCARMA_MovingKurt_Selected, Multiple = TRUE, MaxVars = 1000L))
                      ),
                      Quantico:::BlankRow(12L),
                      Quantico:::BlankRow(12L)
                    )
                  ),
                  shiny::column(
                    6L,
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID = "XGBoostCARMA_MovingSkew", Label = "Select Skewness", Choices = XGBoostCARMA_MovingSkew_Choices, SelectedDefault = XGBoostCARMA_MovingSkew_Selected, Multiple = TRUE, MaxVars = 1000L))
                      ),
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID = "XGBoostCARMA_Quantiles_Selected", Label = "Select percentiles", Value = XGBoostCARMA_Quantiles_Selected_Selected, Min = 0, Max = 10000, Step = 1))
                      ),
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID = "XGBoostCARMA_DataTruncate", Label = "Truncate NA's: Remove rows where lags and rolling stats produced NA's", Choices = XGBoostCARMA_DataTruncate_Choices, SelectedDefault = XGBoostCARMA_DataTruncate_Selected, Multiple = TRUE, MaxVars = 1L))
                      ),
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID = "XGBoostCARMA_MovingQuantiles", Label = "Select windows", Choices = XGBoostCARMA_MovingQuantiles_Choices, SelectedDefault = XGBoostCARMA_MovingQuantiles_Selected, Multiple = TRUE, MaxVars = 1000L))
                      ),
                      Quantico:::BlankRow(12L),
                      Quantico:::BlankRow(12L)
                    )
                  )
                )
              ),

              # ML Parameters ----
              shiny::tabPanel(
                title = "ML Parameters",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shiny::column(
                    6L,
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(12L, align = 'center', Quantico:::NumericInput(InputID = "XGBoostCARMA_NTrees", Label="Number of Trees", Value = XGBoostCARMA_NTrees_Selected, Min = 50, Max = 30000, Step = 25))
                      ),
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(12L, align = 'center', Quantico:::NumericInput(InputID = "XGBoostCARMA_MaxDepth", Label = "Max Depth", Choices = XGBoostCARMA_MaxDepth_Choices, SelectedDefault = XGBoostCARMA_MaxDepth_Selected, Multiple = TRUE, MaxVars = 1L))
                      ),
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID = "XGBoostCARMA_MinChildWeight", Label = "Min Rows per Leaf", Choices = XGBoostCARMA_MinChildWeight_Choices, SelectedDefault = XGBoostCARMA_MinChildWeight_Selected, Multiple = TRUE, MaxVars = 1L))
                      ),
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID = "XGBoostCARMA_SubSample", Label = "Row Sampling per Tree", Choices = XGBoostCARMA_SubSample_Choices, SelectedDefault = XGBoostCARMA_SubSample_Selected, Multiple = TRUE, MaxVars = 1L))
                      ),
                      Quantico:::BlankRow(12L),
                      Quantico:::BlankRow(12L)
                    )
                  ),
                  shiny::column(
                    6L,
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID = "XGBoostCARMA_ColSampleByTree", Label = "Column Sampling per Tree", Choices = XGBoostCARMA_ColSampleByTree_Choices, SelectedDefault = XGBoostCARMA_ColSampleByTree_Selected, Multiple = TRUE, MaxVars = 1L))
                      ),
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID = "XGBoostCARMA_lambda", Label = "L2 Regularization", Choices = XGBoostCARMA_lambda_Choices, SelectedDefault = XGBoostCARMA_lambda_Selected, Multiple = TRUE, MaxVars = 1L))
                      ),
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID = "XGBoostCARMA_alpha", Label = "L1 Regularization", Choices = XGBoostCARMA_alpha_Choices, SelectedDefault = XGBoostCARMA_alpha_Selected, Multiple = TRUE, MaxVars = 1L))
                      ),
                      Quantico:::BlankRow(12L),
                      Quantico:::BlankRow(12L)
                    )
                  )
                )
              ),

              # Eval Metrics ----
              shiny::tabPanel(
                title = "Evaluation",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shiny::column(
                    6L,
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID = "XGBoostCARMA_EvalMetric", Label = "Eval metric for feature selection", Choices = XGBoostCARMA_EvalMetric_Choices, SelectedDefault = XGBoostCARMA_EvalMetric_Selected, Multiple = TRUE, MaxVars = 1L))
                      ),
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID = "XGBoostCARMA_LossFunction", Label = "Loss function for model", Choices = XGBoostCARMA_LossFunction_Choices, SelectedDefault = XGBoostCARMA_LossFunction_Selected, Multiple = TRUE, MaxVars = 1L))
                      ),
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID = "XGBoostCARMA_CrossEvalModelUpdate", Label = "Cross-Eval: Model Update", Choices = XGBoostCARMA_CrossEvalModelUpdate_Choices, SelectedDefault = XGBoostCARMA_CrossEvalModelUpdate_Selected, Multiple = TRUE, MaxVars = 1L))
                      ),
                    )
                  ),
                  shiny::column(
                    6L,
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID = "XGBoostCARMA_CrossEvalValuesUpdate", Label = "Cross-Eval: Values Update", Choices = XGBoostCARMA_CrossEvalValuesUpdate_Choices, SelectedDefault = XGBoostCARMA_CrossEvalValuesUpdate_Selected, Multiple = TRUE, MaxVars = 1L))
                      ),
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID = "XGBoostCARMA_CrossEvalModelUpdateFreq", Label = "Cross-Eval: Model Update Freq", Choices = XGBoostCARMA_CrossEvalModelUpdateFreq_Choices, SelectedDefault = XGBoostCARMA_CrossEvalModelUpdateFreq_Selected, Multiple = TRUE, MaxVars = 1L))
                      ),
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID = "XGBoostCARMA_CrossEvalValuesUpdateFreq", Label = "Cross-Eval: Values Update Freq", Choices = XGBoostCARMA_CrossEvalValuesUpdateFreq_Choices, SelectedDefault = XGBoostCARMA_CrossEvalValuesUpdateFreq_Selected, Multiple = TRUE, MaxVars = 1L))
                      ),
                      Quantico:::BlankRow(12L),
                      Quantico:::BlankRow(12L)
                    )
                  )
                )
              )
            )
          ),
          footer = shiny::tagList(
            shiny::modalButton(label = "Cancel"),
            shiny::actionButton("XGBoostCARMA_OK", "OK", width = '50px')))
      ) # end TagList
    }
  )
}

#' @title LightGBMCARMA_Modal_Fun
#'
#' @description LightGBM CARMA Parameters Modal with OK button to close
#'
#' @author Adrian Antico
#' @family ML
#'
#' @param id = 'LightGBMCARMA_ID'
#' @param AppWidth = 12L
#'
#' @export
LightGBMCARMA_Modal_Fun <- function(id,
                                    AppWidth=12L,

                                    # Reactives
                                    LightGBMCARMA_ModelID_Selected = NULL,
                                    LightGBMCARMA_TargetColumnName_Selected = NULL,
                                    LightGBMCARMA_DateColumnName_Selected = NULL,
                                    LightGBMCARMA_GroupVariables_Selected = NULL,

                                    # Statics
                                    LightGBMCARMA_RunMode_Choices = NULL,
                                    LightGBMCARMA_TimeUnit_Choices = NULL,
                                    LightGBMCARMA_FCPeriods_Choices = NULL,
                                    LightGBMCARMA_TaskType_Choices = NULL,
                                    LightGBMCARMA_NumGPU_Choices = NULL,
                                    LightGBMCARMA_SaveModel_Choices = NULL,
                                    LightGBMCARMA_ArgsList_Choices = NULL,
                                    LightGBMCARMA_TimeWeights_Choices = NULL,
                                    LightGBMCARMA_Methods_Choices = NULL,
                                    LightGBMCARMA_Difference_Choices = NULL,
                                    LightGBMCARMA_NonNegativePred_Choices = NULL,
                                    LightGBMCARMA_RoundPreds_Choices = NULL,
                                    LightGBMCARMA_CalendarVariables_Choices = NULL,
                                    LightGBMCARMA_HolidayVariables_Choices = NULL,
                                    LightGBMCARMA_Lookback_Choices = NULL,
                                    LightGBMCARMA_Lags_Choices = NULL,
                                    LightGBMCARMA_MovingAverages_Choices = NULL,
                                    LightGBMCARMA_MovingSD_Choices = NULL,
                                    LightGBMCARMA_MovingSkew_Choices = NULL,
                                    LightGBMCARMA_MovingKurt_Choices = NULL,
                                    LightGBMCARMA_MovingQuantiles_Choices = NULL,
                                    LightGBMCARMA_Quantiles_Selected_Choices = NULL,
                                    LightGBMCARMA_AnomalyDetection_HighThreshold_Choices = NULL,
                                    LightGBMCARMA_AnomalyDetection_LowThreshold_Choices = NULL,
                                    LightGBMCARMA_TimeTrend_Choices = NULL,
                                    LightGBMCARMA_DataTruncate_Choices = NULL,
                                    LightGBMCARMA_EncodingMethod_Choices = NULL,
                                    LightGBMCARMA_ZeroPadSeries_Choices = NULL,
                                    LightGBMCARMA_CrossEvalModelUpdate_Choices = NULL,
                                    LightGBMCARMA_CrossEvalValuesUpdate_Choices = NULL,
                                    LightGBMCARMA_CrossEvalModelUpdateFreq_Choices = NULL,
                                    LightGBMCARMA_CrossEvalValuesUpdateFreq_Choices = NULL,
                                    LightGBMCARMA_EvalMetric_Choices = NULL,
                                    LightGBMCARMA_LossFunction_Choices = NULL,
                                    LightGBMCARMA_TrainData_Choices = NULL,
                                    LightGBMCARMA_ValidationData_Choices = NULL,
                                    LightGBMCARMA_XREGS_Choices = NULL,
                                    LightGBMCARMA_Trees_Choices = NULL,
                                    LightGBMCARMA_Max_Depth_Choices = NULL,
                                    LightGBMCARMA_ETA_Choices = NULL,
                                    LightGBMCARMA_Min_Data_In_Leaf_Choices = NULL,
                                    LightGBMCARMA_Num_Leaves_Choices = NULL,
                                    LightGBMCARMA_Bagging_Fraction_Choices = NULL,
                                    LightGBMCARMA_Feature_Fraction_Choices = NULL,
                                    LightGBMCARMA_Feature_Fraction_Bynode_Choices = NULL,
                                    LightGBMCARMA_Lambda_L1_Choices = NULL,
                                    LightGBMCARMA_Lambda_L2_Choices = NULL,

                                    # Updaters
                                    LightGBMCARMA_RunMode_Selected = NULL,
                                    LightGBMCARMA_TimeUnit_Selected = NULL,
                                    LightGBMCARMA_FCPeriods_Selected = NULL,
                                    LightGBMCARMA_TaskType_Selected = NULL,
                                    LightGBMCARMA_NumGPU_Selected = NULL,
                                    LightGBMCARMA_SaveModel_Selected = NULL,
                                    LightGBMCARMA_ArgsList_Selected = NULL,
                                    LightGBMCARMA_TimeWeights_Selected = NULL,
                                    LightGBMCARMA_Methods_Selected = NULL,
                                    LightGBMCARMA_Difference_Selected = NULL,
                                    LightGBMCARMA_NonNegativePred_Selected = NULL,
                                    LightGBMCARMA_RoundPreds_Selected = NULL,
                                    LightGBMCARMA_CalendarVariables_Selected = NULL,
                                    LightGBMCARMA_HolidayVariables_Selected = NULL,
                                    LightGBMCARMA_Lookback_Selected = NULL,
                                    LightGBMCARMA_Lags_Selected = NULL,
                                    LightGBMCARMA_MovingAverages_Selected = NULL,
                                    LightGBMCARMA_MovingSD_Selected = NULL,
                                    LightGBMCARMA_MovingSkew_Selected = NULL,
                                    LightGBMCARMA_MovingKurt_Selected = NULL,
                                    LightGBMCARMA_MovingQuantiles_Selected = NULL,
                                    LightGBMCARMA_Quantiles_Selected_Selected = NULL,
                                    LightGBMCARMA_AnomalyDetection_HighThreshold_Selected = NULL,
                                    LightGBMCARMA_AnomalyDetection_LowThreshold_Selected = NULL,
                                    LightGBMCARMA_TimeTrend_Selected = NULL,
                                    LightGBMCARMA_DataTruncate_Selected = NULL,
                                    LightGBMCARMA_EncodingMethod_Selected = NULL,
                                    LightGBMCARMA_ZeroPadSeries_Selected = NULL,
                                    LightGBMCARMA_CrossEvalModelUpdate_Selected = NULL,
                                    LightGBMCARMA_CrossEvalValuesUpdate_Selected = NULL,
                                    LightGBMCARMA_CrossEvalModelUpdateFreq_Selected = NULL,
                                    LightGBMCARMA_CrossEvalValuesUpdateFreq_Selected = NULL,
                                    LightGBMCARMA_EvalMetric_Selected = NULL,
                                    LightGBMCARMA_LossFunction_Selected = NULL,
                                    LightGBMCARMA_TrainData_Selected = NULL,
                                    LightGBMCARMA_ValidationData_Selected = NULL,
                                    LightGBMCARMA_XREGS_Selected = NULL,
                                    LightGBMCARMA_Trees_Selected = NULL,
                                    LightGBMCARMA_Max_Depth_Selected = NULL,
                                    LightGBMCARMA_ETA_Selected = NULL,
                                    LightGBMCARMA_Min_Data_In_Leaf_Selected = NULL,
                                    LightGBMCARMA_Num_Leaves_Selected = NULL,
                                    LightGBMCARMA_Bagging_Fraction_Selected = NULL,
                                    LightGBMCARMA_Feature_Fraction_Selected = NULL,
                                    LightGBMCARMA_Feature_Fraction_Bynode_Selected = NULL,
                                    LightGBMCARMA_Lambda_L1_Selected = NULL,
                                    LightGBMCARMA_Lambda_L2_Selected = NULL) {

  shiny::moduleServer(
    id = id,
    module = function(input, output, session) {
      ns <- session$ns
      shiny::showModal(
        shiny::modalDialog(
          title = 'LightGBM FC Parameters',
          size = "l",
          easyClose = FALSE,
          fade = TRUE,
          shiny::tagList(

            # Top Box ----
            shinydashboard::box(
              title = NULL, solidHeader = TRUE, collapsible = FALSE, status = 'danger', width = AppWidth,

              shiny::fluidRow(
                shiny::column(
                  width = 12L,
                  align = "right",
                  shinyWidgets::dropdown(
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = "info", width = 12L,
                      shiny::fluidRow(
                        shiny::column(
                          width = 12L,
                          align = "left",
                          shiny::a(name = "forecasting"),
                          shiny::h2(tags$b("Forecasting")),
                          shiny::p("Forecasting is a vitally important aspect of this software. It's important that you know how to
                             utilize the functionality as intended. Below are all of the algorithms with descriptions about
                             how to use each and every one for each of their intended uses. If you've done forecasting in the
                             past you'll find that the methods provided are as feature rich as you've encountered, if at all.
                             There are serveral forecasting use cases covered in this software, including:"))),


                      Quantico::BlankRow(12),
                      shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::h3("Run Modes:"))),
                      shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::markdown(
                        "
                      There are various Run modes to training, backtesting, and forecasting:
                      * Train Model: This is equivalent to building an ML model
                      * Retrain Existing Model: This is for retraining a model that's already been built before. Perhaps you simply want an updated model but not a new forecast at the moment
                      * Backtest: This task will train a new model (if FC ArgsList is not supplied) and generate an N-Period ahead forecast that will be evaluated using Validation Data supplied by the user. If you don't have a Validation dataset, go to Data Wrangling and subset rows based on a time variable. The subset data will be your Training Data and your original dataset will be the Validation Data
                      * Feature Engineering Test: This task will loop through various builds starting from the most simple up to a moderately sophisticated models. An evaluation table is generated that you can view in the Tables tab when the procedure is complete. Evaluation metrics are based on the Backtest method. Features tested are below and are in order. If a feature is beneficial it will remain in the models trained thereafter:
                        1. LogPlus1 vs None: this will test whether a target variable transformation is beneficial
                        2. Series Difference vs None: this will test whether utilizing Differencing your series is useful
                        3. Calendar Variables vs None: this will test whether utilizing Calendar Variables is useful
                        4. Holiday Variable vs None: this will test whether utilizing Holiday Variables is useful
                        5. Credibility vs Target Encoding : this will test whether a target encoding is better than a credibility encoding
                        6. Time Weights vs None: this will test whether utilizing Time Weighting is useful
                        7. Anomaly Detection vs None: this will test whether utilizing Anomaly Detection is useful
                        8. Time Trend Variable vs None: this will test whether utilizing a Time Trend Variable is useful
                        9. Lag 1 vs None: this will test whether utilizing Lags are useful (user supplies the lags and if none are set then a lag1 is tested)
                      * Backtest Cross Evaluation: Once you have a good model designed you can mock production by running this procedure. Here, you'll set the data refresh rate and the model update rate. Performance measure are returned in a data.table once the procedure is finished.
                      * Forecast: if you have a trained model you can call it to generate a forecast for you
                      * Retrain + Forecast: if you have a model you can refresh it and have it generate a forecast for you
                      "
                      ))),
                      Quantico::BlankRow(12),
                      shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::h3("Features Engineering:"))),
                      shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::markdown(
                        "
                      * Single shot backtesting over a defined horizon
                      * Roll forward backtesting over a defined horizon
                      * Series filling for any missing gaps
                      * Lags
                      * Moving averages
                      * Calendar variables
                      * Holiday variables
                      * Holiday lookback window for extended effects
                      * Target transformation
                      * Categorical variable encoding
                      * Differencing
                      * Exongenous regressors (user supplied)
                      * Time trend variable
                      * Anomaly detection as variables
                      * Data truncation testing for NA produced by rolling stats
                      * All the ML hyperparameters that come with the underlying ML algorithms
                      "
                      ))),

                      Quantico::BlankRow(12),
                      shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::h3("Forecasting Usage"))),

                      shiny::fluidRow(shiny::column(width = 12L, align = "left", shiny::markdown(
                        "
                    ### General Parameters
                    * ModelID: Use this to identify output among competing models
                    * FCPeriods: use this for forecasting and backtesting. Not used for training
                    * TimeUnit: define the time granularity of your data set
                    * Train Data and Validation Data: training data is used for the ML training process. Validation Data is only used for backtesting
                    * TargetColumnName: Value column that you are forecasting
                    * DateColumnName: Date variable in your data
                    * GroupVariables: List out group variables from lowest grain to highest grain. E.g. Customer, Sku, Brand
                    * EncodingMethod: Use if you have group variables listed
                    * ZeroPadSeries: Fill missing values. Use dynamic to deal with irregular start and end dates across group variables
                    * Methods: Target transformations are extremely helpful for panel data forecasting
                    * Difference: Use if your series have significant trend
                    * TimeWeights: attach more importance to the most recent records in your data
                    * NonNegativePred: prevent the model from predicting negative values
                    * RoundPreds: round predictions to integer values
                    * SaveModel: Use this to bypass ML training for backtesting and forecasting, unless you want a new model
                    * Task Type: utilize GPU or CPU for the ML Training. With GPU, you typically need more trees, more depth, less regularization, etc. CPU typically generates better results using defaults.
                    * Number of GPUs: if you have access to more than one GPU and would like to use it, specify the number of GPUs you want to allocate for ML Training
                    * CalendarVariables: Capture calendar effects within your forecast
                    * HolidayVariables: Capture holiday effects within your forecast
                    * Lookback: used for HolidayVariables: has there been a holiday in the last N days? N is the Lookback value.
                    * TimeTrend: add a time trend variable. Perhaps this alleviates trend issues in your forecast. If not, consider differencing the target variable
                    * Data Truncate: When lags or rolling stats are created, NA's are generated for rows where a full window lookback is not available. E.g. a 10-period moving average on data with only 5 periods: all five periods will be NA
                    * Lags: past values represented on the rows holding the current values. We're looking to utilize information from the past to help predict the future.
                    * Moving Averages: generated using the lag1-Target Variable.
                    * Moving Quantiles: If you beieve the particular percentiles of past values are useful for predicting future states, then include these. E.g. median = 50th percentile
                    * Moving Standard Deviation: If you beieve the volatility of past values are useful for predicting future states, then include these.
                    * Moving Skew: If you beieve the skew of past values are useful for predicting future states, then include these.
                    * Moving Kurtosis: If you beieve the kurtosis of past values are useful for predicting future states, then include these.
                    * CrossEvalModelUpdate: Set to TRUE to enable model updating
                    * CrossEvalModelUpdateFreq: frequency of model updating in cross eval backtesting run mode
                    * CrossEvalValuesUpdate: Set to TRUE to enable data updating
                    * CrossEvalValuesUpdateFreq: frequency of data updating in cross eval backtesting run mode
                    "
                      )))
                    ),

                    size = "lg",
                    icon = shiny::icon("question"),
                    label = NULL,
                    tooltip = FALSE,
                    right = TRUE,
                    up = FALSE,
                    width = NULL,
                    animate = shinyWidgets::animateOptions(
                      enter = "zoomIn",
                      exit = "fadeOutRightBig"
                    ),
                    inputId = NULL,
                    block = FALSE,
                    no_outline = TRUE
                  )
                )
              ),

              Quantico:::BlankRow(12L),
              shiny::fluidRow(
                shiny::column(
                  width = 3L, align = 'center',
                  Quantico:::SelectizeInput(InputID = 'LightGBMCARMA_RunMode', Label = 'Select Run Mode', Choices = LightGBMCARMA_RunMode_Choices, SelectedDefault = LightGBMCARMA_RunMode_Selected, Multiple = TRUE, MaxVars = 1)),
                shiny::column(
                  width = 2L, align = 'center', tags$h3(tags$b('Build FC')),
                  shiny::actionButton(inputId = paste0('BuildModels_LightGBMCARMA'), label = paste0('Run'), icon = shiny::icon('chevron-right', lib='font-awesome'))),
                shiny::column(width = 2L),
                shiny::column(
                  width = 2L, shinyjs::useShinyjs(), align = 'center', tags$h3(tags$b('Refresh')),
                  shiny::actionButton( inputId = paste0('LightGBMCARMA_RefreshInputs'), label = paste0('Run'), icon = shiny::icon('chevron-right', lib='font-awesome'))),
                shiny::column(
                  width = 3L, align = 'center',
                  Quantico:::SelectizeInput(InputID = "LightGBMCARMA_ArgsList", Label = "Existing Models", Choices = LightGBMCARMA_ArgsList_Choices, SelectedDefault = LightGBMCARMA_ArgsList_Selected,  Multiple = TRUE, MaxVars = 100L)))), # box

            Quantico:::BlankRow(12L),
            Quantico:::BlankRow(12L),

            # Tabs
            shiny::tabsetPanel(
              id = 'LightGBMCARMA_TabPanel',
              selected = 'Data',

              # Data Parameters ----
              shiny::tabPanel(
                title = "Data",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shiny::column(
                    6L,
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(12L, align = 'center', Quantico:::TextInput(InputID = 'LightGBMCARMA_ModelID', Label="Model ID", Value = LightGBMCARMA_ModelID_Selected))
                      ),
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(12L, align = 'center', Quantico:::NumericInput(InputID = "LightGBMCARMA_FCPeriods", Label = "Forecast Periods", Value = LightGBMCARMA_FCPeriods_Selected, Min = 1L, Max = 100000L, Step = 1L))
                      ),
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID = "LightGBMCARMA_TimeUnit", Label = "Time Unit: is your data daily, weekly, monthly, or something else?", Choices = LightGBMCARMA_TimeUnit_Choices, SelectedDefault = LightGBMCARMA_TimeUnit_Selected, Multiple = TRUE, MaxVars = 1L))
                      ),
                      Quantico:::BlankRow(12L),
                      Quantico:::BlankRow(12L)
                    )
                  ),

                  shiny::column(
                    6L,
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID = 'LightGBMCARMA_TrainData', Label = 'Select Train Data', Choices = LightGBMCARMA_TrainData_Choices, SelectedDefault = LightGBMCARMA_TrainData_Selected, Multiple = TRUE, MaxVars = 1L))
                      ),
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID = 'LightGBMCARMA_ValidationData', Label = 'Select Validation Data: used for backtesting, not model training', Choices = LightGBMCARMA_ValidationData_Choices, SelectedDefault = LightGBMCARMA_ValidationData_Selected, Multiple = TRUE, MaxVars = 1L))
                      ),
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID = 'LightGBMCARMA_XREGS', Label = 'Exogenous Regressors (XREGS)', Choices = LightGBMCARMA_XREGS_Choices, SelectedDefault = LightGBMCARMA_XREGS_Selected, Multiple = TRUE, MaxVars = 1L))
                      ),
                      Quantico:::BlankRow(12L),
                      Quantico:::BlankRow(12L)
                    )
                  )
                )
              ),

              # Variables ----
              shiny::tabPanel(
                title = "Variables",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shiny::column(
                    6L,
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,

                      # Data Names
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(12L, align = 'center', Quantico:::PickerInput(InputID = "LightGBMCARMA_TargetColumnName", Label = "Target Variable", Choices = NULL, SelectedDefault = LightGBMCARMA_TargetColumnName_Selected, Multiple = TRUE, MaxVars = 1L))
                      ),
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(12L, align = 'center', Quantico:::PickerInput(InputID = "LightGBMCARMA_DateColumnName", Label = "Date Variable", Choices = NULL, SelectedDefault = LightGBMCARMA_DateColumnName_Selected, Multiple = TRUE, MaxVars = 1L))
                      ),
                      Quantico:::BlankRow(12L),
                      Quantico:::BlankRow(12L)
                    )
                  ),
                  shiny::column(
                    6L,
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(12L, align = 'center', Quantico:::PickerInput(InputID = "LightGBMCARMA_GroupVariables", Label = "Group Variables: <lowest grain to highest grain> e.g. customer, sku, catfood", Choices = NULL, SelectedDefault = LightGBMCARMA_GroupVariables_Selected, Multiple = TRUE, MaxVars = 100L))
                      ),
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID = "LightGBMCARMA_EncodingMethod", Label = "Categorical Encoding", Choices = LightGBMCARMA_EncodingMethod_Choices, SelectedDefault = LightGBMCARMA_EncodingMethod_Selected, Multiple = TRUE, MaxVars = 1L))
                      ),
                      Quantico:::BlankRow(12L),
                      Quantico:::BlankRow(12L)
                    )
                  )
                )
              ),

              # Series Structure ----
              shiny::tabPanel(
                title = "Series Structure",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shiny::column(
                    6L,
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                      Quantico::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID = "LightGBMCARMA_ZeroPadSeries", Label = "Series Fill Options: use if you have missing dates in any of your series", Choices = LightGBMCARMA_ZeroPadSeries_Choices, SelectedDefault = LightGBMCARMA_ZeroPadSeries_Selected, Multiple = TRUE, MaxVars = 1L))
                      ),
                      Quantico::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID = "LightGBMCARMA_Methods", Label = "Target transformations", Choices = LightGBMCARMA_Methods_Choices, SelectedDefault = LightGBMCARMA_Methods_Selected, Multiple = TRUE, MaxVars = 100L))
                      ),
                      Quantico::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID = "LightGBMCARMA_Difference", Label = "Target Differencing", Choices = LightGBMCARMA_Difference_Choices, SelectedDefault = LightGBMCARMA_Difference_Selected, Multiple = TRUE, MaxVars = 1L))
                      ),
                      Quantico:::BlankRow(12L),
                      Quantico:::BlankRow(12L)
                    )
                  ),
                  shiny::column(
                    6L,
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                      Quantico::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(12L, align = 'center', Quantico:::NumericInput(InputID = "LightGBMCARMA_TimeWeights", Label = "Time weights: Weighting = (time weights) ^ Days Back from Current", Value = LightGBMCARMA_TimeWeights_Selected, Min = 0.01, Max = 1, Step = 0.0001))
                      ),
                      Quantico::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID = "LightGBMCARMA_NonNegativePred", Label = "Do not allow for negative predictions", Choices = LightGBMCARMA_NonNegativePred_Choices, SelectedDefault = LightGBMCARMA_NonNegativePred_Selected, Multiple = TRUE, MaxVars = 1L))
                      ),
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID = "LightGBMCARMA_RoundPreds", Label = "Round predictions to integers", Choices = LightGBMCARMA_RoundPreds_Choices, SelectedDefault = LightGBMCARMA_RoundPreds_Selected, Multiple = TRUE, MaxVars = 1L))
                      ),
                      Quantico:::BlankRow(12L),
                      Quantico:::BlankRow(12L)
                    )
                  )
                )
              ),

              # Production Parameters ----
              shiny::tabPanel(
                title = "Production",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shiny::column(
                    6L,
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID = "LightGBMCARMA_SaveModel", Label = "Save Model", Choices = LightGBMCARMA_SaveModel_Choices, SelectedDefault = LightGBMCARMA_SaveModel_Selected, Multiple = TRUE, MaxVars = 1L))
                      ),
                      Quantico:::BlankRow(12L),
                      Quantico:::BlankRow(12L)
                    )
                  ),
                  shiny::column(
                    6L,
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID = "LightGBMCARMA_TaskType", Label = "Train Models with GPU or CPU", Choices = LightGBMCARMA_TaskType_Choices, SelectedDefault = LightGBMCARMA_TaskType_Selected, Multiple = TRUE, MaxVars = 1L))
                      ),
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(12L, align = 'center', Quantico:::NumericInput(InputID = "LightGBMCARMA_NumGPU", Label = "Number of GPUs Available for Training", Value = LightGBMCARMA_NumGPU_Selected, Min = 1, Max = 10, Step = 1))
                      ),
                      Quantico:::BlankRow(12L),
                      Quantico:::BlankRow(12L)
                    )
                  )
                )
              ),

              # Feature Engineering ----
              shiny::tabPanel(
                title = "Feature Engineering 1",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shiny::column(
                    6L,
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                      Quantico:::BlankRow(11L),
                      shiny::fluidRow(
                        shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID = "LightGBMCARMA_CalendarVariables", Label = "Calendar variables", Choices = LightGBMCARMA_CalendarVariables_Choices, SelectedDefault = LightGBMCARMA_CalendarVariables_Selected, Multiple = TRUE, MaxVars = 100L))
                      ),
                      Quantico:::BlankRow(11L),
                      shiny::fluidRow(
                        shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID = "LightGBMCARMA_HolidayVariables", Label = "Holiday variables", Choices = LightGBMCARMA_HolidayVariables_Choices, SelectedDefault = LightGBMCARMA_HolidayVariables_Selected, Multiple = TRUE, MaxVars = 100L))
                      ),
                      Quantico:::BlankRow(11L),
                      Quantico:::BlankRow(11L)
                    )
                  ),
                  shiny::column(
                    6L,
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                      Quantico:::BlankRow(11L),
                      shiny::fluidRow(
                        shiny::column(12L, align = 'center', Quantico:::NumericInput(InputID = "LightGBMCARMA_Lookback", Label = "Holiday Window (days)", Value = LightGBMCARMA_Lookback_Selected, Min = 1, Max = 50, Step = 1))
                      ),
                      Quantico:::BlankRow(11L),
                      shiny::fluidRow(
                        shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID = "LightGBMCARMA_TimeTrend", Label = "Time trend", Choices = LightGBMCARMA_TimeTrend_Choices, SelectedDefault = LightGBMCARMA_TimeTrend_Selected, Multiple = TRUE, MaxVars = 1L))
                      ),
                      Quantico:::BlankRow(11L),
                      shiny::fluidRow(
                        shiny::column(6L, align = 'center', Quantico:::SelectizeInput(InputID = "LightGBMCARMA_AnomalyDetection_HighThreshold", Label = "Select tstat for upper threshold", Choices = LightGBMCARMA_AnomalyDetection_HighThreshold_Choices, SelectedDefault = LightGBMCARMA_AnomalyDetection_HighThreshold_Selected, Multiple = TRUE, MaxVars = 1L)),
                        shiny::column(6L, align = 'center', Quantico:::SelectizeInput(InputID = "LightGBMCARMA_AnomalyDetection_LowThreshold", Label = "Select tstat for Lower threshold", Choices = LightGBMCARMA_AnomalyDetection_LowThreshold_Choices, SelectedDefault = LightGBMCARMA_AnomalyDetection_LowThreshold_Selected, Multiple = TRUE, MaxVars = 1L))
                      ),
                      Quantico:::BlankRow(12L),
                      Quantico:::BlankRow(12L)
                    )
                  )
                )
              ),

              # Feature Engineering ----
              shiny::tabPanel(
                title = "Feature Engineering 2",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shiny::column(
                    6L,
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID = "LightGBMCARMA_Lags", Label = "Select Lags", Choices = LightGBMCARMA_Lags_Choices, SelectedDefault = LightGBMCARMA_Lags_Selected, Multiple = TRUE, MaxVars = 1000L))
                      ),
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID = "LightGBMCARMA_MovingAverages", Label = "Select Moving Averages", Choices = LightGBMCARMA_MovingAverages_Choices, SelectedDefault = LightGBMCARMA_MovingAverages_Selected, Multiple = TRUE, MaxVars = 1000L))
                      ),
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID = "LightGBMCARMA_MovingSD", Label = "Select Standard Deviations", Choices = LightGBMCARMA_MovingSD_Choices, SelectedDefault = LightGBMCARMA_MovingSD_Selected, Multiple = TRUE, MaxVars = 1000L))
                      ),
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID = "LightGBMCARMA_MovingKurt", Label = "Select Kurtosis", Choices = LightGBMCARMA_MovingKurt_Choices, SelectedDefault = LightGBMCARMA_MovingKurt_Selected, Multiple = TRUE, MaxVars = 1000L))
                      ),
                      Quantico:::BlankRow(12L),
                      Quantico:::BlankRow(12L)
                    )
                  ),
                  shiny::column(
                    6L,
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID = "LightGBMCARMA_MovingSkew", Label = "Select Skewness", Choices = LightGBMCARMA_MovingSkew_Choices, SelectedDefault = LightGBMCARMA_MovingSkew_Selected, Multiple = TRUE, MaxVars = 1000L))
                      ),
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID = "LightGBMCARMA_Quantiles_Selected", Label = "Select percentiles", Choices = NULL, SelectedDefault = LightGBMCARMA_Quantiles_Selected_Selected, Multiple = TRUE, MaxVars = 100L))
                      ),
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID = "LightGBMCARMA_DataTruncate", Label = "Truncate NA's: Remove rows where lags and rolling stats produced NA's", Choices = LightGBMCARMA_DataTruncate_Choices, SelectedDefault = LightGBMCARMA_DataTruncate_Selected, Multiple = TRUE, MaxVars = 1L))
                      ),
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID = "LightGBMCARMA_MovingQuantiles", Label = "Select windows", Choices = LightGBMCARMA_MovingQuantiles_Choices, SelectedDefault = LightGBMCARMA_MovingQuantiles_Selected, Multiple = TRUE, MaxVars = 1000L))
                      ),
                      Quantico:::BlankRow(12L),
                      Quantico:::BlankRow(12L)
                    )
                  )
                )
              ),

              # ML Parameters ----
              shiny::tabPanel(
                title = "ML Parameters",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shiny::column(
                    6L,
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(12L, align = 'center', Quantico:::NumericInput(InputID = "LightGBMCARMA_Trees", Label="Number of trees", Value = LightGBMCARMA_Trees_Selected, Min = 50, Max = 30000, Step = 25))
                      ),
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(12L, align = 'center', Quantico:::NumericInput(InputID = "LightGBMCARMA_Max_Depth", Label = "Max Depth", Value = LightGBMCARMA_Max_Depth_Selected, Min = 2, Max = 20, Step = 1))
                      ),
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID = "LightGBMCARMA_Min_Data_In_Leaf", Label = "Min Data in Leaves", Choices = LightGBMCARMA_Min_Data_In_Leaf_Choices, SelectedDefault = LightGBMCARMA_Min_Data_In_Leaf_Selected, Multiple = TRUE, MaxVars = 1L))
                      ),
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID = "LightGBMCARMA_Num_Leaves", Label = "Number of Leaves per Tree", Choices = LightGBMCARMA_Num_Leaves_Choices, SelectedDefault = LightGBMCARMA_Num_Leaves_Selected, Multiple = TRUE, MaxVars = 1L))
                      ),
                      Quantico:::BlankRow(12L),
                      Quantico:::BlankRow(12L)
                    )
                  ),
                  shiny::column(
                    6L,
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID = "LightGBMCARMA_Bagging_Fraction", Label = "Row Sampling", Choices = LightGBMCARMA_Bagging_Fraction_Choices, SelectedDefault = LightGBMCARMA_Bagging_Fraction_Selected, Multiple = TRUE, MaxVars = 1L))
                      ),
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID = "LightGBMCARMA_Feature_Fraction", Label = "Columnm Sampling", Choices = LightGBMCARMA_Feature_Fraction_Choices, SelectedDefault = LightGBMCARMA_Feature_Fraction_Selected, Multiple = TRUE, MaxVars = 1L))
                      ),
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID = "LightGBMCARMA_Feature_Fraction_Bynode", Label = "Column Sampling by Node", Choices = LightGBMCARMA_Feature_Fraction_Bynode_Choices, SelectedDefault = LightGBMCARMA_Feature_Fraction_Bynode_Selected, Multiple = TRUE, MaxVars = 1L))
                      ),
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID = "LightGBMCARMA_Lambda_L1", Label = "L2 regularization", Choices = LightGBMCARMA_Lambda_L1_Choices, SelectedDefault = LightGBMCARMA_Lambda_L1_Selected, Multiple = TRUE, MaxVars = 1L))
                      ),
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID = "LightGBMCARMA_Lambda_L2", Label = "L2 regularization", Choices = LightGBMCARMA_Lambda_L2_Choices, SelectedDefault = LightGBMCARMA_Lambda_L2_Selected, Multiple = TRUE, MaxVars = 1L))
                      ),
                      Quantico:::BlankRow(12L),
                      Quantico:::BlankRow(12L)
                    )
                  )
                )
              ),

              # Eval Metrics ----
              shiny::tabPanel(
                title = "Evaluation",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shiny::column(
                    6L,
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID = "LightGBMCARMA_EvalMetric", Label = "Eval metric for feature selection", Choices = LightGBMCARMA_EvalMetric_Choices, SelectedDefault = LightGBMCARMA_EvalMetric_Selected, Multiple = TRUE, MaxVars = 1L))
                      ),
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID = "LightGBMCARMA_LossFunction", Label = "Loss function for model", Choices = LightGBMCARMA_LossFunction_Choices, SelectedDefault = LightGBMCARMA_LossFunction_Selected, Multiple = TRUE, MaxVars = 1L))
                      ),
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID = "LightGBMCARMA_CrossEvalModelUpdate", Label = "Cross-Eval: Model Update", Choices = LightGBMCARMA_CrossEvalModelUpdate_Choices, SelectedDefault = LightGBMCARMA_CrossEvalModelUpdate_Selected, Multiple = TRUE, MaxVars = 1L))
                      ),
                      Quantico:::BlankRow(12L),
                      Quantico:::BlankRow(12L)
                    )
                  ),
                  shiny::column(
                    6L,
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = NULL, width = 12L,
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID = "LightGBMCARMA_CrossEvalValuesUpdate", Label = "Cross-Eval: Values Update", Choices = LightGBMCARMA_CrossEvalValuesUpdate_Choices, SelectedDefault = LightGBMCARMA_CrossEvalValuesUpdate_Selected, Multiple = TRUE, MaxVars = 1L))
                      ),
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID = "LightGBMCARMA_CrossEvalModelUpdateFreq", Label = "Cross-Eval: Model Update Freq", Choices = LightGBMCARMA_CrossEvalModelUpdateFreq_Choices, SelectedDefault = LightGBMCARMA_CrossEvalModelUpdateFreq_Selected, Multiple = TRUE, MaxVars = 1L))
                      ),
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(12L, align = 'center', Quantico:::SelectizeInput(InputID = "LightGBMCARMA_CrossEvalValuesUpdateFreq", Label = "Cross-Eval: Values Update Freq", Choices = LightGBMCARMA_CrossEvalValuesUpdateFreq_Choices, SelectedDefault = LightGBMCARMA_CrossEvalValuesUpdateFreq_Selected, Multiple = TRUE, MaxVars = 1L))
                      ),
                      Quantico:::BlankRow(12L),
                      Quantico:::BlankRow(12L)
                    )
                  )
                )
              )
            )
          ), # end TagList
          footer = shiny::tagList(
            shiny::modalButton(label = "Cancel"),
            shiny::actionButton("LightGBMCARMA_OK", "OK", width = '50px'))))
    })
}

# ----

# ----

# @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ ----
# ::  Plotting  ::                                                                                               ----
# @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ ----

#' @title Plots.CorrMatrix.Modal
#'
#' @description Distribution modals. Histogram, Density, River, and Pie Charts, where only Y and GroupVars are needed
#'
#' @author Adrian Antico
#' @family Plotting Modals
#'
#' @param id = 'PlotVariablesModals'
#' @param PlotNumber 1
#' @param AppWidth = 12L
#'
#' @export
Plots.CorrMatrix.Modal <- function(id, PlotNumber, AppWidth=12L) {
  shiny::moduleServer(
    id = id,
    module = function(input, output, session) {
      ns <- session$ns
      shiny::showModal(
        shiny::modalDialog(
          title = 'Plot Inputs',
          size = "l",
          easyClose = FALSE,
          fade = TRUE,
          shiny::tagList(

            # Tabs
            shiny::tabsetPanel(
              id = paste0('Plot_TabPanel_', PlotNumber),
              selected = 'Data Selection',

              # Input Variables
              shiny::tabPanel(
                title = "Data Selection",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shiny::column(
                    12L, align = "center",
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = 'danger', width = AppWidth,
                      Quantico:::BlankRow(12L),
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(
                          12L,
                          shiny::fluidRow(
                            shiny::column(
                              4L, align = 'center',
                              Quantico:::SelectizeInput(InputID = paste0('Plot', PlotNumber, '_SelectData'), Label='Choose data set', Choices = NULL, Multiple = TRUE, MaxVars = 100)
                            )
                          ),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(
                            shiny::column(
                              4L, align = 'center',
                              Quantico:::SliderInput(InputID = paste0('SampleSize', PlotNumber), Label='Display Records (Post-Agg)', Step = 1000, Value = 15000, Min = 0, Max = 30000))
                          )
                        )
                      )
                    )
                  )
                )
              ),

              # Axis Variables
              shiny::tabPanel(
                title = "Axis Variables",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shiny::column(
                    12L, align = "center",
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = 'danger', width = AppWidth,
                      Quantico:::BlankRow(12L),
                      Quantico:::BlankRow(12L),

                      shiny::tags$h3(shiny::tags$b("*Choose Y-Variable to display vertically")),
                      shiny::fluidRow(
                        shiny::column(width = 6L, align = 'center', Quantico:::PickerInput(InputID = paste0('YVar', PlotNumber), Label = 'Y-Variable', Choices = NULL, Multiple = TRUE)),
                        shiny::column(width = 6L, align = 'center', Quantico:::SelectizeInput(InputID = paste0('YVarTrans', PlotNumber), Label = 'Y-Variable Transformation', Choices = c("Identity","BoxCox","YeoJohnson","Asinh","Log","LogPlus1","Sqrt","Asin","Logit"), SelectedDefault = "Identity", Multiple = TRUE, MaxVars = 1, CloseAfterSelect = TRUE))),
                      Quantico::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(width = 6L),
                        shiny::column(width = 6L, align = 'center', Quantico:::SelectizeInput(InputID = paste0('PlotDateAgg', PlotNumber), Label = 'Date Aggregration Level', Choices = c("as-is","second","minute","hour","day","week","month","quarter","year"), SelectedDefault = "as-is", Multiple = TRUE, MaxVars = 1, CloseAfterSelect = TRUE))
                      ))
                  ))),

              # Filter Variables
              shiny::tabPanel(
                title = "Filter Variables",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shiny::column(
                    12L, align = "center",
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = 'danger', width = AppWidth,
                      Quantico:::BlankRow(12L),
                      Quantico:::BlankRow(12L),
                      Quantico:::DataFilters(id = paste0('DataFiltersContents', PlotNumber), PlotNumber = PlotNumber)))
                )),

              # Title, Axes Titles, ShowLabels
              shiny::tabPanel(
                title = "Formatting",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shiny::column(
                    6L, align = "center",
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = 'danger', width = AppWidth,
                      Quantico:::BlankRow(12L),
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(
                          width = 6L, align = 'center',
                          Quantico:::TextInput(InputID = paste0('Title', PlotNumber), Label='Rename Title', Value = NULL)),
                        shiny::column(
                          width = 6L, align = 'center',
                          Quantico:::SelectizeInput(InputID = paste0('ShowLabels', PlotNumber), Label='Show Labels', Choices = c(TRUE,FALSE), Multiple=TRUE, MaxVars = 1, SelectedDefault = FALSE, CloseAfterSelect = TRUE))),
                      Quantico:::BlankRow(AppWidth),
                      shiny::fluidRow(
                        shiny::column(
                          width = 6L, align = 'center',
                          Quantico:::TextInput(InputID = paste0("YAxisTitle", PlotNumber), Label = "Rename Y-Axis Title", Value = NULL))),
                      Quantico:::BlankRow(AppWidth),
                      shiny::fluidRow(
                        shiny::column(
                          width = 6L, align = 'center',
                          Quantico:::TextInput(InputID = paste0("XAxisTitle", PlotNumber), Label = "Rename X-Axis Title", Value = NULL))),
                      Quantico:::BlankRow(AppWidth)
                    )
                  )
                )
              ))),
          footer = shiny::tagList(
            shiny::modalButton(label = "Cancel"),
            shiny::actionButton(paste0("BoxPlotOK", PlotNumber), "OK", width = '50px'))
        )
      )
    })
}

#' @title Plots.ParallelPlot.Modal
#'
#' @description Distribution modals. Histogram, Density, River, and Pie Charts, where only Y and GroupVars are needed
#'
#' @author Adrian Antico
#' @family Plotting Modals
#'
#' @param id = 'PlotVariablesModals'
#' @param PlotNumber 1
#' @param AppWidth = 12L
#'
#' @export
Plots.ParallelPlot.Modal <- function(id, PlotNumber, AppWidth=12L) {
  shiny::moduleServer(
    id = id,
    module = function(input, output, session) {
      ns <- session$ns
      shiny::showModal(
        shiny::modalDialog(
          title = 'Plot Inputs',
          size = "l",
          easyClose = FALSE,
          fade = TRUE,
          shiny::tagList(

            # Tabs
            shiny::tabsetPanel(
              id = paste0('Plot_TabPanel_', PlotNumber),
              selected = 'Data Selection',

              # Input Variables
              shiny::tabPanel(
                title = "Data Selection",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shiny::column(
                    12L, align = "center",
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = 'danger', width = AppWidth,
                      Quantico:::BlankRow(12L),
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(
                          12L,
                          shiny::fluidRow(
                            shiny::column(
                              4L, align = 'center',
                              Quantico:::SelectizeInput(InputID = paste0('Plot', PlotNumber, '_SelectData'), Label='Choose data set', Choices = NULL, Multiple = TRUE, MaxVars = 100)
                            )
                          ),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(
                            shiny::column(
                              4L, align = 'center',
                              Quantico:::SliderInput(InputID = paste0('SampleSize', PlotNumber), Label='Display Records (Post-Agg)', Step = 1000, Value = 5000, Min = 0, Max = 30000))
                          )
                        )
                      )
                    )
                  )
                )
              ),

              # Axis Variables
              shiny::tabPanel(
                title = "Axis Variables",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shiny::column(
                    12L, align = "center",
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = 'danger', width = AppWidth,
                      Quantico:::BlankRow(12L),
                      Quantico:::BlankRow(12L),

                      shiny::tags$h3(shiny::tags$b("*Max 5 Y-Variables will be used")),
                      shiny::fluidRow(
                        shiny::column(width = 6L, align = 'center', Quantico:::PickerInput(InputID = paste0('YVar', PlotNumber), Label = 'Y-Variable', Choices = NULL, Multiple = TRUE))
                      )
                    )
                  )
                )
              ),

              # Filter Variables
              shiny::tabPanel(
                title = "Filter Variables",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shiny::column(
                    12L, align = "center",
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = 'danger', width = AppWidth,
                      Quantico:::BlankRow(12L),
                      Quantico:::BlankRow(12L),
                      Quantico:::DataFilters(id = paste0('DataFiltersContents', PlotNumber), PlotNumber = PlotNumber)))
                )),

              # Title, Axes Titles, ShowLabels
              shiny::tabPanel(
                title = "Formatting",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shiny::column(
                    6L, align = "center",
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = 'danger', width = AppWidth,
                      Quantico:::BlankRow(12L),
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(
                          width = 6L, align = 'center',
                          Quantico:::TextInput(InputID = paste0('Title', PlotNumber), Label='Rename Title', Value = NULL)),
                        shiny::column(
                          width = 6L, align = 'center',
                          Quantico:::SelectizeInput(InputID = paste0('ShowLabels', PlotNumber), Label='Show Labels', Choices = c(TRUE,FALSE), Multiple=TRUE, MaxVars = 1, SelectedDefault = FALSE, CloseAfterSelect = TRUE))),
                      Quantico:::BlankRow(AppWidth),
                      shiny::fluidRow(
                        shiny::column(
                          width = 6L, align = 'center',
                          Quantico:::TextInput(InputID = paste0("YAxisTitle", PlotNumber), Label = "Rename Y-Axis Title", Value = NULL))),
                      Quantico:::BlankRow(AppWidth),
                      shiny::fluidRow(
                        shiny::column(
                          width = 6L, align = 'center',
                          Quantico:::TextInput(InputID = paste0("XAxisTitle", PlotNumber), Label = "Rename X-Axis Title", Value = NULL))),
                      Quantico:::BlankRow(AppWidth)
                    )
                  )
                )
              ))),
          footer = shiny::tagList(
            shiny::modalButton(label = "Cancel"),
            shiny::actionButton(paste0("BoxPlotOK", PlotNumber), "OK", width = '50px'))
        )
      )
    })
}

#' @title Plots.Distribution.Y.NoFacet.Modal
#'
#' @description Pie Chart
#'
#' @author Adrian Antico
#' @family Plotting Modals
#'
#' @param id = 'PlotVariablesModals'
#' @param PlotNumber 1
#' @param AppWidth = 12L
#'
#' @export
Plots.Distribution.Y.NoFacet.Modal <- function(id, PlotNumber, AppWidth=12L) {
  shiny::moduleServer(
    id = id,
    module = function(input, output, session) {
      ns <- session$ns
      shiny::showModal(
        shiny::modalDialog(
          title = 'Plot Inputs',
          size = "l",
          easyClose = FALSE,
          fade = TRUE,
          shiny::tagList(

            # Tabs
            shiny::tabsetPanel(
              id = paste0('Plot_TabPanel_', PlotNumber),
              selected = 'Data Selection',

              # Data Selection
              # Axis Variables
              # Grouping Variables
              # Filtering Variables
              # Formatting

              # Input Variables
              shiny::tabPanel(
                title = "Data Selection",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shiny::column(
                    12L, align = "center",
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = 'danger', width = AppWidth,
                      Quantico:::BlankRow(12L),
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(
                          12L,
                          shiny::fluidRow(
                            shiny::column(
                              4L, align = 'center',
                              Quantico:::SelectizeInput(InputID = paste0('Plot', PlotNumber, '_SelectData'), Label='Choose data set', Choices = NULL, Multiple = TRUE, MaxVars = 100)
                            )
                          ),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(
                            shiny::column(
                              4L, align = 'center',
                              Quantico:::SliderInput(InputID = paste0('SampleSize', PlotNumber), Label='Display Records (Post-Agg)', Step = 1000, Value = 15000, Min = 0, Max = 30000))
                          )
                        ))
                    )))),

              # Axis Variables
              shiny::tabPanel(
                title = "Axis Variables",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shiny::column(
                    12L, align = "center",
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = 'danger', width = AppWidth,
                      Quantico:::BlankRow(12L),
                      Quantico:::BlankRow(12L),

                      shiny::tags$h3(shiny::tags$b("*Choose Y-Variable to display vertically")),
                      shiny::fluidRow(
                        shiny::column(width = 6L, align = 'center', Quantico:::PickerInput(InputID = paste0('YVar', PlotNumber), Label = 'Y-Variable', Choices = NULL, Multiple = TRUE)),
                        shiny::column(width = 6L, align = 'center', Quantico:::SelectizeInput(InputID = paste0('YVarTrans', PlotNumber), Label = 'Y-Variable Transformation', Choices = c("Identity","BoxCox","YeoJohnson","Asinh","Log","LogPlus1","Sqrt","Asin","Logit"), SelectedDefault = "Identity", Multiple = TRUE, MaxVars = 1, CloseAfterSelect = TRUE))),
                      Quantico::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(width = 6L),
                        shiny::column(width = 6L, align = 'center', Quantico:::SelectizeInput(InputID = paste0('PlotDateAgg', PlotNumber), Label = 'Date Aggregration Level', Choices = c("as-is","second","minute","hour","day","week","month","quarter","year"), SelectedDefault = "as-is", Multiple = TRUE, MaxVars = 1, CloseAfterSelect = TRUE))
                      ))
                  ))),

              # Grouping Variables
              shiny::tabPanel(
                title = "Grouping Variables",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shiny::column(
                    6L, align = "center",
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = 'danger', width = AppWidth,
                      Quantico:::BlankRow(12L),
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(
                          width = 6L, align = 'center',
                          Quantico:::PickerInput(InputID = paste0('GroupVars', PlotNumber), Label='Select Group Variables', Choices = NULL, Multiple=TRUE)),
                        shiny::column(
                          width = 6L, align = 'center',
                          Quantico:::SelectizeInput(InputID = paste0('AggMethod', PlotNumber), Label='Aggregation Method', Choices = c('count','mean','mean(abs(x))','log(mean(x))','median','log(median(x))','median(abs(x))','sum','log(sum(x))','sum(abs(x))','sd','log(sd(x))','sd(abs(x))', 'skewness','skewness(abs(x))', 'kurtosis','kurtosis(abs(x))','CoeffVar','CoeffVar(abs(x))'), Multiple=TRUE, MaxVars = 1, CloseAfterSelect = TRUE))),
                      Quantico:::BlankRow(AppWidth),
                      shiny::fluidRow(
                        shiny::column(
                          width = 12L, align = 'center',
                          shiny::conditionalPanel(condition = paste0("length(input['GroupVars", PlotNumber, "']) >= 1"), Quantico:::PickerInput_GetLevels2(InputID = paste0('Levels_', PlotNumber, '_1'), Choices=NULL)))),
                      Quantico:::BlankRow(AppWidth),
                      shiny::fluidRow(
                        shiny::column(
                          width = 12L, align = 'center',
                          shiny::conditionalPanel(condition = paste0("length(input['GroupVars", PlotNumber, "']) >= 2"), Quantico:::PickerInput_GetLevels2(InputID = paste0('Levels_', PlotNumber, '_2'), Choices=NULL)))),
                      Quantico:::BlankRow(AppWidth),
                      shiny::fluidRow(
                        shiny::column(
                          width = 12L, align = 'center',
                          shiny::conditionalPanel(condition = paste0("length(input['GroupVars", PlotNumber, "']) >= 3"), Quantico:::PickerInput_GetLevels2(InputID = paste0('Levels_', PlotNumber, '_3'), Choices=NULL))))
                    ))
                )
              ),

              # Filter Variables
              shiny::tabPanel(
                title = "Filter Variables",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shiny::column(
                    12L, align = "center",
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = 'danger', width = AppWidth,
                      Quantico:::BlankRow(12L),
                      Quantico:::BlankRow(12L),
                      Quantico:::DataFilters(id = paste0('DataFiltersContents', PlotNumber), PlotNumber = PlotNumber)))
                )),

              # Title, Axes Titles, ShowLabels
              shiny::tabPanel(
                title = "Formatting",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shiny::column(
                    6L, align = "center",
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = 'danger', width = AppWidth,
                      Quantico:::BlankRow(12L),
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(
                          width = 6L, align = 'center',
                          Quantico:::TextInput(InputID = paste0('Title', PlotNumber), Label='Rename Title', Value = NULL)),
                        shiny::column(
                          width = 6L, align = 'center',
                          Quantico:::SelectizeInput(InputID = paste0('ShowLabels', PlotNumber), Label='Show Labels', Choices = c(TRUE,FALSE), Multiple=TRUE, MaxVars = 1, SelectedDefault = FALSE, CloseAfterSelect = TRUE))),
                      Quantico:::BlankRow(AppWidth),
                      shiny::fluidRow(
                        shiny::column(
                          width = 6L, align = 'center',
                          Quantico:::TextInput(InputID = paste0("YAxisTitle", PlotNumber), Label = "Rename Y-Axis Title", Value = NULL))),
                      Quantico:::BlankRow(AppWidth),
                      shiny::fluidRow(
                        shiny::column(
                          width = 6L, align = 'center',
                          Quantico:::TextInput(InputID = paste0("XAxisTitle", PlotNumber), Label = "Rename X-Axis Title", Value = NULL))),
                      Quantico:::BlankRow(AppWidth)
                    )
                  )
                )
              ))),

          footer = shiny::tagList(
            shiny::modalButton(label = "Cancel"),
            shiny::actionButton(paste0("BoxPlotOK", PlotNumber), "OK", width = '50px'))
        )
      )
    })
}

#' @title Plots.WordCloud.Modal
#'
#' @description WordCloud
#'
#' @author Adrian Antico
#' @family Plotting Modals
#'
#' @param id = 'PlotVariablesModals'
#' @param PlotNumber 1
#' @param AppWidth = 12L
#'
#' @export
Plots.WordCloud.Modal <- function(id, PlotNumber, AppWidth=12L) {
  shiny::moduleServer(
    id = id,
    module = function(input, output, session) {
      ns <- session$ns
      shiny::showModal(
        shiny::modalDialog(
          title = 'Plot Inputs',
          size = "l",
          easyClose = FALSE,
          fade = TRUE,
          shiny::tagList(

            # Tabs
            shiny::tabsetPanel(
              id = paste0('Plot_TabPanel_', PlotNumber),
              selected = 'Data Selection',

              # Input Variables
              shiny::tabPanel(
                title = "Data Selection",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shiny::column(
                    12L, align = "center",
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = 'danger', width = AppWidth,
                      Quantico:::BlankRow(12L),
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(
                          12L,
                          shiny::fluidRow(
                            shiny::column(
                              4L, align = 'center',
                              Quantico:::SelectizeInput(InputID = paste0('Plot', PlotNumber, '_SelectData'), Label='Choose data set', Choices = NULL, Multiple = TRUE, MaxVars = 100)
                            )
                          ),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(
                            shiny::column(
                              4L, align = 'center',
                              Quantico:::SliderInput(InputID = paste0('SampleSize', PlotNumber), Label='Display Records (Post-Agg)', Step = 1000, Value = 15000, Min = 0, Max = 30000))
                          )
                        ))
                    )))),

              # Axis Variables
              shiny::tabPanel(
                title = "Axis Variables",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shiny::column(
                    12L, align = "center",
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = 'danger', width = AppWidth,
                      Quantico:::BlankRow(12L),
                      Quantico:::BlankRow(12L),

                      shiny::fluidRow(
                        shiny::column(width = 6L, align = 'center', Quantico:::PickerInput(InputID = paste0('YVar', PlotNumber), Label = 'Y-Variable', Choices = NULL, Multiple = TRUE))
                      ),

                      Quantico:::BlankRow(12L),
                      Quantico:::BlankRow(12L)
                    )
                  )
                )
              ),

              # Filter Variables
              shiny::tabPanel(
                title = "Filter Variables",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shiny::column(
                    12L, align = "center",
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = 'danger', width = AppWidth,
                      Quantico:::BlankRow(12L),
                      Quantico:::BlankRow(12L),
                      Quantico:::DataFilters(id = paste0('DataFiltersContents', PlotNumber), PlotNumber = PlotNumber)))
                )
              ),

              # Title, Axes Titles, ShowLabels
              shiny::tabPanel(
                title = "Formatting",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shiny::column(
                    6L, align = "center",
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = 'danger', width = AppWidth,
                      Quantico:::BlankRow(12L),
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(
                          width = 6L, align = 'center',
                          Quantico:::TextInput(InputID = paste0('Title', PlotNumber), Label='Rename Title', Value = NULL)),
                        shiny::column(
                          width = 6L, align = 'center',
                          Quantico:::SelectizeInput(InputID = paste0('ShowLabels', PlotNumber), Label='Show Labels', Choices = c(TRUE,FALSE), Multiple=TRUE, MaxVars = 1, SelectedDefault = FALSE, CloseAfterSelect = TRUE))),
                      Quantico:::BlankRow(AppWidth),
                      shiny::fluidRow(
                        shiny::column(
                          width = 6L, align = 'center',
                          Quantico:::TextInput(InputID = paste0("YAxisTitle", PlotNumber), Label = "Rename Y-Axis Title", Value = NULL))),
                      Quantico:::BlankRow(AppWidth),
                      shiny::fluidRow(
                        shiny::column(
                          width = 6L, align = 'center',
                          Quantico:::TextInput(InputID = paste0("XAxisTitle", PlotNumber), Label = "Rename X-Axis Title", Value = NULL))),
                      Quantico:::BlankRow(AppWidth)
                    )
                  )
                )
              ))),

          footer = shiny::tagList(
            shiny::modalButton(label = "Cancel"),
            shiny::actionButton(paste0("BoxPlotOK", PlotNumber), "OK", width = '50px'))
        )
      )
    })
}

#' @title Plots.ProbabilityPlot.Modal
#'
#' @description ProbabilityPlot
#'
#' @author Adrian Antico
#' @family Plotting Modals
#'
#' @param id = 'PlotVariablesModals'
#' @param PlotNumber 1
#' @param AppWidth = 12L
#'
#' @export
Plots.ProbabilityPlot.Modal <- function(id, PlotNumber, AppWidth=12L) {
  shiny::moduleServer(
    id = id,
    module = function(input, output, session) {
      ns <- session$ns
      shiny::showModal(
        shiny::modalDialog(
          title = 'Plot Inputs',
          size = "l",
          easyClose = FALSE,
          fade = TRUE,
          shiny::tagList(

            # Tabs
            shiny::tabsetPanel(
              id = paste0('Plot_TabPanel_', PlotNumber),
              selected = 'Data Selection',

              # Input Variables
              shiny::tabPanel(
                title = "Data Selection",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shiny::column(
                    12L, align = "center",
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = 'danger', width = AppWidth,
                      Quantico:::BlankRow(12L),
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(
                          12L,
                          shiny::fluidRow(
                            shiny::column(
                              4L, align = 'center',
                              Quantico:::SelectizeInput(InputID = paste0('Plot', PlotNumber, '_SelectData'), Label='Choose data set', Choices = NULL, Multiple = TRUE, MaxVars = 100)
                            )
                          ),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(
                            shiny::column(
                              4L, align = 'center',
                              Quantico:::SliderInput(InputID = paste0('SampleSize', PlotNumber), Label='Display Records (Post-Agg)', Step = 1000, Value = 15000, Min = 0, Max = 30000))
                          )
                        )
                      )
                    )
                  )
                )
              ),

              # Axis Variables
              shiny::tabPanel(
                title = "Axis Variables",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shiny::column(
                    12L, align = "center",
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = 'danger', width = AppWidth,
                      Quantico:::BlankRow(12L),
                      Quantico:::BlankRow(12L),

                      shiny::fluidRow(
                        shiny::column(width = 6L, align = 'center', Quantico:::PickerInput(InputID = paste0('YVar', PlotNumber), Label = 'Y-Variable', Choices = NULL, Multiple = TRUE)),
                        shiny::column(width = 6L, align = 'center', Quantico:::SelectizeInput(InputID = paste0('YVarTrans', PlotNumber), Label = 'Y-Variable Transformation', Choices = c("Identity","BoxCox","YeoJohnson","Asinh","Log","LogPlus1","Sqrt","Asin","Logit"), SelectedDefault = "Identity", Multiple = TRUE, MaxVars = 1, CloseAfterSelect = TRUE))
                      ),

                      Quantico:::BlankRow(12L),
                      Quantico:::BlankRow(12L)
                    )
                  )
                )
              ),

              # Filter Variables
              shiny::tabPanel(
                title = "Filter Variables",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shiny::column(
                    12L, align = "center",
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = 'danger', width = AppWidth,
                      Quantico:::BlankRow(12L),
                      Quantico:::BlankRow(12L),
                      Quantico:::DataFilters(id = paste0('DataFiltersContents', PlotNumber), PlotNumber = PlotNumber)))
                )
              ),

              # Title, Axes Titles, ShowLabels
              shiny::tabPanel(
                title = "Formatting",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shiny::column(
                    6L, align = "center",
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = 'danger', width = AppWidth,
                      Quantico:::BlankRow(12L),
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(
                          width = 6L, align = 'center',
                          Quantico:::TextInput(InputID = paste0('Title', PlotNumber), Label='Rename Title', Value = NULL)),
                        shiny::column(
                          width = 6L, align = 'center',
                          Quantico:::SelectizeInput(InputID = paste0('ShowLabels', PlotNumber), Label='Show Labels', Choices = c(TRUE,FALSE), Multiple=TRUE, MaxVars = 1, SelectedDefault = FALSE, CloseAfterSelect = TRUE))),
                      Quantico:::BlankRow(AppWidth),
                      shiny::fluidRow(
                        shiny::column(
                          width = 6L, align = 'center',
                          Quantico:::TextInput(InputID = paste0("YAxisTitle", PlotNumber), Label = "Rename Y-Axis Title", Value = NULL))),
                      Quantico:::BlankRow(AppWidth),
                      shiny::fluidRow(
                        shiny::column(
                          width = 6L, align = 'center',
                          Quantico:::TextInput(InputID = paste0("XAxisTitle", PlotNumber), Label = "Rename X-Axis Title", Value = NULL))),
                      Quantico:::BlankRow(AppWidth)
                    )
                  )
                )
              ))),

          footer = shiny::tagList(
            shiny::modalButton(label = "Cancel"),
            shiny::actionButton(paste0("BoxPlotOK", PlotNumber), "OK", width = '50px'))
        )
      )
    })
}

#' @title Plots.ACF.Modal
#'
#' @description Autocorrelation
#'
#' @author Adrian Antico
#' @family Plotting Modals
#'
#' @param id = 'PlotVariablesModals'
#' @param PlotNumber 1
#' @param AppWidth = 12L
#'
#' @export
Plots.ACF.Modal <- function(id, PlotNumber, AppWidth=12L) {
  shiny::moduleServer(
    id = id,
    module = function(input, output, session) {
      ns <- session$ns
      shiny::showModal(
        shiny::modalDialog(
          title = 'Plot Inputs',
          size = "l",
          easyClose = FALSE,
          fade = TRUE,
          shiny::tagList(

            # Tabs
            shiny::tabsetPanel(
              id = paste0('Plot_TabPanel_', PlotNumber),
              selected = 'Data Selection',

              # Data Selection
              # Axis Variables
              # Grouping Variables
              # Filtering Variables
              # Formatting

              # Input Variables
              shiny::tabPanel(
                title = "Data Selection",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shiny::column(
                    12L, align = "center",
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = 'danger', width = AppWidth,
                      Quantico:::BlankRow(12L),
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(
                          12L,
                          shiny::fluidRow(
                            shiny::column(
                              4L, align = 'center',
                              Quantico:::SelectizeInput(InputID = paste0('Plot', PlotNumber, '_SelectData'), Label='Choose data set', Choices = NULL, Multiple = TRUE, MaxVars = 100)
                            )
                          ),
                          Quantico:::BlankRow(12L)
                        )
                      )
                    )
                  )
                )
              ),

              # Axis Variables
              shiny::tabPanel(
                title = "Axis Variables",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shiny::column(
                    12L, align = "center",
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = 'danger', width = AppWidth,
                      Quantico:::BlankRow(12L),
                      Quantico:::BlankRow(12L),

                      shiny::tags$h3(shiny::tags$b("*Select inputs")),
                      shiny::fluidRow(
                        shiny::column(width = 6L, align = 'center', Quantico:::PickerInput(InputID = paste0('PlottingDateVar', PlotNumber), Label = 'Date Variable', Choices = NULL, Multiple = TRUE)),
                        shiny::column(width = 6L, align = 'center', Quantico:::NumericInput(InputID = paste0('PlottingMaxLags', PlotNumber), Label = 'Max Lags', Value = 50, Min = 5, Max = 200, Step = 1))
                      ),

                      Quantico::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(width = 6L, align = 'center', Quantico:::PickerInput(InputID = paste0('YVar', PlotNumber), Label = 'Y-Variable', Choices = NULL, Multiple = TRUE)),
                        shiny::column(width = 6L, align = 'center', Quantico:::SelectizeInput(InputID = paste0('YVarTrans', PlotNumber), Label = 'Y-Variable Transformation', Choices = c("Identity","BoxCox","YeoJohnson","Asinh","Log","LogPlus1","Sqrt","Asin","Logit"), SelectedDefault = "Identity", Multiple = TRUE, MaxVars = 1, CloseAfterSelect = TRUE))
                      ),

                      Quantico::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(width = 6L, align = 'center', Quantico:::SelectizeInput(InputID = paste0('PlottingTimeUnit', PlotNumber), Label = 'Time Agg Level', Choices = c("hour", "day", "week", "month", "quarter", "year"), SelectedDefault = 'day', Multiple = TRUE, MaxVars = 1))
                      ),

                      Quantico:::BlankRow(12L),
                      Quantico:::BlankRow(12L)
                    )
                  )
                )
              ),

              # Filter Variables
              shiny::tabPanel(
                title = "Filter Variables",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shiny::column(
                    12L, align = "center",
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = 'danger', width = AppWidth,
                      Quantico:::BlankRow(12L),
                      Quantico:::BlankRow(12L),
                      Quantico:::DataFilters(id = paste0('DataFiltersContents', PlotNumber), PlotNumber = PlotNumber)))
                )
              ),

              # Title, Axes Titles, ShowLabels
              shiny::tabPanel(
                title = "Formatting",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shiny::column(
                    6L, align = "center",
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = 'danger', width = AppWidth,
                      Quantico:::BlankRow(12L),
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(
                          width = 6L, align = 'center',
                          Quantico:::TextInput(InputID = paste0('Title', PlotNumber), Label='Rename Title', Value = NULL)),
                        shiny::column(
                          width = 6L, align = 'center',
                          Quantico:::SelectizeInput(InputID = paste0('ShowLabels', PlotNumber), Label='Show Labels', Choices = c(TRUE,FALSE), Multiple=TRUE, MaxVars = 1, SelectedDefault = FALSE, CloseAfterSelect = TRUE))),
                      Quantico:::BlankRow(AppWidth),
                      shiny::fluidRow(
                        shiny::column(
                          width = 6L, align = 'center',
                          Quantico:::TextInput(InputID = paste0("YAxisTitle", PlotNumber), Label = "Rename Y-Axis Title", Value = NULL))),
                      Quantico:::BlankRow(AppWidth),
                      shiny::fluidRow(
                        shiny::column(
                          width = 6L, align = 'center',
                          Quantico:::TextInput(InputID = paste0("XAxisTitle", PlotNumber), Label = "Rename X-Axis Title", Value = NULL))),
                      Quantico:::BlankRow(AppWidth)
                    )
                  )
                )
              ))),

          footer = shiny::tagList(
            shiny::modalButton(label = "Cancel"),
            shiny::actionButton(paste0("BoxPlotOK", PlotNumber), "OK", width = '50px'))
        )
      )
    })
}

#' @title Plots.Distribution.XY.NoFacet.Modal
#'
#' @description BoxPlot and ViolinPlot for swapping axes
#'
#' @author Adrian Antico
#' @family Plotting Modals
#'
#' @param id = 'PlotVariablesModals'
#' @param PlotNumber 1
#' @param AppWidth = 12L
#'
#' @export
Plots.Distribution.XY.NoFacet.Modal <- function(id, PlotNumber, AppWidth=12L) {
  shiny::moduleServer(
    id = id,
    module = function(input, output, session) {
      ns <- session$ns
      shiny::showModal(
        shiny::modalDialog(
          title = 'Plot Inputs',
          size = "l",
          easyClose = FALSE,
          fade = TRUE,
          shiny::tagList(

            # Tabs
            shiny::tabsetPanel(
              id = paste0('Plot_TabPanel_', PlotNumber),
              selected = 'Data Selection',

              # Input Variables
              shiny::tabPanel(
                title = "Data Selection",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shiny::column(
                    12L, align = "center",
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = 'danger', width = AppWidth,
                      shiny::fluidRow(
                        Quantico:::BlankRow(12L),
                        Quantico:::BlankRow(12L),
                        shiny::column(
                          12L,
                          shiny::fluidRow(
                            shiny::column(
                              4L, align = 'center',
                              Quantico:::SelectizeInput(InputID = paste0('Plot', PlotNumber, '_SelectData'), Label='Choose data set', Choices = NULL, Multiple = TRUE, MaxVars = 100)
                            )
                          ),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(
                            shiny::column(
                              4L, align = 'center',
                              Quantico:::SliderInput(InputID = paste0('SampleSize', PlotNumber), Label='Display Records (Post-Agg)', Step = 1000, Value = 15000, Min = 0, Max = 30000))
                          )
                        )
                      )
                    )
                  )
                )
              ),

              # Axis Variables
              shiny::tabPanel(
                title = "Axis Variables",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shiny::column(
                    12L, align = "center",
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = 'danger', width = AppWidth,
                      Quantico:::BlankRow(12L),
                      Quantico::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(width = 6L, align = 'center', Quantico:::PickerInput(InputID = paste0('XVar', PlotNumber), Label = 'X-Variable', Choices = NULL, Multiple = TRUE)),
                        shiny::column(width = 6L, align = 'center', Quantico:::SelectizeInput(InputID = paste0('XVarTrans', PlotNumber), Label = 'X-Variable Transformation', Choices = c("Identity","BoxCox","YeoJohnson","Asinh","Log","LogPlus1","Sqrt","Asin","Logit"), SelectedDefault = "Identity", Multiple = TRUE, MaxVars = 1, CloseAfterSelect = TRUE))),
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(width = 6L, align = 'center', Quantico:::PickerInput(InputID = paste0('YVar', PlotNumber), Label = 'Y-Variable', Choices = NULL, Multiple = TRUE)),
                        shiny::column(width = 6L, align = 'center', Quantico:::SelectizeInput(InputID = paste0('YVarTrans', PlotNumber), Label = 'Y-Variable Transformation', Choices = c("Identity","BoxCox","YeoJohnson","Asinh","Log","LogPlus1","Sqrt","Asin","Logit"), SelectedDefault = "Identity", Multiple = TRUE, MaxVars = 1, CloseAfterSelect = TRUE))),
                      Quantico::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(width = 6L),
                        shiny::column(width = 6L, align = 'center', Quantico:::SelectizeInput(InputID = paste0('PlotDateAgg', PlotNumber), Label = 'Date Aggregration Level', Choices = c("as-is","second","minute","hour","day","week","month","quarter","year"), SelectedDefault = "as-is", Multiple = TRUE, MaxVars = 1, CloseAfterSelect = TRUE))
                      ))
                  ))),

              # Filter Variables
              shiny::tabPanel(
                title = "Filter Variables",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shiny::column(
                    12L, align = "center",
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = 'danger', width = AppWidth,
                      Quantico:::BlankRow(12L),
                      Quantico:::BlankRow(12L),
                      Quantico:::DataFilters(id = paste0('DataFiltersContents', PlotNumber), PlotNumber = PlotNumber)))
                )),

              # Title, Axes Titles, ShowLabels
              shiny::tabPanel(
                title = "Formatting",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shiny::column(
                    6L, align = "center",
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = 'danger', width = AppWidth,
                      Quantico:::BlankRow(12L),
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(
                          width = 6L, align = 'center',
                          Quantico:::TextInput(InputID = paste0('Title', PlotNumber), Label='Rename Title', Value = NULL)),
                        shiny::column(
                          width = 6L, align = 'center',
                          Quantico:::SelectizeInput(InputID = paste0('ShowLabels', PlotNumber), Label='Show Labels', Choices = c(TRUE,FALSE), Multiple=TRUE, MaxVars = 1, SelectedDefault = FALSE, CloseAfterSelect = TRUE))),
                      Quantico:::BlankRow(AppWidth),
                      shiny::fluidRow(
                        shiny::column(
                          width = 6L, align = 'center',
                          Quantico:::TextInput(InputID = paste0("YAxisTitle", PlotNumber), Label = "Rename Y-Axis Title", Value = NULL))),
                      Quantico:::BlankRow(AppWidth),
                      shiny::fluidRow(
                        shiny::column(
                          width = 6L, align = 'center',
                          Quantico:::TextInput(InputID = paste0("XAxisTitle", PlotNumber), Label = "Rename X-Axis Title", Value = NULL))),
                      Quantico:::BlankRow(AppWidth)
                    )
                  )
                )
              ))),

          footer = shiny::tagList(
            shiny::modalButton(label = "Cancel"),
            shiny::actionButton(paste0("BoxPlotOK", PlotNumber), "OK", width = '50px'))
        )
      )
    })
}

#' @title Plots.Distribution.Modal
#'
#' @description Distribution modals. Histogram, Density, River, and Pie Charts, where only Y and GroupVars are needed
#'
#' @author Adrian Antico
#' @family Plotting Modals
#'
#' @param id = 'PlotVariablesModals'
#' @param PlotNumber 1
#' @param AppWidth = 12L
#'
#' @export
Plots.Distribution.Modal <- function(id, PlotNumber, AppWidth=12L) {
  shiny::moduleServer(
    id = id,
    module = function(input, output, session) {
      ns <- session$ns
      shiny::showModal(
        shiny::modalDialog(
          title = 'Plot Inputs',
          size = "l",
          easyClose = FALSE,
          fade = TRUE,
          shiny::tagList(

            # Tabs
            shiny::tabsetPanel(
              id = paste0('Plot_TabPanel_', PlotNumber),
              selected = 'Data Selection',

              # Data Selection
              # Axis Variables
              # Grouping Variables
              # Filtering Variables
              # Formatting

              # Input Variables
              shiny::tabPanel(
                title = "Data Selection",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shiny::column(
                    12L, align = "center",
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = 'danger', width = AppWidth,
                      Quantico:::BlankRow(12L),
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(
                          12L,
                          shiny::fluidRow(
                            shiny::column(
                              4L, align = 'center',
                              Quantico:::SelectizeInput(InputID = paste0('Plot', PlotNumber, '_SelectData'), Label='Choose data set', Choices = NULL, Multiple = TRUE, MaxVars = 100)
                            )
                          ),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(
                            shiny::column(
                              4L, align = 'center',
                              Quantico:::SliderInput(InputID = paste0('SampleSize', PlotNumber), Label='Display Records (Post-Agg)', Step = 1000, Value = 15000, Min = 0, Max = 30000))
                          )
                        )
                      )
                    )
                  )
                )
              ),

              # Axis Variables
              shiny::tabPanel(
                title = "Axis Variables",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shiny::column(
                    12L, align = "center",
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = 'danger', width = AppWidth,
                      Quantico:::BlankRow(12L),
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(width = 6L, align = 'center', Quantico:::PickerInput(InputID = paste0('YVar', PlotNumber), Label = 'Y-Variable', Choices = NULL, Multiple = TRUE)),
                        shiny::column(width = 6L, align = 'center', Quantico:::SelectizeInput(InputID = paste0('YVarTrans', PlotNumber), Label = 'Y-Variable Transformation', Choices = c("Identity","BoxCox","YeoJohnson","Asinh","Log","LogPlus1","Sqrt","Asin","Logit"), SelectedDefault = "Identity", Multiple = TRUE, MaxVars = 1, CloseAfterSelect = TRUE))),
                      Quantico::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(width = 6L),
                        shiny::column(width = 6L, align = 'center', Quantico:::SelectizeInput(InputID = paste0('PlotDateAgg', PlotNumber), Label = 'Date Aggregration Level', Choices = c("as-is","second","minute","hour","day","week","month","quarter","year"), SelectedDefault = "as-is", Multiple = TRUE, MaxVars = 1, CloseAfterSelect = TRUE))
                      ))
                  ))),

              # Grouping Variables
              shiny::tabPanel(
                title = "Grouping Variables",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shiny::column(
                    6L, align = "center",
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = 'danger', width = AppWidth,
                      Quantico:::BlankRow(12L),
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(
                          width = 6L, align = 'center',
                          Quantico:::PickerInput(InputID = paste0('GroupVars', PlotNumber), Label='Select Group Variables', Choices = NULL, Multiple=TRUE)),
                        shiny::column(
                          width = 6L, align = 'center',
                          Quantico:::SelectizeInput(InputID = paste0('AggMethod', PlotNumber), Label='Aggregation Method', Choices = c('count','mean','mean(abs(x))','log(mean(x))','median','log(median(x))','median(abs(x))','sum','log(sum(x))','sum(abs(x))','sd','log(sd(x))','sd(abs(x))', 'skewness','skewness(abs(x))', 'kurtosis','kurtosis(abs(x))','CoeffVar','CoeffVar(abs(x))'), Multiple=TRUE, MaxVars = 1, CloseAfterSelect = TRUE))),
                      Quantico:::BlankRow(AppWidth),
                      shiny::fluidRow(
                        shiny::column(
                          width = 12L, align = 'center',
                          shiny::conditionalPanel(condition = paste0("length(input['GroupVars", PlotNumber, "']) >= 1"), Quantico:::PickerInput_GetLevels2(InputID = paste0('Levels_', PlotNumber, '_1'), Choices=NULL)))),
                      Quantico:::BlankRow(AppWidth),
                      shiny::fluidRow(
                        shiny::column(
                          width = 12L, align = 'center',
                          shiny::conditionalPanel(condition = paste0("length(input['GroupVars", PlotNumber, "']) >= 2"), Quantico:::PickerInput_GetLevels2(InputID = paste0('Levels_', PlotNumber, '_2'), Choices=NULL)))),
                      Quantico:::BlankRow(AppWidth),
                      shiny::fluidRow(
                        shiny::column(
                          width = 12L, align = 'center',
                          shiny::conditionalPanel(condition = paste0("length(input['GroupVars", PlotNumber, "']) >= 3"), Quantico:::PickerInput_GetLevels2(InputID = paste0('Levels_', PlotNumber, '_3'), Choices=NULL))))
                    )),

                  shiny::column(
                    6L, align = "center",
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = 'danger', width = AppWidth,
                      Quantico:::BlankRow(12L),
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(width = 12L, align = 'center', Quantico:::SliderInput(InputID = paste0('FacetRows', PlotNumber), Label='Max Rows Facet Grid', Step = 1, Value = 1, Min = 1, Max = 12))),
                      Quantico:::BlankRow(AppWidth),
                      Quantico::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(width = 12L, align = 'center', Quantico:::SliderInput(InputID = paste0('FacetCols', PlotNumber), Label='Max Cols Facet Grid', Step = 1, Value = 1, Min = 1, Max = 12))),
                      Quantico:::BlankRow(AppWidth))
                  )
                )
              ),

              # Filter Variables
              shiny::tabPanel(
                title = "Filter Variables",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shiny::column(
                    12L, align = "center",
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = 'danger', width = AppWidth,
                      Quantico:::BlankRow(12L),
                      Quantico:::BlankRow(12L),
                      Quantico:::DataFilters(id = paste0('DataFiltersContents', PlotNumber), PlotNumber = PlotNumber)))
                )),

              # Title, Axes Titles, ShowLabels
              shiny::tabPanel(
                title = "Formatting",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shiny::column(
                    6L, align = "center",
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = 'danger', width = AppWidth,
                      Quantico:::BlankRow(12L),
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(
                          width = 6L, align = 'center',
                          Quantico:::TextInput(InputID = paste0('Title', PlotNumber), Label='Rename Title', Value = NULL)),
                        shiny::column(
                          width = 6L, align = 'center',
                          Quantico:::SelectizeInput(InputID = paste0('ShowLabels', PlotNumber), Label='Show Labels', Choices = c(TRUE,FALSE), Multiple=TRUE, MaxVars = 1, SelectedDefault = FALSE, CloseAfterSelect = TRUE))),
                      Quantico:::BlankRow(AppWidth),
                      shiny::fluidRow(
                        shiny::column(
                          width = 6L, align = 'center',
                          Quantico:::TextInput(InputID = paste0("YAxisTitle", PlotNumber), Label = "Rename Y-Axis Title", Value = NULL))),
                      Quantico:::BlankRow(AppWidth),
                      shiny::fluidRow(
                        shiny::column(
                          width = 6L, align = 'center',
                          Quantico:::TextInput(InputID = paste0("XAxisTitle", PlotNumber), Label = "Rename X-Axis Title", Value = NULL))),
                      Quantico:::BlankRow(AppWidth)
                    )
                  )
                )
              ))),

          footer = shiny::tagList(
            shiny::modalButton(label = "Cancel"),
            shiny::actionButton(paste0("BoxPlotOK", PlotNumber), "OK", width = '50px'))
        )
      )
    })
}

#' @title Plots.AggRel.NoFacet.Modal
#'
#' @description Plot Variables Modals
#'
#' @author Adrian Antico
#' @family Plotting Modals
#'
#' @param id = 'PlotVariablesModals'
#' @param PlotNumber 1
#' @param AppWidth = 12L
#'
#' @export
Plots.AggRel.NoFacet.Modal <- function(id, PlotNumber, AppWidth=12L) {
  shiny::moduleServer(
    id = id,
    module = function(input, output, session) {
      ns <- session$ns
      shiny::showModal(
        shiny::modalDialog(
          title = 'Plot Inputs',
          size = "l",
          easyClose = FALSE,
          fade = TRUE,
          shiny::tagList(

            # Tabs
            shiny::tabsetPanel(
              id = paste0('Plot_TabPanel_', PlotNumber),
              selected = 'Data Selection',

              # Input Variables
              shiny::tabPanel(
                title = "Data Selection",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shiny::column(
                    12L, align = "center",
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = 'danger', width = AppWidth,
                      Quantico:::BlankRow(12L),
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(
                          12L,
                          shiny::fluidRow(
                            shiny::column(
                              4L, align = 'center',
                              Quantico:::SelectizeInput(InputID = paste0('Plot', PlotNumber, '_SelectData'), Label='Choose data set', Choices = NULL, Multiple = TRUE, MaxVars = 100)
                            )
                          ),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(
                            shiny::column(
                              4L, align = 'center',
                              Quantico:::SliderInput(InputID = paste0('SampleSize', PlotNumber), Label='Display Records (Post-Agg)', Step = 1000, Value = 15000, Min = 0, Max = 30000))
                          )
                        )
                      )
                    )
                  )
                )
              ),

              # Axis Variables
              shiny::tabPanel(
                title = "Axis Variables",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shiny::column(
                    12L, align = "center",
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = 'danger', width = AppWidth,
                      Quantico:::BlankRow(12L),
                      Quantico::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(width = 6L, align = 'center', Quantico:::PickerInput(InputID = paste0('XVar', PlotNumber), Label = 'X-Variable', Choices = NULL, Multiple = TRUE)),
                        shiny::column(width = 6L, align = 'center', Quantico:::SelectizeInput(InputID = paste0('XVarTrans', PlotNumber), Label = 'X-Variable Transformation', Choices = c("Identity","Asinh","Log","LogPlus1","Sqrt","Asin","Logit","BoxCox","YeoJohnson"), SelectedDefault = "Identity", Multiple = TRUE, MaxVars = 1, CloseAfterSelect = TRUE))
                      ),
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(width = 6L, align = 'center', Quantico:::PickerInput(InputID = paste0('YVar', PlotNumber), Label = 'Y-Variable', Choices = NULL, Multiple = TRUE)),
                        shiny::column(width = 6L, align = 'center', Quantico:::SelectizeInput(InputID = paste0('YVarTrans', PlotNumber), Label = 'Y-Variable Transformation', Choices = c("Identity","BoxCox","YeoJohnson","Asinh","Log","LogPlus1","Sqrt","Asin","Logit"), SelectedDefault = "Identity", Multiple = TRUE, MaxVars = 1, CloseAfterSelect = TRUE))),
                      Quantico::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(width = 6L),
                        shiny::column(width = 6L, align = 'center', Quantico:::SelectizeInput(InputID = paste0('PlotDateAgg', PlotNumber), Label = 'Date Aggregration Level', Choices = c("as-is","second","minute","hour","day","week","month","quarter","year"), SelectedDefault = "as-is", Multiple = TRUE, MaxVars = 1, CloseAfterSelect = TRUE))
                      )
                    )
                  )
                )
              ),

              # Grouping Variables
              shiny::tabPanel(
                title = "Grouping Variables",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shiny::column(
                    6L, align = "center",
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = 'danger', width = AppWidth,
                      Quantico:::BlankRow(12L),
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(
                          width = 6L, align = 'center',
                          Quantico:::PickerInput(InputID = paste0('GroupVars', PlotNumber), Label='Select Group Variables', Choices = NULL, Multiple=TRUE)),
                        shiny::column(
                          width = 6L, align = 'center',
                          Quantico:::SelectizeInput(InputID = paste0('AggMethod', PlotNumber), Label='Aggregation Method', Choices = c('count','mean','mean(abs(x))','log(mean(x))','median','log(median(x))','median(abs(x))','sum','log(sum(x))','sum(abs(x))','sd','log(sd(x))','sd(abs(x))', 'skewness','skewness(abs(x))', 'kurtosis','kurtosis(abs(x))','CoeffVar','CoeffVar(abs(x))'), Multiple=TRUE, MaxVars = 1, CloseAfterSelect = TRUE))),
                      Quantico:::BlankRow(AppWidth),
                      shiny::fluidRow(
                        shiny::column(
                          width = 12L, align = 'center',
                          shiny::conditionalPanel(condition = paste0("length(input['GroupVars", PlotNumber, "']) >= 1"), Quantico:::PickerInput_GetLevels2(InputID = paste0('Levels_', PlotNumber, '_1'), Choices=NULL)))),
                      Quantico:::BlankRow(AppWidth),
                      shiny::fluidRow(
                        shiny::column(
                          width = 12L, align = 'center',
                          shiny::conditionalPanel(condition = paste0("length(input['GroupVars", PlotNumber, "']) >= 2"), Quantico:::PickerInput_GetLevels2(InputID = paste0('Levels_', PlotNumber, '_2'), Choices=NULL)))),
                      Quantico:::BlankRow(AppWidth),
                      shiny::fluidRow(
                        shiny::column(
                          width = 12L, align = 'center',
                          shiny::conditionalPanel(condition = paste0("length(input['GroupVars", PlotNumber, "']) >= 3"), Quantico:::PickerInput_GetLevels2(InputID = paste0('Levels_', PlotNumber, '_3'), Choices=NULL))))
                    )
                  )
                )
              ),

              # Filter Variables
              shiny::tabPanel(
                title = "Filter Variables",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shiny::column(
                    12L, align = "center",
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = 'danger', width = AppWidth,
                      Quantico:::BlankRow(12L),
                      Quantico:::BlankRow(12L),
                      Quantico:::DataFilters(id = paste0('DataFiltersContents', PlotNumber), PlotNumber = PlotNumber)))
                )),

              # Title, Axes Titles, ShowLabels
              shiny::tabPanel(
                title = "Formatting",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shiny::column(
                    6L, align = "center",
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = 'danger', width = AppWidth,
                      Quantico:::BlankRow(12L),
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(
                          width = 6L, align = 'center',
                          Quantico:::TextInput(InputID = paste0('Title', PlotNumber), Label='Rename Title', Value = NULL)),
                        shiny::column(
                          width = 6L, align = 'center',
                          Quantico:::SelectizeInput(InputID = paste0('ShowLabels', PlotNumber), Label='Show Labels', Choices = c(TRUE,FALSE), Multiple=TRUE, MaxVars = 1, SelectedDefault = FALSE, CloseAfterSelect = TRUE))),
                      Quantico:::BlankRow(AppWidth),
                      shiny::fluidRow(
                        shiny::column(
                          width = 6L, align = 'center',
                          Quantico:::TextInput(InputID = paste0("YAxisTitle", PlotNumber), Label = "Rename Y-Axis Title", Value = NULL))),
                      Quantico:::BlankRow(AppWidth),
                      shiny::fluidRow(
                        shiny::column(
                          width = 6L, align = 'center',
                          Quantico:::TextInput(InputID = paste0("XAxisTitle", PlotNumber), Label = "Rename X-Axis Title", Value = NULL))),
                      Quantico:::BlankRow(AppWidth)
                    )
                  )
                )
              ))),
          footer = shiny::tagList(
            shiny::modalButton(label = "Cancel"),
            shiny::actionButton(paste0("BoxPlotOK", PlotNumber), "OK", width = '50px'))
        )
      )
    })
}

#' @title Plots.Radar.Modal
#'
#' @description Plot Variables Modals
#'
#' @author Adrian Antico
#' @family Plotting Modals
#'
#' @param id = 'PlotVariablesModals'
#' @param PlotNumber 1
#' @param AppWidth = 12L
#'
#' @export
Plots.Radar.Modal <- function(id, PlotNumber, AppWidth=12L) {
  shiny::moduleServer(
    id = id,
    module = function(input, output, session) {
      ns <- session$ns
      shiny::showModal(
        shiny::modalDialog(
          title = 'Plot Inputs',
          size = "l",
          easyClose = FALSE,
          fade = TRUE,
          shiny::tagList(

            # Tabs
            shiny::tabsetPanel(
              id = paste0('Plot_TabPanel_', PlotNumber),
              selected = 'Data Selection',

              # Input Variables
              shiny::tabPanel(
                title = "Data Selection",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shiny::column(
                    12L, align = "center",
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = 'danger', width = AppWidth,
                      Quantico:::BlankRow(12L),
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(
                          12L,
                          shiny::fluidRow(
                            shiny::column(
                              4L, align = 'center',
                              Quantico:::SelectizeInput(InputID = paste0('Plot', PlotNumber, '_SelectData'), Label='Choose data set', Choices = NULL, Multiple = TRUE, MaxVars = 100)
                            )
                          ),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(
                            shiny::column(
                              4L, align = 'center',
                              Quantico:::SliderInput(InputID = paste0('SampleSize', PlotNumber), Label='Display Records (Post-Agg)', Step = 1000, Value = 15000, Min = 0, Max = 30000))
                          )
                        ))
                    )))),

              # Axis Variables
              shiny::tabPanel(
                title = "Axis Variables",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shiny::column(
                    12L, align = "center",
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = 'danger', width = AppWidth,
                      Quantico:::BlankRow(12L),
                      Quantico::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(width = 6L, align = 'center', Quantico:::PickerInput(InputID = paste0('YVar', PlotNumber), Label = 'Y-Variable', Choices = NULL, Multiple = TRUE)),
                        shiny::column(width = 6L, align = 'center', Quantico:::SelectizeInput(InputID = paste0('YVarTrans', PlotNumber), Label = 'Y-Variable Transformation', Choices = c("Identity","BoxCox","YeoJohnson","Asinh","Log","LogPlus1","Sqrt","Asin","Logit"), SelectedDefault = "Identity", Multiple = TRUE, MaxVars = 1, CloseAfterSelect = TRUE)))
                    )
                  )
                )
              ),

              # Grouping Variables
              shiny::tabPanel(
                title = "Grouping Variables",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shiny::column(
                    6L, align = "center",
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = 'danger', width = AppWidth,
                      Quantico:::BlankRow(12L),
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(
                          width = 6L, align = 'center',
                          Quantico:::PickerInput(InputID = paste0('GroupVars', PlotNumber), Label='Select Group Variables', Choices = NULL, Multiple=TRUE)),
                        shiny::column(
                          width = 6L, align = 'center',
                          Quantico:::SelectizeInput(InputID = paste0('AggMethod', PlotNumber), Label='Aggregation Method', Choices = c('count','mean','mean(abs(x))','log(mean(x))','median','log(median(x))','median(abs(x))','sum','log(sum(x))','sum(abs(x))','sd','log(sd(x))','sd(abs(x))', 'skewness','skewness(abs(x))', 'kurtosis','kurtosis(abs(x))','CoeffVar','CoeffVar(abs(x))'), Multiple=TRUE, MaxVars = 1, CloseAfterSelect = TRUE))),
                      Quantico:::BlankRow(AppWidth),
                      shiny::fluidRow(
                        shiny::column(
                          width = 12L, align = 'center',
                          shiny::conditionalPanel(condition = paste0("length(input['GroupVars", PlotNumber, "']) >= 1"), Quantico:::PickerInput_GetLevels2(InputID = paste0('Levels_', PlotNumber, '_1'), Choices=NULL)))),
                      Quantico:::BlankRow(AppWidth),
                      shiny::fluidRow(
                        shiny::column(
                          width = 12L, align = 'center',
                          shiny::conditionalPanel(condition = paste0("length(input['GroupVars", PlotNumber, "']) >= 2"), Quantico:::PickerInput_GetLevels2(InputID = paste0('Levels_', PlotNumber, '_2'), Choices=NULL)))),
                      Quantico:::BlankRow(AppWidth),
                      shiny::fluidRow(
                        shiny::column(
                          width = 12L, align = 'center',
                          shiny::conditionalPanel(condition = paste0("length(input['GroupVars", PlotNumber, "']) >= 3"), Quantico:::PickerInput_GetLevels2(InputID = paste0('Levels_', PlotNumber, '_3'), Choices=NULL))))
                    )
                  )
                )
              ),

              # Filter Variables
              shiny::tabPanel(
                title = "Filter Variables",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shiny::column(
                    12L, align = "center",
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = 'danger', width = AppWidth,
                      Quantico:::BlankRow(12L),
                      Quantico:::BlankRow(12L),
                      Quantico:::DataFilters(id = paste0('DataFiltersContents', PlotNumber), PlotNumber = PlotNumber)))
                )),

              # Title, Axes Titles, ShowLabels
              shiny::tabPanel(
                title = "Formatting",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shiny::column(
                    6L, align = "center",
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = 'danger', width = AppWidth,
                      Quantico:::BlankRow(12L),
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(
                          width = 6L, align = 'center',
                          Quantico:::TextInput(InputID = paste0('Title', PlotNumber), Label='Rename Title', Value = NULL)),
                        shiny::column(
                          width = 6L, align = 'center',
                          Quantico:::SelectizeInput(InputID = paste0('ShowLabels', PlotNumber), Label='Show Labels', Choices = c(TRUE,FALSE), Multiple=TRUE, MaxVars = 1, SelectedDefault = FALSE, CloseAfterSelect = TRUE))),
                      Quantico:::BlankRow(AppWidth),
                      shiny::fluidRow(
                        shiny::column(
                          width = 6L, align = 'center',
                          Quantico:::TextInput(InputID = paste0("YAxisTitle", PlotNumber), Label = "Rename Y-Axis Title", Value = NULL))),
                      Quantico:::BlankRow(AppWidth),
                      shiny::fluidRow(
                        shiny::column(
                          width = 6L, align = 'center',
                          Quantico:::TextInput(InputID = paste0("XAxisTitle", PlotNumber), Label = "Rename X-Axis Title", Value = NULL))),
                      Quantico:::BlankRow(AppWidth)
                    )
                  )
                )
              ))),

          footer = shiny::tagList(
            shiny::modalButton(label = "Cancel"),
            shiny::actionButton(paste0("BoxPlotOK", PlotNumber), "OK", width = '50px'))
        )
      )
    })
}

#' @title Plots.AggRel.Modal
#'
#' @description Plot Variables Modals
#'
#' @author Adrian Antico
#' @family Plotting Modals
#'
#' @param id = 'PlotVariablesModals'
#' @param PlotNumber 1
#' @param AppWidth = 12L
#'
#' @export
Plots.AggRel.Modal <- function(id, PlotNumber, AppWidth=12L) {
  shiny::moduleServer(
    id = id,
    module = function(input, output, session) {
      ns <- session$ns
      shiny::showModal(
        shiny::modalDialog(
          title = 'Plot Inputs',
          size = "l",
          easyClose = FALSE,
          fade = TRUE,
          shiny::tagList(

            # Tabs
            shiny::tabsetPanel(
              id = paste0('Plot_TabPanel_', PlotNumber),
              selected = 'Data Selection',

              # Input Variables
              shiny::tabPanel(
                title = "Data Selection",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shiny::column(
                    12L, align = "center",
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = 'danger', width = AppWidth,
                      Quantico:::BlankRow(12L),
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(
                          12L,
                          shiny::fluidRow(
                            shiny::column(
                              4L, align = 'center',
                              Quantico:::SelectizeInput(InputID = paste0('Plot', PlotNumber, '_SelectData'), Label='Choose data set', Choices = NULL, Multiple = TRUE, MaxVars = 100)
                            )
                          ),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(
                            shiny::column(
                              4L, align = 'center',
                              Quantico:::SliderInput(InputID = paste0('SampleSize', PlotNumber), Label='Display Records (Post-Agg)', Step = 1000, Value = 15000, Min = 0, Max = 30000))
                          )
                        ))
                    )))),

              # Axis Variables
              shiny::tabPanel(
                title = "Axis Variables",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shiny::column(
                    12L, align = "center",
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = 'danger', width = AppWidth,
                      Quantico:::BlankRow(12L),
                      Quantico::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(width = 6L, align = 'center', Quantico:::PickerInput(InputID = paste0('XVar', PlotNumber), Label = 'X-Variable', Choices = NULL, Multiple = TRUE)),
                        shiny::column(width = 6L, align = 'center', Quantico:::SelectizeInput(InputID = paste0('XVarTrans', PlotNumber), Label = 'X-Variable Transformation', Choices = c("Identity","Asinh","Log","LogPlus1","Sqrt","Asin","Logit","BoxCox","YeoJohnson"), SelectedDefault = "Identity", Multiple = TRUE, MaxVars = 1, CloseAfterSelect = TRUE))
                      ),
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(width = 6L, align = 'center', Quantico:::PickerInput(InputID = paste0('YVar', PlotNumber), Label = 'Y-Variable', Choices = NULL, Multiple = TRUE)),
                        shiny::column(width = 6L, align = 'center', Quantico:::SelectizeInput(InputID = paste0('YVarTrans', PlotNumber), Label = 'Y-Variable Transformation', Choices = c("Identity","BoxCox","YeoJohnson","Asinh","Log","LogPlus1","Sqrt","Asin","Logit"), SelectedDefault = "Identity", Multiple = TRUE, MaxVars = 1, CloseAfterSelect = TRUE))),
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(width = 6L, align = 'center', Quantico:::PickerInput(InputID = paste0('DualYVar', PlotNumber), Label = 'Dual Axis Y-Variable', Choices = NULL, Multiple = TRUE)),
                        shiny::column(width = 6L, align = 'center', Quantico:::SelectizeInput(InputID = paste0('DualYVarTrans', PlotNumber), Label = 'Dual Axis Y-Variable Transformation', Choices = c("Identity","BoxCox","YeoJohnson","Asinh","Log","LogPlus1","Sqrt","Asin","Logit"), SelectedDefault = "Identity", Multiple = TRUE, MaxVars = 1, CloseAfterSelect = TRUE))),
                      Quantico::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(width = 6L),
                        shiny::column(width = 6L, align = 'center', Quantico:::SelectizeInput(InputID = paste0('PlotDateAgg', PlotNumber), Label = 'Date Aggregration Level', Choices = c("as-is","second","minute","hour","day","week","month","quarter","year"), SelectedDefault = "as-is", Multiple = TRUE, MaxVars = 1, CloseAfterSelect = TRUE))
                      ))
                  ))),

              # Grouping Variables
              shiny::tabPanel(
                title = "Grouping Variables",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shiny::column(
                    6L, align = "center",
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = 'danger', width = AppWidth,
                      Quantico:::BlankRow(12L),
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(
                          width = 6L, align = 'center',
                          Quantico:::PickerInput(InputID = paste0('GroupVars', PlotNumber), Label='Select Group Variables', Choices = NULL, Multiple=TRUE)),
                        shiny::column(
                          width = 6L, align = 'center',
                          Quantico:::SelectizeInput(InputID = paste0('AggMethod', PlotNumber), Label='Aggregation Method', Choices = c('count','mean','mean(abs(x))','log(mean(x))','median','log(median(x))','median(abs(x))','sum','log(sum(x))','sum(abs(x))','sd','log(sd(x))','sd(abs(x))', 'skewness','skewness(abs(x))', 'kurtosis','kurtosis(abs(x))','CoeffVar','CoeffVar(abs(x))'), Multiple=TRUE, MaxVars = 1, CloseAfterSelect = TRUE))),
                      Quantico:::BlankRow(AppWidth),
                      shiny::fluidRow(
                        shiny::column(
                          width = 12L, align = 'center',
                          shiny::conditionalPanel(condition = paste0("length(input['GroupVars", PlotNumber, "']) >= 1"), Quantico:::PickerInput_GetLevels2(InputID = paste0('Levels_', PlotNumber, '_1'), Choices=NULL)))),
                      Quantico:::BlankRow(AppWidth),
                      shiny::fluidRow(
                        shiny::column(
                          width = 12L, align = 'center',
                          shiny::conditionalPanel(condition = paste0("length(input['GroupVars", PlotNumber, "']) >= 2"), Quantico:::PickerInput_GetLevels2(InputID = paste0('Levels_', PlotNumber, '_2'), Choices=NULL)))),
                      Quantico:::BlankRow(AppWidth),
                      shiny::fluidRow(
                        shiny::column(
                          width = 12L, align = 'center',
                          shiny::conditionalPanel(condition = paste0("length(input['GroupVars", PlotNumber, "']) >= 3"), Quantico:::PickerInput_GetLevels2(InputID = paste0('Levels_', PlotNumber, '_3'), Choices=NULL))))
                    )),

                  shiny::column(
                    6L, align = "center",
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = 'danger', width = AppWidth,
                      Quantico:::BlankRow(12L),
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(width = 12L, align = 'center', Quantico:::SliderInput(InputID = paste0('FacetRows', PlotNumber), Label='Max Rows Facet Grid', Step = 1, Value = 1, Min = 1, Max = 12))),
                      Quantico:::BlankRow(AppWidth),
                      Quantico::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(width = 12L, align = 'center', Quantico:::SliderInput(InputID = paste0('FacetCols', PlotNumber), Label='Max Columns Facet Grid', Step = 1, Value = 1, Min = 1, Max = 12))),
                      Quantico:::BlankRow(AppWidth))
                  )
                )
              ),

              # Filter Variables
              shiny::tabPanel(
                title = "Filter Variables",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shiny::column(
                    12L, align = "center",
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = 'danger', width = AppWidth,
                      Quantico:::BlankRow(12L),
                      Quantico:::BlankRow(12L),
                      Quantico:::DataFilters(id = paste0('DataFiltersContents', PlotNumber), PlotNumber = PlotNumber)))
                )),

              # Title, Axes Titles, ShowLabels
              shiny::tabPanel(
                title = "Formatting",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shiny::column(
                    6L, align = "center",
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = 'danger', width = AppWidth,
                      Quantico:::BlankRow(12L),
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(
                          width = 6L, align = 'center',
                          Quantico:::TextInput(InputID = paste0('Title', PlotNumber), Label='Rename Title', Value = NULL)),
                        shiny::column(
                          width = 6L, align = 'center',
                          Quantico:::SelectizeInput(InputID = paste0('ShowLabels', PlotNumber), Label='Show Labels', Choices = c(TRUE,FALSE), Multiple=TRUE, MaxVars = 1, SelectedDefault = FALSE, CloseAfterSelect = TRUE))),
                      Quantico:::BlankRow(AppWidth),
                      shiny::fluidRow(
                        shiny::column(
                          width = 6L, align = 'center',
                          Quantico:::TextInput(InputID = paste0("YAxisTitle", PlotNumber), Label = "Rename Y-Axis Title", Value = NULL))),
                      Quantico:::BlankRow(AppWidth),
                      shiny::fluidRow(
                        shiny::column(
                          width = 6L, align = 'center',
                          Quantico:::TextInput(InputID = paste0("XAxisTitle", PlotNumber), Label = "Rename X-Axis Title", Value = NULL))),
                      Quantico:::BlankRow(AppWidth)
                    )
                  )
                )
              ))),

          footer = shiny::tagList(
            shiny::modalButton(label = "Cancel"),
            shiny::actionButton(paste0("BoxPlotOK", PlotNumber), "OK", width = '50px'))
        )
      )
    })
}

#' @title Plots.3D.Target.NoGroup.Modal
#'
#' @description Plot Variables Modals
#'
#' @author Adrian Antico
#' @family Plotting Modals
#'
#' @param id = 'PlotVariablesModals'
#' @param PlotNumber 1
#' @param AppWidth = 12L
#'
#' @export
Plots.3D.Target.NoGroup.Modal <- function(id, PlotNumber, AppWidth=12L) {
  shiny::moduleServer(
    id = id,
    module = function(input, output, session) {
      ns <- session$ns
      shiny::showModal(
        shiny::modalDialog(
          title = 'Plot Inputs',
          size = "l",
          easyClose = FALSE,
          fade = TRUE,
          shiny::tagList(

            # Tabs
            shiny::tabsetPanel(
              id = paste0('Plot_TabPanel_', PlotNumber),
              selected = 'Data Selection',

              # Input Variables
              shiny::tabPanel(
                title = "Data Selection",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shiny::column(
                    12L, align = "center",
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = 'danger', width = AppWidth,
                      Quantico:::BlankRow(12L),
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(
                          12L,
                          shiny::fluidRow(
                            shiny::column(
                              4L, align = 'center',
                              Quantico:::SelectizeInput(InputID = paste0('Plot', PlotNumber, '_SelectData'), Label='Choose data set', Choices = NULL, Multiple = TRUE, MaxVars = 100)
                            )
                          ),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(
                            shiny::column(
                              4L, align = 'center',
                              Quantico:::SliderInput(InputID = paste0('SampleSize', PlotNumber), Label='Display Records (Post-Agg)', Step = 1000, Value = 15000, Min = 0, Max = 30000))
                          )
                        )
                      )
                    )
                  )
                )
              ),

              # Axis Variables
              shiny::tabPanel(
                title = "Axis Variables",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shiny::column(
                    12L, align = "center",
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = 'danger', width = AppWidth,
                      Quantico:::BlankRow(12L),
                      Quantico::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(width = 6L, align = 'center', Quantico:::PickerInput(InputID = paste0('XVar', PlotNumber), Label = 'X-Variable', Choices = NULL, Multiple = TRUE)),
                        shiny::column(width = 6L, align = 'center', Quantico:::SelectizeInput(InputID = paste0('XVarTrans', PlotNumber), Label = 'X-Variable Transformation', Choices = c("Identity","Asinh","Log","LogPlus1","Sqrt","Asin","Logit","BoxCox","YeoJohnson"), SelectedDefault = "Identity", Multiple = TRUE, MaxVars = 1, CloseAfterSelect = TRUE))
                      ),
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(width = 6L, align = 'center', Quantico:::PickerInput(InputID = paste0('YVar', PlotNumber), Label = 'Y-Variable', Choices = NULL, Multiple = TRUE)),
                        shiny::column(width = 6L, align = 'center', Quantico:::SelectizeInput(InputID = paste0('YVarTrans', PlotNumber), Label = 'Y-Variable Transformation', Choices = c("Identity","Asinh","Log","LogPlus1","Sqrt","Asin","Logit","BoxCox","YeoJohnson"), SelectedDefault = "Identity", Multiple = TRUE, MaxVars = 1, CloseAfterSelect = TRUE))),
                      Quantico:::BlankRow(AppWidth),
                      shiny::fluidRow(
                        shiny::column(width = 6L, align = 'center', Quantico:::PickerInput(InputID = paste0('ZVar', PlotNumber), Label = 'Z-Variable', Choices = NULL, Multiple = TRUE)),
                        shiny::column(width = 6L, align = 'center', Quantico:::SelectizeInput(InputID = paste0('ZVarTrans', PlotNumber), Label = 'Z-Variable Transformation', Choices = c("Identity","Asinh","Log","LogPlus1","Sqrt","Asin","Logit","BoxCox","YeoJohnson"), SelectedDefault = "Identity", Multiple = TRUE, MaxVars = 1, CloseAfterSelect = TRUE))
                      ),
                      Quantico::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(width = 6L),
                        shiny::column(
                          width = 6L, align = 'center',
                          Quantico:::SelectizeInput(InputID = paste0('PlotDateAgg', PlotNumber), Label = 'Date Aggregration Level', Choices = c("as-is","second","minute","hour","day","week","month","quarter","year"), SelectedDefault = "as-is", Multiple = TRUE, MaxVars = 1, CloseAfterSelect = TRUE))
                      ))
                  ))),

              # Filter Variables
              shiny::tabPanel(
                title = "Filter Variables",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shiny::column(
                    12L, align = "center",
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = 'danger', width = AppWidth,
                      Quantico:::BlankRow(12L),
                      Quantico:::BlankRow(12L),
                      Quantico:::DataFilters(id = paste0('DataFiltersContents', PlotNumber), PlotNumber = PlotNumber)))
                )),

              # Title, Axes Titles, ShowLabels
              shiny::tabPanel(
                title = "Formatting",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shiny::column(
                    6L, align = "center",
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = 'danger', width = AppWidth,
                      Quantico:::BlankRow(12L),
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(
                          width = 6L, align = 'center',
                          Quantico:::TextInput(InputID = paste0('Title', PlotNumber), Label='Rename Title', Value = NULL)),
                        shiny::column(
                          width = 6L, align = 'center',
                          Quantico:::SelectizeInput(InputID = paste0('ShowLabels', PlotNumber), Label='Show Labels', Choices = c(TRUE,FALSE), Multiple=TRUE, MaxVars = 1, SelectedDefault = FALSE, CloseAfterSelect = TRUE))),
                      Quantico:::BlankRow(AppWidth),
                      shiny::fluidRow(
                        shiny::column(
                          width = 6L, align = 'center',
                          Quantico:::TextInput(InputID = paste0("YAxisTitle", PlotNumber), Label = "Rename Y-Axis Title", Value = NULL))),
                      Quantico:::BlankRow(AppWidth),
                      shiny::fluidRow(
                        shiny::column(
                          width = 6L, align = 'center',
                          Quantico:::TextInput(InputID = paste0("XAxisTitle", PlotNumber), Label = "Rename X-Axis Title", Value = NULL))),
                      Quantico:::BlankRow(AppWidth)
                    )
                  )
                )
              ))),

          footer = shiny::tagList(
            shiny::modalButton(label = "Cancel"),
            shiny::actionButton(paste0("BoxPlotOK", PlotNumber), "OK", width = '50px'))
        )
      )
    }
  )
}

#' @title Plots.3D.NoGroup.Modal
#'
#' @description Plot Variables Modals
#'
#' @author Adrian Antico
#' @family Plotting Modals
#'
#' @param id = 'PlotVariablesModals'
#' @param PlotNumber 1
#' @param AppWidth = 12L
#'
#' @export
Plots.3D.NoGroup.Modal <- function(id, PlotNumber, AppWidth=12L) {
  shiny::moduleServer(
    id = id,
    module = function(input, output, session) {
      ns <- session$ns
      shiny::showModal(
        shiny::modalDialog(
          title = 'Plot Inputs',
          size = "l",
          easyClose = FALSE,
          fade = TRUE,
          shiny::tagList(

            # Tabs
            shiny::tabsetPanel(
              id = paste0('Plot_TabPanel_', PlotNumber),
              selected = 'Data Selection',

              # Input Variables
              shiny::tabPanel(
                title = "Data Selection",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shiny::column(
                    12L, align = "center",
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = 'danger', width = AppWidth,
                      Quantico:::BlankRow(12L),
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(
                          12L,
                          shiny::fluidRow(
                            shiny::column(
                              4L, align = 'center',
                              Quantico:::SelectizeInput(InputID = paste0('Plot', PlotNumber, '_SelectData'), Label='Choose data set', Choices = NULL, Multiple = TRUE, MaxVars = 100)
                            )
                          ),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(
                            shiny::column(
                              4L, align = 'center',
                              Quantico:::SliderInput(InputID = paste0('SampleSize', PlotNumber), Label='Display Records (Post-Agg)', Step = 1000, Value = 15000, Min = 0, Max = 30000))
                          )
                        ))
                    )))),

              # Axis Variables
              shiny::tabPanel(
                title = "Axis Variables",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shiny::column(
                    12L, align = "center",
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = 'danger', width = AppWidth,
                      Quantico:::BlankRow(12L),
                      Quantico::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(width = 6L, align = 'center', Quantico:::PickerInput(InputID = paste0('XVar', PlotNumber), Label = 'X-Variable', Choices = NULL, Multiple = TRUE)),
                        shiny::column(width = 6L, align = 'center', Quantico:::SelectizeInput(InputID = paste0('XVarTrans', PlotNumber), Label = 'X-Variable Transformation', Choices = c("Identity","Asinh","Log","LogPlus1","Sqrt","Asin","Logit","BoxCox","YeoJohnson"), SelectedDefault = "Identity", Multiple = TRUE, MaxVars = 1, CloseAfterSelect = TRUE))
                      ),
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(width = 6L, align = 'center', Quantico:::PickerInput(InputID = paste0('YVar', PlotNumber), Label = 'Y-Variable', Choices = NULL, Multiple = TRUE)),
                        shiny::column(width = 6L, align = 'center', Quantico:::SelectizeInput(InputID = paste0('YVarTrans', PlotNumber), Label = 'Y-Variable Transformation', Choices = c("Identity","Asinh","Log","LogPlus1","Sqrt","Asin","Logit","BoxCox","YeoJohnson"), SelectedDefault = "Identity", Multiple = TRUE, MaxVars = 1, CloseAfterSelect = TRUE))),
                      Quantico:::BlankRow(AppWidth),
                      shiny::fluidRow(
                        shiny::column(width = 6L, align = 'center', Quantico:::PickerInput(InputID = paste0('ZVar', PlotNumber), Label = 'Z-Variable', Choices = NULL, Multiple = TRUE)),
                        shiny::column(width = 6L, align = 'center', Quantico:::SelectizeInput(InputID = paste0('ZVarTrans', PlotNumber), Label = 'Z-Variable Transformation', Choices = c("Identity","Asinh","Log","LogPlus1","Sqrt","Asin","Logit","BoxCox","YeoJohnson"), SelectedDefault = "Identity", Multiple = TRUE, MaxVars = 1, CloseAfterSelect = TRUE))
                      ),
                      Quantico::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(width = 6L),
                        shiny::column(width = 6L, align = 'center', Quantico:::SelectizeInput(InputID = paste0('PlotDateAgg', PlotNumber), Label = 'Date Aggregration Level', Choices = c("as-is","second","minute","hour","day","week","month","quarter","year"), SelectedDefault = "as-is", Multiple = TRUE, MaxVars = 1, CloseAfterSelect = TRUE))
                      ))
                  ))),

              # Filter Variables
              shiny::tabPanel(
                title = "Filter Variables",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shiny::column(
                    12L, align = "center",
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = 'danger', width = AppWidth,
                      Quantico:::BlankRow(12L),
                      Quantico:::BlankRow(12L),
                      Quantico:::DataFilters(id = paste0('DataFiltersContents', PlotNumber), PlotNumber = PlotNumber)))
                )),

              # Title, Axes Titles, ShowLabels
              shiny::tabPanel(
                title = "Formatting",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shiny::column(
                    6L, align = "center",
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = 'danger', width = AppWidth,
                      Quantico:::BlankRow(12L),
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(
                          width = 6L, align = 'center',
                          Quantico:::TextInput(InputID = paste0('Title', PlotNumber), Label='Rename Title', Value = NULL)),
                        shiny::column(
                          width = 6L, align = 'center',
                          Quantico:::SelectizeInput(InputID = paste0('ShowLabels', PlotNumber), Label='Show Labels', Choices = c(TRUE,FALSE), Multiple=TRUE, MaxVars = 1, SelectedDefault = FALSE, CloseAfterSelect = TRUE))),
                      Quantico:::BlankRow(AppWidth),
                      shiny::fluidRow(
                        shiny::column(
                          width = 6L, align = 'center',
                          Quantico:::TextInput(InputID = paste0("YAxisTitle", PlotNumber), Label = "Rename Y-Axis Title", Value = NULL))),
                      Quantico:::BlankRow(AppWidth),
                      shiny::fluidRow(
                        shiny::column(
                          width = 6L, align = 'center',
                          Quantico:::TextInput(InputID = paste0("XAxisTitle", PlotNumber), Label = "Rename X-Axis Title", Value = NULL))),
                      Quantico:::BlankRow(AppWidth)
                    )
                  )
                )
              ))),

          footer = shiny::tagList(
            shiny::modalButton(label = "Cancel"),
            shiny::actionButton(paste0("BoxPlotOK", PlotNumber), "OK", width = '50px'))
        )
      )
    }
  )
}

#' @title Plots.3D.Modal
#'
#' @description Plot Variables Modals
#'
#' @author Adrian Antico
#' @family Plotting Modals
#'
#' @param id = 'PlotVariablesModals'
#' @param PlotNumber 1
#' @param AppWidth = 12L
#'
#' @export
Plots.3D.Modal <- function(id, PlotNumber, AppWidth=12L) {
  shiny::moduleServer(
    id = id,
    module = function(input, output, session) {
      ns <- session$ns
      shiny::showModal(
        shiny::modalDialog(
          title = 'Plot Inputs',
          size = "l",
          easyClose = FALSE,
          fade = TRUE,
          shiny::tagList(

            # Tabs
            shiny::tabsetPanel(
              id = paste0('Plot_TabPanel_', PlotNumber),
              selected = 'Data Selection',

              # Input Variables
              shiny::tabPanel(
                title = "Data Selection",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shiny::column(
                    12L, align = "center",
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = 'danger', width = AppWidth,
                      Quantico:::BlankRow(12L),
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(
                          12L,
                          shiny::fluidRow(
                            shiny::column(
                              4L, align = 'center',
                              Quantico:::SelectizeInput(InputID = paste0('Plot', PlotNumber, '_SelectData'), Label='Choose data set', Choices = NULL, Multiple = TRUE, MaxVars = 100)
                            )
                          ),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(
                            shiny::column(
                              4L, align = 'center',
                              Quantico:::SliderInput(InputID = paste0('SampleSize', PlotNumber), Label='Display Records (Post-Agg)', Step = 1000, Value = 15000, Min = 0, Max = 30000))
                          )
                        ))
                    )))),

              # Axis Variables
              shiny::tabPanel(
                title = "Axis Variables",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shiny::column(
                    12L, align = "center",
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = 'danger', width = AppWidth,
                      Quantico:::BlankRow(12L),
                      Quantico::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(width = 6L, align = 'center', Quantico:::PickerInput(InputID = paste0('XVar', PlotNumber), Label = 'X-Variable', Choices = NULL, Multiple = TRUE)),
                        shiny::column(width = 6L, align = 'center', Quantico:::SelectizeInput(InputID = paste0('XVarTrans', PlotNumber), Label = 'X-Variable Transformation', Choices = c("Identity","Asinh","Log","LogPlus1","Sqrt","Asin","Logit","BoxCox","YeoJohnson"), SelectedDefault = "Identity", Multiple = TRUE, MaxVars = 1, CloseAfterSelect = TRUE))
                      ),
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(width = 6L, align = 'center', Quantico:::PickerInput(InputID = paste0('YVar', PlotNumber), Label = 'Y-Variable', Choices = NULL, Multiple = TRUE)),
                        shiny::column(width = 6L, align = 'center', Quantico:::SelectizeInput(InputID = paste0('YVarTrans', PlotNumber), Label = 'Y-Variable Transformation', Choices = c("Identity","Asinh","Log","LogPlus1","Sqrt","Asin","Logit","BoxCox","YeoJohnson"), SelectedDefault = "Identity", Multiple = TRUE, MaxVars = 1, CloseAfterSelect = TRUE))),
                      Quantico:::BlankRow(AppWidth),
                      shiny::fluidRow(
                        shiny::column(width = 6L, align = 'center', Quantico:::PickerInput(InputID = paste0('ZVar', PlotNumber), Label = 'Z-Variable', Choices = NULL, Multiple = TRUE)),
                        shiny::column(width = 6L, align = 'center', Quantico:::SelectizeInput(InputID = paste0('ZVarTrans', PlotNumber), Label = 'Z-Variable Transformation', Choices = c("Identity","Asinh","Log","LogPlus1","Sqrt","Asin","Logit","BoxCox","YeoJohnson"), SelectedDefault = "Identity", Multiple = TRUE, MaxVars = 1, CloseAfterSelect = TRUE))
                      ),
                      Quantico::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(width = 6L),
                        shiny::column(width = 6L, align = 'center', Quantico:::SelectizeInput(InputID = paste0('PlotDateAgg', PlotNumber), Label = 'Date Aggregration Level', Choices = c("as-is","second","minute","hour","day","week","month","quarter","year"), SelectedDefault = "as-is", Multiple = TRUE, MaxVars = 1, CloseAfterSelect = TRUE))
                      ))
                  ))),

              # Grouping Variables
              shiny::tabPanel(
                title = "Grouping Variables",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shiny::column(
                    6L, align = "center",
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = 'danger', width = AppWidth,
                      Quantico:::BlankRow(12L),
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(
                          width = 6L, align = 'center',
                          Quantico:::PickerInput(InputID = paste0('GroupVars', PlotNumber), Label='Select Group Variables', Choices = NULL, Multiple=TRUE)),
                        shiny::column(
                          width = 6L, align = 'center',
                          Quantico:::SelectizeInput(InputID = paste0('AggMethod', PlotNumber), Label='Aggregation Method', Choices = c('count','mean','mean(abs(x))','log(mean(x))','median','log(median(x))','median(abs(x))','sum','log(sum(x))','sum(abs(x))','sd','log(sd(x))','sd(abs(x))', 'skewness','skewness(abs(x))', 'kurtosis','kurtosis(abs(x))','CoeffVar','CoeffVar(abs(x))'), Multiple=TRUE, MaxVars = 1, CloseAfterSelect = TRUE))),
                      Quantico:::BlankRow(AppWidth),
                      shiny::fluidRow(
                        shiny::column(
                          width = 12L, align = 'center',
                          shiny::conditionalPanel(condition = paste0("length(input['GroupVars", PlotNumber, "']) >= 1"), Quantico:::PickerInput_GetLevels2(InputID = paste0('Levels_', PlotNumber, '_1'), Choices=NULL)))),
                      Quantico:::BlankRow(AppWidth),
                      shiny::fluidRow(
                        shiny::column(
                          width = 12L, align = 'center',
                          shiny::conditionalPanel(condition = paste0("length(input['GroupVars", PlotNumber, "']) >= 2"), Quantico:::PickerInput_GetLevels2(InputID = paste0('Levels_', PlotNumber, '_2'), Choices=NULL)))),
                      Quantico:::BlankRow(AppWidth),
                      shiny::fluidRow(
                        shiny::column(
                          width = 12L, align = 'center',
                          shiny::conditionalPanel(condition = paste0("length(input['GroupVars", PlotNumber, "']) >= 3"), Quantico:::PickerInput_GetLevels2(InputID = paste0('Levels_', PlotNumber, '_3'), Choices=NULL))))
                    )),

                  shiny::column(
                    6L, align = "center",
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = 'danger', width = AppWidth,
                      Quantico:::BlankRow(12L),
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(width = 12L, align = 'center', Quantico:::SliderInput(InputID = paste0('FacetRows', PlotNumber), Label='Max Rows Facet Grid', Step = 1, Value = 1, Min = 1, Max = 12))),
                      Quantico:::BlankRow(AppWidth),
                      shiny::fluidRow(
                        shiny::column(width = 12L, align = 'center', Quantico:::SliderInput(InputID = paste0('FacetCols', PlotNumber), Label='Max Columns Facet Grid', Step = 1, Value = 1, Min = 1, Max = 12))),
                      Quantico:::BlankRow(AppWidth))
                  )
                )
              ),

              # Filter Variables
              shiny::tabPanel(
                title = "Filter Variables",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shiny::column(
                    12L, align = "center",
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = 'danger', width = AppWidth,
                      Quantico:::BlankRow(12L),
                      Quantico:::BlankRow(12L),
                      Quantico:::DataFilters(id = paste0('DataFiltersContents', PlotNumber), PlotNumber = PlotNumber)))
                )),

              # Title, Axes Titles, ShowLabels
              shiny::tabPanel(
                title = "Formatting",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shiny::column(
                    6L, align = "center",
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = 'danger', width = AppWidth,
                      Quantico:::BlankRow(12L),
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(
                          width = 6L, align = 'center',
                          Quantico:::TextInput(InputID = paste0('Title', PlotNumber), Label='Rename Title', Value = NULL)),
                        shiny::column(
                          width = 6L, align = 'center',
                          Quantico:::SelectizeInput(InputID = paste0('ShowLabels', PlotNumber), Label='Show Labels', Choices = c(TRUE,FALSE), Multiple=TRUE, MaxVars = 1, SelectedDefault = FALSE, CloseAfterSelect = TRUE))),
                      Quantico:::BlankRow(AppWidth),
                      shiny::fluidRow(
                        shiny::column(
                          width = 6L, align = 'center',
                          Quantico:::TextInput(InputID = paste0("YAxisTitle", PlotNumber), Label = "Rename Y-Axis Title", Value = NULL))),
                      Quantico:::BlankRow(AppWidth),
                      shiny::fluidRow(
                        shiny::column(
                          width = 6L, align = 'center',
                          Quantico:::TextInput(InputID = paste0("XAxisTitle", PlotNumber), Label = "Rename X-Axis Title", Value = NULL))),
                      Quantico:::BlankRow(AppWidth)
                    )
                  )
                )
              ))),

          footer = shiny::tagList(
            shiny::modalButton(label = "Cancel"),
            shiny::actionButton(paste0("BoxPlotOK", PlotNumber), "OK", width = '50px'))
        )
      )
    }
  )
}

#' @title Plots.3D.Modal.NoFacet
#'
#' @description Plot Variables Modals
#'
#' @author Adrian Antico
#' @family Plotting Modals
#'
#' @param id = 'PlotVariablesModals'
#' @param PlotNumber 1
#' @param AppWidth = 12L
#'
#' @export
Plots.3D.Modal.NoFacet <- function(id, PlotNumber, AppWidth=12L) {
  shiny::moduleServer(
    id = id,
    module = function(input, output, session) {
      ns <- session$ns
      shiny::showModal(
        shiny::modalDialog(
          title = 'Plot Inputs',
          size = "l",
          easyClose = FALSE,
          fade = TRUE,
          shiny::tagList(

            # Tabs
            shiny::tabsetPanel(
              id = paste0('Plot_TabPanel_', PlotNumber),
              selected = 'Data Selection',

              # Input Variables
              shiny::tabPanel(
                title = "Data Selection",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shiny::column(
                    12L, align = "center",
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = 'danger', width = AppWidth,
                      Quantico:::BlankRow(12L),
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(
                          12L,
                          shiny::fluidRow(
                            shiny::column(
                              4L, align = 'center',
                              Quantico:::SelectizeInput(InputID = paste0('Plot', PlotNumber, '_SelectData'), Label='Choose data set', Choices = NULL, Multiple = TRUE, MaxVars = 100)
                            )
                          ),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(
                            shiny::column(
                              4L, align = 'center',
                              Quantico:::SliderInput(InputID = paste0('SampleSize', PlotNumber), Label='Display Records (Post-Agg)', Step = 1000, Value = 15000, Min = 0, Max = 30000))
                          )
                        ))
                    )))),

              # Axis Variables
              shiny::tabPanel(
                title = "Axis Variables",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shiny::column(
                    12L, align = "center",
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = 'danger', width = AppWidth,
                      Quantico:::BlankRow(12L),
                      Quantico::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(width = 6L, align = 'center', Quantico:::PickerInput(InputID = paste0('XVar', PlotNumber), Label = 'X-Variable', Choices = NULL, Multiple = TRUE)),
                        shiny::column(width = 6L, align = 'center', Quantico:::SelectizeInput(InputID = paste0('XVarTrans', PlotNumber), Label = 'X-Variable Transformation', Choices = c("Identity","Asinh","Log","LogPlus1","Sqrt","Asin","Logit","BoxCox","YeoJohnson"), SelectedDefault = "Identity", Multiple = TRUE, MaxVars = 1, CloseAfterSelect = TRUE))
                      ),
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(width = 6L, align = 'center', Quantico:::PickerInput(InputID = paste0('YVar', PlotNumber), Label = 'Y-Variable', Choices = NULL, Multiple = TRUE)),
                        shiny::column(width = 6L, align = 'center', Quantico:::SelectizeInput(InputID = paste0('YVarTrans', PlotNumber), Label = 'Y-Variable Transformation', Choices = c("Identity","Asinh","Log","LogPlus1","Sqrt","Asin","Logit","BoxCox","YeoJohnson"), SelectedDefault = "Identity", Multiple = TRUE, MaxVars = 1, CloseAfterSelect = TRUE))),
                      Quantico:::BlankRow(AppWidth),
                      shiny::fluidRow(
                        shiny::column(width = 6L, align = 'center', Quantico:::PickerInput(InputID = paste0('ZVar', PlotNumber), Label = 'Z-Variable', Choices = NULL, Multiple = TRUE)),
                        shiny::column(width = 6L, align = 'center', Quantico:::SelectizeInput(InputID = paste0('ZVarTrans', PlotNumber), Label = 'Z-Variable Transformation', Choices = c("Identity","Asinh","Log","LogPlus1","Sqrt","Asin","Logit","BoxCox","YeoJohnson"), SelectedDefault = "Identity", Multiple = TRUE, MaxVars = 1, CloseAfterSelect = TRUE))
                      ),
                      Quantico::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(width = 6L),
                        shiny::column(width = 6L, align = 'center', Quantico:::SelectizeInput(InputID = paste0('PlotDateAgg', PlotNumber), Label = 'Date Aggregration Level', Choices = c("as-is","second","minute","hour","day","week","month","quarter","year"), SelectedDefault = "as-is", Multiple = TRUE, MaxVars = 1, CloseAfterSelect = TRUE))
                      ))
                  ))),

              # Grouping Variables
              shiny::tabPanel(
                title = "Grouping Variables",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shiny::column(
                    6L, align = "center",
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = 'danger', width = AppWidth,
                      Quantico:::BlankRow(12L),
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(
                          width = 6L, align = 'center',
                          Quantico:::PickerInput(InputID = paste0('GroupVars', PlotNumber), Label='Select Group Variables', Choices = NULL, Multiple=TRUE)),
                        shiny::column(
                          width = 6L, align = 'center',
                          Quantico:::SelectizeInput(InputID = paste0('AggMethod', PlotNumber), Label='Aggregation Method', Choices = c('count','mean','mean(abs(x))','log(mean(x))','median','log(median(x))','median(abs(x))','sum','log(sum(x))','sum(abs(x))','sd','log(sd(x))','sd(abs(x))', 'skewness','skewness(abs(x))', 'kurtosis','kurtosis(abs(x))','CoeffVar','CoeffVar(abs(x))'), Multiple=TRUE, MaxVars = 1, CloseAfterSelect = TRUE))),
                      Quantico:::BlankRow(AppWidth),
                      shiny::fluidRow(
                        shiny::column(
                          width = 12L, align = 'center',
                          shiny::conditionalPanel(condition = paste0("length(input['GroupVars", PlotNumber, "']) >= 1"), Quantico:::PickerInput_GetLevels2(InputID = paste0('Levels_', PlotNumber, '_1'), Choices=NULL)))),
                      Quantico:::BlankRow(AppWidth),
                      shiny::fluidRow(
                        shiny::column(
                          width = 12L, align = 'center',
                          shiny::conditionalPanel(condition = paste0("length(input['GroupVars", PlotNumber, "']) >= 2"), Quantico:::PickerInput_GetLevels2(InputID = paste0('Levels_', PlotNumber, '_2'), Choices=NULL)))),
                      Quantico:::BlankRow(AppWidth),
                      shiny::fluidRow(
                        shiny::column(
                          width = 12L, align = 'center',
                          shiny::conditionalPanel(condition = paste0("length(input['GroupVars", PlotNumber, "']) >= 3"), Quantico:::PickerInput_GetLevels2(InputID = paste0('Levels_', PlotNumber, '_3'), Choices=NULL))))
                    )
                  )
                )
              ),

              # Filter Variables
              shiny::tabPanel(
                title = "Filter Variables",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shiny::column(
                    12L, align = "center",
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = 'danger', width = AppWidth,
                      Quantico:::BlankRow(12L),
                      Quantico:::BlankRow(12L),
                      Quantico:::DataFilters(id = paste0('DataFiltersContents', PlotNumber), PlotNumber = PlotNumber)))
                )),

              # Title, Axes Titles, ShowLabels
              shiny::tabPanel(
                title = "Formatting",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shiny::column(
                    6L, align = "center",
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = 'danger', width = AppWidth,
                      Quantico:::BlankRow(12L),
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(
                          width = 6L, align = 'center',
                          Quantico:::TextInput(InputID = paste0('Title', PlotNumber), Label='Rename Title', Value = NULL)),
                        shiny::column(
                          width = 6L, align = 'center',
                          Quantico:::SelectizeInput(InputID = paste0('ShowLabels', PlotNumber), Label='Show Labels', Choices = c(TRUE,FALSE), Multiple=TRUE, MaxVars = 1, SelectedDefault = FALSE, CloseAfterSelect = TRUE))),
                      Quantico:::BlankRow(AppWidth),
                      shiny::fluidRow(
                        shiny::column(
                          width = 6L, align = 'center',
                          Quantico:::TextInput(InputID = paste0("YAxisTitle", PlotNumber), Label = "Rename Y-Axis Title", Value = NULL))),
                      Quantico:::BlankRow(AppWidth),
                      shiny::fluidRow(
                        shiny::column(
                          width = 6L, align = 'center',
                          Quantico:::TextInput(InputID = paste0("XAxisTitle", PlotNumber), Label = "Rename X-Axis Title", Value = NULL))),
                      Quantico:::BlankRow(AppWidth)
                    )
                  )
                )
              ))),

          footer = shiny::tagList(
            shiny::modalButton(label = "Cancel"),
            shiny::actionButton(paste0("BoxPlotOK", PlotNumber), "OK", width = '50px'))
        )
      )
    }
  )
}

#' @title Plots.Eval.XYZ.NoGroup.Modal
#'
#' @description Plot Variables Modals
#'
#' @author Adrian Antico
#' @family Plotting Modals
#'
#' @param id = 'PlotVariablesModals'
#' @param PlotNumber 1
#' @param AppWidth = 12L
#'
#' @export
Plots.Eval.XYZ.NoGroup.Modal <- function(id, PlotNumber, AppWidth=12L) {
  shiny::moduleServer(
    id = id,
    module = function(input, output, session) {
      ns <- session$ns
      shiny::showModal(
        shiny::modalDialog(
          title = 'Plot Inputs',
          size = "l",
          easyClose = FALSE,
          fade = TRUE,
          shiny::tagList(

            # Tabs
            shiny::tabsetPanel(
              id = paste0('Plot_TabPanel_', PlotNumber),
              selected = 'Data Selection',

              # Input Variables
              shiny::tabPanel(
                title = "Data Selection",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shiny::column(
                    12L, align = "center",
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = 'danger', width = AppWidth,
                      Quantico:::BlankRow(12L),
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(
                          12L,
                          shiny::fluidRow(
                            shiny::column(
                              4L, align = 'center',
                              Quantico:::SelectizeInput(InputID = paste0('Plot', PlotNumber, '_SelectData'), Label='Choose data set', Choices = NULL, Multiple = TRUE, MaxVars = 100)
                            )
                          ),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(
                            shiny::column(
                              4L, align = 'center',
                              Quantico:::SliderInput(InputID = paste0('SampleSize', PlotNumber), Label='Display Records (Post-Agg)', Step = 1000, Value = 15000, Min = 0, Max = 30000))
                          )
                        )
                      )
                    )
                  )
                )
              ),

              # Axis Variables
              shiny::tabPanel(
                title = "Axis Variables",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shiny::column(
                    12L, align = "center",
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = 'danger', width = AppWidth,
                      Quantico:::BlankRow(12L),
                      Quantico:::BlankRow(AppWidth),
                      shiny::fluidRow(
                        shiny::column(width = 6L, align = 'center', Quantico:::PickerInput(InputID = paste0('XVar', PlotNumber), Label = 'X-Variable', Choices = NULL, Multiple = TRUE, MaxVars = 2L)),
                        shiny::column(width = 6L, align = 'center', Quantico:::SelectizeInput(InputID = paste0('XVarTrans', PlotNumber), Label = 'Y-Variable Transformation', Choices = c("Identity","Asinh","Log","LogPlus1","Sqrt","Asin","Logit","BoxCox","YeoJohnson"), Multiple = TRUE, MaxVars = 1, CloseAfterSelect = TRUE))
                      ),
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(width = 6L, align = 'center', Quantico:::PickerInput(InputID = paste0('YVar', PlotNumber), Label = 'Y-Variable', Choices = NULL, Multiple = TRUE)),
                        shiny::column(width = 6L, align = 'center', Quantico:::SelectizeInput(InputID = paste0('YVarTrans', PlotNumber), Label = 'Y-Variable Transformation', Choices = c("Identity","Asinh","Log","LogPlus1","Sqrt","Asin","Logit","BoxCox","YeoJohnson"), Multiple = TRUE, MaxVars = 1, CloseAfterSelect = TRUE))
                      ),
                      Quantico:::BlankRow(AppWidth),
                      shiny::fluidRow(
                        shiny::column(width = 6L, align = 'center', Quantico:::PickerInput(InputID = paste0('ZVar', PlotNumber), Label = 'Z-Variable', Choices = NULL, Multiple = TRUE)),
                        shiny::column(width = 6L, align = 'center', Quantico:::SelectizeInput(InputID = paste0('ZVarTrans', PlotNumber), Label = 'Z-Variable Transformation', Choices = c("Identity","Asinh","Log","LogPlus1","Sqrt","Asin","Logit","BoxCox","YeoJohnson"), Multiple = TRUE, MaxVars = 1, CloseAfterSelect = TRUE))
                      ),
                      Quantico:::BlankRow(AppWidth),
                      shiny::fluidRow(
                        shiny::column(width = 6L),
                        shiny::column(
                          width = 6L, align = 'center',
                          Quantico:::SelectizeInput(InputID = paste0('PlotDateAgg', PlotNumber), Label = 'Date Aggregration Level', Choices = c("as-is","second","minute","hour","day","week","month","quarter","year"), SelectedDefault = "as-is", Multiple = TRUE, MaxVars = 1, CloseAfterSelect = TRUE)
                        )
                      )
                    )
                  )
                )
              ),

              # Filter Variables
              shiny::tabPanel(
                title = "Filter Variables",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shiny::column(
                    12L, align = "center",
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = 'danger', width = AppWidth,
                      Quantico:::BlankRow(12L),
                      Quantico:::BlankRow(12L),
                      Quantico:::DataFilters(id = paste0('DataFiltersContents', PlotNumber), PlotNumber = PlotNumber)))
                )),

              # Title, Axes Titles, ShowLabels
              shiny::tabPanel(
                title = "Formatting",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shiny::column(
                    6L, align = "center",
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = 'danger', width = AppWidth,
                      Quantico:::BlankRow(12L),
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(
                          width = 6L, align = 'center',
                          Quantico:::TextInput(InputID = paste0('Title', PlotNumber), Label='Rename Title', Value = NULL)),
                        shiny::column(
                          width = 6L, align = 'center',
                          Quantico:::SelectizeInput(InputID = paste0('ShowLabels', PlotNumber), Label='Show Labels', Choices = c(TRUE,FALSE), Multiple=TRUE, MaxVars = 1, SelectedDefault = FALSE, CloseAfterSelect = TRUE))),
                      Quantico:::BlankRow(AppWidth),
                      shiny::fluidRow(
                        shiny::column(
                          width = 6L, align = 'center',
                          Quantico:::TextInput(InputID = paste0("YAxisTitle", PlotNumber), Label = "Rename Y-Axis Title", Value = NULL))),
                      Quantico:::BlankRow(AppWidth),
                      shiny::fluidRow(
                        shiny::column(
                          width = 6L, align = 'center',
                          Quantico:::TextInput(InputID = paste0("XAxisTitle", PlotNumber), Label = "Rename X-Axis Title", Value = NULL))),
                      Quantico:::BlankRow(AppWidth)
                    )
                  )
                )
              ))),

          footer = shiny::tagList(
            shiny::modalButton(label = "Cancel"),
            shiny::actionButton(paste0("BoxPlotOK", PlotNumber), "OK", width = '50px'))
        )
      )
    }
  )
}

#' @title Plots.Eval.ZY.Modal
#'
#' @description Plot Variables Modals
#'
#' @author Adrian Antico
#' @family Plotting Modals
#'
#' @param id = 'PlotVariablesModals'
#' @param PlotNumber 1
#' @param AppWidth = 12L
#'
#' @export
Plots.Eval.ZY.NoFacet.Modal <- function(id, PlotNumber, AppWidth=12L) {
  shiny::moduleServer(
    id = id,
    module = function(input, output, session) {
      ns <- session$ns
      shiny::showModal(
        shiny::modalDialog(
          title = 'Plot Inputs',
          size = "l",
          easyClose = FALSE,
          fade = TRUE,
          shiny::tagList(

            # Tabs
            shiny::tabsetPanel(
              id = paste0('Plot_TabPanel_', PlotNumber),
              selected = 'Data Selection',

              # Input Variables
              shiny::tabPanel(
                title = "Data Selection",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shiny::column(
                    12L, align = "center",
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = 'danger', width = AppWidth,
                      Quantico:::BlankRow(12L),
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(
                          12L,
                          shiny::fluidRow(
                            shiny::column(
                              4L, align = 'center',
                              Quantico:::SelectizeInput(InputID = paste0('Plot', PlotNumber, '_SelectData'), Label='Choose data set', Choices = NULL, Multiple = TRUE, MaxVars = 100)
                            )
                          ),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(
                            shiny::column(
                              4L, align = 'center',
                              Quantico:::SliderInput(InputID = paste0('SampleSize', PlotNumber), Label='Display Records (Post-Agg)', Step = 1000, Value = 15000, Min = 0, Max = 30000))
                          )
                        )
                      )
                    )
                  )
                )
              ),

              # Axis Variables
              shiny::tabPanel(
                title = "Axis Variables",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shiny::column(
                    12L, align = "center",
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = 'danger', width = AppWidth,
                      Quantico:::BlankRow(12L),
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(width = 6L, align = 'center', Quantico:::PickerInput(InputID = paste0('YVar', PlotNumber), Label = 'Y-Variable', Choices = NULL, Multiple = TRUE)),
                        shiny::column(width = 6L, align = 'center', Quantico:::SelectizeInput(InputID = paste0('YVarTrans', PlotNumber), Label = 'Y-Variable Transformation', Choices = c("Identity","Asinh","Log","LogPlus1","Sqrt","Asin","Logit","BoxCox","YeoJohnson"), Multiple = TRUE, MaxVars = 1, CloseAfterSelect = TRUE))),
                      Quantico:::BlankRow(AppWidth),
                      shiny::fluidRow(
                        shiny::column(width = 6L, align = 'center', Quantico:::PickerInput(InputID = paste0('ZVar', PlotNumber), Label = 'Z-Variable', Choices = NULL, Multiple = TRUE)),
                        shiny::column(width = 6L, align = 'center', Quantico:::SelectizeInput(InputID = paste0('ZVarTrans', PlotNumber), Label = 'Z-Variable Transformation', Choices = c("Identity","Asinh","Log","LogPlus1","Sqrt","Asin","Logit","BoxCox","YeoJohnson"), Multiple = TRUE, MaxVars = 1, CloseAfterSelect = TRUE))
                      ),
                      Quantico:::BlankRow(AppWidth),
                      shiny::fluidRow(
                        shiny::column(width = 6L),
                        shiny::column(
                          width = 6L, align = 'center',
                          Quantico:::SelectizeInput(InputID = paste0('PlotDateAgg', PlotNumber), Label = 'Date Aggregration Level', Choices = c("as-is","second","minute","hour","day","week","month","quarter","year"), SelectedDefault = "as-is", Multiple = TRUE, MaxVars = 1, CloseAfterSelect = TRUE)
                        )
                      )
                    )
                  )
                )
              ),

              # Filter Variables
              shiny::tabPanel(
                title = "Filter Variables",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shiny::column(
                    12L, align = "center",
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = 'danger', width = AppWidth,
                      Quantico:::BlankRow(12L),
                      Quantico:::BlankRow(12L),
                      Quantico:::DataFilters(id = paste0('DataFiltersContents', PlotNumber), PlotNumber = PlotNumber)))
                )),

              # Title, Axes Titles, ShowLabels
              shiny::tabPanel(
                title = "Formatting",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shiny::column(
                    6L, align = "center",
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = 'danger', width = AppWidth,
                      Quantico:::BlankRow(12L),
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(
                          width = 6L, align = 'center',
                          Quantico:::TextInput(InputID = paste0('Title', PlotNumber), Label='Rename Title', Value = NULL)),
                        shiny::column(
                          width = 6L, align = 'center',
                          Quantico:::SelectizeInput(InputID = paste0('ShowLabels', PlotNumber), Label='Show Labels', Choices = c(TRUE,FALSE), Multiple=TRUE, MaxVars = 1, SelectedDefault = FALSE, CloseAfterSelect = TRUE))),
                      Quantico:::BlankRow(AppWidth),
                      shiny::fluidRow(
                        shiny::column(
                          width = 6L, align = 'center',
                          Quantico:::TextInput(InputID = paste0("YAxisTitle", PlotNumber), Label = "Rename Y-Axis Title", Value = NULL))),
                      Quantico:::BlankRow(AppWidth),
                      shiny::fluidRow(
                        shiny::column(
                          width = 6L, align = 'center',
                          Quantico:::TextInput(InputID = paste0("XAxisTitle", PlotNumber), Label = "Rename X-Axis Title", Value = NULL))),
                      Quantico:::BlankRow(AppWidth)
                    )
                  )
                )
              ))),

          footer = shiny::tagList(
            shiny::modalButton(label = "Cancel"),
            shiny::actionButton(paste0("BoxPlotOK", PlotNumber), "OK", width = '50px'))
        )
      )
    }
  )
}

#' @title Plots.Eval.ZY.Modal
#'
#' @description Plot Variables Modals
#'
#' @author Adrian Antico
#' @family Plotting Modals
#'
#' @param id = 'PlotVariablesModals'
#' @param PlotNumber 1
#' @param AppWidth = 12L
#'
#' @export
Plots.Eval.ZY.Modal <- function(id, PlotNumber, AppWidth=12L) {
  shiny::moduleServer(
    id = id,
    module = function(input, output, session) {
      ns <- session$ns
      shiny::showModal(
        shiny::modalDialog(
          title = 'Plot Inputs',
          size = "l",
          easyClose = FALSE,
          fade = TRUE,
          shiny::tagList(

            # Tabs
            shiny::tabsetPanel(
              id = paste0('Plot_TabPanel_', PlotNumber),
              selected = 'Data Selection',

              # Input Variables
              shiny::tabPanel(
                title = "Data Selection",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shiny::column(
                    12L, align = "center",
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = 'danger', width = AppWidth,
                      Quantico:::BlankRow(12L),
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(
                          12L,
                          shiny::fluidRow(
                            shiny::column(
                              4L, align = 'center',
                              Quantico:::SelectizeInput(InputID = paste0('Plot', PlotNumber, '_SelectData'), Label='Choose data set', Choices = NULL, Multiple = TRUE, MaxVars = 100)
                            )
                          ),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(
                            shiny::column(
                              4L, align = 'center',
                              Quantico:::SliderInput(InputID = paste0('SampleSize', PlotNumber), Label='Display Records (Post-Agg)', Step = 1000, Value = 15000, Min = 0, Max = 30000))
                          )
                        )
                      )
                    )
                  )
                )
              ),

              # Axis Variables
              shiny::tabPanel(
                title = "Axis Variables",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shiny::column(
                    12L, align = "center",
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = 'danger', width = AppWidth,
                      Quantico:::BlankRow(12L),
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(width = 6L, align = 'center', Quantico:::PickerInput(InputID = paste0('YVar', PlotNumber), Label = 'Y-Variable', Choices = NULL, Multiple = TRUE)),
                        shiny::column(width = 6L, align = 'center', Quantico:::SelectizeInput(InputID = paste0('YVarTrans', PlotNumber), Label = 'Y-Variable Transformation', Choices = c("Identity","Asinh","Log","LogPlus1","Sqrt","Asin","Logit","BoxCox","YeoJohnson"), Multiple = TRUE, MaxVars = 1, CloseAfterSelect = TRUE))),
                      Quantico:::BlankRow(AppWidth),
                      shiny::fluidRow(
                        shiny::column(width = 6L, align = 'center', Quantico:::PickerInput(InputID = paste0('ZVar', PlotNumber), Label = 'Z-Variable', Choices = NULL, Multiple = TRUE)),
                        shiny::column(width = 6L, align = 'center', Quantico:::SelectizeInput(InputID = paste0('ZVarTrans', PlotNumber), Label = 'Z-Variable Transformation', Choices = c("Identity","Asinh","Log","LogPlus1","Sqrt","Asin","Logit","BoxCox","YeoJohnson"), Multiple = TRUE, MaxVars = 1, CloseAfterSelect = TRUE))
                      ),
                      Quantico:::BlankRow(AppWidth),
                      shiny::fluidRow(
                        shiny::column(width = 6L),
                        shiny::column(
                          width = 6L, align = 'center',
                          Quantico:::SelectizeInput(InputID = paste0('PlotDateAgg', PlotNumber), Label = 'Date Aggregration Level', Choices = c("as-is","second","minute","hour","day","week","month","quarter","year"), SelectedDefault = "as-is", Multiple = TRUE, MaxVars = 1, CloseAfterSelect = TRUE)
                        )
                      )
                    )
                  )
                )
              ),

              # Grouping Variables
              shiny::tabPanel(
                title = "Grouping Variables",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shiny::column(
                    6L, align = "center",
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = 'danger', width = AppWidth,
                      Quantico:::BlankRow(12L),
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(
                          width = 6L, align = 'center',
                          Quantico:::PickerInput(InputID = paste0('GroupVars', PlotNumber), Label='Select Group Variables', Choices = NULL, Multiple=TRUE)),
                        shiny::column(
                          width = 6L, align = 'center',
                          Quantico:::SelectizeInput(InputID = paste0('AggMethod', PlotNumber), Label='Aggregation Method', Choices = c('count','mean','mean(abs(x))','log(mean(x))','median','log(median(x))','median(abs(x))','sum','log(sum(x))','sum(abs(x))','sd','log(sd(x))','sd(abs(x))', 'skewness','skewness(abs(x))', 'kurtosis','kurtosis(abs(x))','CoeffVar','CoeffVar(abs(x))'), Multiple=TRUE, MaxVars = 100, CloseAfterSelect = TRUE))),
                      Quantico:::BlankRow(AppWidth),
                      shiny::fluidRow(
                        shiny::column(
                          width = 12L, align = 'center',
                          shiny::conditionalPanel(condition = paste0("length(input['GroupVars", PlotNumber, "']) >= 1"), Quantico:::PickerInput_GetLevels2(InputID = paste0('Levels_', PlotNumber, '_1'), Choices=NULL)))),
                      Quantico:::BlankRow(AppWidth),
                      shiny::fluidRow(
                        shiny::column(
                          width = 12L, align = 'center',
                          shiny::conditionalPanel(condition = paste0("length(input['GroupVars", PlotNumber, "']) >= 2"), Quantico:::PickerInput_GetLevels2(InputID = paste0('Levels_', PlotNumber, '_2'), Choices=NULL)))),
                      Quantico:::BlankRow(AppWidth),
                      shiny::fluidRow(
                        shiny::column(
                          width = 12L, align = 'center',
                          shiny::conditionalPanel(condition = paste0("length(input['GroupVars", PlotNumber, "']) >= 3"), Quantico:::PickerInput_GetLevels2(InputID = paste0('Levels_', PlotNumber, '_3'), Choices=NULL))))
                    )),

                  shiny::column(
                    6L, align = "center",
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = 'danger', width = AppWidth,
                      Quantico:::BlankRow(12L),
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(width = 12L, align = 'center', Quantico:::SliderInput(InputID = paste0('FacetRows', PlotNumber), Label='Max Rows Facet Grid', Step = 1, Value = 1, Min = 1, Max = 12))),
                      Quantico:::BlankRow(AppWidth),
                      Quantico::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(width = 12L, align = 'center', Quantico:::SliderInput(InputID = paste0('FacetCols', PlotNumber), Label='Max Columns Facet Grid', Step = 1, Value = 1, Min = 1, Max = 12))),
                      Quantico:::BlankRow(AppWidth))
                  )
                )
              ),

              # Filter Variables
              shiny::tabPanel(
                title = "Filter Variables",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shiny::column(
                    12L, align = "center",
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = 'danger', width = AppWidth,
                      Quantico:::BlankRow(12L),
                      Quantico:::BlankRow(12L),
                      Quantico:::DataFilters(id = paste0('DataFiltersContents', PlotNumber), PlotNumber = PlotNumber)))
                )),

              # Title, Axes Titles, ShowLabels
              shiny::tabPanel(
                title = "Formatting",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shiny::column(
                    6L, align = "center",
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = 'danger', width = AppWidth,
                      Quantico:::BlankRow(12L),
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(
                          width = 6L, align = 'center',
                          Quantico:::TextInput(InputID = paste0('Title', PlotNumber), Label='Rename Title', Value = NULL)),
                        shiny::column(
                          width = 6L, align = 'center',
                          Quantico:::SelectizeInput(InputID = paste0('ShowLabels', PlotNumber), Label='Show Labels', Choices = c(TRUE,FALSE), Multiple=TRUE, MaxVars = 1, SelectedDefault = FALSE, CloseAfterSelect = TRUE))),
                      Quantico:::BlankRow(AppWidth),
                      shiny::fluidRow(
                        shiny::column(
                          width = 6L, align = 'center',
                          Quantico:::TextInput(InputID = paste0("YAxisTitle", PlotNumber), Label = "Rename Y-Axis Title", Value = NULL))),
                      Quantico:::BlankRow(AppWidth),
                      shiny::fluidRow(
                        shiny::column(
                          width = 6L, align = 'center',
                          Quantico:::TextInput(InputID = paste0("XAxisTitle", PlotNumber), Label = "Rename X-Axis Title", Value = NULL))),
                      Quantico:::BlankRow(AppWidth)
                    )
                  )
                )
              ))),

          footer = shiny::tagList(
            shiny::modalButton(label = "Cancel"),
            shiny::actionButton(paste0("BoxPlotOK", PlotNumber), "OK", width = '50px'))
        )
      )
    }
  )
}

#' @title Plots.Eval.XY.Modal
#'
#' @description Plot Variables Modals
#'
#' @author Adrian Antico
#' @family Plotting Modals
#'
#' @param id = 'PlotVariablesModals'
#' @param PlotNumber 1
#' @param AppWidth = 12L
#'
#' @export
Plots.Eval.XY.Modal <- function(id, PlotNumber, AppWidth=12L) {
  shiny::moduleServer(
    id = id,
    module = function(input, output, session) {
      ns <- session$ns
      shiny::showModal(
        shiny::modalDialog(
          title = 'Plot Inputs',
          size = "l",
          easyClose = FALSE,
          fade = TRUE,
          shiny::tagList(

            # Tabs
            shiny::tabsetPanel(
              id = paste0('Plot_TabPanel_', PlotNumber),
              selected = 'Data Selection',

              # Input Variables
              shiny::tabPanel(
                title = "Data Selection",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shiny::column(
                    12L, align = "center",
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = 'danger', width = AppWidth,
                      Quantico:::BlankRow(12L),
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(
                          12L,
                          shiny::fluidRow(
                            shiny::column(
                              4L, align = 'center',
                              Quantico:::SelectizeInput(InputID = paste0('Plot', PlotNumber, '_SelectData'), Label='Choose data set', Choices = NULL, Multiple = TRUE, MaxVars = 100)
                            )
                          ),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(
                            shiny::column(
                              4L, align = 'center',
                              Quantico:::SliderInput(InputID = paste0('SampleSize', PlotNumber), Label='Display Records (Post-Agg)', Step = 1000, Value = 15000, Min = 0, Max = 30000))
                          )
                        )
                      )
                    )
                  )
                )
              ),

              # Axis Variables
              shiny::tabPanel(
                title = "Axis Variables",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shiny::column(
                    12L, align = "center",
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = 'danger', width = AppWidth,
                      Quantico:::BlankRow(12L),
                      Quantico:::BlankRow(AppWidth),
                      shiny::fluidRow(
                        shiny::column(width = 6L, align = 'center', Quantico:::PickerInput(InputID = paste0('XVar', PlotNumber), Label = 'X-Variable', Choices = NULL, Multiple = TRUE)),
                        shiny::column(width = 6L, align = 'center', Quantico:::SelectizeInput(InputID = paste0('XVarTrans', PlotNumber), Label = 'X-Variable Transformation', Choices = c("Identity","Asinh","Log","LogPlus1","Sqrt","Asin","Logit","BoxCox","YeoJohnson"), Multiple = TRUE, MaxVars = 1, CloseAfterSelect = TRUE))
                      ),
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(width = 6L, align = 'center', Quantico:::PickerInput(InputID = paste0('YVar', PlotNumber), Label = 'Y-Variable', Choices = NULL, Multiple = TRUE)),
                        shiny::column(width = 6L, align = 'center', Quantico:::SelectizeInput(InputID = paste0('YVarTrans', PlotNumber), Label = 'Y-Variable Transformation', Choices = c("Identity","Asinh","Log","LogPlus1","Sqrt","Asin","Logit","BoxCox","YeoJohnson"), Multiple = TRUE, MaxVars = 1, CloseAfterSelect = TRUE))),
                      Quantico:::BlankRow(AppWidth),
                      shiny::fluidRow(
                        shiny::column(width = 6L),
                        shiny::column(
                          width = 6L, align = 'center',
                          Quantico:::SelectizeInput(InputID = paste0('PlotDateAgg', PlotNumber), Label = 'Date Aggregration Level', Choices = c("as-is","second","minute","hour","day","week","month","quarter","year"), SelectedDefault = "as-is", Multiple = TRUE, MaxVars = 1, CloseAfterSelect = TRUE)
                        )
                      )
                    )
                  )
                )
              ),

              # Grouping Variables
              shiny::tabPanel(
                title = "Grouping Variables",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shiny::column(
                    6L, align = "center",
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = 'danger', width = AppWidth,
                      Quantico:::BlankRow(12L),
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(
                          width = 6L, align = 'center',
                          Quantico:::PickerInput(InputID = paste0('GroupVars', PlotNumber), Label='Select Group Variables', Choices = NULL, Multiple=TRUE)),
                        shiny::column(
                          width = 6L, align = 'center',
                          Quantico:::SelectizeInput(InputID = paste0('AggMethod', PlotNumber), Label='Aggregation Method', Choices = c('count','mean','mean(abs(x))','log(mean(x))','median','log(median(x))','median(abs(x))','sum','log(sum(x))','sum(abs(x))','sd','log(sd(x))','sd(abs(x))', 'skewness','skewness(abs(x))', 'kurtosis','kurtosis(abs(x))','CoeffVar','CoeffVar(abs(x))'), Multiple=TRUE, MaxVars = 100, CloseAfterSelect = TRUE))),
                      Quantico:::BlankRow(AppWidth),
                      shiny::fluidRow(
                        shiny::column(
                          width = 12L, align = 'center',
                          shiny::conditionalPanel(condition = paste0("length(input['GroupVars", PlotNumber, "']) >= 1"), Quantico:::PickerInput_GetLevels2(InputID = paste0('Levels_', PlotNumber, '_1'), Choices=NULL)))),
                      Quantico:::BlankRow(AppWidth),
                      shiny::fluidRow(
                        shiny::column(
                          width = 12L, align = 'center',
                          shiny::conditionalPanel(condition = paste0("length(input['GroupVars", PlotNumber, "']) >= 2"), Quantico:::PickerInput_GetLevels2(InputID = paste0('Levels_', PlotNumber, '_2'), Choices=NULL)))),
                      Quantico:::BlankRow(AppWidth),
                      shiny::fluidRow(
                        shiny::column(
                          width = 12L, align = 'center',
                          shiny::conditionalPanel(condition = paste0("length(input['GroupVars", PlotNumber, "']) >= 3"), Quantico:::PickerInput_GetLevels2(InputID = paste0('Levels_', PlotNumber, '_3'), Choices=NULL))))
                    )),

                  shiny::column(
                    6L, align = "center",
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = 'danger', width = AppWidth,
                      Quantico:::BlankRow(12L),
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(width = 12L, align = 'center', Quantico:::SliderInput(InputID = paste0('FacetRows', PlotNumber), Label='Max Rows Facet Grid', Step = 1, Value = 1, Min = 1, Max = 12))),
                      Quantico:::BlankRow(AppWidth),
                      Quantico::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(width = 12L, align = 'center', Quantico:::SliderInput(InputID = paste0('FacetCols', PlotNumber), Label='Max Columns Facet Grid', Step = 1, Value = 1, Min = 1, Max = 12))),
                      Quantico:::BlankRow(AppWidth))
                  )
                )
              ),

              # Filter Variables
              shiny::tabPanel(
                title = "Filter Variables",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shiny::column(
                    12L, align = "center",
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = 'danger', width = AppWidth,
                      Quantico:::BlankRow(12L),
                      Quantico:::BlankRow(12L),
                      Quantico:::DataFilters(id = paste0('DataFiltersContents', PlotNumber), PlotNumber = PlotNumber)))
                )),

              # Title, Axes Titles, ShowLabels
              shiny::tabPanel(
                title = "Formatting",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shiny::column(
                    6L, align = "center",
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = 'danger', width = AppWidth,
                      Quantico:::BlankRow(12L),
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(
                          width = 6L, align = 'center',
                          Quantico:::TextInput(InputID = paste0('Title', PlotNumber), Label='Rename Title', Value = NULL)),
                        shiny::column(
                          width = 6L, align = 'center',
                          Quantico:::SelectizeInput(InputID = paste0('ShowLabels', PlotNumber), Label='Show Labels', Choices = c(TRUE,FALSE), Multiple=TRUE, MaxVars = 1, SelectedDefault = FALSE, CloseAfterSelect = TRUE))),
                      Quantico:::BlankRow(AppWidth),
                      shiny::fluidRow(
                        shiny::column(
                          width = 6L, align = 'center',
                          Quantico:::TextInput(InputID = paste0("YAxisTitle", PlotNumber), Label = "Rename Y-Axis Title", Value = NULL))),
                      Quantico:::BlankRow(AppWidth),
                      shiny::fluidRow(
                        shiny::column(
                          width = 6L, align = 'center',
                          Quantico:::TextInput(InputID = paste0("XAxisTitle", PlotNumber), Label = "Rename X-Axis Title", Value = NULL))),
                      Quantico:::BlankRow(AppWidth)
                    )
                  )
                )
              ))),

          footer = shiny::tagList(
            shiny::modalButton(label = "Cancel"),
            shiny::actionButton(paste0("BoxPlotOK", PlotNumber), "OK", width = '50px'))
        )
      )
    }
  )
}

#' @title Plots.Eval.VarImp.Modal
#'
#' @description Plot Variables Modals
#'
#' @author Adrian Antico
#' @family Plotting Modals
#'
#' @param id = 'PlotVariablesModals'
#' @param PlotNumber 1
#' @param AppWidth = 12L
#'
#' @export
Plots.Eval.VarImp.Modal <- function(id, PlotNumber, AppWidth=12L) {
  shiny::moduleServer(
    id = id,
    module = function(input, output, session) {
      ns <- session$ns
      shiny::showModal(
        shiny::modalDialog(
          title = 'Plot Inputs',
          size = "l",
          easyClose = FALSE,
          fade = TRUE,
          shiny::tagList(

            # Tabs
            shiny::tabsetPanel(
              id = paste0('Plot_TabPanel_', PlotNumber),
              selected = 'Data Selection',

              # Input Variables
              shiny::tabPanel(
                title = "Data Selection",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shiny::column(
                    12L, align = "center",
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = 'danger', width = AppWidth,
                      Quantico:::BlankRow(12L),
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(
                          12L,
                          shiny::fluidRow(
                            shiny::column(
                              4L, align = 'center',
                              Quantico:::SelectizeInput(InputID = paste0('Plot', PlotNumber, '_SelectData'), Label='Choose data set', Choices = NULL, Multiple = TRUE, MaxVars = 100)
                            )
                          ),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(
                            shiny::column(
                              4L, align = 'center',
                              Quantico:::SliderInput(InputID = paste0('SampleSize', PlotNumber), Label='Display Records (Post-Agg)', Step = 1000, Value = 15000, Min = 0, Max = 30000))
                          )
                        )
                      )
                    )
                  )
                )
              ),

              # Axis Variables
              shiny::tabPanel(
                title = "Axis Variables",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shiny::column(
                    12L, align = "center",
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = 'danger', width = AppWidth,
                      Quantico:::BlankRow(12L),
                      Quantico::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(width = 6L, align = 'center', Quantico:::PickerInput(InputID = paste0('XVar', PlotNumber), Label = 'X-Variable', Choices = NULL, Multiple = TRUE)),
                        shiny::column(width = 6L, align = 'center', Quantico:::SelectizeInput(InputID = paste0('XVarTrans', PlotNumber), Label = 'X-Variable Transformation', Choices = c("Identity","Asinh","Log","LogPlus1","Sqrt","Asin","Logit","BoxCox","YeoJohnson"), Multiple = TRUE, MaxVars = 1, CloseAfterSelect = TRUE))
                      ),
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(width = 6L, align = 'center', Quantico:::PickerInput(InputID = paste0('YVar', PlotNumber), Label = 'Y-Variable', Choices = NULL, Multiple = TRUE)),
                        shiny::column(width = 6L, align = 'center', Quantico:::SelectizeInput(InputID = paste0('YVarTrans', PlotNumber), Label = 'Y-Variable Transformation', Choices = c("Identity","Asinh","Log","LogPlus1","Sqrt","Asin","Logit","BoxCox","YeoJohnson"), Multiple = TRUE, MaxVars = 1, CloseAfterSelect = TRUE))
                      )
                    )
                  )
                )
              ),

              # Title, Axes Titles, ShowLabels
              shiny::tabPanel(
                title = "Formatting",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shiny::column(
                    6L, align = "center",
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = 'danger', width = AppWidth,
                      Quantico:::BlankRow(12L),
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(
                          width = 6L, align = 'center',
                          Quantico:::TextInput(InputID = paste0('Title', PlotNumber), Label='Rename Title', Value = NULL)),
                        shiny::column(
                          width = 6L, align = 'center',
                          Quantico:::SelectizeInput(InputID = paste0('ShowLabels', PlotNumber), Label='Show Labels', Choices = c(TRUE,FALSE), Multiple=TRUE, MaxVars = 1, SelectedDefault = FALSE, CloseAfterSelect = TRUE))),
                      Quantico:::BlankRow(AppWidth),
                      shiny::fluidRow(
                        shiny::column(
                          width = 6L, align = 'center',
                          Quantico:::TextInput(InputID = paste0("YAxisTitle", PlotNumber), Label = "Rename Y-Axis Title", Value = NULL))),
                      Quantico:::BlankRow(AppWidth),
                      shiny::fluidRow(
                        shiny::column(
                          width = 6L, align = 'center',
                          Quantico:::TextInput(InputID = paste0("XAxisTitle", PlotNumber), Label = "Rename X-Axis Title", Value = NULL))),
                      Quantico:::BlankRow(AppWidth)
                    )
                  )
                )
              ))),

          footer = shiny::tagList(
            shiny::modalButton(label = "Cancel"),
            shiny::actionButton(paste0("BoxPlotOK", PlotNumber), "OK", width = '50px'))
        )
      )
    }
  )
}

#' @title Plots.Eval.ShapImp.Modal
#'
#' @description Plot Variables Modals
#'
#' @author Adrian Antico
#' @family Plotting Modals
#'
#' @param id = 'PlotVariablesModals'
#' @param PlotNumber 1
#' @param AppWidth = 12L
#'
#' @export
Plots.Eval.ShapImp.Modal <- function(id, PlotNumber, AppWidth=12L) {
  shiny::moduleServer(
    id = id,
    module = function(input, output, session) {
      ns <- session$ns
      shiny::showModal(
        shiny::modalDialog(
          title = 'Plot Inputs',
          size = "l",
          easyClose = FALSE,
          fade = TRUE,
          shiny::tagList(

            # Tabs
            shiny::tabsetPanel(
              id = paste0('Plot_TabPanel_', PlotNumber),
              selected = 'Data Selection',

              # Input Variables
              shiny::tabPanel(
                title = "Data Selection",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shiny::column(
                    12L, align = "center",
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = 'danger', width = AppWidth,
                      Quantico:::BlankRow(12L),
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(
                          12L,
                          shiny::fluidRow(
                            shiny::column(
                              4L, align = 'center',
                              Quantico:::SelectizeInput(InputID = paste0('Plot', PlotNumber, '_SelectData'), Label='Choose data set', Choices = NULL, Multiple = TRUE, MaxVars = 100)
                            )
                          ),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(
                            shiny::column(
                              4L, align = 'center',
                              Quantico:::SliderInput(InputID = paste0('SampleSize', PlotNumber), Label='Display Records (Post-Agg)', Step = 1000, Value = 15000, Min = 0, Max = 30000))
                          )
                        )
                      )
                    )
                  )
                )
              ),

              # Grouping Variables
              shiny::tabPanel(
                title = "Grouping Variables",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shiny::column(
                    6L, align = "center",
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = 'danger', width = AppWidth,
                      Quantico:::BlankRow(12L),
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(
                          width = 6L, align = 'center',
                          Quantico:::PickerInput(InputID = paste0('GroupVars', PlotNumber), Label='Select Group Variables', Choices = NULL, Multiple=TRUE)),
                        shiny::column(
                          width = 6L, align = 'center',
                          Quantico:::SelectizeInput(InputID = paste0('AggMethod', PlotNumber), Label='Aggregation Method', Choices = c('count','mean','mean(abs(x))','log(mean(x))','median','log(median(x))','median(abs(x))','sum','log(sum(x))','sum(abs(x))','sd','log(sd(x))','sd(abs(x))', 'skewness','skewness(abs(x))', 'kurtosis','kurtosis(abs(x))','CoeffVar','CoeffVar(abs(x))'), Multiple=TRUE, MaxVars = 100, CloseAfterSelect = TRUE))),
                      Quantico:::BlankRow(AppWidth),
                      shiny::fluidRow(
                        shiny::column(
                          width = 12L, align = 'center',
                          shiny::conditionalPanel(condition = paste0("length(input['GroupVars", PlotNumber, "']) >= 1"), Quantico:::PickerInput_GetLevels2(InputID = paste0('Levels_', PlotNumber, '_1'), Choices=NULL)))),
                      Quantico:::BlankRow(AppWidth),
                      shiny::fluidRow(
                        shiny::column(
                          width = 12L, align = 'center',
                          shiny::conditionalPanel(condition = paste0("length(input['GroupVars", PlotNumber, "']) >= 2"), Quantico:::PickerInput_GetLevels2(InputID = paste0('Levels_', PlotNumber, '_2'), Choices=NULL)))),
                      Quantico:::BlankRow(AppWidth),
                      shiny::fluidRow(
                        shiny::column(
                          width = 12L, align = 'center',
                          shiny::conditionalPanel(condition = paste0("length(input['GroupVars", PlotNumber, "']) >= 3"), Quantico:::PickerInput_GetLevels2(InputID = paste0('Levels_', PlotNumber, '_3'), Choices=NULL))))
                    ))
                )
              ),

              # Filter Variables
              shiny::tabPanel(
                title = "Filter Variables",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shiny::column(
                    12L, align = "center",
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = 'danger', width = AppWidth,
                      Quantico:::BlankRow(12L),
                      Quantico:::BlankRow(12L),
                      Quantico:::DataFilters(id = paste0('DataFiltersContents', PlotNumber), PlotNumber = PlotNumber)))
                )),

              # Title, Axes Titles, ShowLabels
              shiny::tabPanel(
                title = "Formatting",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shiny::column(
                    6L, align = "center",
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = 'danger', width = AppWidth,
                      Quantico:::BlankRow(12L),
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(
                          width = 6L, align = 'center',
                          Quantico:::TextInput(InputID = paste0('Title', PlotNumber), Label='Rename Title', Value = NULL)),
                        shiny::column(
                          width = 6L, align = 'center',
                          Quantico:::SelectizeInput(InputID = paste0('ShowLabels', PlotNumber), Label='Show Labels', Choices = c(TRUE,FALSE), Multiple=TRUE, MaxVars = 1, SelectedDefault = FALSE, CloseAfterSelect = TRUE))),
                      Quantico:::BlankRow(AppWidth),
                      shiny::fluidRow(
                        shiny::column(
                          width = 6L, align = 'center',
                          Quantico:::TextInput(InputID = paste0("YAxisTitle", PlotNumber), Label = "Rename Y-Axis Title", Value = NULL))),
                      Quantico:::BlankRow(AppWidth),
                      shiny::fluidRow(
                        shiny::column(
                          width = 6L, align = 'center',
                          Quantico:::TextInput(InputID = paste0("XAxisTitle", PlotNumber), Label = "Rename X-Axis Title", Value = NULL))),
                      Quantico:::BlankRow(AppWidth)
                    )
                  )
                )
              ))),

          footer = shiny::tagList(
            shiny::modalButton(label = "Cancel"),
            shiny::actionButton(paste0("BoxPlotOK", PlotNumber), "OK", width = '50px'))
        )
      )
    }
  )
}

#' @title Plots.Eval.Modal
#'
#' @description Plot Variables Modals
#'
#' @author Adrian Antico
#' @family Plotting Modals
#'
#' @param id = 'PlotVariablesModals'
#' @param PlotNumber 1
#' @param AppWidth = 12L
#'
#' @export
Plots.Eval.Modal <- function(id, PlotNumber, AppWidth=12L) {
  shiny::moduleServer(
    id = id,
    module = function(input, output, session) {
      ns <- session$ns
      shiny::showModal(
        shiny::modalDialog(
          title = 'Plot Inputs',
          size = "l",
          easyClose = FALSE,
          fade = TRUE,
          shiny::tagList(

            # Tabs
            shiny::tabsetPanel(
              id = paste0('Plot_TabPanel_', PlotNumber),
              selected = 'Data Selection',

              # Input Variables
              shiny::tabPanel(
                title = "Data Selection",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shiny::column(
                    12L, align = "center",
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = 'danger', width = AppWidth,
                      Quantico:::BlankRow(12L),
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(
                          12L,
                          shiny::fluidRow(
                            shiny::column(
                              4L, align = 'center',
                              Quantico:::SelectizeInput(InputID = paste0('Plot', PlotNumber, '_SelectData'), Label='Choose data set', Choices = NULL, Multiple = TRUE, MaxVars = 100)
                            )
                          ),
                          Quantico:::BlankRow(12L),
                          shiny::fluidRow(
                            shiny::column(
                              4L, align = 'center',
                              Quantico:::SliderInput(InputID = paste0('SampleSize', PlotNumber), Label='Display Records (Post-Agg)', Step = 1000, Value = 15000, Min = 0, Max = 30000))
                          )
                        )
                      )
                    )
                  )
                )
              ),

              # Axis Variables
              shiny::tabPanel(
                title = "Axis Variables",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shiny::column(
                    12L, align = "center",
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = 'danger', width = AppWidth,
                      Quantico:::BlankRow(12L),
                      Quantico::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(width = 6L, align = 'center', Quantico:::PickerInput(InputID = paste0('XVar', PlotNumber), Label = 'X-Variable', Choices = NULL, Multiple = TRUE)),
                        shiny::column(width = 6L, align = 'center', Quantico:::SelectizeInput(InputID = paste0('XVarTrans', PlotNumber), Label = 'X-Variable Transformation', Choices = c("Identity","Asinh","Log","LogPlus1","Sqrt","Asin","Logit","BoxCox","YeoJohnson"), Multiple = TRUE, MaxVars = 1, CloseAfterSelect = TRUE))
                      ),
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(width = 6L, align = 'center', Quantico:::PickerInput(InputID = paste0('YVar', PlotNumber), Label = 'Y-Variable', Choices = NULL, Multiple = TRUE)),
                        shiny::column(width = 6L, align = 'center', Quantico:::SelectizeInput(InputID = paste0('YVarTrans', PlotNumber), Label = 'Y-Variable Transformation', Choices = c("Identity","Asinh","Log","LogPlus1","Sqrt","Asin","Logit","BoxCox","YeoJohnson"), Multiple = TRUE, MaxVars = 1, CloseAfterSelect = TRUE))),
                      Quantico:::BlankRow(AppWidth),
                      shiny::fluidRow(
                        shiny::column(width = 6L, align = 'center', Quantico:::PickerInput(InputID = paste0('ZVar', PlotNumber), Label = 'Z-Variable', Choices = NULL, Multiple = TRUE)),
                        shiny::column(width = 6L, align = 'center', Quantico:::SelectizeInput(InputID = paste0('ZVarTrans', PlotNumber), Label = 'Z-Variable Transformation', Choices = c("Identity","Asinh","Log","LogPlus1","Sqrt","Asin","Logit","BoxCox","YeoJohnson"), Multiple = TRUE, MaxVars = 1, CloseAfterSelect = TRUE))
                      ),
                      Quantico:::BlankRow(AppWidth),
                      shiny::fluidRow(
                        shiny::column(width = 6L),
                        shiny::column(
                          width = 6L, align = 'center',
                          Quantico:::SelectizeInput(InputID = paste0('PlotDateAgg', PlotNumber), Label = 'Date Aggregration Level', Choices = c("as-is","second","minute","hour","day","week","month","quarter","year"), SelectedDefault = "as-is", Multiple = TRUE, MaxVars = 1, CloseAfterSelect = TRUE)
                        )
                      )
                    )
                  )
                )
              ),

              # Grouping Variables
              shiny::tabPanel(
                title = "Grouping Variables",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shiny::column(
                    6L, align = "center",
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = 'danger', width = AppWidth,
                      Quantico:::BlankRow(12L),
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(
                          width = 6L, align = 'center',
                          Quantico:::PickerInput(InputID = paste0('GroupVars', PlotNumber), Label='Select Group Variables', Choices = NULL, Multiple=TRUE)),
                        shiny::column(
                          width = 6L, align = 'center',
                          Quantico:::SelectizeInput(InputID = paste0('AggMethod', PlotNumber), Label='Aggregation Method', Choices = c('count','mean','mean(abs(x))','log(mean(x))','median','log(median(x))','median(abs(x))','sum','log(sum(x))','sum(abs(x))','sd','log(sd(x))','sd(abs(x))', 'skewness','skewness(abs(x))', 'kurtosis','kurtosis(abs(x))','CoeffVar','CoeffVar(abs(x))'), Multiple=TRUE, MaxVars = 100, CloseAfterSelect = TRUE))),
                      Quantico:::BlankRow(AppWidth),
                      shiny::fluidRow(
                        shiny::column(
                          width = 12L, align = 'center',
                          shiny::conditionalPanel(condition = paste0("length(input['GroupVars", PlotNumber, "']) >= 1"), Quantico:::PickerInput_GetLevels2(InputID = paste0('Levels_', PlotNumber, '_1'), Choices=NULL)))),
                      Quantico:::BlankRow(AppWidth),
                      shiny::fluidRow(
                        shiny::column(
                          width = 12L, align = 'center',
                          shiny::conditionalPanel(condition = paste0("length(input['GroupVars", PlotNumber, "']) >= 2"), Quantico:::PickerInput_GetLevels2(InputID = paste0('Levels_', PlotNumber, '_2'), Choices=NULL)))),
                      Quantico:::BlankRow(AppWidth),
                      shiny::fluidRow(
                        shiny::column(
                          width = 12L, align = 'center',
                          shiny::conditionalPanel(condition = paste0("length(input['GroupVars", PlotNumber, "']) >= 3"), Quantico:::PickerInput_GetLevels2(InputID = paste0('Levels_', PlotNumber, '_3'), Choices=NULL))))
                    )),

                  shiny::column(
                    6L, align = "center",
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = 'danger', width = AppWidth,
                      Quantico:::BlankRow(12L),
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(width = 12L, align = 'center', Quantico:::SliderInput(InputID = paste0('FacetRows', PlotNumber), Label='Max Rows Facet Grid', Step = 1, Value = 1, Min = 1, Max = 12))),
                      Quantico::BlankRow(12L),
                      Quantico::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(width = 12L, align = 'center', Quantico:::SliderInput(InputID = paste0('FacetCols', PlotNumber), Label='Max Columns Facet Grid', Step = 1, Value = 1, Min = 1, Max = 12))),
                      Quantico:::BlankRow(AppWidth))
                  )
                )
              ),

              # Filter Variables
              shiny::tabPanel(
                title = "Filter Variables",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shiny::column(
                    12L, align = "center",
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = 'danger', width = AppWidth,
                      Quantico:::BlankRow(12L),
                      Quantico:::BlankRow(12L),
                      Quantico:::DataFilters(id = paste0('DataFiltersContents', PlotNumber), PlotNumber = PlotNumber)))
                )),

              # Title, Axes Titles, ShowLabels
              shiny::tabPanel(
                title = "Formatting",
                icon = shiny::icon('code'),
                Quantico:::BlankRow(12L),
                shiny::fluidRow(
                  shiny::column(
                    6L, align = "center",
                    shinydashboard::box(
                      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = 'danger', width = AppWidth,
                      Quantico:::BlankRow(12L),
                      Quantico:::BlankRow(12L),
                      shiny::fluidRow(
                        shiny::column(
                          width = 6L, align = 'center',
                          Quantico:::TextInput(InputID = paste0('Title', PlotNumber), Label='Rename Title', Value = NULL)),
                        shiny::column(
                          width = 6L, align = 'center',
                          Quantico:::SelectizeInput(InputID = paste0('ShowLabels', PlotNumber), Label='Show Labels', Choices = c(TRUE,FALSE), Multiple=TRUE, MaxVars = 1, SelectedDefault = FALSE, CloseAfterSelect = TRUE))),
                      Quantico:::BlankRow(AppWidth),
                      shiny::fluidRow(
                        shiny::column(
                          width = 6L, align = 'center',
                          Quantico:::TextInput(InputID = paste0("YAxisTitle", PlotNumber), Label = "Rename Y-Axis Title", Value = NULL))),
                      Quantico:::BlankRow(AppWidth),
                      shiny::fluidRow(
                        shiny::column(
                          width = 6L, align = 'center',
                          Quantico:::TextInput(InputID = paste0("XAxisTitle", PlotNumber), Label = "Rename X-Axis Title", Value = NULL))),
                      Quantico:::BlankRow(AppWidth)
                    )
                  )
                )
              ))),

          footer = shiny::tagList(
            shiny::modalButton(label = "Cancel"),
            shiny::actionButton(paste0("BoxPlotOK", PlotNumber), "OK", width = '50px'))
        )
      )
    }
  )
}


# #' @title Plots.Stocks.Modal
# #'
# #' @description Plot Variables Modals
# #'
# #' @author Adrian Antico
# #' @family Plotting Modals
# #'
# #' @param id = 'PlotVariablesModals'
# #' @param PlotNumber 1
# #' @param AppWidth = 12L
# #'
# #' @export
# Plots.Stocks.Modal <- function(id, PlotNumber, AppWidth=12L) {
#   shiny::moduleServer(
#     id = id,
#     module = function(input, output, session) {
#       ns <- session$ns
#       shiny::showModal(
#         shiny::modalDialog(
#           title = 'Plot Inputs',
#           size = "l",
#           easyClose = FALSE,
#           fade = TRUE,
#           shiny::tagList(

#             # Tabs
#             shiny::tabsetPanel(
#               id = paste0('Plot_TabPanel_', PlotNumber),
#               selected = 'Axis Variables',

#               # Input Variables
#               shiny::tabPanel(
#                 title = "Axis Variables",
#                 icon = shiny::icon('code'),
#                 Quantico:::BlankRow(12L),

#                 shinydashboard::box(
#                   title = NULL, solidHeader = TRUE, collapsible = FALSE, status = 'danger', width = AppWidth,
#                   Quantico:::BlankRow(12L),

#                   shiny::fluidRow(
#                     shiny::column(
#                       6L, align = 'center',
#                       Quantico:::PickerInput(InputID = paste0('Symbols', PlotNumber), Label = 'Ticker Selection', Choices = NULL, Multiple = FALSE)),
#                     shiny::column(
#                       6L, align = 'center',
#                       shiny:::dateRangeInput(inputId = paste0('StockDateRange', PlotNumber), label = "Date Range:", startview = "month", start = as.character(Sys.Date()-365L), end = as.character(Sys.Date())))
#                   ),

#                   Quantico:::BlankRow(AppWidth),
#                   Quantico:::BlankRow(AppWidth),
#                   shiny::fluidRow(
#                     shiny::column(
#                       6L, align = 'center',
#                       Quantico:::SelectizeInput(InputID = paste0('StockMetric', PlotNumber), Label = 'Metric Selection', Choices = NULL, Multiple = TRUE, MaxVars = 1L)),
#                     shiny::column(
#                       6L, align = 'center',
#                       Quantico:::SelectizeInput(InputID = paste0('StockTimeAgg', PlotNumber), Label = "Time Aggregation", Choices = NULL))
#                   ),

#                 ))
#             ),

#             Quantico:::BlankRow(12L),
#             Quantico:::BlankRow(12L)),

#           footer = shiny::tagList(
#             shiny::modalButton(label = "Cancel"),
#             shiny::actionButton(paste0("BoxPlotOK", PlotNumber), "OK", width = '50px'))
#         )
#       )
#     })
# }

#' @title DataFilters
#'
#' @description Display a dropdown button with filter variables and other filter info needed for server
#'
#' @author Adrian Antico
#' @family Plotting Modals
#'
#' @param id = 'DataFilters'
#' @param PlotNumber = 1
#' @param H3Color = H3Color
#' @param H4Color = H4Color
#' @param Right = FALSE
#' @param Animate = TRUE
#' @param Status = 'custom'
#'
#' @export
DataFilters <- function(id='DataFiltersContents',
                        PlotNumber = 1,
                        H3Color = parent.frame()$H3Color,
                        H4Color = parent.frame()$H4Color,
                        Right = FALSE,
                        Animate = TRUE,
                        Status = 'custom') {

  ns <- shiny::NS(id)
  shiny::tagList(
    shiny::fluidRow(
      shiny::column(
        3L,
        shinydashboard::box(
          title = NULL, solidHeader = TRUE, collapsible = FALSE, status = "danger", width = 12L,
          shiny::fluidRow(shiny::column(12L, Quantico:::PickerInput(InputID = paste0('FilterVariable_', PlotNumber, '_1'), Label = 'Filter Variable 1', Choices = NULL, SelectedDefault = NULL, Multiple = TRUE, MaxVars = 2L))),
          Quantico::BlankRow(12L),
          Quantico::BlankRow(12L),
          shiny::fluidRow(shiny::column(12L, Quantico:::SelectizeInput(InputID = paste0('FilterLogic_', PlotNumber, '_1'), Label = 'Logical Operation', Choices = NULL, SelectedDefault = NULL, Multiple = TRUE, MaxVars = 1))),
          Quantico::BlankRow(12L),
          shiny::fluidRow(shiny::column(12L, Quantico:::PickerInput(InputID = paste0('FilterValue_', PlotNumber, '_1_1'), Label = "Value 1", Choices = NULL, SelectedDefault = NULL, Multiple = TRUE, MaxVars = 100))),
          Quantico::BlankRow(12L),
          shiny::fluidRow(shiny::column(12L, Quantico:::PickerInput(InputID = paste0('FilterValue_', PlotNumber, '_1_2'), Label = "Value 2", Choices = NULL, SelectedDefault = NULL, Multiple = TRUE, MaxVars = 100)))
        )
      ),

      shiny::column(
        3L,
        shinydashboard::box(
          title = NULL, solidHeader = TRUE, collapsible = FALSE, status = "danger", width = 12L,
          shiny::fluidRow(shiny::column(12L, Quantico:::PickerInput(InputID = paste0('FilterVariable_', PlotNumber, '_2'), Label = 'Filter Variable 2', Choices = NULL, SelectedDefault = NULL, Multiple = TRUE, MaxVars = 2L))),
          Quantico::BlankRow(12L),
          Quantico::BlankRow(12L),
          shiny::fluidRow(shiny::column(12L, Quantico:::SelectizeInput(InputID = paste0('FilterLogic_', PlotNumber, '_2'), Label = 'Logical Operation', Choices = NULL, SelectedDefault = NULL, Multiple = TRUE, MaxVars = 1))),
          Quantico::BlankRow(12L),
          shiny::fluidRow(shiny::column(12L, Quantico:::PickerInput(InputID = paste0('FilterValue_', PlotNumber, '_2_1'), Label = "Value 1", Choices = NULL, SelectedDefault = NULL, Multiple=TRUE, MaxVars = 100))),
          Quantico::BlankRow(12L),
          shiny::fluidRow(shiny::column(12L, Quantico:::PickerInput(InputID = paste0('FilterValue_', PlotNumber, '_2_2'), Label = "Value 2", Choices = NULL, SelectedDefault = NULL, Multiple=TRUE, MaxVars = 100)))
        )
      ),

      shiny::column(
        3L,
        shinydashboard::box(
          title = NULL, solidHeader = TRUE, collapsible = FALSE, status = "danger", width = 12L,
          shiny::fluidRow(shiny::column(12L, Quantico:::PickerInput(InputID = paste0('FilterVariable_', PlotNumber, '_3'), Label = 'Filter Variable 3', Choices = NULL, SelectedDefault = NULL, Multiple = TRUE, MaxVars = 2L))),
          Quantico::BlankRow(12L),
          Quantico::BlankRow(12L),
          shiny::fluidRow(shiny::column(12L, Quantico:::SelectizeInput(InputID = paste0('FilterLogic_', PlotNumber, '_3'), Label = 'Logical Operation', Choices = NULL, SelectedDefault = NULL, Multiple = TRUE, MaxVars = 1))),
          Quantico::BlankRow(12L),
          shiny::fluidRow(shiny::column(12L, Quantico:::PickerInput(InputID = paste0('FilterValue_', PlotNumber, '_3_1'), Label = "Value 1", Choices = NULL, SelectedDefault = NULL, Multiple = TRUE, MaxVars = 100))),
          Quantico::BlankRow(12L),
          shiny::fluidRow(shiny::column(12L, Quantico:::PickerInput(InputID = paste0('FilterValue_', PlotNumber, '_3_2'), Label = "Value 2", Choices = NULL, SelectedDefault = NULL, Multiple = TRUE, MaxVars = 100)))
        )
      ),

      shiny::column(
        3L,
        shinydashboard::box(
          title = NULL, solidHeader = TRUE, collapsible = FALSE, status = "danger", width = 12L,
          shiny::fluidRow(shiny::column(12L, Quantico:::PickerInput(InputID = paste0('FilterVariable_', PlotNumber, '_4'), Label = 'Filter Variable 4', Choices = NULL, SelectedDefault = NULL, Multiple = TRUE, MaxVars = 2L))),
          Quantico::BlankRow(12L),
          Quantico::BlankRow(12L),
          shiny::fluidRow(shiny::column(12L, Quantico:::SelectizeInput(InputID = paste0('FilterLogic_', PlotNumber, '_4'), Label = 'Logical Operation', Choices = NULL, SelectedDefault = NULL, Multiple = TRUE, MaxVars = 1L))),
          Quantico::BlankRow(12L),
          shiny::fluidRow(shiny::column(12L, Quantico:::PickerInput(InputID = paste0('FilterValue_', PlotNumber, '_4_1'), Label = "Value 1", Choices = NULL, Multiple = TRUE, MaxVars = 100))),
          Quantico::BlankRow(12L),
          shiny::fluidRow(shiny::column(12L, Quantico:::PickerInput(InputID = paste0('FilterValue_', PlotNumber, '_4_2'), Label = "Value 2", Choices = NULL, Multiple = TRUE, MaxVars = 100)))
        )
      ),

      # Add space so area underneath selected item remains inside the dropdown
      #   Otherwise, the dropdown closes prematurely
      Quantico:::BlankRow(12L),
      Quantico:::BlankRow(12L),
      Quantico:::BlankRow(12L),
      Quantico:::BlankRow(12L)
    )
  ) # end tagList
}

# ----

# ----

# @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ ----
# ::  Output Panels  ::                                                                                          ----
# @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ ----

#' @title PlotDropDownContents
#'
#' @description Display a plot dropdown button with a formatted input box for YVar, XVar, GroupVars, Levels1, Levels2, Levels3, FacetVar1, FacetVar2, SizeVar
#'
#' @author Adrian Antico
#' @family Output Panels
#'
#' @param id = 'PlotDropDown'
#' @param PlotNumber = 1L
#' @param Align = 'center'
#' @param DropDownRight = FALSE
#' @param Animate = TRUE
#' @param Status = 'custom'
#' @param H3Color = '#0088a7'
#'
#' @export
PlotDropDownContents <- function(id,
                                 PlotNumber = 1,
                                 Align='center',
                                 DropDownRight=FALSE,
                                 Animate=TRUE,
                                 Status='custom',
                                 H3Color = '#0088a7') {

  PlotList <- list()
  PlotList[["Distribution"]] <- c("", 'HistogramPlot','DensityPlot','BoxPlot','WordCloud','ProbabilityPlot')
  PlotList[["Aggregate"]] <- c('BarPlot','StackedBarPlot','BarPlot3D','HeatMapPlot','RadarPlot','PiePlot','DonutPlot','RosetypePlot')
  PlotList[["Time Series"]] <- c('LinePlot','AreaPlot','StepPlot','RiverPlot','Autocorrelation','PartialAutocorr')
  PlotList[["Relationship"]] <- c('CorrelogramPlot','ParallelPlot','ScatterPlot','ScatterPlot3D','CopulaPlot','CopulaPlot3D')
  PlotList[["Model Evaluation"]] <- c(
    'Residuals','ResidScatter',
    'PartialDependenceLine','PartialDependenceHeatMap',
    'CalibrationLine','CalibrationBox',
    'VariableImportance','ShapleyImportance',
    'ROCPlot','ConfusionMatrixHeatmap',
    'GainsPlot','LiftPlot')

  Height <- '43px'
  if((PlotNumber > 6L && PlotNumber <= 12L) || (PlotNumber > 18L && PlotNumber <= 24L) || (PlotNumber > 30L && PlotNumber <= 36L)) {
    DropDownRight <- TRUE
  }
  ns <- shiny::NS(id)
  if(Animate) Animate <- shinyWidgets::animateOptions(enter = "zoomIn", exit = "zoomOut", duration = 0.7)
  shiny::tagList(
    shiny::column(
      id = paste0("PlotDropDownContents", PlotNumber),
      width = 1L,
      align = 'center',
      style = "padding-left: 15px; padding-right: 15px;",
      Quantico::PickerInput(
        InputID = paste0("PlotID_", PlotNumber),
        Label = "",
        Choices = PlotList,
        SelectedDefault =  NULL,
        Multiple = FALSE,
        MaxVars = 1,
        PlotSelection = paste0("Plot", PlotNumber)),
      style = TextLabelStyle,
      shiny::actionButton(inputId = paste0('PlotDropDown', PlotNumber), label = "", icon = shiny::icon(name = "forward-step"), style = "width: 45px;")
    ) # end column
  ) # end tagList
}

#' @title PlotPanels
#'
#' @description Panels
#'
#' @author Adrian Antico
#' @family Output Panels
#'
#' @param id = 'PlotPanels'
#' @param AppWidth = 12L
#' @param Page numeric
#' @param NumPlotsAvailable numeric
#' @param DragulaChoices character
#'
#' @export
PlotPanels <- function(id, Page, NumPlotsAvailable, AppWidth=12L, DragulaChoices = NULL, PlotPanel = TRUE) {
  ns <- shiny::NS(id)
  shiny::tabPanel(
    title = paste0('Plots ',Page),
    icon = shiny::icon('chart-line'),
    Quantico::BlankRow(12L),
    shinydashboard::box(
      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = 'danger', width = 12L, class = "OutputPaneBox",
      style = "padding-top: 10px; min-height: 1540px; max-height: 1540px; overflow-x: clip; overflow-y:auto; margin-top: 1px; padding-left: 12px; background-color: #0000; border: 0px #0000 solid; box-shadow: 0px 0px 0px 0px #0000;",

      # Dragula, Plot Width / Height, Number Bins / Levels
      shiny::fluidRow(
        style = "padding-left: 8px;padding-right: 15px;padding-top: 8px;",
        shinydashboard::box(
          title = NULL, solidHeader = TRUE, collapsible = FALSE, status = 'warning', width = 12L, style = "padding-top: 5px",

          shiny::fluidRow(
            width=12L,
            style="padding-left: 15px; padding-top: 10px;",
            id = "PlotAddButtonsUILocation",
            lapply(seq_len(12L), function(x) {
              Quantico:::PlotDropDownContents(id='PlotDropDown', PlotNumber = x + (Page - 1L) * 12L,  Align='center', DropDownRight=FALSE, Animate=TRUE, Status='custom')
            })
          ),

          shiny::fluidRow(
            Quantico::BlankRow(12L),
            shiny::column(
              width = 5L, align = 'center',
              shiny::wellPanel(
                esquisse::dragulaInput(
                  inputId = paste0('PlotTypeDragula',Page),
                  label = tags$b('Move Top Row Boxes to Bottom Box to Display'),
                  targetsLabels = 'View',
                  boxStyle = "background-color: #bababa52;", #"display: inline !important;",#"background-color: gray;",
                  choices = "Plot1",
                  replace = FALSE, sourceLabel = 'Display Plots', height = "50px", ncolSource = 'auto'),
              )
            ),


            shiny::column(
              width = 1L, align = 'center',
              style = "padding-top: 15px; padding-left: 0px; padding-right: 0px; background-color: #0000;",
              shiny::fluidRow(
                shiny::actionButton(
                  inputId = paste0('TrendPlotExecute',Page),
                  label = "Run", icon = shiny::icon("chevron-right")),
              ),
              shiny::fluidRow(
                style = "padding-top: 30px;",
                shiny::actionButton(
                  inputId = paste0('PlottingMarkdownExecute',Page),
                  label = "Save", icon = shiny::icon("chevron-right")),
              ),
              shiny::tags$style(
                paste0(
                  "
                  #", paste0('TrendPlotExecute',Page), " {
                  padding-left: 0px;
                  padding-right: 0px;
                  background-color: #858a9c6e;
                  margin-top: 29px;
                  height: 50px;
                  width: 95px;
                  border-radius: 25px;
                  font-size: x-large;
                  }

                  #", paste0('TrendPlotExecute',Page), ":hover {
                  padding-left: 0px;
                  padding-right: 0px;
                  background-color: #858a9c6e;
                  margin-top: 29px;
                  height: 50px;
                  width: 95px;
                  box-shadow: 0px 0px 20px #858a9c6e;
                  border-radius: 25px;
                  font-size: x-large;
                  }
                  #", paste0('PlottingMarkdownExecute',Page), " {
                  padding-left: 0px;
                  padding-right: 0px;
                  background-color: #858a9c6e;
                  margin-top: 29px;
                  height: 50px;
                  width: 95px;
                  border-radius: 25px;
                  font-size: x-large;
                  }

                  #", paste0('PlottingMarkdownExecute',Page), ":hover {
                  padding-left: 0px;
                  padding-right: 0px;
                  background-color: #858a9c6e;
                  margin-top: 29px;
                  height: 50px;
                  width: 95px;
                  box-shadow: 0px 0px 20px #858a9c6e;
                  border-radius: 25px;
                  font-size: x-large;
                  }
                  "
                )
              )
            ),

            shiny::column(
              width = 2L, align = 'center',
              shiny::wellPanel(
                shiny::sliderInput(inputId = paste0("PlotWidth",Page), label = 'Plot Width', value = 1450, min = 100, max = 2800),
                shiny::sliderInput(inputId = paste0("PlotHeight",Page), label = 'Plot Height', value = 950, min = 100, max = 2800))),
            shiny::column(
              width = 2L, align = 'center',
              shiny::wellPanel(
                style = "min-height: 227px;",
                shiny::sliderInput(inputId = paste0("GridCols", Page), label = "Output Columns", min = 1L, max = 6L, value = 1L, step = 1L),
                shiny::sliderInput(inputId = paste0("Number_of_Bins",Page), label = 'Histogram Bins', value = 30, min = 0, max = 200))),
            shiny::column(
              width = 2L, align = 'center',
              shiny::wellPanel(
                shiny::sliderInput(inputId = paste0("Numer_of_Levels",Page), label = 'Group Levels', value = 75, min = 0, max = 100),
                shiny::sliderInput(inputId = paste0("FontSize",Page), label = 'Font Size', value = 14, min = 8, max = 30))))
        )),

      # Plotting Grid Output
      Quantico::BlankRow(12L),
      shiny::fluidRow(
        style = "padding-left: 9px; padding-right: 14px;",
        shiny::column(
          12L, align = 'center', id = paste0("PlottingExecute",Page),
          shiny::uiOutput(paste0("PlottingExecute", Page)))
      )
    )
  )
}

#' @title DataPanels
#'
#' @description Panels
#'
#' @author Adrian Antico
#' @family Data Wrangling
#'
#' @param id = 'DataPanels'
#' @param AppWidth = 12L
#' @param Page numeric
#' @param DL character
#'
#' @export
DataPanels <- function(id, Page, AppWidth=12L, DL = NULL) {
  ns <- shiny::NS(id)
  shiny::tabPanel(
    title = paste0('Tables ',Page),
    icon = shiny::icon('table'),
    Quantico::BlankRow(12L),
    shinydashboard::box(
      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = 'danger', width = 12L, class = "OutputPaneBox",
      style = "padding-top: 10px; min-height: 1540px; max-height: 1540px; overflow-x: clip; overflow-y:auto; margin-top: 1px; padding-left: 12px; background-color: #0000; border: 0px #0000 solid; box-shadow: 0px 0px 0px 0px #0000;",

      # Data Panel of Options
      shiny::fluidRow(
        style = "padding-left: 8px;padding-right: 15px;padding-top: 8px;",
        shinydashboard::box(
          title = NULL, solidHeader = TRUE, collapsible = FALSE, status = 'warning', width = 12L, style = "padding-top: 26px",
          shiny::column(
            width = 5L, align = 'center',
            shiny::wellPanel(
              style = "padding-top: 70px; min-height: 200px; ",
              Quantico::PickerInput(InputID = paste0('DataOutputSelection',Page), Label = 'Display Data', Choices = tryCatch(names(DL), error = function(x) NULL), Multiple = TRUE, MaxVars = 100L)),
          ),

          shiny::column(
            width = 1L, align = 'center',
            style = "padding-top: 65px; padding-left: 0px; padding-right: 0px; background-color: #0000;",
            shiny::fluidRow(
              shiny::actionButton(
                inputId = paste0('DataOutputExecute',Page),
                label = "Run", icon = shiny::icon("chevron-right")),
            ),
            # shiny::fluidRow(
            #   style = "padding-top: 30px;",
            #   shiny::actionButton(
            #     inputId = paste0('TablesMarkdownExecute',Page),
            #     label = "Save", icon = shiny::icon("chevron-right")),
            # ),
            shiny::tags$style(
              paste0(
                "
                  #", paste0('DataOutputExecute',Page), " {
                  padding-left: 0px;
                  padding-right: 0px;
                  background-color: #858a9c6e;
                  margin-top: 29px;
                  height: 50px;
                  width: 95px;
                  border-radius: 25px;
                  font-size: x-large;
                  }

                  #", paste0('DataOutputExecute',Page), ":hover {
                  padding-left: 0px;
                  padding-right: 0px;
                  background-color: #858a9c6e;
                  margin-top: 29px;
                  height: 50px;
                  width: 95px;
                  box-shadow: 0px 0px 20px #858a9c6e;
                  border-radius: 25px;
                  font-size: x-large;
                  }

                  "
              )
            )
          ),

          #", paste0('TablesMarkdownExecute',Page), " {
          # padding-left: 0px;
          # padding-right: 0px;
          # background-color: #858a9c6e;
          #   margin-top: 29px;
          # height: 50px;
          # width: 95px;
          # border-radius: 25px;
          # font-size: x-large;
          # }
          #
          # #", paste0('TablesMarkdownExecute',Page), ":hover {
          # padding-left: 0px;
          # padding-right: 0px;
          # background-color: #858a9c6e;
          #   margin-top: 29px;
          # height: 50px;
          # width: 95px;
          # box-shadow: 0px 0px 20px #858a9c6e;
          # border-radius: 25px;
          # font-size: x-large;
          # }


          shiny::column(
            width = 2L,
            align = 'left',
            shiny::wellPanel(
              style = "min-height: 200px; padding-top: 0px;",
              shiny::fluidRow(
                style = "padding-top: 60px; padding-bottom: 50px;",
                shiny::column(12L, align = "left", style = "padding-left: 30px;", shinyWidgets::materialSwitch(inputId = paste0("WrapText", Page), label = 'Wrap', status = "danger", right = FALSE, value = FALSE), shiny::tags$style("padding-left: 40px;"))
              ),
              shiny::fluidRow(
                shiny::column(12L, align = "left", style = "padding-left: 30px;", shinyWidgets::materialSwitch(inputId = paste0("Shuffle", Page), label = 'Shuffle', status = "danger", right = FALSE, value = FALSE), shiny::tags$style("padding-left: 40px;"))
              )
            )
          ),
          shiny::column(
            width = 2L,
            align = 'left',
            shiny::wellPanel(
              style = "min-height: 200px; padding-top: 0px;",
              shiny::fluidRow(
                style = "padding-top: 30px; padding-bottom: 10px;",
                shiny::column(12L, align = 'center', shiny::numericInput(inputId = paste0("MinRows", Page), label = 'Records per Page', value = 10, min = 10, max = 1000, step = 10))
              ),
              shiny::fluidRow(
                shiny::column(12L, align = 'center', shiny::numericInput(inputId = paste0("Number_of_Records", Page), label = 'Total Rows', value = 10000, min = 1000, max = 100000, 1000))
              )
            )
          ),
          shiny::column(
            width = 2L,
            align = 'left',
            shiny::wellPanel(
              style = "min-height: 200px; padding-top: 0px;",
              shiny::fluidRow(
                style = "padding-top: 30px; padding-bottom: 40px;",
                shiny::column(12L, align = 'center', shiny::numericInput(inputId = paste0("GridColsData", Page), label = "Columns", value = 1L, min = 1L, max = 6L))
              ),
              shiny::fluidRow(
                shiny::column(12L, align = "left", style = "padding-left: 30px;", shinyWidgets::materialSwitch(inputId = paste0("Compact", Page), label = 'Compact', status = "danger", right = FALSE, value = TRUE), shiny::tags$style("padding-left: 40px;"))
              )
            )
          )
        )
      ),

      # Output
      Quantico::BlankRow(12L),
      shiny::fluidRow(
        style = "padding-left: 9px; padding-right: 14px;",
        shiny::column(
          12L, align = 'center', id = "DataOutput1",
          shiny::uiOutput("DataOutput1"))
      )
    )
  )
}

#' @title MLPanels
#'
#' @description Panels
#'
#' @author Adrian Antico
#' @family Output Panels
#'
#' @param id = 'MLPanels'
#' @param AppWidth = 12L
#' @param Page numeric
#' @param DL numeric
#'
#' @export
MLPanels <- function(id, Page, AppWidth=12L, MOL = NULL) {
  ns <- shiny::NS(id)
  shiny::tabPanel(
    title = paste0('ML ',Page),
    icon = shiny::icon('wand-magic-sparkles'),

    Quantico::BlankRow(12L),
    shinydashboard::box(
      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = 'danger', width = 12L, class = "OutputPaneBox",
      style = "padding-top: 10px; min-height: 1540px; max-height: 1540px; overflow-x: clip; overflow-y:auto; margin-top: 1px; padding-left: 12px; background-color: #0000; border: 0px #0000 solid; box-shadow: 0px 0px 0px 0px #0000;",

      # ML Panel of Options
      shiny::fluidRow(
        style = "padding-left: 8px;padding-right: 15px;padding-top: 8px;",
        shinydashboard::box(
          title = NULL, solidHeader = TRUE, collapsible = FALSE, status = 'warning', width = 12L, style = "padding-top: 26px",
          shiny::column(
            width = 3L, align = 'center',
            shiny::wellPanel(
              style = "min-height: 200px; padding-top: 0px;",
              shiny::fluidRow(
                style = "padding-top: 30px; padding-bottom: 33px;",
                Quantico::PickerInput(InputID = paste0('MLReportsModelSelection',Page), Label = 'Model Selection', Choices = tryCatch({names(MOL)[which(substr(x = names(MOL), start = 1, stop = 3) %in% c("ML_"))]}, error = function(x) NULL), Multiple = FALSE, MaxVars = 1L)
              ),
              shiny::fluidRow(
                style = "padding-top: 5px; padding-bottom: 30px;",
                Quantico::PickerInput(InputID = paste0('MLOutputSelection',Page), Label = 'Evaluation Objects',
                                      Choices = c("Model Comparison Metrics", "Evaluation Plots", "Partial Dependence Plots"),
                                      SelectedDefault = c("Model Comparison Metrics", "Evaluation Plots", "Partial Dependence Plots"),
                                      Multiple = TRUE, MaxVars = 100L)
              )
            )
          ),

          shiny::column(
            width = 1L, align = 'center',
            style = "padding-top: 26px; padding-left: 0px; padding-right: 0px; background-color: #0000;",
            shiny::fluidRow(
              shiny::actionButton(
                inputId = paste0('MLOutputExecute',Page),
                label = "Run", icon = shiny::icon("chevron-right")),
            ),
            shiny::fluidRow(
              style = "padding-top: 30px;",
              shiny::actionButton(
                inputId = paste0('MLMarkdownExecute',Page),
                label = "Save", icon = shiny::icon("chevron-right")),
            ),
            shiny::tags$style(
              paste0(
                "
                  #", paste0('MLOutputExecute',Page), " {
                  padding-left: 0px;
                  padding-right: 0px;
                  background-color: #858a9c6e;
                  margin-top: 29px;
                  height: 50px;
                  width: 95px;
                  border-radius: 25px;
                  font-size: x-large;
                  }

                  #", paste0('MLOutputExecute',Page), ":hover {
                  padding-left: 0px;
                  padding-right: 0px;
                  background-color: #858a9c6e;
                  margin-top: 29px;
                  height: 50px;
                  width: 95px;
                  box-shadow: 0px 0px 20px #858a9c6e;
                  border-radius: 25px;
                  font-size: x-large;
                  }
                  #", paste0('MLMarkdownExecute',Page), " {
                  padding-left: 0px;
                  padding-right: 0px;
                  background-color: #858a9c6e;
                  margin-top: 29px;
                  height: 50px;
                  width: 95px;
                  border-radius: 25px;
                  font-size: x-large;
                  }

                  #", paste0('MLMarkdownExecute',Page), ":hover {
                  padding-left: 0px;
                  padding-right: 0px;
                  background-color: #858a9c6e;
                  margin-top: 29px;
                  height: 50px;
                  width: 95px;
                  box-shadow: 0px 0px 20px #858a9c6e;
                  border-radius: 25px;
                  font-size: x-large;
                  }
                  "
              )
            )
          ),

          shiny::column(
            width = 3L,
            align = 'left',
            shiny::wellPanel(
              style = "min-height: 262px; padding-top: 0px;",
              shiny::fluidRow(
                style = "padding-top: 32px; padding-bottom: 40px;",
                shiny::column(12L, align = "center", style = "padding-left: 30px;", Quantico::NumericInput(InputID = paste0("SampleSize", Page), Label = 'Sample Size', Value = 100000, Min = 1, Max = 10000000, Step = 10000)),
              ),
              shiny::fluidRow(
                shiny::column(12L, align = "center", style = "padding-left: 30px;", Quantico::PickerInput(InputID = paste0('PDPVariables',Page), Label = 'PDP Variables', Choices = NULL, Multiple = TRUE, MaxVars = 100L))
              )
            )
          ),

          shiny::column(
            width = 3L,
            align = 'left',
            shiny::wellPanel(
              style = "min-height: 262px; padding-top: 0px;",
              shiny::fluidRow(
                style = "padding-top: 32px; padding-bottom: 12px;",
                shiny::column(12L, align = "center", style = "padding-left: 30px;", Quantico::PickerInput(InputID = paste0("TrainDataInclude", Page), Label = 'Include Train Data?', Choices = c(TRUE,FALSE), SelectedDefault = FALSE, Multiple = FALSE)),
              ),
              Quantico::BlankRow(12L),
              shiny::fluidRow(
                shiny::column(12L, align = "center", style = "padding-left: 30px;", Quantico::PickerInput(InputID = paste0('GroupVariableInclude',Page), Label = 'By-Variable Include?', Choices = NULL, Multiple = TRUE, MaxVars = 1L))
              )
            )
          ),

          shiny::column(
            width = 2L,
            align = 'left',
            shiny::wellPanel(
              style = "min-height: 262px; padding-top: 0px;",
              shiny::fluidRow(
                style = "padding-top: 25px; padding-bottom: 15px;",
                shiny::column(12L, align = 'center', shiny::sliderInput(inputId = paste0("PlotWidtha",Page), label = 'Plot Width', value = 1450, min = 100, max = 2800))
              ),
              shiny::fluidRow(
                shiny::column(12L, align = "center", shiny::sliderInput(inputId = paste0("PlotHeighta",Page), label = 'Plot Height', value = 950, min = 100, max = 2800))
              )
            )
          )
        )
      ),

      # Output
      Quantico::BlankRow(12L),
      shiny::fluidRow(
        style = "padding-left: 9px; padding-right: 14px;",
        shiny::column(
          12L, align = 'center', id = "MLOutput1",
          shiny::uiOutput(paste0("MLOutput", Page))
        )
      )
    )
  )
}

#' @title InferencePanels
#'
#' @description Panels
#'
#' @author Adrian Antico
#' @family Output Panels
#'
#' @param id = 'InferencePanels'
#' @param AppWidth = 12L
#' @param Page numeric
#' @param DL numeric
#'
#' @export
InferencePanels <- function(id, Page, AppWidth=12L, IOL = NULL) {
  ns <- shiny::NS(id)
  shiny::tabPanel(
    title = paste0('Inference ',Page),
    icon = shiny::icon('wand-magic-sparkles'),

    Quantico::BlankRow(12L),
    shinydashboard::box(
      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = 'danger', width = 12L, class = "OutputPaneBox",
      style = "padding-top: 10px; min-height: 1540px; max-height: 1540px; overflow-x: clip; overflow-y:auto; margin-top: 1px; padding-left: 12px; background-color: #0000; border: 0px #0000 solid; box-shadow: 0px 0px 0px 0px #0000;",

      # ML Panel of Options
      shiny::fluidRow(
        style = "padding-left: 8px;padding-right: 15px;padding-top: 8px;",
        shinydashboard::box(
          title = NULL, solidHeader = TRUE, collapsible = FALSE, status = 'warning', width = 12L, style = "padding-top: 26px",
          shiny::column(
            width = 5L, align = 'center',
            shiny::wellPanel(
              style = "min-height: 240px; padding-top: 0px;",
              shiny::fluidRow(
                style = "padding-top: 78px; padding-bottom: 33px;",
                Quantico::PickerInput(InputID = paste0('InferenceReportsModelSelection',Page), Label = 'Inference Output', Choices = tryCatch({names(IOL)}, error = function(x) NULL), Multiple = FALSE, MaxVars = 1L)
              )
            )
          ),

          shiny::column(
            width = 1L, align = 'center',
            style = "padding-top: 73px; padding-left: 0px; padding-right: 0px; background-color: #0000;",
            shiny::fluidRow(
              shiny::actionButton(
                inputId = paste0('InferenceOutputExecute',Page),
                label = "Run", icon = shiny::icon("chevron-right")),
            ),
            # shiny::fluidRow(
            #   style = "padding-top: 30px;",
            #   shiny::actionButton(
            #     inputId = paste0('InferenceMarkdownExecute',Page),
            #     label = "Save", icon = shiny::icon("chevron-right")),
            # ),
            shiny::tags$style(
              paste0(
                "
                  #", paste0('InferenceOutputExecute',Page), " {
                  padding-left: 0px;
                  padding-right: 0px;
                  background-color: #858a9c6e;
                  margin-top: 29px;
                  height: 50px;
                  width: 95px;
                  border-radius: 25px;
                  font-size: x-large;
                  }

                  #", paste0('InferenceOutputExecute',Page), ":hover {
                  padding-left: 0px;
                  padding-right: 0px;
                  background-color: #858a9c6e;
                  margin-top: 29px;
                  height: 50px;
                  width: 95px;
                  box-shadow: 0px 0px 20px #858a9c6e;
                  border-radius: 25px;
                  font-size: x-large;
                  }"
              )
            )
          ),


          # #", paste0('InferenceMarkdownExecute',Page), " {
          # padding-left: 0px;
          # padding-right: 0px;
          # background-color: #858a9c6e;
          #   margin-top: 29px;
          # height: 50px;
          # width: 95px;
          # border-radius: 25px;
          # font-size: x-large;
          # }
          #
          # #", paste0('InferenceMarkdownExecute',Page), ":hover {
          # padding-left: 0px;
          # padding-right: 0px;
          # background-color: #858a9c6e;
          #   margin-top: 29px;
          # height: 50px;
          # width: 95px;
          # box-shadow: 0px 0px 20px #858a9c6e;
          # border-radius: 25px;
          # font-size: x-large;
          # }


          shiny::column(
            width = 2L,
            align = 'left',
            shiny::wellPanel(
              style = "min-height: 240px; padding-top: 0px;",
              shiny::fluidRow(
                style = "padding-top: 63px;",
                shiny::column(12L, align = "left", style = "padding-left: 30px;", shinyWidgets::materialSwitch(inputId = paste0("Striped", Page), label = 'Striped', status = "danger", right = FALSE, value = TRUE), shiny::tags$style("padding-left: 40px;"))
              ),
              shiny::fluidRow(
                style = "padding-top: 40px; padding-bottom: 20px;",
                shiny::column(12L, align = 'center', shiny::numericInput(inputId = paste0("MinRowsa", Page), label = 'Records per Page', value = 10, min = 10, max = 1000, step = 10))
              )
            )
          ),
          shiny::column(
            width = 2L,
            align = 'left',
            shiny::wellPanel(
              style = "min-height: 240px; padding-top: 0px;",
              shiny::fluidRow(
                style = "padding-top: 63px; padding-bottom: 68px",
                shiny::column(12L, align = "left", style = "padding-left: 30px;", shinyWidgets::materialSwitch(inputId = paste0("Compact", Page), label = 'Compact', status = "danger", right = FALSE, value = TRUE), shiny::tags$style("padding-left: 40px;"))
              ),
              shiny::fluidRow(
                shiny::column(12L, align = "left", style = "padding-left: 30px;", shinyWidgets::materialSwitch(inputId = paste0("Filterable", Page), label = 'Filterable', status = "danger", right = FALSE, value = TRUE), shiny::tags$style("padding-left: 40px;"))
              )
            )
          ),

          shiny::column(
            width = 2L,
            align = 'left',
            shiny::wellPanel(
              style = "min-height: 240px; padding-top: 0px;",
              shiny::fluidRow(
                style = "padding-top: 15px; padding-bottom: 15px;",
                shiny::column(12L, align = 'center', shiny::sliderInput(inputId = paste0("PlotWidthinf",Page), label = 'Plot Width', value = 1450, min = 100, max = 2800))
              ),
              shiny::fluidRow(
                shiny::column(12L, align = "center", shiny::sliderInput(inputId = paste0("PlotHeightinf",Page), label = 'Plot Height', value = 950, min = 100, max = 2800))
              )
            )
          )
        )
      ),

      # Output
      Quantico::BlankRow(12L),
      shiny::fluidRow(
        style = "padding-left: 9px; padding-right: 14px;",
        shiny::column(
          12L, align = 'center', id = "MLOutput1",
          shiny::uiOutput(paste0("InferenceOutput", Page))
        )
      )
    )
  )
}

#' @title EDAPanels
#'
#' @description Panels
#'
#' @author Adrian Antico
#' @family Output Panels
#'
#' @param id = 'EDAPanels'
#' @param AppWidth = 12L
#' @param Page numeric
#' @param DL numeric
#'
#' @export
EDAPanels <- function(id, Page, AppWidth=12L, DL = NULL) {
  ns <- shiny::NS(id)
  shiny::tabPanel(
    title = paste0('EDA ',Page),
    icon = shiny::icon('magnifying-glass'),
    Quantico::BlankRow(12L),
    shinydashboard::box(
      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = 'danger', width = 12L, class = "OutputPaneBox",
      style = "padding-top: 10px; min-height: 1540px; max-height: 1540px; overflow-x: clip; overflow-y:auto; margin-top: 1px; padding-left: 12px; background-color: #0000; border: 0px #0000 solid; box-shadow: 0px 0px 0px 0px #0000;",

      # Data Panel of Options
      shiny::fluidRow(
        style = "padding-left: 8px;padding-right: 15px;padding-top: 8px;",
        shinydashboard::box(
          title = NULL, solidHeader = TRUE, collapsible = FALSE, status = 'warning', width = 12L, style = "padding-top: 26px",
          shiny::column(
            width = 3L, align = 'center',
            shiny::wellPanel(
              style = "min-height: 200px; padding-top: 0px;",
              shiny::fluidRow(
                style = "padding-top: 30px; padding-bottom: 33px;",
                Quantico::PickerInput(InputID = paste0('EDAData',Page), Label = 'Data Selection', Choices = tryCatch(names(DL), error = function(x) NULL), Multiple = TRUE, MaxVars = 1L)
              ),
              shiny::fluidRow(
                style = "padding-top: 5px; padding-bottom: 30px;",
                Quantico::PickerInput(InputID = paste0('EDAUnivariateVars',Page), Label = 'Univariate Vars', Choices = NULL, Multiple = TRUE, MaxVars = 100L)
              )
            )
          ),


          shiny::column(
            width = 1L, align = 'center',
            style = "padding-top: 26px; padding-left: 0px; padding-right: 0px; background-color: #0000;",
            shiny::fluidRow(
              shiny::actionButton(
                inputId = paste0('EDAOutputExecute',Page),
                label = "Run", icon = shiny::icon("chevron-right")),
            ),
            shiny::fluidRow(
              style = "padding-top: 30px;",
              shiny::actionButton(
                inputId = paste0('EDAMarkdownExecute',Page),
                label = "Save", icon = shiny::icon("chevron-right")),
            ),
            shiny::tags$style(
              paste0(
                "
                  #", paste0('EDAOutputExecute',Page), " {
                  padding-left: 0px;
                  padding-right: 0px;
                  background-color: #858a9c6e;
                  margin-top: 29px;
                  height: 50px;
                  width: 95px;
                  border-radius: 25px;
                  font-size: x-large;
                  }

                  #", paste0('EDAOutputExecute',Page), ":hover {
                  padding-left: 0px;
                  padding-right: 0px;
                  background-color: #858a9c6e;
                  margin-top: 29px;
                  height: 50px;
                  width: 95px;
                  box-shadow: 0px 0px 20px #858a9c6e;
                  border-radius: 25px;
                  font-size: x-large;
                  }
                  #", paste0('EDAMarkdownExecute',Page), " {
                  padding-left: 0px;
                  padding-right: 0px;
                  background-color: #858a9c6e;
                  margin-top: 29px;
                  height: 50px;
                  width: 95px;
                  border-radius: 25px;
                  font-size: x-large;
                  }

                  #", paste0('EDAMarkdownExecute',Page), ":hover {
                  padding-left: 0px;
                  padding-right: 0px;
                  background-color: #858a9c6e;
                  margin-top: 29px;
                  height: 50px;
                  width: 95px;
                  box-shadow: 0px 0px 20px #858a9c6e;
                  border-radius: 25px;
                  font-size: x-large;
                  }
                  "
              )
            )
          ),

          shiny::column(
            width = 3L,
            align = 'left',
            shiny::wellPanel(
              style = "min-height: 262px; padding-top: 0px;",
              shiny::fluidRow(
                style = "padding-top: 32px; padding-bottom: 40px;",
                shiny::column(12L, align = "center", style = "padding-left: 30px;", Quantico::PickerInput(InputID = paste0("EDACorrVars", Page), Label = 'Corr Vars', Choices = NULL, Multiple = TRUE, MaxVars = 100L))
              ),
              shiny::fluidRow(
                shiny::column(12L, align = "center", style = "padding-left: 30px;", Quantico::PickerInput(InputID = paste0('EDATrendVars',Page), Label = 'Trend Vars', Choices = NULL, Multiple = TRUE, MaxVars = 100L))
              )
            )
          ),

          shiny::column(
            width = 3L,
            align = 'left',
            shiny::wellPanel(
              style = "min-height: 262px; padding-top: 0px;",
              shiny::fluidRow(
                style = "padding-top: 32px; padding-bottom: 35px;",
                shiny::column(12L, align = "center", style = "padding-left: 30px;", Quantico::PickerInput(InputID = paste0("EDADateVar", Page), Label = 'Trend Date Var', Choices = NULL, SelectedDefault = NULL, Multiple = TRUE, MaxVars = 1L)),
              ),
              shiny::fluidRow(
                shiny::column(12L, align = "center", style = "padding-left: 30px;", Quantico::PickerInput(InputID = paste0('EDAGroupVar',Page), Label = 'By-Variable', Choices = NULL, Multiple = TRUE, MaxVars = 1L))
              )
            )
          ),

          shiny::column(
            width = 2L,
            align = 'left',
            shiny::wellPanel(
              style = "min-height: 262px; padding-top: 0px;",
              shiny::fluidRow(
                style = "padding-top: 25px; padding-bottom: 15px;",
                shiny::column(12L, align = 'center', shiny::sliderInput(inputId = paste0("PlotWidtheda",Page), label = 'Plot Width', value = 1450, min = 100, max = 2800))
              ),
              shiny::fluidRow(
                shiny::column(12L, align = "center", shiny::sliderInput(inputId = paste0("PlotHeighteda",Page), label = 'Plot Height', value = 950, min = 100, max = 2800))
              )
            )
          )
        )
      ),

      # Output
      Quantico::BlankRow(12L),
      shiny::fluidRow(
        style = "padding-left: 9px; padding-right: 14px;",
        shiny::column(
          12L, align = 'center', id = "EDAOutput1",
          shiny::uiOutput(paste0("EDAOutput", Page))
        )
      )
    )
  )
}

#' @title FCPanels
#'
#' @description Panels
#'
#' @author Adrian Antico
#' @family Output Panels
#'
#' @param id = 'FCPanels'
#' @param AppWidth = 12L
#' @param Page numeric
#' @param DL numeric
#'
#' @export
FCPanels <- function(id, Page, AppWidth=12L, IOL = NULL) {
  ns <- shiny::NS(id)
  shiny::tabPanel(
    title = paste0('FC ',Page),
    icon = shiny::icon('wand-magic-sparkles'),

    Quantico::BlankRow(12L),
    shinydashboard::box(
      title = NULL, solidHeader = TRUE, collapsible = FALSE, status = 'danger', width = 12L, class = "OutputPaneBox",
      style = "padding-top: 10px; min-height: 1540px; max-height: 1540px; overflow-x: clip; overflow-y:auto; margin-top: 1px; padding-left: 12px; background-color: #0000; border: 0px #0000 solid; box-shadow: 0px 0px 0px 0px #0000;",

      # ML Panel of Options
      shiny::fluidRow(
        style = "padding-left: 8px;padding-right: 15px;padding-top: 8px;",
        shinydashboard::box(
          title = NULL, solidHeader = TRUE, collapsible = FALSE, status = 'warning', width = 12L, style = "padding-top: 26px",
          shiny::column(
            width = 5L, align = 'center',
            shiny::wellPanel(
              style = "min-height: 240px; padding-top: 0px;",
              shiny::fluidRow(
                style = "padding-top: 78px; padding-bottom: 33px;",
                Quantico::PickerInput(InputID = paste0('FCReportsModelSelection',Page), Label = 'FC Output', Choices = tryCatch({names(IOL)}, error = function(x) NULL), Multiple = FALSE, MaxVars = 1L)
              )
            )
          ),

          shiny::column(
            width = 1L, align = 'center',
            style = "padding-top: 73px; padding-left: 0px; padding-right: 0px; background-color: #0000;",
            shiny::fluidRow(
              shiny::actionButton(
                inputId = paste0('FCOutputExecute',Page),
                label = "Run", icon = shiny::icon("chevron-right")),
            ),
            # shiny::fluidRow(
            #   style = "padding-top: 30px;",
            #   shiny::actionButton(
            #     inputId = paste0('FCMarkdownExecute',Page),
            #     label = "Save", icon = shiny::icon("chevron-right")),
            # ),
            shiny::tags$style(
              paste0(
                "
                  #", paste0('FCOutputExecute',Page), " {
                  padding-left: 0px;
                  padding-right: 0px;
                  background-color: #858a9c6e;
                  margin-top: 29px;
                  height: 50px;
                  width: 95px;
                  border-radius: 25px;
                  font-size: x-large;
                  }

                  #", paste0('FCOutputExecute',Page), ":hover {
                  padding-left: 0px;
                  padding-right: 0px;
                  background-color: #858a9c6e;
                  margin-top: 29px;
                  height: 50px;
                  width: 95px;
                  box-shadow: 0px 0px 20px #858a9c6e;
                  border-radius: 25px;
                  font-size: x-large;
                  }"
              )
            )
          ),


          # #", paste0('FCMarkdownExecute',Page), " {
          # padding-left: 0px;
          # padding-right: 0px;
          # background-color: #858a9c6e;
          #   margin-top: 29px;
          # height: 50px;
          # width: 95px;
          # border-radius: 25px;
          # font-size: x-large;
          # }
          #
          # #", paste0('FCMarkdownExecute',Page), ":hover {
          # padding-left: 0px;
          # padding-right: 0px;
          # background-color: #858a9c6e;
          #   margin-top: 29px;
          # height: 50px;
          # width: 95px;
          # box-shadow: 0px 0px 20px #858a9c6e;
          # border-radius: 25px;
          # font-size: x-large;
          # }


          shiny::column(
            width = 2L,
            align = 'left',
            shiny::wellPanel(
              style = "min-height: 240px; padding-top: 0px;",
              shiny::fluidRow(
                style = "padding-top: 63px;",
                shiny::column(12L, align = "left", style = "padding-left: 30px;", shinyWidgets::materialSwitch(inputId = paste0("Striped", Page), label = 'Striped', status = "danger", right = FALSE, value = TRUE), shiny::tags$style("padding-left: 40px;"))
              ),
              shiny::fluidRow(
                style = "padding-top: 40px; padding-bottom: 20px;",
                shiny::column(12L, align = 'center', shiny::numericInput(inputId = paste0("MinRowsa", Page), label = 'Records per Page', value = 10, min = 10, max = 1000, step = 10))
              )
            )
          ),
          shiny::column(
            width = 2L,
            align = 'left',
            shiny::wellPanel(
              style = "min-height: 240px; padding-top: 0px;",
              shiny::fluidRow(
                style = "padding-top: 63px; padding-bottom: 68px",
                shiny::column(12L, align = "left", style = "padding-left: 30px;", shinyWidgets::materialSwitch(inputId = paste0("Compact", Page), label = 'Compact', status = "danger", right = FALSE, value = TRUE), shiny::tags$style("padding-left: 40px;"))
              ),
              shiny::fluidRow(
                shiny::column(12L, align = "left", style = "padding-left: 30px;", shinyWidgets::materialSwitch(inputId = paste0("Filterable", Page), label = 'Filterable', status = "danger", right = FALSE, value = TRUE), shiny::tags$style("padding-left: 40px;"))
              )
            )
          ),

          shiny::column(
            width = 2L,
            align = 'left',
            shiny::wellPanel(
              style = "min-height: 240px; padding-top: 0px;",
              shiny::fluidRow(
                style = "padding-top: 15px; padding-bottom: 15px;",
                shiny::column(12L, align = 'center', shiny::sliderInput(inputId = paste0("PlotWidthinf",Page), label = 'Plot Width', value = 1450, min = 100, max = 2800))
              ),
              shiny::fluidRow(
                shiny::column(12L, align = "center", shiny::sliderInput(inputId = paste0("PlotHeightinf",Page), label = 'Plot Height', value = 950, min = 100, max = 2800))
              )
            )
          )
        )
      ),

      # Output
      Quantico::BlankRow(12L),
      shiny::fluidRow(
        style = "padding-left: 9px; padding-right: 14px;",
        shiny::column(
          12L, align = 'center', id = "MLOutput1",
          shiny::uiOutput(paste0("FCOutput", Page))
        )
      )
    )
  )
}

# ----

# ----
